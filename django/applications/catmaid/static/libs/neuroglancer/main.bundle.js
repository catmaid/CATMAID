!function(e){function t(t){for(var n,r,s=t[0],o=t[1],a=0,c=[];a<s.length;a++)r=s[a],i[r]&&c.push(i[r][0]),i[r]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);for(l&&l(t);c.length;)c.shift()()}var n={},i={0:0};function r(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var s=new Promise(function(t,r){n=i[e]=[t,r]});t.push(n[2]=s);var o,a=document.createElement("script");a.charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.src=function(e){return r.p+""+({1:"tfjs-library"}[e]||e)+".bundle.js"}(e),o=function(t){a.onerror=a.onload=null,clearTimeout(l);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src,o=new Error("Loading chunk "+e+" failed.\n("+r+": "+s+")");o.type=r,o.request=s,n[1](o)}i[e]=void 0}};var l=setTimeout(function(){o({type:"timeout",target:a})},12e4);a.onerror=a.onload=o,document.head.appendChild(a)}return Promise.all(t)},r.m=e,r.c=n,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.oe=function(e){throw console.error(e),e};var s=window.webpackJsonp=window.webpackJsonp||[],o=s.push.bind(s);s.push=t,s=s.slice();for(var a=0;a<s.length;a++)t(s[a]);var l=o;r(r.s=134)}([function(e,t,n){"use strict";var i={};n.r(i),n.d(i,"create",function(){return h}),n.d(i,"fromMat4",function(){return p}),n.d(i,"clone",function(){return f}),n.d(i,"copy",function(){return g}),n.d(i,"fromValues",function(){return m}),n.d(i,"set",function(){return v}),n.d(i,"identity",function(){return b}),n.d(i,"transpose",function(){return y}),n.d(i,"invert",function(){return w}),n.d(i,"adjoint",function(){return x}),n.d(i,"determinant",function(){return S}),n.d(i,"multiply",function(){return C}),n.d(i,"translate",function(){return O}),n.d(i,"rotate",function(){return L}),n.d(i,"scale",function(){return T}),n.d(i,"fromTranslation",function(){return k}),n.d(i,"fromRotation",function(){return E}),n.d(i,"fromScaling",function(){return A}),n.d(i,"fromMat2d",function(){return M}),n.d(i,"fromQuat",function(){return I}),n.d(i,"normalFromMat4",function(){return N}),n.d(i,"projection",function(){return D}),n.d(i,"str",function(){return R}),n.d(i,"frob",function(){return P}),n.d(i,"add",function(){return j}),n.d(i,"subtract",function(){return V}),n.d(i,"multiplyScalar",function(){return _}),n.d(i,"multiplyScalarAndAdd",function(){return U}),n.d(i,"exactEquals",function(){return F}),n.d(i,"equals",function(){return z}),n.d(i,"mul",function(){return B}),n.d(i,"sub",function(){return G});var r={};n.r(r),n.d(r,"create",function(){return W}),n.d(r,"clone",function(){return $}),n.d(r,"copy",function(){return H}),n.d(r,"fromValues",function(){return q}),n.d(r,"set",function(){return Y}),n.d(r,"identity",function(){return J}),n.d(r,"transpose",function(){return X}),n.d(r,"invert",function(){return K}),n.d(r,"adjoint",function(){return Q}),n.d(r,"determinant",function(){return Z}),n.d(r,"multiply",function(){return ee}),n.d(r,"translate",function(){return te}),n.d(r,"scale",function(){return ne}),n.d(r,"rotate",function(){return ie}),n.d(r,"rotateX",function(){return re}),n.d(r,"rotateY",function(){return se}),n.d(r,"rotateZ",function(){return oe}),n.d(r,"fromTranslation",function(){return ae}),n.d(r,"fromScaling",function(){return le}),n.d(r,"fromRotation",function(){return ce}),n.d(r,"fromXRotation",function(){return ue}),n.d(r,"fromYRotation",function(){return de}),n.d(r,"fromZRotation",function(){return he}),n.d(r,"fromRotationTranslation",function(){return pe}),n.d(r,"fromQuat2",function(){return fe}),n.d(r,"getTranslation",function(){return ge}),n.d(r,"getScaling",function(){return me}),n.d(r,"getRotation",function(){return ve}),n.d(r,"fromRotationTranslationScale",function(){return be}),n.d(r,"fromRotationTranslationScaleOrigin",function(){return ye}),n.d(r,"fromQuat",function(){return we}),n.d(r,"frustum",function(){return xe}),n.d(r,"perspective",function(){return Se}),n.d(r,"perspectiveFromFieldOfView",function(){return Ce}),n.d(r,"ortho",function(){return Oe}),n.d(r,"lookAt",function(){return Le}),n.d(r,"targetTo",function(){return Te}),n.d(r,"str",function(){return ke}),n.d(r,"frob",function(){return Ee}),n.d(r,"add",function(){return Ae}),n.d(r,"subtract",function(){return Me}),n.d(r,"multiplyScalar",function(){return Ie}),n.d(r,"multiplyScalarAndAdd",function(){return Ne}),n.d(r,"exactEquals",function(){return De}),n.d(r,"equals",function(){return Re}),n.d(r,"mul",function(){return Pe}),n.d(r,"sub",function(){return je});var s={};n.r(s),n.d(s,"create",function(){return Ve}),n.d(s,"clone",function(){return _e}),n.d(s,"length",function(){return Ue}),n.d(s,"fromValues",function(){return Fe}),n.d(s,"copy",function(){return ze}),n.d(s,"set",function(){return Be}),n.d(s,"add",function(){return Ge}),n.d(s,"subtract",function(){return We}),n.d(s,"multiply",function(){return $e}),n.d(s,"divide",function(){return He}),n.d(s,"ceil",function(){return qe}),n.d(s,"floor",function(){return Ye}),n.d(s,"min",function(){return Je}),n.d(s,"max",function(){return Xe}),n.d(s,"round",function(){return Ke}),n.d(s,"scale",function(){return Qe}),n.d(s,"scaleAndAdd",function(){return Ze}),n.d(s,"distance",function(){return et}),n.d(s,"squaredDistance",function(){return tt}),n.d(s,"squaredLength",function(){return nt}),n.d(s,"negate",function(){return it}),n.d(s,"inverse",function(){return rt}),n.d(s,"normalize",function(){return st}),n.d(s,"dot",function(){return ot}),n.d(s,"cross",function(){return at}),n.d(s,"lerp",function(){return lt}),n.d(s,"hermite",function(){return ct}),n.d(s,"bezier",function(){return ut}),n.d(s,"random",function(){return dt}),n.d(s,"transformMat4",function(){return ht}),n.d(s,"transformMat3",function(){return pt}),n.d(s,"transformQuat",function(){return ft}),n.d(s,"rotateX",function(){return gt}),n.d(s,"rotateY",function(){return mt}),n.d(s,"rotateZ",function(){return vt}),n.d(s,"angle",function(){return bt}),n.d(s,"zero",function(){return yt}),n.d(s,"str",function(){return wt}),n.d(s,"exactEquals",function(){return xt}),n.d(s,"equals",function(){return St}),n.d(s,"sub",function(){return Ot}),n.d(s,"mul",function(){return Lt}),n.d(s,"div",function(){return Tt}),n.d(s,"dist",function(){return kt}),n.d(s,"sqrDist",function(){return Et}),n.d(s,"len",function(){return At}),n.d(s,"sqrLen",function(){return Mt}),n.d(s,"forEach",function(){return It});var o={};n.r(o),n.d(o,"create",function(){return Nt}),n.d(o,"clone",function(){return Dt}),n.d(o,"fromValues",function(){return Rt}),n.d(o,"copy",function(){return Pt}),n.d(o,"set",function(){return jt}),n.d(o,"add",function(){return Vt}),n.d(o,"subtract",function(){return _t}),n.d(o,"multiply",function(){return Ut}),n.d(o,"divide",function(){return Ft}),n.d(o,"ceil",function(){return zt}),n.d(o,"floor",function(){return Bt}),n.d(o,"min",function(){return Gt}),n.d(o,"max",function(){return Wt}),n.d(o,"round",function(){return $t}),n.d(o,"scale",function(){return Ht}),n.d(o,"scaleAndAdd",function(){return qt}),n.d(o,"distance",function(){return Yt}),n.d(o,"squaredDistance",function(){return Jt}),n.d(o,"length",function(){return Xt}),n.d(o,"squaredLength",function(){return Kt}),n.d(o,"negate",function(){return Qt}),n.d(o,"inverse",function(){return Zt}),n.d(o,"normalize",function(){return en}),n.d(o,"dot",function(){return tn}),n.d(o,"cross",function(){return nn}),n.d(o,"lerp",function(){return rn}),n.d(o,"random",function(){return sn}),n.d(o,"transformMat4",function(){return on}),n.d(o,"transformQuat",function(){return an}),n.d(o,"zero",function(){return ln}),n.d(o,"str",function(){return cn}),n.d(o,"exactEquals",function(){return un}),n.d(o,"equals",function(){return dn}),n.d(o,"sub",function(){return hn}),n.d(o,"mul",function(){return pn}),n.d(o,"div",function(){return fn}),n.d(o,"dist",function(){return gn}),n.d(o,"sqrDist",function(){return mn}),n.d(o,"len",function(){return vn}),n.d(o,"sqrLen",function(){return bn}),n.d(o,"forEach",function(){return yn});var a={};n.r(a),n.d(a,"create",function(){return wn}),n.d(a,"identity",function(){return xn}),n.d(a,"setAxisAngle",function(){return Sn}),n.d(a,"getAxisAngle",function(){return Cn}),n.d(a,"multiply",function(){return On}),n.d(a,"rotateX",function(){return Ln}),n.d(a,"rotateY",function(){return Tn}),n.d(a,"rotateZ",function(){return kn}),n.d(a,"calculateW",function(){return En}),n.d(a,"slerp",function(){return An}),n.d(a,"random",function(){return Mn}),n.d(a,"invert",function(){return In}),n.d(a,"conjugate",function(){return Nn}),n.d(a,"fromMat3",function(){return Dn}),n.d(a,"fromEuler",function(){return Rn}),n.d(a,"str",function(){return Pn}),n.d(a,"clone",function(){return Bn}),n.d(a,"fromValues",function(){return Gn}),n.d(a,"copy",function(){return Wn}),n.d(a,"set",function(){return $n}),n.d(a,"add",function(){return Hn}),n.d(a,"mul",function(){return qn}),n.d(a,"scale",function(){return Yn}),n.d(a,"dot",function(){return Jn}),n.d(a,"lerp",function(){return Xn}),n.d(a,"length",function(){return Kn}),n.d(a,"len",function(){return Qn}),n.d(a,"squaredLength",function(){return Zn}),n.d(a,"sqrLen",function(){return ei}),n.d(a,"normalize",function(){return ti}),n.d(a,"exactEquals",function(){return ni}),n.d(a,"equals",function(){return ii}),n.d(a,"rotationTo",function(){return ri}),n.d(a,"sqlerp",function(){return si}),n.d(a,"setAxes",function(){return oi});var l={};n.r(l),n.d(l,"create",function(){return ai}),n.d(l,"clone",function(){return li}),n.d(l,"fromValues",function(){return ci}),n.d(l,"copy",function(){return ui}),n.d(l,"set",function(){return di}),n.d(l,"add",function(){return hi}),n.d(l,"subtract",function(){return pi}),n.d(l,"multiply",function(){return fi}),n.d(l,"divide",function(){return gi}),n.d(l,"ceil",function(){return mi}),n.d(l,"floor",function(){return vi}),n.d(l,"min",function(){return bi}),n.d(l,"max",function(){return yi}),n.d(l,"round",function(){return wi}),n.d(l,"scale",function(){return xi}),n.d(l,"scaleAndAdd",function(){return Si}),n.d(l,"distance",function(){return Ci}),n.d(l,"squaredDistance",function(){return Oi}),n.d(l,"length",function(){return Li}),n.d(l,"squaredLength",function(){return Ti}),n.d(l,"negate",function(){return ki}),n.d(l,"inverse",function(){return Ei}),n.d(l,"normalize",function(){return Ai}),n.d(l,"dot",function(){return Mi}),n.d(l,"cross",function(){return Ii}),n.d(l,"lerp",function(){return Ni}),n.d(l,"random",function(){return Di}),n.d(l,"transformMat2",function(){return Ri}),n.d(l,"transformMat2d",function(){return Pi}),n.d(l,"transformMat3",function(){return ji}),n.d(l,"transformMat4",function(){return Vi}),n.d(l,"rotate",function(){return _i}),n.d(l,"angle",function(){return Ui}),n.d(l,"zero",function(){return Fi}),n.d(l,"str",function(){return zi}),n.d(l,"exactEquals",function(){return Bi}),n.d(l,"equals",function(){return Gi}),n.d(l,"len",function(){return Wi}),n.d(l,"sub",function(){return $i}),n.d(l,"mul",function(){return Hi}),n.d(l,"div",function(){return qi}),n.d(l,"dist",function(){return Yi}),n.d(l,"sqrDist",function(){return Ji}),n.d(l,"sqrLen",function(){return Xi}),n.d(l,"forEach",function(){return Ki});var c=1e-6,u="undefined"!=typeof Float32Array?Float32Array:Array,d=Math.random;Math.PI;function h(){var e=new u(9);return u!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function p(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function f(e){var t=new u(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function g(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function m(e,t,n,i,r,s,o,a,l){var c=new u(9);return c[0]=e,c[1]=t,c[2]=n,c[3]=i,c[4]=r,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c}function v(e,t,n,i,r,s,o,a,l,c){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function b(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function y(e,t){if(e===t){var n=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function w(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=u*o-a*c,h=-u*s+a*l,p=c*s-o*l,f=n*d+i*h+r*p;return f?(f=1/f,e[0]=d*f,e[1]=(-u*i+r*c)*f,e[2]=(a*i-r*o)*f,e[3]=h*f,e[4]=(u*n-r*l)*f,e[5]=(-a*n+r*s)*f,e[6]=p*f,e[7]=(-c*n+i*l)*f,e[8]=(o*n-i*s)*f,e):null}function x(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=o*u-a*c,e[1]=r*c-i*u,e[2]=i*a-r*o,e[3]=a*l-s*u,e[4]=n*u-r*l,e[5]=r*s-n*a,e[6]=s*c-o*l,e[7]=i*l-n*c,e[8]=n*o-i*s,e}function S(e){var t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*s-o*l)+n*(-c*r+o*a)+i*(l*r-s*a)}function C(e,t,n){var i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=n[0],p=n[1],f=n[2],g=n[3],m=n[4],v=n[5],b=n[6],y=n[7],w=n[8];return e[0]=h*i+p*o+f*c,e[1]=h*r+p*a+f*u,e[2]=h*s+p*l+f*d,e[3]=g*i+m*o+v*c,e[4]=g*r+m*a+v*u,e[5]=g*s+m*l+v*d,e[6]=b*i+y*o+w*c,e[7]=b*r+y*a+w*u,e[8]=b*s+y*l+w*d,e}function O(e,t,n){var i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=n[0],p=n[1];return e[0]=i,e[1]=r,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=h*i+p*o+c,e[7]=h*r+p*a+u,e[8]=h*s+p*l+d,e}function L(e,t,n){var i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=Math.sin(n),p=Math.cos(n);return e[0]=p*i+h*o,e[1]=p*r+h*a,e[2]=p*s+h*l,e[3]=p*o-h*i,e[4]=p*a-h*r,e[5]=p*l-h*s,e[6]=c,e[7]=u,e[8]=d,e}function T(e,t,n){var i=n[0],r=n[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function k(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function E(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function A(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function M(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function I(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,d=i*a,h=r*o,p=r*a,f=r*l,g=s*o,m=s*a,v=s*l;return e[0]=1-d-f,e[3]=u-v,e[6]=h+m,e[1]=u+v,e[4]=1-c-f,e[7]=p-g,e[2]=h-m,e[5]=p+g,e[8]=1-c-d,e}function N(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],p=t[11],f=t[12],g=t[13],m=t[14],v=t[15],b=n*a-i*o,y=n*l-r*o,w=n*c-s*o,x=i*l-r*a,S=i*c-s*a,C=r*c-s*l,O=u*g-d*f,L=u*m-h*f,T=u*v-p*f,k=d*m-h*g,E=d*v-p*g,A=h*v-p*m,M=b*A-y*E+w*k+x*T-S*L+C*O;return M?(M=1/M,e[0]=(a*A-l*E+c*k)*M,e[1]=(l*T-o*A-c*L)*M,e[2]=(o*E-a*T+c*O)*M,e[3]=(r*E-i*A-s*k)*M,e[4]=(n*A-r*T+s*L)*M,e[5]=(i*T-n*E-s*O)*M,e[6]=(g*C-m*S+v*x)*M,e[7]=(m*w-f*C-v*y)*M,e[8]=(f*S-g*w+v*b)*M,e):null}function D(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function R(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function P(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))}function j(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}function V(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function _(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}function U(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e}function F(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function z(e,t){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],d=e[8],h=t[0],p=t[1],f=t[2],g=t[3],m=t[4],v=t[5],b=t[6],y=t[7],w=t[8];return Math.abs(n-h)<=c*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-p)<=c*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-f)<=c*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-g)<=c*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(o-m)<=c*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-v)<=c*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-b)<=c*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(u-y)<=c*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(d-w)<=c*Math.max(1,Math.abs(d),Math.abs(w))}var B=C,G=V;function W(){var e=new u(16);return u!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function $(e){var t=new u(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function H(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function q(e,t,n,i,r,s,o,a,l,c,d,h,p,f,g,m){var v=new u(16);return v[0]=e,v[1]=t,v[2]=n,v[3]=i,v[4]=r,v[5]=s,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=d,v[11]=h,v[12]=p,v[13]=f,v[14]=g,v[15]=m,v}function Y(e,t,n,i,r,s,o,a,l,c,u,d,h,p,f,g,m){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=d,e[11]=h,e[12]=p,e[13]=f,e[14]=g,e[15]=m,e}function J(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function X(e,t){if(e===t){var n=t[1],i=t[2],r=t[3],s=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=r,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function K(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],p=t[11],f=t[12],g=t[13],m=t[14],v=t[15],b=n*a-i*o,y=n*l-r*o,w=n*c-s*o,x=i*l-r*a,S=i*c-s*a,C=r*c-s*l,O=u*g-d*f,L=u*m-h*f,T=u*v-p*f,k=d*m-h*g,E=d*v-p*g,A=h*v-p*m,M=b*A-y*E+w*k+x*T-S*L+C*O;return M?(M=1/M,e[0]=(a*A-l*E+c*k)*M,e[1]=(r*E-i*A-s*k)*M,e[2]=(g*C-m*S+v*x)*M,e[3]=(h*S-d*C-p*x)*M,e[4]=(l*T-o*A-c*L)*M,e[5]=(n*A-r*T+s*L)*M,e[6]=(m*w-f*C-v*y)*M,e[7]=(u*C-h*w+p*y)*M,e[8]=(o*E-a*T+c*O)*M,e[9]=(i*T-n*E-s*O)*M,e[10]=(f*S-g*w+v*b)*M,e[11]=(d*w-u*S-p*b)*M,e[12]=(a*L-o*k-l*O)*M,e[13]=(n*k-i*L+r*O)*M,e[14]=(g*y-f*x-m*b)*M,e[15]=(u*x-d*y+h*b)*M,e):null}function Q(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],p=t[11],f=t[12],g=t[13],m=t[14],v=t[15];return e[0]=a*(h*v-p*m)-d*(l*v-c*m)+g*(l*p-c*h),e[1]=-(i*(h*v-p*m)-d*(r*v-s*m)+g*(r*p-s*h)),e[2]=i*(l*v-c*m)-a*(r*v-s*m)+g*(r*c-s*l),e[3]=-(i*(l*p-c*h)-a*(r*p-s*h)+d*(r*c-s*l)),e[4]=-(o*(h*v-p*m)-u*(l*v-c*m)+f*(l*p-c*h)),e[5]=n*(h*v-p*m)-u*(r*v-s*m)+f*(r*p-s*h),e[6]=-(n*(l*v-c*m)-o*(r*v-s*m)+f*(r*c-s*l)),e[7]=n*(l*p-c*h)-o*(r*p-s*h)+u*(r*c-s*l),e[8]=o*(d*v-p*g)-u*(a*v-c*g)+f*(a*p-c*d),e[9]=-(n*(d*v-p*g)-u*(i*v-s*g)+f*(i*p-s*d)),e[10]=n*(a*v-c*g)-o*(i*v-s*g)+f*(i*c-s*a),e[11]=-(n*(a*p-c*d)-o*(i*p-s*d)+u*(i*c-s*a)),e[12]=-(o*(d*m-h*g)-u*(a*m-l*g)+f*(a*h-l*d)),e[13]=n*(d*m-h*g)-u*(i*m-r*g)+f*(i*h-r*d),e[14]=-(n*(a*m-l*g)-o*(i*m-r*g)+f*(i*l-r*a)),e[15]=n*(a*h-l*d)-o*(i*h-r*d)+u*(i*l-r*a),e}function Z(e){var t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],p=e[12],f=e[13],g=e[14],m=e[15];return(t*o-n*s)*(d*m-h*g)-(t*a-i*s)*(u*m-h*f)+(t*l-r*s)*(u*g-d*f)+(n*a-i*o)*(c*m-h*p)-(n*l-r*o)*(c*g-d*p)+(i*l-r*a)*(c*f-u*p)}function ee(e,t,n){var i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=t[9],p=t[10],f=t[11],g=t[12],m=t[13],v=t[14],b=t[15],y=n[0],w=n[1],x=n[2],S=n[3];return e[0]=y*i+w*a+x*d+S*g,e[1]=y*r+w*l+x*h+S*m,e[2]=y*s+w*c+x*p+S*v,e[3]=y*o+w*u+x*f+S*b,y=n[4],w=n[5],x=n[6],S=n[7],e[4]=y*i+w*a+x*d+S*g,e[5]=y*r+w*l+x*h+S*m,e[6]=y*s+w*c+x*p+S*v,e[7]=y*o+w*u+x*f+S*b,y=n[8],w=n[9],x=n[10],S=n[11],e[8]=y*i+w*a+x*d+S*g,e[9]=y*r+w*l+x*h+S*m,e[10]=y*s+w*c+x*p+S*v,e[11]=y*o+w*u+x*f+S*b,y=n[12],w=n[13],x=n[14],S=n[15],e[12]=y*i+w*a+x*d+S*g,e[13]=y*r+w*l+x*h+S*m,e[14]=y*s+w*c+x*p+S*v,e[15]=y*o+w*u+x*f+S*b,e}function te(e,t,n){var i,r,s,o,a,l,c,u,d,h,p,f,g=n[0],m=n[1],v=n[2];return t===e?(e[12]=t[0]*g+t[4]*m+t[8]*v+t[12],e[13]=t[1]*g+t[5]*m+t[9]*v+t[13],e[14]=t[2]*g+t[6]*m+t[10]*v+t[14],e[15]=t[3]*g+t[7]*m+t[11]*v+t[15]):(i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=t[9],p=t[10],f=t[11],e[0]=i,e[1]=r,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=d,e[9]=h,e[10]=p,e[11]=f,e[12]=i*g+a*m+d*v+t[12],e[13]=r*g+l*m+h*v+t[13],e[14]=s*g+c*m+p*v+t[14],e[15]=o*g+u*m+f*v+t[15]),e}function ne(e,t,n){var i=n[0],r=n[1],s=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ie(e,t,n,i){var r,s,o,a,l,u,d,h,p,f,g,m,v,b,y,w,x,S,C,O,L,T,k,E,A=i[0],M=i[1],I=i[2],N=Math.sqrt(A*A+M*M+I*I);return N<c?null:(A*=N=1/N,M*=N,I*=N,r=Math.sin(n),o=1-(s=Math.cos(n)),a=t[0],l=t[1],u=t[2],d=t[3],h=t[4],p=t[5],f=t[6],g=t[7],m=t[8],v=t[9],b=t[10],y=t[11],w=A*A*o+s,x=M*A*o+I*r,S=I*A*o-M*r,C=A*M*o-I*r,O=M*M*o+s,L=I*M*o+A*r,T=A*I*o+M*r,k=M*I*o-A*r,E=I*I*o+s,e[0]=a*w+h*x+m*S,e[1]=l*w+p*x+v*S,e[2]=u*w+f*x+b*S,e[3]=d*w+g*x+y*S,e[4]=a*C+h*O+m*L,e[5]=l*C+p*O+v*L,e[6]=u*C+f*O+b*L,e[7]=d*C+g*O+y*L,e[8]=a*T+h*k+m*E,e[9]=l*T+p*k+v*E,e[10]=u*T+f*k+b*E,e[11]=d*T+g*k+y*E,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function re(e,t,n){var i=Math.sin(n),r=Math.cos(n),s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*r+c*i,e[5]=o*r+u*i,e[6]=a*r+d*i,e[7]=l*r+h*i,e[8]=c*r-s*i,e[9]=u*r-o*i,e[10]=d*r-a*i,e[11]=h*r-l*i,e}function se(e,t,n){var i=Math.sin(n),r=Math.cos(n),s=t[0],o=t[1],a=t[2],l=t[3],c=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r-c*i,e[1]=o*r-u*i,e[2]=a*r-d*i,e[3]=l*r-h*i,e[8]=s*i+c*r,e[9]=o*i+u*r,e[10]=a*i+d*r,e[11]=l*i+h*r,e}function oe(e,t,n){var i=Math.sin(n),r=Math.cos(n),s=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r+c*i,e[1]=o*r+u*i,e[2]=a*r+d*i,e[3]=l*r+h*i,e[4]=c*r-s*i,e[5]=u*r-o*i,e[6]=d*r-a*i,e[7]=h*r-l*i,e}function ae(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function le(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ce(e,t,n){var i,r,s,o=n[0],a=n[1],l=n[2],u=Math.sqrt(o*o+a*a+l*l);return u<c?null:(o*=u=1/u,a*=u,l*=u,i=Math.sin(t),s=1-(r=Math.cos(t)),e[0]=o*o*s+r,e[1]=a*o*s+l*i,e[2]=l*o*s-a*i,e[3]=0,e[4]=o*a*s-l*i,e[5]=a*a*s+r,e[6]=l*a*s+o*i,e[7]=0,e[8]=o*l*s+a*i,e[9]=a*l*s-o*i,e[10]=l*l*s+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function ue(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function de(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function he(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pe(e,t,n){var i=t[0],r=t[1],s=t[2],o=t[3],a=i+i,l=r+r,c=s+s,u=i*a,d=i*l,h=i*c,p=r*l,f=r*c,g=s*c,m=o*a,v=o*l,b=o*c;return e[0]=1-(p+g),e[1]=d+b,e[2]=h-v,e[3]=0,e[4]=d-b,e[5]=1-(u+g),e[6]=f+m,e[7]=0,e[8]=h+v,e[9]=f-m,e[10]=1-(u+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function fe(e,t){var n=new u(3),i=-t[0],r=-t[1],s=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],d=t[7],h=i*i+r*r+s*s+o*o;return h>0?(n[0]=2*(a*o+d*i+l*s-c*r)/h,n[1]=2*(l*o+d*r+c*i-a*s)/h,n[2]=2*(c*o+d*s+a*r-l*i)/h):(n[0]=2*(a*o+d*i+l*s-c*r),n[1]=2*(l*o+d*r+c*i-a*s),n[2]=2*(c*o+d*s+a*r-l*i)),pe(e,t,n),e}function ge(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function me(e,t){var n=t[0],i=t[1],r=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(n*n+i*i+r*r),e[1]=Math.sqrt(s*s+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e}function ve(e,t){var n=t[0]+t[5]+t[10],i=0;return n>0?(i=2*Math.sqrt(n+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e}function be(e,t,n,i){var r=t[0],s=t[1],o=t[2],a=t[3],l=r+r,c=s+s,u=o+o,d=r*l,h=r*c,p=r*u,f=s*c,g=s*u,m=o*u,v=a*l,b=a*c,y=a*u,w=i[0],x=i[1],S=i[2];return e[0]=(1-(f+m))*w,e[1]=(h+y)*w,e[2]=(p-b)*w,e[3]=0,e[4]=(h-y)*x,e[5]=(1-(d+m))*x,e[6]=(g+v)*x,e[7]=0,e[8]=(p+b)*S,e[9]=(g-v)*S,e[10]=(1-(d+f))*S,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function ye(e,t,n,i,r){var s=t[0],o=t[1],a=t[2],l=t[3],c=s+s,u=o+o,d=a+a,h=s*c,p=s*u,f=s*d,g=o*u,m=o*d,v=a*d,b=l*c,y=l*u,w=l*d,x=i[0],S=i[1],C=i[2],O=r[0],L=r[1],T=r[2],k=(1-(g+v))*x,E=(p+w)*x,A=(f-y)*x,M=(p-w)*S,I=(1-(h+v))*S,N=(m+b)*S,D=(f+y)*C,R=(m-b)*C,P=(1-(h+g))*C;return e[0]=k,e[1]=E,e[2]=A,e[3]=0,e[4]=M,e[5]=I,e[6]=N,e[7]=0,e[8]=D,e[9]=R,e[10]=P,e[11]=0,e[12]=n[0]+O-(k*O+M*L+D*T),e[13]=n[1]+L-(E*O+I*L+R*T),e[14]=n[2]+T-(A*O+N*L+P*T),e[15]=1,e}function we(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,d=i*a,h=r*o,p=r*a,f=r*l,g=s*o,m=s*a,v=s*l;return e[0]=1-d-f,e[1]=u+v,e[2]=h-m,e[3]=0,e[4]=u-v,e[5]=1-c-f,e[6]=p+g,e[7]=0,e[8]=h+m,e[9]=p-g,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xe(e,t,n,i,r,s,o){var a=1/(n-t),l=1/(r-i),c=1/(s-o);return e[0]=2*s*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+i)*l,e[10]=(o+s)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*c,e[15]=0,e}function Se(e,t,n,i,r){var s,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(s=1/(i-r),e[10]=(r+i)*s,e[14]=2*r*i*s):(e[10]=-1,e[14]=-2*i),e}function Ce(e,t,n,i){var r=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(r+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(r-s)*c*.5,e[10]=i/(n-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*n/(n-i),e[15]=0,e}function Oe(e,t,n,i,r,s,o){var a=1/(t-n),l=1/(i-r),c=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=(o+s)*c,e[15]=1,e}function Le(e,t,n,i){var r,s,o,a,l,u,d,h,p,f,g=t[0],m=t[1],v=t[2],b=i[0],y=i[1],w=i[2],x=n[0],S=n[1],C=n[2];return Math.abs(g-x)<c&&Math.abs(m-S)<c&&Math.abs(v-C)<c?J(e):(d=g-x,h=m-S,p=v-C,r=y*(p*=f=1/Math.sqrt(d*d+h*h+p*p))-w*(h*=f),s=w*(d*=f)-b*p,o=b*h-y*d,(f=Math.sqrt(r*r+s*s+o*o))?(r*=f=1/f,s*=f,o*=f):(r=0,s=0,o=0),a=h*o-p*s,l=p*r-d*o,u=d*s-h*r,(f=Math.sqrt(a*a+l*l+u*u))?(a*=f=1/f,l*=f,u*=f):(a=0,l=0,u=0),e[0]=r,e[1]=a,e[2]=d,e[3]=0,e[4]=s,e[5]=l,e[6]=h,e[7]=0,e[8]=o,e[9]=u,e[10]=p,e[11]=0,e[12]=-(r*g+s*m+o*v),e[13]=-(a*g+l*m+u*v),e[14]=-(d*g+h*m+p*v),e[15]=1,e)}function Te(e,t,n,i){var r=t[0],s=t[1],o=t[2],a=i[0],l=i[1],c=i[2],u=r-n[0],d=s-n[1],h=o-n[2],p=u*u+d*d+h*h;p>0&&(u*=p=1/Math.sqrt(p),d*=p,h*=p);var f=l*h-c*d,g=c*u-a*h,m=a*d-l*u;return(p=f*f+g*g+m*m)>0&&(f*=p=1/Math.sqrt(p),g*=p,m*=p),e[0]=f,e[1]=g,e[2]=m,e[3]=0,e[4]=d*m-h*g,e[5]=h*f-u*m,e[6]=u*g-d*f,e[7]=0,e[8]=u,e[9]=d,e[10]=h,e[11]=0,e[12]=r,e[13]=s,e[14]=o,e[15]=1,e}function ke(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Ee(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))}function Ae(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Me(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function Ie(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function Ne(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e[9]=t[9]+n[9]*i,e[10]=t[10]+n[10]*i,e[11]=t[11]+n[11]*i,e[12]=t[12]+n[12]*i,e[13]=t[13]+n[13]*i,e[14]=t[14]+n[14]*i,e[15]=t[15]+n[15]*i,e}function De(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Re(e,t){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],d=e[8],h=e[9],p=e[10],f=e[11],g=e[12],m=e[13],v=e[14],b=e[15],y=t[0],w=t[1],x=t[2],S=t[3],C=t[4],O=t[5],L=t[6],T=t[7],k=t[8],E=t[9],A=t[10],M=t[11],I=t[12],N=t[13],D=t[14],R=t[15];return Math.abs(n-y)<=c*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-w)<=c*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(r-x)<=c*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-S)<=c*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(o-C)<=c*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(a-O)<=c*Math.max(1,Math.abs(a),Math.abs(O))&&Math.abs(l-L)<=c*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(u-T)<=c*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(d-k)<=c*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(h-E)<=c*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(p-A)<=c*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(f-M)<=c*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(g-I)<=c*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(m-N)<=c*Math.max(1,Math.abs(m),Math.abs(N))&&Math.abs(v-D)<=c*Math.max(1,Math.abs(v),Math.abs(D))&&Math.abs(b-R)<=c*Math.max(1,Math.abs(b),Math.abs(R))}var Pe=ee,je=Me;function Ve(){var e=new u(3);return u!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function _e(e){var t=new u(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ue(e){var t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)}function Fe(e,t,n){var i=new u(3);return i[0]=e,i[1]=t,i[2]=n,i}function ze(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Be(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e}function Ge(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function We(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function $e(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function He(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function qe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Ye(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Je(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function Xe(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function Ke(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Qe(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Ze(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e}function et(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return Math.sqrt(n*n+i*i+r*r)}function tt(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r}function nt(e){var t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function it(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function rt(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function st(e,t){var n=t[0],i=t[1],r=t[2],s=n*n+i*i+r*r;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function ot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function at(e,t,n){var i=t[0],r=t[1],s=t[2],o=n[0],a=n[1],l=n[2];return e[0]=r*l-s*a,e[1]=s*o-i*l,e[2]=i*a-r*o,e}function lt(e,t,n,i){var r=t[0],s=t[1],o=t[2];return e[0]=r+i*(n[0]-r),e[1]=s+i*(n[1]-s),e[2]=o+i*(n[2]-o),e}function ct(e,t,n,i,r,s){var o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),u=o*(3-2*s);return e[0]=t[0]*a+n[0]*l+i[0]*c+r[0]*u,e[1]=t[1]*a+n[1]*l+i[1]*c+r[1]*u,e[2]=t[2]*a+n[2]*l+i[2]*c+r[2]*u,e}function ut(e,t,n,i,r,s){var o=1-s,a=o*o,l=s*s,c=a*o,u=3*s*a,d=3*l*o,h=l*s;return e[0]=t[0]*c+n[0]*u+i[0]*d+r[0]*h,e[1]=t[1]*c+n[1]*u+i[1]*d+r[1]*h,e[2]=t[2]*c+n[2]*u+i[2]*d+r[2]*h,e}function dt(e,t){t=t||1;var n=2*d()*Math.PI,i=2*d()-1,r=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*r,e[1]=Math.sin(n)*r,e[2]=i*t,e}function ht(e,t,n){var i=t[0],r=t[1],s=t[2],o=n[3]*i+n[7]*r+n[11]*s+n[15];return o=o||1,e[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,e[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,e[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,e}function pt(e,t,n){var i=t[0],r=t[1],s=t[2];return e[0]=i*n[0]+r*n[3]+s*n[6],e[1]=i*n[1]+r*n[4]+s*n[7],e[2]=i*n[2]+r*n[5]+s*n[8],e}function ft(e,t,n){var i=n[0],r=n[1],s=n[2],o=n[3],a=t[0],l=t[1],c=t[2],u=r*c-s*l,d=s*a-i*c,h=i*l-r*a,p=r*h-s*d,f=s*u-i*h,g=i*d-r*u,m=2*o;return u*=m,d*=m,h*=m,p*=2,f*=2,g*=2,e[0]=a+u+p,e[1]=l+d+f,e[2]=c+h+g,e}function gt(e,t,n,i){var r=[],s=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2],e}function mt(e,t,n,i){var r=[],s=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2],e}function vt(e,t,n,i){var r=[],s=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2],e}function bt(e,t){var n=Fe(e[0],e[1],e[2]),i=Fe(t[0],t[1],t[2]);st(n,n),st(i,i);var r=ot(n,i);return r>1?0:r<-1?Math.PI:Math.acos(r)}function yt(e){return e[0]=0,e[1]=0,e[2]=0,e}function wt(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function xt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function St(e,t){var n=e[0],i=e[1],r=e[2],s=t[0],o=t[1],a=t[2];return Math.abs(n-s)<=c*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-o)<=c*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=c*Math.max(1,Math.abs(r),Math.abs(a))}var Ct,Ot=We,Lt=$e,Tt=He,kt=et,Et=tt,At=Ue,Mt=nt,It=(Ct=Ve(),function(e,t,n,i,r,s){var o,a;for(t||(t=3),n||(n=0),a=i?Math.min(i*t+n,e.length):e.length,o=n;o<a;o+=t)Ct[0]=e[o],Ct[1]=e[o+1],Ct[2]=e[o+2],r(Ct,Ct,s),e[o]=Ct[0],e[o+1]=Ct[1],e[o+2]=Ct[2];return e});function Nt(){var e=new u(4);return u!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Dt(e){var t=new u(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Rt(e,t,n,i){var r=new u(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r}function Pt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function jt(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e}function Vt(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function _t(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function Ut(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function Ft(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function zt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Bt(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Gt(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e}function Wt(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e}function $t(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Ht(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function qt(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e}function Yt(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(n*n+i*i+r*r+s*s)}function Jt(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],s=t[3]-e[3];return n*n+i*i+r*r+s*s}function Xt(e){var t=e[0],n=e[1],i=e[2],r=e[3];return Math.sqrt(t*t+n*n+i*i+r*r)}function Kt(e){var t=e[0],n=e[1],i=e[2],r=e[3];return t*t+n*n+i*i+r*r}function Qt(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function Zt(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function en(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],o=n*n+i*i+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=i*o,e[2]=r*o,e[3]=s*o,e}function tn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function nn(e,t,n,i){var r=n[0]*i[1]-n[1]*i[0],s=n[0]*i[2]-n[2]*i[0],o=n[0]*i[3]-n[3]*i[0],a=n[1]*i[2]-n[2]*i[1],l=n[1]*i[3]-n[3]*i[1],c=n[2]*i[3]-n[3]*i[2],u=t[0],d=t[1],h=t[2],p=t[3];return e[0]=d*c-h*l+p*a,e[1]=-u*c+h*o-p*s,e[2]=u*l-d*o+p*r,e[3]=-u*a+d*s-h*r,e}function rn(e,t,n,i){var r=t[0],s=t[1],o=t[2],a=t[3];return e[0]=r+i*(n[0]-r),e[1]=s+i*(n[1]-s),e[2]=o+i*(n[2]-o),e[3]=a+i*(n[3]-a),e}function sn(e,t){var n,i,r,s,o,a;t=t||1;do{o=(n=2*d()-1)*n+(i=2*d()-1)*i}while(o>=1);do{a=(r=2*d()-1)*r+(s=2*d()-1)*s}while(a>=1);var l=Math.sqrt((1-o)/a);return e[0]=t*n,e[1]=t*i,e[2]=t*r*l,e[3]=t*s*l,e}function on(e,t,n){var i=t[0],r=t[1],s=t[2],o=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,e[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,e[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,e[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,e}function an(e,t,n){var i=t[0],r=t[1],s=t[2],o=n[0],a=n[1],l=n[2],c=n[3],u=c*i+a*s-l*r,d=c*r+l*i-o*s,h=c*s+o*r-a*i,p=-o*i-a*r-l*s;return e[0]=u*c+p*-o+d*-l-h*-a,e[1]=d*c+p*-a+h*-o-u*-l,e[2]=h*c+p*-l+u*-a-d*-o,e[3]=t[3],e}function ln(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function cn(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function un(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function dn(e,t){var n=e[0],i=e[1],r=e[2],s=e[3],o=t[0],a=t[1],l=t[2],u=t[3];return Math.abs(n-o)<=c*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=c*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-l)<=c*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-u)<=c*Math.max(1,Math.abs(s),Math.abs(u))}var hn=_t,pn=Ut,fn=Ft,gn=Yt,mn=Jt,vn=Xt,bn=Kt,yn=function(){var e=Nt();return function(t,n,i,r,s,o){var a,l;for(n||(n=4),i||(i=0),l=r?Math.min(r*n+i,t.length):t.length,a=i;a<l;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],s(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();function wn(){var e=new u(4);return u!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function xn(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Sn(e,t,n){n*=.5;var i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function Cn(e,t){var n=2*Math.acos(t[3]),i=Math.sin(n/2);return i>c?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n}function On(e,t,n){var i=t[0],r=t[1],s=t[2],o=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+o*a+r*c-s*l,e[1]=r*u+o*l+s*a-i*c,e[2]=s*u+o*c+i*l-r*a,e[3]=o*u-i*a-r*l-s*c,e}function Ln(e,t,n){n*=.5;var i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+o*a,e[1]=r*l+s*a,e[2]=s*l-r*a,e[3]=o*l-i*a,e}function Tn(e,t,n){n*=.5;var i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l-s*a,e[1]=r*l+o*a,e[2]=s*l+i*a,e[3]=o*l-r*a,e}function kn(e,t,n){n*=.5;var i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*a,e[1]=r*l-i*a,e[2]=s*l+o*a,e[3]=o*l-s*a,e}function En(e,t){var n=t[0],i=t[1],r=t[2];return e[0]=n,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),e}function An(e,t,n,i){var r,s,o,a,l,u=t[0],d=t[1],h=t[2],p=t[3],f=n[0],g=n[1],m=n[2],v=n[3];return(s=u*f+d*g+h*m+p*v)<0&&(s=-s,f=-f,g=-g,m=-m,v=-v),1-s>c?(r=Math.acos(s),o=Math.sin(r),a=Math.sin((1-i)*r)/o,l=Math.sin(i*r)/o):(a=1-i,l=i),e[0]=a*u+l*f,e[1]=a*d+l*g,e[2]=a*h+l*m,e[3]=a*p+l*v,e}function Mn(e){var t=d(),n=d(),i=d(),r=Math.sqrt(1-t),s=Math.sqrt(t);return e[0]=r*Math.sin(2*Math.PI*n),e[1]=r*Math.cos(2*Math.PI*n),e[2]=s*Math.sin(2*Math.PI*i),e[3]=s*Math.cos(2*Math.PI*i),e}function In(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],o=n*n+i*i+r*r+s*s,a=o?1/o:0;return e[0]=-n*a,e[1]=-i*a,e[2]=-r*a,e[3]=s*a,e}function Nn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Dn(e,t){var n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var s=(r+1)%3,o=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*o+o]+1),e[r]=.5*n,n=.5/n,e[3]=(t[3*s+o]-t[3*o+s])*n,e[s]=(t[3*s+r]+t[3*r+s])*n,e[o]=(t[3*o+r]+t[3*r+o])*n}return e}function Rn(e,t,n,i){var r=.5*Math.PI/180;t*=r,n*=r,i*=r;var s=Math.sin(t),o=Math.cos(t),a=Math.sin(n),l=Math.cos(n),c=Math.sin(i),u=Math.cos(i);return e[0]=s*l*u-o*a*c,e[1]=o*a*u+s*l*c,e[2]=o*l*c-s*a*u,e[3]=o*l*u+s*a*c,e}function Pn(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var jn,Vn,_n,Un,Fn,zn,Bn=Dt,Gn=Rt,Wn=Pt,$n=jt,Hn=Vt,qn=On,Yn=Ht,Jn=tn,Xn=rn,Kn=Xt,Qn=Kn,Zn=Kt,ei=Zn,ti=en,ni=un,ii=dn,ri=(jn=Ve(),Vn=Fe(1,0,0),_n=Fe(0,1,0),function(e,t,n){var i=ot(t,n);return i<-.999999?(at(jn,Vn,t),At(jn)<1e-6&&at(jn,_n,t),st(jn,jn),Sn(e,jn,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(at(jn,t,n),e[0]=jn[0],e[1]=jn[1],e[2]=jn[2],e[3]=1+i,ti(e,e))}),si=(Un=wn(),Fn=wn(),function(e,t,n,i,r,s){return An(Un,t,r,s),An(Fn,n,i,s),An(e,Un,Fn,2*s*(1-s)),e}),oi=(zn=h(),function(e,t,n,i){return zn[0]=n[0],zn[3]=n[1],zn[6]=n[2],zn[1]=i[0],zn[4]=i[1],zn[7]=i[2],zn[2]=-t[0],zn[5]=-t[1],zn[8]=-t[2],ti(e,Dn(e,zn))});function ai(){var e=new u(2);return u!=Float32Array&&(e[0]=0,e[1]=0),e}function li(e){var t=new u(2);return t[0]=e[0],t[1]=e[1],t}function ci(e,t){var n=new u(2);return n[0]=e,n[1]=t,n}function ui(e,t){return e[0]=t[0],e[1]=t[1],e}function di(e,t,n){return e[0]=t,e[1]=n,e}function hi(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function pi(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function fi(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function gi(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function mi(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function vi(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function bi(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function yi(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function wi(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function xi(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function Si(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e}function Ci(e,t){var n=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(n*n+i*i)}function Oi(e,t){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i}function Li(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}function Ti(e){var t=e[0],n=e[1];return t*t+n*n}function ki(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Ei(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Ai(e,t){var n=t[0],i=t[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e}function Mi(e,t){return e[0]*t[0]+e[1]*t[1]}function Ii(e,t,n){var i=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=i,e}function Ni(e,t,n,i){var r=t[0],s=t[1];return e[0]=r+i*(n[0]-r),e[1]=s+i*(n[1]-s),e}function Di(e,t){t=t||1;var n=2*d()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function Ri(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e}function Pi(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r+n[4],e[1]=n[1]*i+n[3]*r+n[5],e}function ji(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[3]*r+n[6],e[1]=n[1]*i+n[4]*r+n[7],e}function Vi(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e}function _i(e,t,n,i){var r=t[0]-n[0],s=t[1]-n[1],o=Math.sin(i),a=Math.cos(i);return e[0]=r*a-s*o+n[0],e[1]=r*o+s*a+n[1],e}function Ui(e,t){var n=e[0],i=e[1],r=t[0],s=t[1],o=n*n+i*i;o>0&&(o=1/Math.sqrt(o));var a=r*r+s*s;a>0&&(a=1/Math.sqrt(a));var l=(n*r+i*s)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function Fi(e){return e[0]=0,e[1]=0,e}function zi(e){return"vec2("+e[0]+", "+e[1]+")"}function Bi(e,t){return e[0]===t[0]&&e[1]===t[1]}function Gi(e,t){var n=e[0],i=e[1],r=t[0],s=t[1];return Math.abs(n-r)<=c*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-s)<=c*Math.max(1,Math.abs(i),Math.abs(s))}var Wi=Li,$i=pi,Hi=fi,qi=gi,Yi=Ci,Ji=Oi,Xi=Ti,Ki=function(){var e=ai();return function(t,n,i,r,s,o){var a,l;for(n||(n=2),i||(i=0),l=r?Math.min(r*n+i,t.length):t.length,a=i;a<l;a+=n)e[0]=t[a],e[1]=t[a+1],s(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}}();n.d(t,"e",function(){return Qi}),n.d(t,"a",function(){return Zi}),n.d(t,"b",function(){return er}),n.d(t,"g",function(){return tr}),n.d(t,"j",function(){return nr}),n.d(t,"i",function(){return ir}),n.d(t,"h",function(){return rr}),n.d(t,"n",function(){return sr}),n.d(t,"v",function(){return or}),n.d(t,"q",function(){return cr}),n.d(t,"r",function(){return ur}),n.d(t,"c",function(){return dr}),n.d(t,"s",function(){return hr}),n.d(t,"o",function(){return pr}),n.d(t,"l",function(){return fr}),n.d(t,"d",function(){return gr}),n.d(t,"f",function(){return mr}),n.d(t,"k",function(){return i}),n.d(t,"m",function(){return r}),n.d(t,"p",function(){return a}),n.d(t,"t",function(){return l}),n.d(t,"u",function(){return s}),n.d(t,"w",function(){return o});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Qi=r.create(),Zi=["x","y","z"];class er{constructor(e,t){this.lower=e,this.upper=t}}const tr=[s.fromValues(1,0,0),s.fromValues(0,1,0),s.fromValues(0,0,1)],nr=s.fromValues(0,0,0),ir=s.fromValues(1,1,1),rr=s.fromValues(1/0,1/0,1/0);a.create();function sr(e){return e[0]*e[1]*e[2]}function or(e){return`${e[0]},${e[1]},${e[2]}`}const ar=1e-4;function lr(e,t){let n=Math.abs(e[t]),i=Math.abs(e[t+1]),r=Math.abs(e[t+2]),s=Math.max(n,i,r);n/s<ar&&(e[t]=0),i/s<ar&&(e[t+1]=0),r/s<ar&&(e[t+2]=0)}function cr(e){lr(e,0),lr(e,4),lr(e,8)}function ur(e,t,n){let i=t[0],r=t[1],s=t[2];return e[0]=n[0]*i+n[4]*r+n[8]*s,e[1]=n[1]*i+n[5]*r+n[9]*s,e[2]=n[2]*i+n[6]*r+n[10]*s,e}function dr(e,t){const n=t[0],i=t[1],r=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(n*n+i*i+r*r),e[1]=Math.sqrt(s*s+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e}function hr(e,t,n,i,s){const o=e;return e[0]=i[0],e[1]=i[1],e[2]=i[2]*s,r.fromRotationTranslationScale(e,n,t,o)}function pr(e,t,n,i){let r=function(e,t,n){const i=s.squaredDistance(e,t);let r=0;for(let i=0;i<3;++i){const s=e[i];r-=(s-n[i])*(t[i]-s)}return r/Math.max(i,1e-6)}(t,n,i);r=Math.max(0,Math.min(1,r));for(let i=0;i<3;++i){const s=t[i];e[i]=s+r*(n[i]-s)}return e}function fr(e,t){const n=t[0],i=t[1],r=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=n,e[1]=i,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=c,e[8]=u,e}function gr(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],p=t[11],f=t[12],g=t[13],m=t[14],v=t[15];e[0]=s+n,e[1]=c+o,e[2]=p+u,e[3]=v+f,e[4]=s-n,e[5]=c-o,e[6]=p-u,e[7]=v-f,e[8]=s+i,e[9]=c+a,e[10]=p+d,e[11]=v+g,e[12]=s-i,e[13]=c-a,e[14]=p-d,e[15]=v-g;const b=s+r,y=c+l,w=p+h,x=v+m,S=Math.sqrt(b**2+y**2+w**2);return e[16]=b/S,e[17]=y/S,e[18]=w/S,e[19]=x/S,e[20]=s-r,e[21]=c-l,e[22]=p-h,e[23]=v-m,e}function mr(e,t,n,i,r,s,o){for(let a=0;a<6;++a){const l=o[4*a],c=o[4*a+1],u=o[4*a+2],d=o[4*a+3];if(Math.max(l*e,l*i)+Math.max(c*t,c*r)+Math.max(u*n,u*s)+d<0)return!1}return!0}},function(e,t,n){"use strict";n.d(t,"p",function(){return r}),n.d(t,"n",function(){return s}),n.d(t,"o",function(){return o}),n.d(t,"f",function(){return a}),n.d(t,"b",function(){return l}),n.d(t,"d",function(){return c}),n.d(t,"g",function(){return u}),n.d(t,"h",function(){return y}),n.d(t,"a",function(){return w}),n.d(t,"c",function(){return x}),n.d(t,"t",function(){return S}),n.d(t,"r",function(){return C}),n.d(t,"z",function(){return O}),n.d(t,"s",function(){return L}),n.d(t,"A",function(){return T}),n.d(t,"y",function(){return k}),n.d(t,"x",function(){return E}),n.d(t,"w",function(){return A}),n.d(t,"v",function(){return M}),n.d(t,"u",function(){return I}),n.d(t,"q",function(){return N}),n.d(t,"e",function(){return D}),n.d(t,"m",function(){return R}),n.d(t,"k",function(){return P}),n.d(t,"j",function(){return j}),n.d(t,"i",function(){return V}),n.d(t,"l",function(){return _});var i=n(0);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r(e){let t=typeof e;if("number"===t||"string"===t){let t=parseFloat(""+e);if(!Number.isNaN(t))return t}throw new Error(`Expected floating-point number, but received: ${JSON.stringify(e)}.`)}function s(e){let t=r(e);if(Number.isFinite(t))return t;throw new Error(`Expected finite floating-point number, but received: ${t}.`)}function o(e){let t=s(e);if(t>0)return t;throw new Error(`Expected positive finite floating-point number, but received: ${t}.`)}function a(e,t,n=r){S(t),e[0]=e[1]=e[2]=0;for(const i of Object.keys(t))switch(i){case"x":e[0]=n(t[i]);break;case"y":e[1]=n(t[i]);break;case"z":e[2]=n(t[i]);break;default:throw new Error(`Expected object to have keys ['x', 'y', 'z'], but received: ${JSON.stringify(t)}.`)}return e}function l(e,t){let n=e.length;if(!Array.isArray(t)||t.length!==n)throw new Error("Incompatible sizes");for(let e=0;e<n;++e)if(!Number.isFinite(parseFloat(t[e])))throw new Error("Non-finite value.");for(let i=0;i<n;++i)e[i]=parseFloat(t[i]);return e}function c(e,t){let n=e.length;if(!Array.isArray(t)||t.length!==n)throw new Error("Incompatible sizes.");for(let e=0;e<n;++e){let n=parseInt(t[e],void 0);if(!Number.isInteger(n))throw new Error("Non-integer value.")}for(let i=0;i<n;++i)e[i]=parseInt(t[i],void 0);return e}function u(e){if("object"==typeof e){if(null===e)return"null";if(Array.isArray(e)){let t="[",n=e.length,i=0;if(i<n)for(t+=u(e[i]);++i<n;)t+=",",t+=u(e[i]);return t+="]"}let t="{",n=Object.keys(e).sort(),i=0,r=n.length;if(i<r){let s=n[i];for(t+=JSON.stringify(s),t+=":",t+=u(e[s]);++i<r;)t+=",",s=n[i],t+=JSON.stringify(s),t+=":",t+=u(e[s])}return t+="}"}return JSON.stringify(e)}const d=/('(?:[^'\\]|(?:\\.))*')/,h=/("(?:[^'\\]|(?:\\.))*")/,p=new RegExp(`${d.source}|${h.source}`),f=new RegExp(`${h.source}|${d.source}`),g=/^((?:[^"'\\]|(?:\\[^']))*)("|\\')/,m=/^((?:[^"'\\]|(?:\\.))*)'/;function v(e,t,n,i){if(e.length>=2&&e.charAt(0)===t&&e.charAt(e.length-1)===t){let r=e.substr(1,e.length-2),s=n;for(;r.length>0;){let e=r.match(i);if(null===e){s+=r;break}s+=e[1],e[2]===n?(s+="\\",s+=n):s+=t,r=r.substr(e.index+e[0].length)}return s+=n}return e}function b(e,t,n){const i=/[&_,]/g;let r,s,o;'"'===n?(r="'",s=g,o=p):(r='"',s=m,o=f);let a="";for(;e.length>0;){let l,c,u=e.match(o);if(null===u)l=e,e="",c="";else{l=e.substr(0,u.index),e=e.substr(u.index+u[0].length);let t=u[1];c=void 0!==t?v(t,r,n,s):u[2]}a+=l.replace(i,t),a+=c}return a}function y(e){return JSON.parse(function(e){return b(e,",",'"')}(e))}function w(e,t){if(!Array.isArray(e))throw new Error(`Expected array, but received: ${JSON.stringify(e)}.`);return e.map(t)}function x(e,t,n){const i=e.length;if(!Array.isArray(t)||t.length!==i)throw new Error(`Expected length ${i} array, but received: ${JSON.stringify(t)}.`);for(let r=0;r<i;++r)e[r]=n(t[r],r);return e}function S(e){if("object"!=typeof e||null==e||Array.isArray(e))throw new Error(`Expected JSON object, but received: ${JSON.stringify(e)}.`);return e}function C(e){let t=parseInt(e,10);if(!Number.isInteger(t))throw new Error(`Expected integer, but received: ${JSON.stringify(e)}.`);return t}function O(e){let t=C(e);if(t<=0)throw new Error(`Expected positive integer, but received: ${t}.`);return t}function L(e,t){let n=t.get(e);if(void 0===n)throw new Error(`Expected one of ${JSON.stringify(Array.from(t.keys()))}, `+`but received: ${JSON.stringify(e)}.`);return n}function T(e){if("string"!=typeof e)throw new Error(`Expected string, but received: ${JSON.stringify(e)}.`);return e}function k(e){if(void 0!==e)return T(e)}function E(e){if(void 0!==e)return C(e)}function A(e){if(void 0!==e){if("boolean"==typeof e)return e;if("true"===e)return!0;if("false"===e)return!1;throw new Error(`Expected string or boolean but received: ${JSON.stringify(e)}`)}}function M(e,t,n){let i=e.hasOwnProperty(t)?e[t]:void 0;try{return n(i)}catch(e){throw new Error(`Error parsing ${JSON.stringify(t)} property: ${e.message}`)}}function I(e,t){S(e);let n=new Map;for(let i of Object.keys(e))try{n.set(i,t(e[i]))}catch(e){throw new Error(`Error parsing value associated with key ${JSON.stringify(i)}: ${e.message}`)}return n}function N(e){if("number"!=typeof e||!Number.isFinite(e)||e<0||e>1)throw new Error(`Expected floating point number in [0,1], but received: ${JSON.stringify(e)}.`);return e}function D(e){if(""===e)return{};if(e.startsWith("{"))return y(e);{let t={},n=e.split(/[&;]/);for(let e of n){let n=e.match(/^([^=&;]+)=([^&;]*)$/);if(null===n)throw new Error(`Invalid query string part: ${JSON.stringify(e)}.`);t[n[1]]=decodeURIComponent(n[2])}return t}}function R(e,t){if("string"==typeof e&&null!==e.match(/^[a-zA-Z]/)&&(e=e.toUpperCase(),t.hasOwnProperty(e)))return t[e];throw new Error(`Invalid enum value: ${JSON.stringify(e)}.`)}function P(e){return x(i.u.create(),e,s)}function j(e){return x(i.u.create(),e,o)}function V(e){return x(i.u.create(),e,O)}function _(e){if("boolean"!=typeof e)throw new Error(`Expected boolean, received: ${JSON.stringify(e)}`);return e}},function(e,t,n){"use strict";function i(e){for(let n=e.length;n>0;--n)"object"==typeof(t=e[n-1])?t.dispose():t();
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var t}function r(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}n.d(t,"c",function(){return i}),n.d(t,"d",function(){return r}),n.d(t,"a",function(){return s}),n.d(t,"b",function(){return o});class s{constructor(){this.refCount=1}addRef(){return++this.refCount,this}dispose(){0==--this.refCount&&this.refCountReachedZero()}refCountReachedZero(){this.disposed();let{disposers:e}=this;void 0!==e&&(i(e),this.disposers=void 0),this.wasDisposed=!0}disposed(){}registerDisposer(e){let{disposers:t}=this;return null==t?this.disposers=[e]:t.push(e),e}unregisterDisposer(e){let{disposers:t}=this;if(null!=t){let n=t.indexOf(e);-1!==n&&t.splice(n,1)}return e}registerEventListener(e,t,n,i){this.registerDisposer(r(e,t,n,i))}registerCancellable(e){return this.registerDisposer(()=>{e.cancel()}),e}}class o extends s{constructor(e){super(),this.value=e}}},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return r});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class i{constructor(){this.handlers=new Set,this.count=0;const e=this;this.dispatch=function(){++e.count,e.handlers.forEach(e=>{e.apply(this,arguments)})}}add(e){return this.handlers.add(e),()=>this.remove(e)}remove(e){return this.handlers.delete(e)}dispose(){this.handlers=void 0}}class r extends i{}},function(e,t,n){"use strict";n.d(t,"c",function(){return s}),n.d(t,"b",function(){return a});var i=n(27),r=n(12);n.d(t,"a",function(){return r.b});var s,o=n(0);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.IMAGE=1]="IMAGE",e[e.SEGMENTATION=2]="SEGMENTATION"}(s||(s={}));class a extends i.i{constructor(e){let{lowerVoxelBound:t=o.j,upperVoxelBound:n,chunkDataSize:i,voxelSize:s,transform:a,baseVoxelOffset:l=o.j}=e,{lowerClipBound:c=o.u.multiply(o.u.create(),s,t),upperClipBound:u=o.u.multiply(o.u.create(),s,n)}=e;const d=o.u.multiply(o.u.create(),i,s);let h=o.u.create(),p=o.u.create();for(let e=0;e<3;++e)h[e]=Math.floor(t[e]/i[e]),p[e]=Math.floor((n[e]-1)/i[e]+1);super({voxelSize:s,transform:a,lowerChunkBound:h,upperChunkBound:p,chunkSize:d}),this.baseVoxelOffset=l,this.lowerClipBound=c,this.upperClipBound=u,this.lowerVoxelBound=t,this.upperVoxelBound=n,this.chunkDataSize=i;let f=this.dataType=e.dataType,g=this.numChannels=e.numChannels;this.chunkBytes=Object(o.n)(i)*r.a[f]*g,this.compressedSegmentationBlockSize=e.compressedSegmentationBlockSize}static make(e){return new a(Object.assign({},e,{transform:Object(i.k)(e.transform,e.volumeSourceOptions)}))}static fromObject(e){return new a(e)}toObject(){return Object.assign({},super.toObject(),{numChannels:this.numChannels,chunkDataSize:this.chunkDataSize,dataType:this.dataType,lowerVoxelBound:this.lowerVoxelBound,upperVoxelBound:this.upperVoxelBound,lowerClipBound:this.lowerClipBound,upperClipBound:this.upperClipBound,baseVoxelOffset:this.baseVoxelOffset,compressedSegmentationBlockSize:this.compressedSegmentationBlockSize})}static withDefaultCompression(e){let{compressedSegmentationBlockSize:t,dataType:n,voxelSize:l,transform:c,lowerVoxelBound:u,upperVoxelBound:d}=e;return c=Object(i.k)(c,e.volumeSourceOptions),void 0!==t||e.volumeType!==s.SEGMENTATION||n!==r.b.UINT32&&n!==r.b.UINT64||(t=Object(i.l)({voxelSize:l,transform:c,lowerVoxelBound:u,upperVoxelBound:d,maxVoxelsPerChunkLog2:9,maxBlockSize:o.u.min(o.u.create(),e.chunkDataSize,e.maxCompressedSegmentationBlockSize||o.h)})),new a(Object.assign({},e,{compressedSegmentationBlockSize:t,transform:c}))}static getDefaults(e){const t=Object.assign({},e,{transform:Object(i.k)(e.transform,e.volumeSourceOptions)});let{chunkDataSizes:n=Object(i.j)(t)}=e;return n.map(t=>a.withDefaultCompression(Object.assign({},e,{chunkDataSize:t})))}}},function(e,t,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var i;n.d(t,"g",function(){return i}),n.d(t,"l",function(){return r}),n.d(t,"f",function(){return s}),n.d(t,"d",function(){return a}),n.d(t,"e",function(){return l}),n.d(t,"k",function(){return c}),n.d(t,"j",function(){return u}),n.d(t,"i",function(){return d}),n.d(t,"b",function(){return h}),n.d(t,"a",function(){return p}),n.d(t,"c",function(){return f}),n.d(t,"h",function(){return g}),function(e){e[e.GPU_MEMORY=0]="GPU_MEMORY",e[e.SYSTEM_MEMORY=1]="SYSTEM_MEMORY",e[e.SYSTEM_MEMORY_WORKER=2]="SYSTEM_MEMORY_WORKER",e[e.DOWNLOADING=3]="DOWNLOADING",e[e.QUEUED=4]="QUEUED",e[e.NEW=5]="NEW",e[e.FAILED=6]="FAILED",e[e.EXPIRED=7]="EXPIRED"}(i||(i={}));const r=8;var s;!function(e){e[e.FIRST_TIER=0]="FIRST_TIER",e[e.FIRST_ORDERED_TIER=0]="FIRST_ORDERED_TIER",e[e.VISIBLE=0]="VISIBLE",e[e.PREFETCH=1]="PREFETCH",e[e.LAST_ORDERED_TIER=1]="LAST_ORDERED_TIER",e[e.RECENT=2]="RECENT",e[e.LAST_TIER=2]="LAST_TIER"}(s||(s={}));const o=3;var a,l;!function(e){e[e.totalTime=0]="totalTime",e[e.totalChunks=1]="totalChunks"}(a||(a={})),function(e){e[e.numChunks=0]="numChunks",e[e.systemMemoryBytes=1]="systemMemoryBytes",e[e.gpuMemoryBytes=2]="gpuMemoryBytes"}(l||(l={}));const c=3;function u(e,t){return e*o+t}function d(e){return r*o*c+e}const h="ChunkQueueManager",p="ChunkManager",f="ChunkSource.invalidate",g="ChunkQueueManager.requestChunkStatistics"},function(e,t,n){"use strict";n.d(t,"a",function(){return u}),n.d(t,"c",function(){return i}),n.d(t,"e",function(){return d}),n.d(t,"g",function(){return p}),n.d(t,"b",function(){return g}),n.d(t,"d",function(){return m}),n.d(t,"h",function(){return b}),n.d(t,"i",function(){return y}),n.d(t,"f",function(){return w});var i,r=n(2),s=n(0),o=n(1),a=n(51),l=n(3),c=n(17);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class u extends r.a{constructor(e){super(),this.id=e,this.changed=new l.a}}!function(e){e[e.POINT=0]="POINT",e[e.LINE=1]="LINE",e[e.AXIS_ALIGNED_BOUNDING_BOX=2]="AXIS_ALIGNED_BOUNDING_BOX",e[e.ELLIPSOID=3]="ELLIPSOID"}(i||(i={}));const d=[i.POINT,i.LINE,i.AXIS_ALIGNED_BOUNDING_BOX,i.ELLIPSOID],h=new Map;function p(e){return h.get(e)}function f(e){const t=p(e.type).toJSON(e);t.type=i[e.type].toLowerCase(),t.id=e.id,t.description=e.description||void 0;const{segments:n}=e;return void 0!==n&&n.length>0&&(t.segments=n.map(e=>e.toString())),t}h.set(i.LINE,{icon:"",description:"Line",toJSON:e=>({pointA:Array.from(e.pointA),pointB:Array.from(e.pointB)}),restoreState:(e,t)=>{e.pointA=Object(o.v)(t,"pointA",o.k),e.pointB=Object(o.v)(t,"pointB",o.k)},serializedBytes:24,serializer:(e,t,n)=>{const i=new Float32Array(e,t,6*n);return(e,t)=>{const{pointA:n,pointB:r}=e,s=6*t;i[s]=n[0],i[s+1]=n[1],i[s+2]=n[2],i[s+3]=r[0],i[s+4]=r[1],i[s+5]=r[2]}}}),h.set(i.POINT,{icon:"",description:"Point",toJSON:e=>({point:Array.from(e.point)}),restoreState:(e,t)=>{e.point=Object(o.v)(t,"point",o.k)},serializedBytes:12,serializer:(e,t,n)=>{const i=new Float32Array(e,t,3*n);return(e,t)=>{const{point:n}=e,r=3*t;i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2]}}}),h.set(i.AXIS_ALIGNED_BOUNDING_BOX,{icon:"",description:"Bounding Box",toJSON:e=>({pointA:Array.from(e.pointA),pointB:Array.from(e.pointB)}),restoreState:(e,t)=>{e.pointA=Object(o.v)(t,"pointA",o.k),e.pointB=Object(o.v)(t,"pointB",o.k)},serializedBytes:24,serializer:(e,t,n)=>{const i=new Float32Array(e,t,6*n);return(e,t)=>{const{pointA:n,pointB:r}=e,s=6*t;i[s]=Math.min(n[0],r[0]),i[s+1]=Math.min(n[1],r[1]),i[s+2]=Math.min(n[2],r[2]),i[s+3]=Math.max(n[0],r[0]),i[s+4]=Math.max(n[1],r[1]),i[s+5]=Math.max(n[2],r[2])}}}),h.set(i.ELLIPSOID,{icon:"",description:"Ellipsoid",toJSON:e=>({center:Array.from(e.center),radii:Array.from(e.radii)}),restoreState:(e,t)=>{e.center=Object(o.v)(t,"center",o.k),e.radii=Object(o.v)(t,"radii",o.j)},serializedBytes:24,serializer:(e,t,n)=>{const i=new Float32Array(e,t,6*n);return(e,t)=>{const{center:n,radii:r}=e,s=6*t;i.set(n,s),i.set(r,s+3)}}});class g extends r.a{constructor(e=s.m.create()){super(),this.objectToLocal=e,this.annotationMap=new Map,this.changed=new l.a,this.readonly=!1,this.childAdded=new l.b,this.childUpdated=new l.b,this.childDeleted=new l.b,this.pending=new Set,this.references=new Map}add(e,t=!0){if(e.id){if(this.annotationMap.has(e.id))throw new Error(`Annotation id already exists: ${JSON.stringify(e.id)}.`)}else e.id=b();return this.annotationMap.set(e.id,e),this.changed.dispatch(),this.childAdded.dispatch(e),t||this.pending.add(e.id),this.getReference(e.id)}commit(e){const t=e.id;this.pending.delete(t)}update(e,t){if(null===e.value)throw new Error("Annotation already deleted.");e.value=t,this.annotationMap.set(t.id,t),e.changed.dispatch(),this.changed.dispatch(),this.childUpdated.dispatch(t)}[Symbol.iterator](){return this.annotationMap.values()}get(e){return this.annotationMap.get(e)}delete(e){null!==e.value&&(e.value=null,this.annotationMap.delete(e.id),this.pending.delete(e.id),e.changed.dispatch(),this.changed.dispatch(),this.childDeleted.dispatch(e.id))}getReference(e){let t=this.references.get(e);return void 0!==t?t.addRef():((t=new u(e)).value=this.annotationMap.get(e)||null,this.references.set(e,t),t.registerDisposer(()=>{this.references.delete(e)}),t)}toJSON(){const e=[],{pending:t}=this;for(const n of this)t.has(n.id)||e.push(f(n));return e}clear(){this.annotationMap.clear(),this.pending.clear(),this.changed.dispatch()}restoreState(e){const{annotationMap:t}=this;t.clear(),this.pending.clear(),void 0!==e&&Object(o.a)(e,e=>{const n=function(e,t=!1){Object(o.t)(e);const n=Object(o.v)(e,"type",e=>Object(o.m)(e,i)),r={id:Object(o.v)(e,"id",t?o.y:o.A)||b(),description:Object(o.v)(e,"description",o.y),segments:Object(o.v)(e,"segments",e=>void 0===e?void 0:Object(o.a)(e,e=>c.a.parseString(e))),type:n};return p(n).restoreState(r,e),r}(e);t.set(n.id,n)});for(const e of this.references.values()){const{id:n}=e,i=t.get(n);e.value=i||null,e.changed.dispatch()}this.changed.dispatch()}reset(){this.clear()}}class m extends g{}const v="Data Bounds";function b(){return Object(a.a)(160)}function y(e,t){return{type:i.AXIS_ALIGNED_BOUNDING_BOX,id:"data-bounds",description:v,pointA:e,pointB:t}}function w(e){if(null==e)return e;const t=e.segments;return void 0!==t&&(e.segments=t.map(e=>new c.a(e.low,e.high))),e}},function(e,t,n){"use strict";var i,r=n(2);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s{constructor(e){if(this.parents=new Array,this.parentPriorities=new Array,this.bindings=new Map,void 0!==e){this.parents.push(...e.parents),this.parentPriorities.push(...e.parentPriorities);for(const[t,n]of e.bindings)this.bindings.set(t,n)}}addParent(e,t){const{parents:n,parentPriorities:i}=this;let r=0;const{length:s}=n;for(;r<s&&t<i[r];)++r;return n.splice(r,0,e),i.splice(r,0,t),()=>{this.removeParent(e)}}removeParent(e){const t=this.parents.indexOf(e);if(-1===t)throw new Error("Attempt to remove non-existent parent map.");this.parents.splice(t,1),this.parentPriorities.splice(t,1)}set(e,t){this.bindings.set(e,t)}delete(e){this.bindings.delete(e)}clear(){this.bindings.clear(),this.parents.length=0,this.parentPriorities.length=0}get(e){const{parents:t,parentPriorities:n}=this,i=n.length;let r,s=0;for(;s<i&&n[s]>0;++s)if(void 0!==(r=t[s].get(e)))return r;if(void 0!==(r=this.bindings.get(e)))return r;for(;s<i;++s)if(void 0!==(r=t[s].get(e)))return r}*getAll(e){const{parents:t,parentPriorities:n}=this,i=n.length;let r;for(;0<i&&n[0]>0;)void 0!==(r=t[0].get(e))&&(yield r);for(void 0!==(r=this.bindings.get(e))&&(yield r);0<i;)void 0!==(r=t[0].get(e))&&(yield r)}*entries(){const{parents:e,parentPriorities:t}=this,n=t.length;for(;0<n&&t[0]>0;)yield*e[0].entries();for(yield*this.bindings.entries();0<n;)yield*e[0].entries()}}function o(e,t){let n="";return 1&t&&(n+="control+"),2&t&&(n+="alt+"),4&t&&(n+="meta+"),8&t&&(n+="shift+"),n+=e}function a(e){return"string"==typeof e?{action:e}:e}function*l(e){const t=e.indexOf(":"),n=function(e){let t,n=e.split("+"),i=0;for(let e of n)switch(e){case"control":i|=1;break;case"alt":i|=2;break;case"meta":i|=4;break;case"shift":i|=8;break;default:if(void 0!==t)return;t=e}if(void 0!==t)return o(t,i)}(e.substring(t+1));if(void 0===n)throw new Error(`Invalid event identifier: ${JSON.stringify(e)}`);if(-1!==t){const i=e.substring(0,t);if("at"!==i&&"bubble"!==i)throw new Error(`Invalid event phase: ${JSON.stringify(i)}`);yield`${i}:${n}`}else yield`at:${n}`,yield`bubble:${n}`}n.d(t,"a",function(){return c}),n.d(t,"b",function(){return d}),n.d(t,"c",function(){return h}),n.d(t,"d",function(){return p}),function(e){e[e.CONTROL=1]="CONTROL",e[e.ALT=2]="ALT",e[e.META=4]="META",e[e.SHIFT=8]="SHIFT"}(i||(i={}));class c extends s{static fromObject(e,t={}){const n=new c;if(n.label=t.label,void 0!==t.parents)for(const[e,i]of t.parents)n.addParent(e,i);for(const t of Object.keys(e))n.set(t,a(e[t]));return n}setFromObject(e){for(const t of Object.keys(e))this.set(t,a(e[t]))}set(e,t){const n=a(t);for(const t of l(e))super.set(t,n)}delete(e){for(const t of l(e))super.delete(t)}describe(){const e=[],t=new Map;for(const[e,n]of this.entries()){const i=e.indexOf(":");t.set(e.substring(i+1),n.action)}for(const[n,i]of t)e.push(`${n}${i}`);return e.join(", ")}}const u=[];function d(e,t,n,i,r){const s=u[n]+":"+e;!function(e,t,n){if(void 0===n)return;!1!==n.stopPropagation&&e.stopPropagation();const i=new CustomEvent("action:"+n.action,{bubbles:!0,detail:t,cancelable:!0}),r=!e.target.dispatchEvent(i);(!1!==n.preventDefault||r)&&e.preventDefault()}(t,i,r.get(s))}function h(e,t,n,i){var r;d(o(e,((r=t).ctrlKey?1:0)|(r.altKey?2:0)|(r.metaKey?4:0)|(r.shiftKey?8:0)),t,t.eventPhase,n,i)}function p(e,t,n,i){return Object(r.d)(e,`action:${t}`,n,i)}u[Event.AT_TARGET]="at",u[Event.CAPTURING_PHASE]="capture",u[Event.BUBBLING_PHASE]="bubble"},function(e,t,n){"use strict";n.d(t,"e",function(){return d}),n.d(t,"d",function(){return p}),n.d(t,"a",function(){return g}),n.d(t,"b",function(){return m}),n.d(t,"c",function(){return v}),n.d(t,"g",function(){return y}),n.d(t,"f",function(){return w});var i=n(14),r=n(2);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const s=!("undefined"!=typeof Window&&self instanceof Window),o=!1,a=!1,l="rpc.promise.response",c="rpc.promise.cancel";var u=new Map;function d(e,t){u.set(e,t)}class h extends Error{constructor(e,t){super(t),this.name=e,this.message=t}}function p(e,t){d(e,function(e){let n=e.id;const r=new i.b;let s=t.call(this,e,r);this.set(n,{promise:s,cancellationToken:r}),s.then(({value:e,transfers:t})=>{this.delete(n),this.invoke(l,{id:n,value:e},t)},e=>{this.delete(n),this.invoke(l,{id:n,error:e.message,errorName:e.name})})})}d(c,function(e){let t=e.id;const n=this.get(t);if(void 0!==n){let{cancellationToken:e}=n;e.cancel()}}),d(l,function(e){let t=e.id,{resolve:n,reject:r}=this.get(t);if(this.delete(t),e.hasOwnProperty("value"))n(e.value);else{e.errorName===i.a.name?r(i.a):r(new h(e.errorName,e.error))}});const f=s?-1:0;class g{constructor(e){this.target=e,this.objects=new Map,this.nextId=f,e.onmessage=(e=>{let t=e.data;a&&console.log("Received message",t),u.get(t.functionName).call(this,t)})}get numObjects(){return this.objects.size}set(e,t){this.objects.set(e,t)}delete(e){this.objects.delete(e)}get(e){return this.objects.get(e)}getRef(e){let t=e.id,n=this.get(t);return n.referencedGeneration=e.gen,n.addRef(),n}invoke(e,t,n){t.functionName=e,a&&console.trace("Sending message",t),this.target.postMessage(t,n)}promiseInvoke(e,t,n=i.e,r){return Object(i.d)(n,(n,i,s)=>{const o=t.id=this.newId();this.set(o,{resolve:n,reject:i}),this.invoke(e,t,r),s.add(()=>{this.invoke(c,{id:o})})})}newId(){return s?this.nextId--:this.nextId++}}class m extends r.a{constructor(){super(...arguments),this.rpc=null,this.rpcId=null}initializeSharedObject(e,t=e.newId()){this.rpc=e,this.rpcId=t,this.isOwner=!1,e.set(t,this)}initializeCounterpart(e,t={}){this.initializeSharedObject(e),this.unreferencedGeneration=0,this.referencedGeneration=0,this.isOwner=!0,t.id=this.rpcId,t.type=this.RPC_TYPE_ID,e.invoke("SharedObject.new",t)}dispose(){super.dispose()}addCounterpartRef(){return{id:this.rpcId,gen:++this.referencedGeneration}}refCountReachedZero(){!0===this.isOwner?this.referencedGeneration===this.unreferencedGeneration&&this.ownerDispose():!1===this.isOwner?this.rpc.invoke("SharedObject.refCountReachedZero",{id:this.rpcId,gen:this.referencedGeneration}):super.refCountReachedZero()}ownerDispose(){o&&console.log(`[${s}] #rpc object = ${this.rpc.numObjects}`);let{rpc:e,rpcId:t}=this;super.refCountReachedZero(),e.delete(t),e.invoke("SharedObject.dispose",{id:t})}counterpartRefCountReachedZero(e){this.unreferencedGeneration=e,0===this.refCount&&e===this.referencedGeneration&&this.ownerDispose()}}class v extends m{constructor(e,t={}){super(),function(e,t,n={}){null!=t&&e.initializeSharedObject(t,n.id)}(this,e,t)}}d("SharedObject.dispose",function(e){let t=this.get(e.id);if(0!==t.refCount)throw new Error("Attempted to dispose object with non-zero reference count.");o&&console.log(`[${s}] #rpc objects: ${this.numObjects}`),t.disposed(),this.delete(t.rpcId),t.rpcId=null,t.rpc=null}),d("SharedObject.refCountReachedZero",function(e){let t=this.get(e.id),n=e.gen;t.counterpartRefCountReachedZero(n)});const b=new Map;function y(e){return t=>{t.prototype.RPC_TYPE_ID=e}}function w(e){return t=>{if(void 0!==e)t.prototype.RPC_TYPE_ID=e;else if(void 0===(e=t.prototype.RPC_TYPE_ID))throw new Error("RPC_TYPE_ID should have already been defined");b.set(e,t)}}d("SharedObject.new",function(e){let t=e.type;--new(b.get(t))(this,e).refCount})},function(e,t,n){"use strict";n.d(t,"f",function(){return a}),n.d(t,"c",function(){return l}),n.d(t,"g",function(){return u}),n.d(t,"a",function(){return d}),n.d(t,"d",function(){return h}),n.d(t,"b",function(){return p}),n.d(t,"e",function(){return f}),n.d(t,"h",function(){return g});var i=n(13),r=n.n(i),s=n(2),o=n(3);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class a{constructor(e){this.value_=e,this.changed=new o.a}get value(){return this.value_}set value(e){e!==this.value_&&(this.value_=e,this.changed.dispatch())}}class l extends a{constructor(e,t,n=e){super(e),this.validator=t,this.defaultValue=n}toJSON(){let{value_:e}=this;if(e!==this.defaultValue)return this.value_}reset(){this.value=this.defaultValue}restoreState(e){if(void 0!==e){let{validator:t}=this;try{return void(this.value=t(e))}catch(e){}}this.value=this.defaultValue}}class c extends s.a{constructor(e,t){super(),this.changed=new o.a,this.f=e,this.ws=t;for(const e of t)this.registerDisposer(e.changed.add(this.changed.dispatch))}get value(){return this.f(...this.ws.map(e=>e.value))}}function u(e,...t){return new c(e,t)}class d extends s.a{constructor(e,...t){super(),this.f=e,this.changed=new o.a;for(const e of t)this.registerDisposer(e.add(this.changed.dispatch))}get value(){return this.f()}}class h extends s.a{constructor(){super(...arguments),this.changed=new o.a}get value(){return this.value_}set value(e){const{value_:t}=this;if(this.value_=e,void 0!==t&&(t.dispose(),t.unregisterDisposer(this.valueHandler),this.valueHandler=void 0),void 0!==e){const t=this.valueHandler=(()=>{this.value_===e&&(this.value_=void 0,this.changed.dispatch())});e.registerDisposer(t)}e!==t&&this.changed.dispatch()}reset(){this.value=void 0}disposed(){void 0!==this.value_&&(this.value_.unregisterDisposer(this.valueHandler),this.value_.dispose()),this.value_=void 0,super.disposed()}}class p extends h{constructor(e,t){super(),this.validator=e,this.jsonConverter=t}toJSON(){const{value:e}=this;return e&&this.jsonConverter(e)}restoreState(e){this.value=this.validator(e)}}class f{constructor(e){this.changed=new o.a,this.values=void 0===e?new Set:new Set(e)}add(e){const{values:t}=this;return t.has(e)||(t.add(e),this.changed.dispatch()),this}delete(e){const{values:t}=this;return!!t.delete(e)&&(this.changed.dispatch(),!0)}has(e){return this.values.has(e)}get size(){return this.values.size}[Symbol.iterator](){return this.values[Symbol.iterator]()}clear(){const{values:e}=this;e.size>0&&(e.clear(),this.changed.dispatch())}}function g(e,t){let n,i;function o(){n=e.value,i=new s.a,t(i,n)}const a=r()(()=>{e.value!==n&&(i.dispose(),o())},0),l=e.changed.add(a);return o(),()=>{a.cancel(),l(),i.dispose()}}},function(e,t,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function i(e){for(;;){let t=e.firstElementChild;if(!t)break;e.removeChild(t)}}function r(e){let{parentElement:t}=e;return!!t&&(t.removeChild(e),!0)}n.d(t,"a",function(){return i}),n.d(t,"b",function(){return r})},function(e,t,n){"use strict";n.d(t,"b",function(){return f}),n.d(t,"a",function(){return m}),n.d(t,"d",function(){return v}),n.d(t,"c",function(){return y}),n.d(t,"e",function(){return w}),n.d(t,"f",function(){return x});var i=n(5),r=n(57),s=n(9),o=n(14),a=n(1),l=n(84),c=n(35),u=n(3),d=n(8),h=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const p=!1;class f{constructor(e){this.source=e,this.state=i.g.SYSTEM_MEMORY}get gl(){return this.source.gl}copyToGPU(e){this.state=i.g.GPU_MEMORY}freeGPUMemory(e){this.state=i.g.SYSTEM_MEMORY}}function g(e){if("number"!=typeof e||e<0)throw new Error(`Expected non-negative number as limit, but received: ${JSON.stringify(e)}`);return e}class m{constructor({defaultItemLimit:e=Number.POSITIVE_INFINITY,defaultSizeLimit:t=Number.POSITIVE_INFINITY}={}){this.sizeLimit=new s.c(t,g),this.itemLimit=new s.c(e,g)}}let v=class extends d.b{constructor(e,t,n,i){super(),this.gl=t,this.frameNumberCounter=n,this.capacities=i,this.visibleChunksChanged=new u.a,this.pendingChunkUpdates=null,this.pendingChunkUpdatesTail=null,this.chunkUpdateDeadline=null,this.chunkUpdateDelay=30;const s=t=>({itemLimit:this.registerDisposer(r.a.makeFromExisting(e,t.itemLimit)).rpcId,sizeLimit:this.registerDisposer(r.a.makeFromExisting(e,t.sizeLimit)).rpcId});this.initializeCounterpart(e,{gpuMemoryCapacity:s(i.gpuMemory),systemMemoryCapacity:s(i.systemMemory),downloadCapacity:s(i.download),computeCapacity:s(i.compute)})}scheduleChunkUpdate(){let e,t=this.chunkUpdateDeadline;e=null===t||Date.now()<t?0:this.chunkUpdateDelay,setTimeout(this.processPendingChunkUpdates.bind(this),e)}processPendingChunkUpdates(){let e=this.chunkUpdateDeadline;null===e&&(e=Date.now()+30);let t=!1;for(;;){if(Date.now()>e){setTimeout(this.processPendingChunkUpdates.bind(this),this.chunkUpdateDelay);break}let n=this.pendingChunkUpdates;this.applyChunkUpdate(n)&&(t=!0);let i=this.pendingChunkUpdates=n.nextUpdate;if(--window.numPendingChunkUpdates,null==i){this.pendingChunkUpdatesTail=null;break}}t&&this.visibleChunksChanged.dispatch()}handleFetch_(e,t){const{resolve:n,reject:i,cancellationToken:r}=t.promise;if(r.isCanceled)return void i(o.a);const s=t.key,a=e.chunks.get(s);if(!a)return void i(new Error(`No chunk found at ${s} for source ${e.constructor.name}`));const l=a.data;l?n({value:l}):i(new Error(`At ${s} for source ${e.constructor.name}: chunk has no data`))}applyChunkUpdate(e){let t=!1,{rpc:n}=this;const r=n.get(e.source);if(p&&console.log(`${Date.now()} Chunk.update processed: ${r.rpcId} `+`${e.id} ${e.state}`),void 0!==e.promise)this.handleFetch_(r,e);else if(void 0===e.id){for(const e of r.chunks.keys())r.deleteChunk(e);t=!0}else{let n=e.state;if(n===i.g.EXPIRED)r.deleteChunk(e.id);else{let s,o=e.id;if(e.new?(s=r.getChunk(e),r.addChunk(o,s)):s=r.chunks.get(o),n!==s.state)switch(n){case i.g.GPU_MEMORY:s.copyToGPU(this.gl),t=!0;break;case i.g.SYSTEM_MEMORY:s.freeGPUMemory(this.gl);break;default:throw new Error(`INTERNAL ERROR: Invalid chunk state: ${i.g[n]}`)}}}return t}};function b(e,t){let n=e.get(t.source);p&&console.log(`${Date.now()} Chunk.update received: `+`${n.rpcId} ${t.id} ${t.state} with chunkDataSize ${t.chunkDataSize}`);let i=n.chunkManager.chunkQueueManager;if(n.immediateChunkUpdates)return void(i.applyChunkUpdate(t)&&i.visibleChunksChanged.dispatch());let r=i.pendingChunkUpdatesTail;++window.numPendingChunkUpdates,null==r?(i.pendingChunkUpdates=t,i.pendingChunkUpdatesTail=t,i.scheduleChunkUpdate()):(r.nextUpdate=t,i.pendingChunkUpdatesTail=t)}v=h([Object(d.g)(i.b)],v),window.numPendingChunkUpdates=0,Object(d.e)("Chunk.update",function(e){b(this,e)}),Object(d.d)("Chunk.retrieve",function(e,t){return new Promise((n,i)=>{e.promise={resolve:n,reject:i,cancellationToken:t},b(this,e)})});let y=class extends d.b{constructor(e){super(),this.chunkQueueManager=e,this.memoize=new l.b,this.registerDisposer(e.addRef()),this.initializeCounterpart(e.rpc,{chunkQueueManager:e.rpcId})}get gl(){return this.chunkQueueManager.gl}getChunkSource(e,t){const n=e.encodeOptions(t);n.constructorId=Object(c.a)(e);const i=Object(a.g)(n);return this.memoize.get(i,()=>{const i=new e(this,t);return i.initializeCounterpart(this.rpc,{}),i.key=n,i})}};y=h([Object(d.g)(i.a)],y);class w extends d.b{constructor(e,t={}){super(),this.chunkManager=e,this.chunks=new Map,this.immediateChunkUpdates=!1}initializeCounterpart(e,t){t.chunkManager=this.chunkManager.rpcId,super.initializeCounterpart(e,t)}get gl(){return this.chunkManager.chunkQueueManager.gl}deleteChunk(e){const t=this.chunks.get(e);t.state===i.g.GPU_MEMORY&&t.freeGPUMemory(this.gl),this.chunks.delete(e)}addChunk(e,t){this.chunks.set(e,t)}getChunk(e){throw new Error("Not implemented.")}invalidateCache(){this.rpc.invoke(i.c,{id:this.rpcId})}static encodeOptions(e){return{}}}function x(e,t){let n=class extends e{constructor(...e){super(...e);const t=e[1];this.parameters=t.parameters}initializeCounterpart(e,t){t.parameters=this.parameters,super.initializeCounterpart(e,t)}static encodeOptions(e){return Object.assign({parameters:e.parameters},super.encodeOptions(e))}};return n=h([Object(d.g)(t.RPC_ID)],n)}},function(e,t,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var i;n.d(t,"b",function(){return i}),n.d(t,"a",function(){return r}),function(e){e[e.UINT8=0]="UINT8",e[e.UINT16=1]="UINT16",e[e.UINT32=2]="UINT32",e[e.UINT64=3]="UINT64",e[e.FLOAT32=4]="FLOAT32"}(i||(i={}));const r=[];r[i.UINT8]=1,r[i.UINT16]=2,r[i.UINT32]=4,r[i.UINT64]=8,r[i.FLOAT32]=4},function(e,t,n){var i=n(114),r=n(135),s=n(137),o="Expected a function",a=Math.max,l=Math.min;e.exports=function(e,t,n){var c,u,d,h,p,f,g=0,m=!1,v=!1,b=!0;if("function"!=typeof e)throw new TypeError(o);function y(t){var n=c,i=u;return c=u=void 0,g=t,h=e.apply(i,n)}function w(e){var n=e-f;return void 0===f||n>=t||n<0||v&&e-g>=d}function x(){var e=r();if(w(e))return S(e);p=setTimeout(x,function(e){var n=t-(e-f);return v?l(n,d-(e-g)):n}(e))}function S(e){return p=void 0,b&&c?y(e):(c=u=void 0,h)}function C(){var e=r(),n=w(e);if(c=arguments,u=this,f=e,n){if(void 0===p)return function(e){return g=e,p=setTimeout(x,t),m?y(e):h}(f);if(v)return p=setTimeout(x,t),y(f)}return void 0===p&&(p=setTimeout(x,t)),h}return t=s(t)||0,i(n)&&(m=!!n.leading,d=(v="maxWait"in n)?a(s(n.maxWait)||0,t):d,b="trailing"in n?!!n.trailing:b),C.cancel=function(){void 0!==p&&clearTimeout(p),g=0,c=f=u=p=void 0},C.flush=function(){return void 0===p?h:S(r())},C}},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"e",function(){return s}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return a}),n.d(t,"d",function(){return l});const i=new
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class{constructor(){this.name="CancellationError",this.message="CANCELED"}toString(){return"CANCELED"}};const r=()=>{},s={isCanceled:!1,add:()=>r,remove:r};class o{cancel(){const{handlers:e}=this;if(null!==e&&(this.handlers=null,void 0!==e))for(let t of e)t()}get isCanceled(){return null===this.handlers}add(e){let{handlers:t}=this;return null===t?(e(),r):(void 0===t&&(t=this.handlers=new Set),t.add(e),()=>{this.remove(e)})}remove(e){const{handlers:t}=this;null!=t&&t.delete(e)}}class a extends o{constructor(){super(...arguments),this.consumers=new Set}addConsumer(e=s){const{consumers:t}=this;t.has(e)||e.isCanceled||(t.add(e),e.add(()=>{t.delete(e),0===t.size&&this.cancel()}))}}function l(e,t){return new Promise((n,i)=>{if(e===s)return void t(n,i,s);const r=new o,a=e.add(()=>{r.cancel()});t(e=>{a(),n(e)},e=>{a(),i(e)},r)})}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var r=(o=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),s=i.sources.map(function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"});return[n].concat(s).concat([r]).join("\n")}var o;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},r=0;r<this.length;r++){var s=this[r][0];null!=s&&(i[s]=!0)}for(r=0;r<e.length;r++){var o=e[r];null!=o[0]&&i[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),t.push(o))}},t}},function(e,t,n){var i,r,s={},o=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=i.apply(this,arguments)),r}),a=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var i=function(e,t){return t?t.querySelector(e):document.querySelector(e)}.call(this,e,n);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}}(),l=null,c=0,u=[],d=n(145);function h(e,t){for(var n=0;n<e.length;n++){var i=e[n],r=s[i.id];if(r){r.refs++;for(var o=0;o<r.parts.length;o++)r.parts[o](i.parts[o]);for(;o<i.parts.length;o++)r.parts.push(b(i.parts[o],t))}else{var a=[];for(o=0;o<i.parts.length;o++)a.push(b(i.parts[o],t));s[i.id]={id:i.id,refs:1,parts:a}}}}function p(e,t){for(var n=[],i={},r=0;r<e.length;r++){var s=e[r],o=t.base?s[0]+t.base:s[0],a={css:s[1],media:s[2],sourceMap:s[3]};i[o]?i[o].parts.push(a):n.push(i[o]={id:o,parts:[a]})}return n}function f(e,t){var n=a(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=u[u.length-1];if("top"===e.insertAt)i?i.nextSibling?n.insertBefore(t,i.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),u.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=a(e.insertAt.before,n);n.insertBefore(t,r)}}function g(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=u.indexOf(e);t>=0&&u.splice(t,1)}function m(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var i=function(){0;return n.nc}();i&&(e.attrs.nonce=i)}return v(t,e.attrs),f(e,t),t}function v(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function b(e,t){var n,i,r,s;if(t.transform&&e.css){if(!(s="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=s}if(t.singleton){var o=c++;n=l||(l=m(t)),i=x.bind(null,n,o,!1),r=x.bind(null,n,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",v(t,e.attrs),f(e,t),t}(t),i=function(e,t,n){var i=n.css,r=n.sourceMap,s=void 0===t.convertToAbsoluteUrls&&r;(t.convertToAbsoluteUrls||s)&&(i=d(i));r&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var o=new Blob([i],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(o),a&&URL.revokeObjectURL(a)}.bind(null,n,t),r=function(){g(n),n.href&&URL.revokeObjectURL(n.href)}):(n=m(t),i=function(e,t){var n=t.css,i=t.media;i&&e.setAttribute("media",i);if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}.bind(null,n),r=function(){g(n)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else r()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=o()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=p(e,t);return h(n,t),function(e){for(var i=[],r=0;r<n.length;r++){var o=n[r];(a=s[o.id]).refs--,i.push(a)}e&&h(p(e,t),t);for(r=0;r<i.length;r++){var a;if(0===(a=i[r]).refs){for(var l=0;l<a.parts.length;l++)a.parts[l]();delete s[a.id]}}}};var y,w=(y=[],function(e,t){return y[e]=t,y.filter(Boolean).join("\n")});function x(e,t,n,i){var r=n?"":i.css;if(e.styleSheet)e.styleSheet.cssText=w(t,r);else{var s=document.createTextNode(r),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(s,o[t]):e.appendChild(s)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const i=new Uint32Array(2),r=4294967296;let s=[];for(let e=2;e<=36;++e){let t=Math.floor(32/Math.log2(e)),n=Math.pow(e,t),i=`^[0-${String.fromCharCode("0".charCodeAt(0)+Math.min(9,e-1))}`;e>10&&(i+=`a-${String.fromCharCode("a".charCodeAt(0)+e-11)}`,i+=`A-${String.fromCharCode("A".charCodeAt(0)+e-11)}`),i+=`]{1,${Math.ceil(64/Math.log2(e))}}$`;let r=new RegExp(i);s[e]={lowDigits:t,lowBase:n,pattern:r}}function o(e,t){const n=65535&(e>>>=0),i=e>>>16,r=65535&(t>>>=0),s=t>>>16;let o=(n*r>>>16)+i*r,a=o>>>16,l=(a+=(o=(65535&o)+n*s)>>>16)>>>16;return((65535&(l+=(a=(65535&a)+i*s)>>>16))<<16|65535&a)>>>0}class a{constructor(e=0,t=0){this.low=e,this.high=t}clone(){return new a(this.low,this.high)}assign(e){this.low=e.low,this.high=e.high}toString(e=10){let t=this.low,n=this.high;if(0===n)return t.toString(e);n*=r;let{lowBase:i,lowDigits:o}=s[e],a=n%i;n=Math.floor(n/i),t+=a,n+=Math.floor(t/i);let l=(t%=i).toString(e);return n.toString(e)+"0".repeat(o-l.length)+l}static less(e,t){return e.high<t.high||e.high===t.high&&e.low<t.low}static compare(e,t){return e.high-t.high||e.low-t.low}static equal(e,t){return e.low===t.low&&e.high===t.high}static min(e,t){return a.less(e,t)?e:t}static max(e,t){return a.less(e,t)?t:e}static random(){return crypto.getRandomValues(i),new a(i[0],i[1])}tryParseString(e,t=10){const{lowDigits:n,lowBase:i,pattern:a}=s[t];if(!a.test(e))return!1;if(e.length<=n)return this.low=parseInt(e,t),this.high=0,!0;const l=e.length-n,c=parseInt(e.substr(l),t),u=parseInt(e.substr(0,l),t);let d,h;if(i===r)d=u,h=c;else{const e=Math.imul(u,i)>>>0;d=o(u,i)+(Math.imul(Math.floor(u/r),i)>>>0),(h=c+e)>=r&&(++d,h-=r)}return h>>>0===h&&d>>>0===d&&(this.low=h,this.high=d,!0)}parseString(e,t=10){if(!this.tryParseString(e,t))throw new Error(`Failed to parse string as uint64 value: ${JSON.stringify(e)}.`);return this}static parseString(e,t=10){return(new a).parseString(e,t)}valid(){let{low:e,high:t}=this;return e>>>0===e&&t>>>0===t}toJSON(){return this.toString()}static lshift(e,t,n){const{low:i,high:r}=t;return 0===n?(e.low=i,e.high=r):n<32?(e.low=i<<n,e.high=r<<n|i>>>32-n):(e.low=0,e.high=i<<n-32),e}static rshift(e,t,n){const{low:i,high:r}=t;return 0===n?(e.low=i,e.high=r):n<32?(e.low=i>>>n|r<<32-n,e.high=r>>>n):(e.low=r>>>n-32,e.high=0),e}static or(e,t,n){return e.low=t.low|n.low,e.high=t.high|n.high,e}static xor(e,t,n){return e.low=t.low^n.low,e.high=t.high^n.high,e}static and(e,t,n){return e.low=t.low&n.low,e.high=t.high&n.high,e}static add(e,t,n){let i=t.low+n.low,r=t.high+n.high;const s=i>>>0;return s!==i&&(r+=1),e.low=s,e.high=r>>>0,e}static addUint32(e,t,n){let i=t.low+n,r=t.high;const s=i>>>0;return s!==i&&(r+=1),e.low=s,e.high=r>>>0,e}static decrement(e,t){let{low:n,high:i}=t;return 0===n&&(i-=1),e.low=n-1>>>0,e.high=i>>>0,e}static increment(e,t){let{low:n,high:i}=t;return 4294967295===n&&(i+=1),e.low=n+1>>>0,e.high=i>>>0,e}static subtract(e,t,n){let i=t.low-n.low,r=t.high-n.high;const s=i>>>0;return s!==i&&(r-=1),e.low=s,e.high=r>>>0,e}static multiplyUint32(e,t,n){const{low:i,high:r}=t;return e.low=Math.imul(i,n)>>>0,e.high=Math.imul(r,n)+o(i,n)>>>0,e}static lowMask(e,t){return t<=32?(e.high=0,e.low=4294967295>>>32-t):(e.high=4294967295>>>t-32,e.low=4294967295),e}}a.ZERO=new a(0,0),a.ONE=new a(1,0)},function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"c",function(){return l}),n.d(t,"a",function(){return c});var i=n(13),r=n.n(i),s=n(2),o=n(3);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class a{constructor(e,t=e){this.value_=e,this.defaultValue=t,this.changed=new o.a}get value(){return this.value_}set value(e){e!==this.value_&&(this.value_=e,this.changed.dispatch())}toggle(){this.value=!this.value}toJSON(){let{value_:e}=this;if(e!==this.defaultValue)return this.value_}restoreState(e){this.value=!0!==e&&!1!==e?this.defaultValue:e}reset(){this.value=this.defaultValue}}class l extends s.a{constructor(e){super(),this.model=e,this.element=document.createElement("input");let{element:t}=this;t.type="checkbox",this.registerDisposer(e.changed.add(()=>{this.updateCheckbox()})),this.updateCheckbox(),this.registerEventListener(t,"change",function(t){e.value=this.checked}),t.addEventListener("mousedown",e=>{e.preventDefault()})}updateCheckbox(){this.element.checked=this.model.value}disposed(){let{element:e}=this,{parentElement:t}=e;t&&t.removeChild(e),super.disposed()}}class c extends s.a{constructor(e,t){super(),this.model=e,this.element=t,this.initialDisplay=this.element.style.display,this.updateVisibility(),this.registerDisposer(e.changed.add(this.registerCancellable(r()(()=>this.updateVisibility(),0))))}updateVisibility(){this.element.style.display=this.model.value?this.initialDisplay:"none"}}},function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return a});var i=n(2),r=n(1),s=n(35);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class o{constructor(e,t=WebGL2RenderingContext.ARRAY_BUFFER){this.gl=e,this.bufferType=t,this.gl=e,this.buffer=e.createBuffer()}bind(){this.gl.bindBuffer(this.bufferType,this.buffer)}bindToVertexAttrib(e,t,n=WebGL2RenderingContext.FLOAT,i=!1,r=0,s=0){this.bind(),this.gl.enableVertexAttribArray(e),this.gl.vertexAttribPointer(e,t,n,i,r,s)}bindToVertexAttribI(e,t,n=WebGL2RenderingContext.UNSIGNED_INT,i=0,r=0){this.bind(),this.gl.enableVertexAttribArray(e),this.gl.vertexAttribIPointer(e,t,n,i,r)}setData(e,t=WebGL2RenderingContext.STATIC_DRAW){let n=this.gl;this.bind(),n.bufferData(this.bufferType,e,t)}dispose(){this.gl.deleteBuffer(this.buffer),this.buffer=void 0,this.gl=void 0}static fromData(e,t,n,i){let r=new o(e,n);return r.setData(t,i),r}}function a(e,t,n,...a){return e.memoize.get(Object(r.g)({id:"getMemoizedBuffer",getter:Object(s.a)(n),args:a}),()=>{const r=new i.b(o.fromData(e,n(...a),t,WebGL2RenderingContext.STATIC_DRAW));return r.registerDisposer(r.value),r})}},function(e,t,n){"use strict";var i=n(13),r=n.n(i),s=n(9),o=n(77),a=n(2),l=n(0),c=n(1),u=n(3);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function d(e,t){e.remove(t)}function h(e,t){e.add(t)}var p,f=n(17),g=n(25),m=n(31);function v(){return new s.e([p.DATA,p.ANNOTATION,p.DEFAULT_ANNOTATION])}n.d(t,"g",function(){return p}),n.d(t,"k",function(){return v}),n.d(t,"f",function(){return b}),n.d(t,"j",function(){return y}),n.d(t,"i",function(){return S}),n.d(t,"d",function(){return C}),n.d(t,"a",function(){return O}),n.d(t,"e",function(){return L}),n.d(t,"c",function(){return T}),n.d(t,"l",function(){return E}),n.d(t,"h",function(){return A}),n.d(t,"b",function(){return M}),function(e){e[e.DATA=0]="DATA",e[e.ANNOTATION=1]="ANNOTATION",e[e.DEFAULT_ANNOTATION=2]="DEFAULT_ANNOTATION"}(p||(p={}));class b extends a.a{constructor(){super(...arguments),this.ready=!1,this.role=p.DATA,this.layerChanged=new u.a,this.redrawNeeded=new u.a,this.readyStateChanged=new u.a,this.voxelSize=null,this.boundingBox=null}setReady(e){this.ready=e,this.readyStateChanged.dispatch(),this.layerChanged.dispatch()}handleAction(e){}getValueAt(e){}transformPickedValue(e,t){return e}updateMouseState(e,t,n,i){}}class y extends b{constructor(){super(...arguments),this.visibility=new g.a}}const w="tab",x="tool";class S extends a.a{constructor(e,t){super(),this.manager=e,this.layersChanged=new u.a,this.readyStateChanged=new u.a,this.specificationChanged=new u.a,this.renderLayers=new Array,this.isReady=!1,this.tabs=this.registerDisposer(new m.c),this.tool=this.registerDisposer(new s.b(e=>Object(o.c)(this,e),e=>e.toJSON())),this.tabs.changed.add(this.specificationChanged.dispatch),this.tool.changed.add(this.specificationChanged.dispatch)}restoreState(e){this.tool.restoreState(e[x]),this.tabs.restoreState(e[w])}addRenderLayer(e){this.renderLayers.push(e);const{layersChanged:t,readyStateChanged:n}=this;e.layerChanged.add(t.dispatch),e.readyStateChanged.add(n.dispatch),n.dispatch(),t.dispatch()}removeRenderLayer(e){const{renderLayers:t,layersChanged:n,readyStateChanged:i}=this,r=t.indexOf(e);if(-1===r)throw new Error("Attempted to remove invalid RenderLayer");t.splice(r,1),e.layerChanged.remove(n.dispatch),e.readyStateChanged.remove(i.dispatch),e.dispose(),i.dispatch(),n.dispatch()}disposed(){const{layersChanged:e,readyStateChanged:t}=this;for(const n of this.renderLayers)n.layerChanged.remove(e.dispatch),n.readyStateChanged.remove(t.dispatch),n.dispose();super.disposed()}getValueAt(e,t){let n,{renderLayers:i}=this,{pickedRenderLayer:r}=t;if(null!==r&&-1!==i.indexOf(r))return n=r.transformPickedValue(t.pickedValue,t.pickedOffset),this.transformPickedValue(n);for(let t of i)if(t.ready&&void 0!==(n=t.getValueAt(e)))break;return this.transformPickedValue(n)}transformPickedValue(e){return e}toJSON(){return{[w]:this.tabs.toJSON(),[x]:this.tool.toJSON()}}handleAction(e){}}class C extends a.a{constructor(e,t=null,n=!0){super(),this.visible=n,this.readyStateChanged=new u.a,this.layerChanged=new u.a,this.specificationChanged=new u.a,this.wasDisposed=!1,this.layer_=null,this.name_=e,this.layer=t}get layer(){return this.layer_}set layer(e){let t=this.layer_;if(null!=t&&(this.unregisterUserLayer(),t.dispose()),this.layer_=e,null!=e){const t=[e.layersChanged.add(()=>this.handleLayerChanged()),e.readyStateChanged.add(this.readyStateChanged.dispatch),e.specificationChanged.add(this.specificationChanged.dispatch)];this.unregisterUserLayer=(()=>{t.forEach(e=>e())}),this.readyStateChanged.dispatch(),this.handleLayerChanged()}}isReady(){const{layer:e}=this;return null!==e&&e.isReady}get name(){return this.name_}set name(e){e!==this.name_&&(this.name_=e,this.layerChanged.dispatch())}handleLayerChanged(){this.visible&&this.layerChanged.dispatch()}setVisible(e){e!==this.visible&&(this.visible=e,this.layerChanged.dispatch())}disposed(){this.wasDisposed=!0,this.layer=null,super.disposed()}}class O extends a.a{constructor(){super(),this.managedLayers=new Array,this.layerSet=new Set,this.layersChanged=new u.a,this.readyStateChanged=new u.a,this.specificationChanged=new u.a,this.boundPositions=new WeakSet,this.numDirectUsers=0,this.renderLayerToManagedLayerMapGeneration=-1,this.renderLayerToManagedLayerMap_=new Map,this.scheduleRemoveLayersWithSingleRef=this.registerCancellable(r()(()=>this.removeLayersWithSingleRef(),0)),this.layersChanged.add(this.scheduleRemoveLayersWithSingleRef)}get renderLayerToManagedLayerMap(){const e=this.layersChanged.count,t=this.renderLayerToManagedLayerMap_;if(this.renderLayerToManagedLayerMapGeneration!==e){this.renderLayerToManagedLayerMapGeneration=e,t.clear();for(const e of this.managedLayers){const n=e.layer;if(null!==n)for(const i of n.renderLayers)t.set(i,e)}}return t}filter(e){let t=!1;this.managedLayers=this.managedLayers.filter(n=>!!e(n)||(this.unbindManagedLayer(n),this.layerSet.delete(n),t=!0,!1)),t&&this.layersChanged.dispatch()}removeLayersWithSingleRef(){this.numDirectUsers>0||this.filter(e=>1!==e.refCount)}updateSignalBindings(e,t){t(e.layerChanged,this.layersChanged.dispatch),t(e.readyStateChanged,this.readyStateChanged.dispatch),t(e.specificationChanged,this.specificationChanged.dispatch)}useDirectly(){return 1==++this.numDirectUsers&&this.layersChanged.remove(this.scheduleRemoveLayersWithSingleRef),()=>{0==--this.numDirectUsers&&(this.layersChanged.add(this.scheduleRemoveLayersWithSingleRef),this.scheduleRemoveLayersWithSingleRef())}}addManagedLayer(e,t){return this.updateSignalBindings(e,h),this.layerSet.add(e),void 0===t&&(t=this.managedLayers.length),this.managedLayers.splice(t,0,e),this.layersChanged.dispatch(),this.readyStateChanged.dispatch(),e}addUserLayer(e,t,n){let i=new C(e,t,n);return this.addManagedLayer(i)}*readyRenderLayers(){for(let e of this.managedLayers)if(e.visible&&e.layer)for(let t of e.layer.renderLayers)t.ready&&(yield t)}unbindManagedLayer(e){this.updateSignalBindings(e,d),e.dispose()}clear(){for(let e of this.managedLayers)this.unbindManagedLayer(e);this.managedLayers.length=0,this.layerSet.clear(),this.layersChanged.dispatch()}remove(e){const t=this.managedLayers[e];this.unbindManagedLayer(t),this.managedLayers.splice(e,1),this.layerSet.delete(t),this.layersChanged.dispatch()}removeManagedLayer(e){let t=this.managedLayers.indexOf(e);if(-1===t)throw new Error("Internal error: invalid managed layer.");this.remove(t)}reorderManagedLayer(e,t){const n=this.managedLayers.length;if(e===t||e<0||e>=n||t<0||t>=n)return;let[i]=this.managedLayers.splice(e,1);this.managedLayers.splice(t,0,i),this.layersChanged.dispatch()}disposed(){this.clear(),super.disposed()}getLayerByName(e){return this.managedLayers.find(t=>t.name===e)}getUniqueLayerName(e){let t=e,n=0;for(;void 0!==this.getLayerByName(t);)t=e+ ++n;return t}has(e){return this.layerSet.has(e)}initializePosition(e){let{boundPositions:t}=this;if(t.has(e))return;t.add(e);const n=r()(()=>{this.updatePositionFromLayers(e)});this.readyStateChanged.add(n),e.changed.add(n),this.updatePositionFromLayers(e)}updatePositionFromLayers(e){if(!e.valid)for(let t of this.managedLayers){let n=t.layer;if(null!=n)for(let t of n.renderLayers)if(t.ready&&(e.voxelSize.valid||null==t.voxelSize||(l.u.copy(e.voxelSize.size,t.voxelSize),e.voxelSize.setValid()),!e.spatialCoordinatesValid&&!e.voxelCoordinatesValid&&null!=t.boundingBox)){let n=t.boundingBox,i=e.spatialCoordinates;l.u.add(i,n.lower,n.upper),l.u.scale(i,i,.5),e.spatialCoordinatesValid=!0,e.changed.dispatch()}}}get renderLayers(){let e=this;return{*[Symbol.iterator](){for(let t of e.managedLayers)if(null!==t.layer)for(let e of t.layer.renderLayers)yield e}}}get visibleRenderLayers(){let e=this;return{*[Symbol.iterator](){for(let t of e.managedLayers)if(null!==t.layer&&t.visible)for(let e of t.layer.renderLayers)yield e}}}invokeAction(e){for(let t of this.managedLayers){if(null===t.layer||!t.visible)continue;let n=t.layer;n.handleAction(e);for(let t of n.renderLayers)t.ready&&t.handleAction(e)}}}class L{constructor(){this.changed=new u.a,this.position=l.u.create(),this.active=!1,this.pickedRenderLayer=null,this.pickedValue=new f.a(0,0),this.pickedOffset=0,this.pickedAnnotationLayer=void 0,this.pickedAnnotationId=void 0,this.pickedAnnotationBuffer=void 0,this.pickedAnnotationBufferOffset=void 0,this.forcerFunction=void 0}removeForcer(e){e===this.forcerFunction&&(this.forcerFunction=void 0,this.setActive(!1))}setForcer(e){this.forcerFunction=e,void 0===e&&this.setActive(!1)}updateUnconditionally(){const{forcerFunction:e}=this;return void 0!==e&&(e(),this.active)}setActive(e){this.active===e&&!0!==e||(this.active=e,this.changed.dispatch())}}class T extends a.a{constructor(e,t){super(),this.layerManager=e,this.mouseState=t,this.values=new Map,this.changed=new u.a,this.needsUpdate=!0,this.registerDisposer(t.changed.add(()=>{this.handleChange()})),this.registerDisposer(e.layersChanged.add(()=>{this.handleLayerChange()}))}handleLayerChange(){this.mouseState.active&&this.handleChange()}handleChange(){this.needsUpdate=!0,this.changed.dispatch()}update(){if(!this.needsUpdate)return;this.needsUpdate=!1;let e=this.values,t=this.mouseState;if(e.clear(),t.active){let n=t.position;for(let i of this.layerManager.managedLayers){let r=i.layer;i.visible&&r&&e.set(r,r.getValueAt(n,t))}}}get(e){return this.update(),this.values.get(e)}toJSON(){this.update();const e={},{values:t}=this;for(const n of this.layerManager.managedLayers){const i=n.layer;if(i){let r=t.get(i);void 0!==r&&(r instanceof f.a&&(r={t:"u64",v:r}),e[n.name]=r)}}return e}}class k extends a.a{constructor(e,t,n,i,s){super(),this.layerManager=e,this.renderLayerType=t,this.roles=n,this.layerAdded=i,this.visibility=s,this.visibleLayers=new Map,this.newVisibleLayers=new Set,this.debouncedUpdateVisibleLayers=this.registerCancellable(r()(()=>this.updateVisibleLayers(),0)),this.registerDisposer(e.layersChanged.add(this.debouncedUpdateVisibleLayers)),this.registerDisposer(n.changed.add(this.debouncedUpdateVisibleLayers)),this.updateVisibleLayers()}disposed(){this.visibleLayers.forEach(e=>e()),this.visibleLayers.clear(),super.disposed()}updateVisibleLayers(){let{visibleLayers:e,newVisibleLayers:t,renderLayerType:n,layerAdded:i,roles:r}=this;for(let s of this.layerManager.readyRenderLayers())if(s instanceof n&&r.has(s.role)){let n=s;if(t.add(n),!e.has(n)){const t=n.visibility.add(this.visibility),r=i(n);e.set(n.addRef(),()=>{r(),t(),n.dispose()})}}for(let[n,i]of e)t.has(n)||(e.delete(n),i());t.clear()}getVisibleLayers(){return this.debouncedUpdateVisibleLayers.flush(),[...this.visibleLayers.keys()]}}function E(e,t,n,i,r){return i.registerDisposer(new k(e,t,n,e=>{const t=e.redrawNeeded.add(()=>i.scheduleRedraw()),n=r&&r(e);return i.scheduleRedraw(),()=>{void 0!==n&&n(),t(),i.scheduleRedraw()}},i.visibility))}class A extends a.a{constructor(e){super(),this.layerManager=e,this.changed=new u.a,this.visible_=!1,this.size=new s.c(300,c.z),this.registerDisposer(e),this.size.changed.add(this.changed.dispatch)}get layer(){return this.layer_}get visible(){return this.visible_}set visible(e){void 0===this.layer_&&(e=!1),this.visible_!==e&&(this.visible_=e,this.changed.dispatch())}set layer(e){if(e!==this.layer_){if(void 0!==this.layer_&&(this.existingLayerDisposer(),this.existingLayerDisposer=void 0),this.layer_=e,void 0!==e){const t=()=>{this.layer_=void 0,this.visible=!1,this.existingLayerDisposer=void 0,this.changed.dispatch()};e.registerDisposer(t);const n=e.specificationChanged.add(()=>{this.changed.dispatch()});this.existingLayerDisposer=(()=>{const i=e.layer;if(null!==i){const e=i.tool.value;void 0!==e&&e.deactivate()}e.unregisterDisposer(t),n()})}else this.visible_=!1;this.changed.dispatch()}}toJSON(){if(void 0!==this.layer)return{layer:this.layer.name,visible:!0===this.visible||void 0,size:this.size.toJSON()}}restoreState(e){if(void 0===e)return void this.reset();Object(c.t)(e);const t=Object(c.v)(e,"layer",c.y),n=void 0!==t?this.layerManager.getLayerByName(t):void 0;this.layer=n,this.visible=!!Object(c.v)(e,"visible",c.w),Object(c.v)(e,"size",e=>this.size.restoreState(e))}reset(){this.layer=void 0}}class M extends a.a{constructor(e,t){super(),this.layerManager=e,this.filter=t,this.changed=new u.a,this.validate=r()(()=>{const{layerName_:e}=this;if(void 0!==e){const t=this.layerManager.getLayerByName(e);void 0!==t&&this.filter(t)?(this.layer_=t,this.changed.dispatch()):(this.layer_=void 0,this.layerName_=void 0,this.changed.dispatch())}},0),this.registerDisposer(e),this.registerDisposer(e.specificationChanged.add(()=>{const{layer_:e}=this;if(void 0!==e)if(this.layerManager.layerSet.has(e)&&this.filter(e)){const{name:t}=e;t!==this.layerName_&&(this.layerName_=t,this.changed.dispatch())}else this.layer_=void 0,this.layerName_=void 0,this.changed.dispatch()}))}get layer(){return this.layer_}get layerName(){return this.layerName_}set layer(e){this.layer_!==e&&(void 0!==e&&this.layerManager.layerSet.has(e)&&this.filter(e)?(this.layer_=e,this.layerName_=e.name):(this.layer_=void 0,this.layerName_=void 0),this.changed.dispatch())}set layerName(e){e!==this.layerName_&&(this.layer_=void 0,this.layerName_=e,this.changed.dispatch(),this.validate())}restoreState(e){const t=Object(c.y)(e);this.layerName=t}toJSON(){const{layer_:e}=this;return void 0!==e?e.name:this.layerName_}reset(){this.layerName_=void 0,this.layer_=void 0,this.changed.dispatch()}}},function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"f",function(){return g}),n.d(t,"e",function(){return m}),n.d(t,"d",function(){return v}),n.d(t,"g",function(){return b}),n.d(t,"h",function(){return y}),n.d(t,"a",function(){return S}),n.d(t,"c",function(){return C});var i=n(42),r=n(12),s=n(26),o=n(80);class a{}const l=[-1,WebGL2RenderingContext.RED_INTEGER,WebGL2RenderingContext.RG_INTEGER,WebGL2RenderingContext.RGB_INTEGER,WebGL2RenderingContext.RGBA_INTEGER],c=[-1,WebGL2RenderingContext.RED,WebGL2RenderingContext.RG,WebGL2RenderingContext.RGB,WebGL2RenderingContext.RGBA],u=["","r","rg","rgb","rgba"],d=[-1,WebGL2RenderingContext.R8UI,WebGL2RenderingContext.RG8UI,WebGL2RenderingContext.RGB8UI,WebGL2RenderingContext.RGBA8UI],h=[-1,WebGL2RenderingContext.R16UI,WebGL2RenderingContext.RG16UI,WebGL2RenderingContext.RGB16UI,WebGL2RenderingContext.RGBA16UI],p=[-1,WebGL2RenderingContext.R32UI,WebGL2RenderingContext.RG32UI,WebGL2RenderingContext.RGB32UI,WebGL2RenderingContext.RGBA32UI],f=[-1,WebGL2RenderingContext.R32F,WebGL2RenderingContext.RG32F,WebGL2RenderingContext.RGB32F,WebGL2RenderingContext.RGBA32F];function g(e){return e===r.b.FLOAT32?"":"u"}function m(e,t,n=1){switch(t){case r.b.UINT8:if(n<1||n>4)break;return e.texelsPerElement=1,e.textureInternalFormat=d[n],e.textureFormat=l[n],e.texelType=WebGL2RenderingContext.UNSIGNED_BYTE,e.arrayElementsPerTexel=n,e.arrayConstructor=Uint8Array,e.samplerPrefix="u",e;case r.b.UINT16:if(n<1||n>4)break;return e.texelsPerElement=1,e.textureInternalFormat=h[n],e.textureFormat=l[n],e.texelType=WebGL2RenderingContext.UNSIGNED_SHORT,e.arrayElementsPerTexel=n,e.arrayConstructor=Uint16Array,e.samplerPrefix="u",e;case r.b.UINT64:if(n<1||n>2)break;return e.texelsPerElement=1,e.textureInternalFormat=p[2*n],e.textureFormat=l[2*n],e.texelType=WebGL2RenderingContext.UNSIGNED_INT,e.arrayElementsPerTexel=2*n,e.arrayConstructor=Uint32Array,e.samplerPrefix="u",e;case r.b.UINT32:if(n<1||n>4)break;return e.texelsPerElement=1,e.textureInternalFormat=p[n],e.textureFormat=l[n],e.texelType=WebGL2RenderingContext.UNSIGNED_INT,e.arrayElementsPerTexel=1,e.arrayConstructor=Uint32Array,e.samplerPrefix="u",e;case r.b.FLOAT32:if(n<1||n>4)break;return e.texelsPerElement=1,e.textureInternalFormat=f[n],e.textureFormat=c[n],e.texelType=WebGL2RenderingContext.FLOAT,e.arrayElementsPerTexel=n,e.arrayConstructor=Float32Array,e.samplerPrefix="",e}throw new Error(`No supported texture format for ${r.b[t]}[${n}].`)}function v(e,t,n,i){const{maxTextureSize:r}=t;if(i*n>r*r)throw new Error("Number of elements exceeds maximum texture size: "+n+" * "+i);const s=Math.ceil(i/r),o=e.textureXBits=Math.ceil(Math.log2(s));e.textureWidth=(1<<o)*n,e.textureHeight=Math.ceil(i/(1<<o))}function b(e,t,n,r){const{arrayConstructor:s,arrayElementsPerTexel:a,textureInternalFormat:l,textureFormat:c}=n,{textureWidth:u,textureHeight:d}=t,h=u*d*a;r.constructor!==s&&(r=new s(r.buffer,r.byteOffset,r.byteLength/s.BYTES_PER_ELEMENT));let p=Object(i.b)(r,h);e.pixelStorei(WebGL2RenderingContext.UNPACK_ALIGNMENT,1),Object(o.c)(e),e.texImage2D(WebGL2RenderingContext.TEXTURE_2D,0,l,u,d,0,c,n.texelType,p)}function y(e,t,n,i,r,s){const{arrayConstructor:a,textureInternalFormat:l,textureFormat:c,texelsPerElement:u}=t;n.constructor!==a&&(n=new a(n.buffer,n.byteOffset,n.byteLength/a.BYTES_PER_ELEMENT)),e.pixelStorei(WebGL2RenderingContext.UNPACK_ALIGNMENT,1),Object(o.b)(e),e.texImage3D(WebGL2RenderingContext.TEXTURE_3D,0,l,i*u,r,s,0,c,t.texelType,n)}function w(e){switch(e){case r.b.UINT8:return s.i;case r.b.UINT16:return s.f;case r.b.UINT32:return s.g;case r.b.UINT64:return s.h;case r.b.FLOAT32:return s.c}}function x(e,t,n,i,o,a){const l=Object(s.a)(o,a);let c=[w(o)],d=`\n${l} ${e}(${i} index) {\n`;switch(o){case r.b.UINT8:case r.b.UINT16:case r.b.UINT32:d+=`\n  ${l} result;\n  highp uvec4 temp;\n  ${t}(${n}, index, temp);\n  result.value = temp.${u[a]};\n  return result;\n`;break;case r.b.UINT64:c.push(s.j),d+=`\n  highp uvec4 temp;\n  ${t}(${n}, index, temp);\n  return unpackUint64leFromUint32(temp.${u[2*a]});\n`;break;case r.b.FLOAT32:c.push(s.c),d+=`\n  highp vec4 temp;\n  ${t}(${n}, index, temp);\n  return temp.${u[a]};\n`}return d+="\n}\n",c.push(d),c}class S{constructor(e){this.key=e,this.uniformName=`uTextureXBits_${this.key}`,this.readTextureValue=`readTextureValue_${this.key}`}defineShader(e){let{uniformName:t}=this;e.addUniform("highp uint",t)}getReadTextureValueCode(e,t){let{uniformName:n}=this,i=`\nvoid ${this.readTextureValue}(highp ${t}sampler2D sampler, highp uint index`;for(let n=0;n<e;++n)i+=`, out ${t}vec4 output${n}`;i+=`) {\n\n  highp int y = int(index >> ${n});\n  highp int x = int((index - (uint(y) << ${n})) * ${e}u);\n`;for(let t=0;t<e;++t)i+=`\n  output${t} = texelFetch(sampler, ivec2(x + ${t}, y), 0);\n`;return i+="\n}\n"}getAccessor(e,t,n,i=1){const r=g(n);return[this.getReadTextureValueCode(1,r),...x(e,this.readTextureValue,t,"highp uint",n,i)]}setupTextureLayout(e,t,n){e.uniform1ui(t.uniform(this.uniformName),n.textureXBits)}}class C{constructor(e){this.key=e,this.readTextureValue=`readTextureValue_${this.key}`}getReadTextureValueCode(e,t){let n=`\nvoid ${this.readTextureValue}(highp ${t}sampler3D sampler, highp ivec3 p`;for(let i=0;i<e;++i)n+=`, out ${t}vec4 output${i}`;n+=") {\n";for(let t=0;t<e;++t)n+=`\n  output${t} = texelFetch(sampler, ivec3(p.x * ${e} + ${t}, p.y, p.z), 0);\n`;return n+="\n}\n"}getAccessor(e,t,n,i=1){const r=g(n);return[this.getReadTextureValueCode(1,r),...x(e,this.readTextureValue,t,"highp ivec3",n,i)]}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(146);let i=null;var r=200;class s{constructor(e=!1){null===i&&((i=document.createElement("ul")).id="statusContainer",document.body.appendChild(i));let t=document.createElement("li");this.element=t,!0===e&&(e=r),!1!==e?(this.setVisible(!1),this.timer=setTimeout(this.setVisible.bind(this,!0),e)):this.timer=null,i.appendChild(t)}dispose(){i.removeChild(this.element),this.element=void 0,null!==this.timer&&clearTimeout(this.timer)}setText(e,t){this.element.textContent=e,t&&this.setVisible(!0)}setHTML(e,t){this.element.innerHTML=e,t&&this.setVisible(!0)}setVisible(e){null!==this.timer&&(clearTimeout(this.timer),this.timer=null),this.element.style.display=e?"block":"none"}static forPromise(e,t){let n=new s(t.delay);n.setText(t.initialMessage);let i=n.dispose.bind(n);return e.then(i,e=>{let i;i=e instanceof Error?e.message:""+e;let{errorPrefix:r=""}=t;n.setErrorMessage(r+i),n.setVisible(!0)}),e}setErrorMessage(e){this.element.textContent=e+" ";let t=document.createElement("button");t.textContent="Dismiss",t.addEventListener("click",()=>{this.dispose()}),this.element.appendChild(t)}static showMessage(e){const t=new s;return t.element.textContent=e,t.setVisible(!0),t}static showTemporaryMessage(e,t=2e3){const n=this.showMessage(e);return setTimeout(()=>n.dispose(),t),n}}},function(e,t,n){"use strict";n.d(t,"c",function(){return d}),n.d(t,"a",function(){return h}),n.d(t,"b",function(){return p});var i=n(2);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r=!1;var s;!function(e){e[e.VERTEX=WebGL2RenderingContext.VERTEX_SHADER]="VERTEX",e[e.FRAGMENT=WebGL2RenderingContext.FRAGMENT_SHADER]="FRAGMENT"}(s||(s={}));class o extends Error{constructor(e,t,n,i){const r=`Error compiling ${s[e].toLowerCase()} shader: ${n}`;super(r),this.name="ShaderCompilationError",this.log=n,this.message=r,this.shaderType=e,this.source=t,this.errorMessages=i}}class a extends Error{constructor(e,t,n){const i=`Error linking shader: ${n}`;super(i),this.name="ShaderLinkError",this.log=n,this.message=i,this.vertexSource=e,this.fragmentSource=t}}function l(e,t,n){var i=e.createShader(n);if(e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS)){let s=e.getShaderInfoLog(i)||"";if(r){let e=t.replace("<","&lt;").replace(">","&gt;").split("\n"),n="<pre>";n+=s.replace("<","&lt;").replace(">","&gt;")+"\n",e.forEach((e,t)=>{n+=`${t+1}: ${e}\n`}),n+="\n</pre>";let i=window.open("about:blank","_blank");if(null!==i)try{i.document.write(n)}catch(e){}}throw new o(n,t,s,function(e){e=e.replace("\0","");let t=[];for(let n of e.split("\n")){let e=n.match(/^ERROR:\s*(\d+):(\d+)\s*(.+)$/);null!==e?t.push({message:e[3].trim(),file:parseInt(e[1],10),line:parseInt(e[2],10)}):null!==(e=n.match(/^ERROR:\s*(.+)$/))?t.push({message:e[1]}):(n=n.trim())&&t.push({message:n})}return t}(s))}return i}class c extends i.a{constructor(e,t,n,i,r){super(),this.gl=e,this.vertexSource=t,this.fragmentSource=n,this.attributes=new Map,this.uniforms=new Map;let s=this.vertexShader=l(e,t,e.VERTEX_SHADER),o=this.fragmentShader=l(e,n,e.FRAGMENT_SHADER),c=e.createProgram();if(e.attachShader(c,s),e.attachShader(c,o),e.linkProgram(c),!e.getProgramParameter(c,e.LINK_STATUS)){let i=e.getProgramInfoLog(c)||"";throw new a(t,n,i)}this.program=c;let{uniforms:u,attributes:d}=this;if(i)for(let t of i)u.set(t,e.getUniformLocation(c,t));if(r)for(let t of r)d.set(t,e.getAttribLocation(c,t))}uniform(e){return this.uniforms.get(e)}attribute(e){return this.attributes.get(e)}textureUnit(e){return this.textureUnits.get(e)}bind(){this.gl.useProgram(this.program)}disposed(){let{gl:e}=this;e.deleteShader(this.vertexShader),this.vertexShader=void 0,e.deleteShader(this.fragmentShader),this.fragmentShader=void 0,e.deleteProgram(this.program),this.program=void 0,this.gl=void 0,this.attributes=void 0,this.uniforms=void 0}}class u{constructor(){this.code="",this.parts=new Set}add(e){if(!this.parts.has(e))switch(this.parts.add(e),typeof e){case"string":this.code+=e;break;case"function":this.add(e());break;default:if(!Array.isArray(e))throw console.log("Invalid code type",e),new Error("Invalid code type");for(let t of e)this.add(t)}}toString(){return this.code}}const d={sampler2D:WebGL2RenderingContext.TEXTURE_2D,isampler2D:WebGL2RenderingContext.TEXTURE_2D,usampler2D:WebGL2RenderingContext.TEXTURE_2D,sampler3D:WebGL2RenderingContext.TEXTURE_3D,isampler3D:WebGL2RenderingContext.TEXTURE_3D,usampler3D:WebGL2RenderingContext.TEXTURE_3D};class h{constructor(e){this.gl=e,this.nextSymbolID=0,this.nextTextureUnit=0,this.uniformsCode="",this.attributesCode="",this.varyingsCodeVS="",this.varyingsCodeFS="",this.fragmentExtensionsSet=new Set,this.fragmentExtensions="",this.vertexCode=new u,this.vertexMain="",this.fragmentCode=new u,this.outputBufferCode="",this.fragmentMain="",this.required=new Set,this.uniforms=new Array,this.attributes=new Array,this.initializers=[],this.textureUnits=new Map}allocateTextureUnit(e,t=1){if(this.textureUnits.has(e))throw new Error("Duplicate texture unit symbol: "+e);let n=this.nextTextureUnit;return this.nextTextureUnit+=t,this.textureUnits.set(e,n),n}addTextureSampler(e,t,n,i){let r=this.allocateTextureUnit(n,i);return this.addUniform(`highp ${e}`,t,i),this.addInitializer(e=>{if(i){let n=new Int32Array(i);for(let e=0;e<i;++e)n[e]=e+r;e.gl.uniform1iv(e.uniform(t),n)}else e.gl.uniform1i(e.uniform(t),r)}),r}symbol(e){return e+this.nextSymbolID++}addAttribute(e,t){return this.attributes.push(t),this.attributesCode+=`in ${e} ${t};\n`,t}addVarying(e,t,n=""){this.varyingsCodeVS+=`${n} out ${e} ${t};\n`,this.varyingsCodeFS+=`${n} in ${e} ${t};\n`}addOutputBuffer(e,t,n){null!==n&&(this.outputBufferCode+=`layout(location = ${n}) `),this.outputBufferCode+=`out ${e} ${t};\n`}addUniform(e,t,n){return this.uniforms.push(t),this.uniformsCode+=null!=n?`uniform ${e} ${t}[${n}];\n`:`uniform ${e} ${t};\n`,t}addFragmentExtension(e){this.fragmentExtensionsSet.has(e)||(this.fragmentExtensionsSet.add(e),this.fragmentExtensions+=`#extension ${e} : require\n`)}addVertexCode(e){this.vertexCode.add(e)}addFragmentCode(e){this.fragmentCode.add(e)}setVertexMain(e){this.vertexMain=e}addVertexMain(e){this.vertexMain=(this.vertexMain||"")+e}setFragmentMain(e){this.fragmentMain=`void main() {\n${e}\n}\n`}setFragmentMainFunction(e){this.fragmentMain=e}addInitializer(e){this.initializers.push(e)}require(e){this.required.has(e)||(this.required.add(e),e(this))}build(){let e=`#version 300 es\nprecision highp float;\nprecision highp int;\n${this.uniformsCode}\n${this.attributesCode}\n${this.varyingsCodeVS}\n${this.vertexCode}\nvoid main() {\n${this.vertexMain}\n}\n`,t=`#version 300 es\n${this.fragmentExtensions}\nprecision highp float;\nprecision highp int;\n${this.uniformsCode}\n${this.varyingsCodeFS}\n${this.outputBufferCode}\n${this.fragmentCode}\n${this.fragmentMain}\n`,n=new c(this.gl,e,t,this.uniforms,this.attributes);n.textureUnits=this.textureUnits;let{initializers:i}=this;if(i.length>0){n.bind();for(let e of i)e(n)}return n}}function p(e,t,n){const i=new Map;return function(r){let s=i.get(r);if(void 0===s){const o=new h(t);o.require(r),n(o),s=e.registerDisposer(o.build()),i.set(r,s)}return s}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"c",function(){return o}),n.d(t,"e",function(){return a}),n.d(t,"f",function(){return l}),n.d(t,"b",function(){return c}),n.d(t,"d",function(){return u});var i=n(14),r=n(17);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class s extends Error{constructor(e,t,n){let i=`Fetching ${JSON.stringify(e)} resulted in HTTP error ${t}`;n&&(i+=`: ${n}`),super(i+="."),this.name="HttpError",this.message=i,this.url=e,this.status=t,this.statusText=n}static fromResponse(e){return new s(e.url,e.status,e.statusText)}}async function o(e,t){let n;try{n=await fetch(e,t)}catch(e){if(e instanceof TypeError)throw new s("",0,"");throw e}if(!n.ok)throw s.fromResponse(n);return n}function a(e){return e.arrayBuffer()}function l(e){return e.json()}async function c(e,t,n,r=i.e){if(r===i.e){const i=await o(e,t);return await n(i)}const s=new AbortController,a=r.add(()=>s.abort());try{const i=await o(e,t);return await n(i)}finally{a()}}new r.a;function u(e){let t=e.match(/^([^:\/]+):\/\/([^\/]+)(\/.*)?$/);if(null===t)throw new Error(`Invalid URL: ${JSON.stringify(e)}`);if("gs"===t[1]){const e=t[2];let n=t[3];return void 0===n&&(n=""),`https://storage.googleapis.com/${e}${n}`}return e}},function(e,t,n){"use strict";n.d(t,"b",function(){return s}),n.d(t,"a",function(){return o}),n.d(t,"c",function(){return a});var i=n(57),r=n(9);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class s extends r.f{constructor(e=Number.NEGATIVE_INFINITY){super(e)}get visible(){return this.value===Number.POSITIVE_INFINITY}get ignored(){return this.value===Number.NEGATIVE_INFINITY}}s.VISIBLE=Number.POSITIVE_INFINITY,s.IGNORED=Number.NEGATIVE_INFINITY;class o extends s{constructor(){super(...arguments),this.contributors=new Map}add(e){const{contributors:t}=this,n=e.changed.add(()=>{this.update()}),i=()=>{t.delete(i),n(),this.update()};return t.set(i,e),this.update(),i}update(){let e=Number.NEGATIVE_INFINITY;for(const t of this.contributors.values())e=Math.max(e,t.value);this.value=e}}function a(e){return class extends e{constructor(){super(...arguments),this.visibility=new o}initializeCounterpart(e,t={}){t.visibility=this.registerDisposer(i.a.makeFromExisting(e,this.visibility)).rpcId,super.initializeCounterpart(e,t)}}}},function(e,t,n){"use strict";n.d(t,"e",function(){return r}),n.d(t,"h",function(){return s}),n.d(t,"j",function(){return o}),n.d(t,"b",function(){return a}),n.d(t,"i",function(){return l}),n.d(t,"c",function(){return c}),n.d(t,"f",function(){return u}),n.d(t,"g",function(){return d}),n.d(t,"d",function(){return h}),n.d(t,"a",function(){return p});var i=n(12),r="\nvec3 hueToRgb(float hue) {\n  float hue6 = hue * 6.0;\n  float r = abs(hue6 - 3.0) - 1.0;\n  float g = 2.0 - abs(hue6 - 2.0);\n  float b = 2.0 - abs(hue6 - 4.0);\n  return clamp(vec3(r, g, b), 0.0, 1.0);\n}\nvec3 hsvToRgb(vec3 c) {\n  vec3 hueRgb = hueToRgb(c.x);\n  return c.z * ((hueRgb - 1.0) * c.y + 1.0);\n}\n";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s="\nstruct uint64_t {\n  highp uvec2 value;\n};\nstruct uint64x2_t {\n  highp uvec4 value;\n};\nuint64_t toUint64(uint64_t x) { return x; }\n",o=[s,"\nuint64_t unpackUint64leFromUint32(highp uvec2 x) {\n  uint64_t result;\n  result.value = x;\n  return result;\n}\nuint64x2_t unpackUint64leFromUint32(highp uvec4 x) {\n  uint64x2_t result;\n  result.value = x;\n  return result;\n}\n"],a=[s,"\nbool equals(uint64_t a, uint64_t b) {\n  return a.value == b.value;\n}\n"],l=[s,"\nstruct uint8_t {\n  highp uint value;\n};\nstruct uint8x2_t {\n  highp uvec2 value;\n};\nstruct uint8x3_t {\n  highp uvec3 value;\n};\nstruct uint8x4_t {\n  highp uvec4 value;\n};\nhighp uint toRaw(uint8_t x) { return x.value; }\nhighp float toNormalized(uint8_t x) { return float(x.value) / 255.0; }\nhighp uvec2 toRaw(uint8x2_t x) { return x.value; }\nhighp vec2 toNormalized(uint8x2_t x) { return vec2(x.value) / 255.0; }\nhighp uvec3 toRaw(uint8x3_t x) { return x.value; }\nvec3 toNormalized(uint8x3_t x) { return vec3(x.value) / 255.0; }\nhighp uvec4 toRaw(uint8x4_t x) { return x.value; }\nvec4 toNormalized(uint8x4_t x) { return vec4(x.value) / 255.0; }\nuint64_t toUint64(uint8_t x) {\n  uint64_t result;\n  result.value[0] = x.value;\n  result.value[1] = 0u;\n  return result;\n}\n"],c="\nfloat toRaw(float x) { return x; }\nfloat toNormalized(float x) { return x; }\nvec2 toRaw(vec2 x) { return x; }\nvec2 toNormalized(vec2 x) { return x; }\nvec3 toRaw(vec3 x) { return x; }\nvec3 toNormalized(vec3 x) { return x; }\nvec4 toRaw(vec4 x) { return x; }\nvec4 toNormalized(vec4 x) { return x; }\n",u=[s,"\nstruct uint16_t {\n  highp uint value;\n};\nstruct uint16x2_t {\n  highp uvec2 value;\n};\nhighp uint toRaw(uint16_t x) { return x.value; }\nhighp float toNormalized(uint16_t x) { return float(toRaw(x)) / 65535.0; }\nhighp uvec2 toRaw(uint16x2_t x) { return x.value; }\nhighp vec2 toNormalized(uint16x2_t x) { return vec2(toRaw(x)) / 65535.0; }\nuint64_t toUint64(uint16_t x) {\n  uint64_t result;\n  result.value[0] = x.value;\n  result.value[1] = 0u;\n  return result;\n}\n"],d=[s,"\nstruct uint32_t {\n  highp uint value;\n};\nhighp float toNormalized(uint32_t x) { return float(x.value) / 4294967295.0; }\nhighp uint toRaw(uint32_t x) { return x.value; }\nuint64_t toUint64(uint32_t x) {\n  uint64_t result;\n  result.value[0] = x.value;\n  result.value[1] = 0u;\n  return result;\n}\n"];var h="\nhighp int getFortranOrderIndex(ivec3 subscripts, ivec3 size) {\n  return subscripts.x + size.x * (subscripts.y + size.y * subscripts.z);\n}\n";function p(e,t=1){switch(e){case i.b.FLOAT32:if(1===t)return"float";if(t>1&&t<=4)return`vec${t}`;break;case i.b.UINT8:if(1===t)return"uint8_t";if(t>1&&t<=4)return`uint8x${t}_t`;break;case i.b.UINT16:if(1===t)return"uint16_t";if(2===t)return"uint16x2_t";break;case i.b.UINT32:if(1===t)return"uint32_t";break;case i.b.UINT64:if(1===t)return"uint64_t"}throw new Error(`No shader type for ${i.b[e]}[${t}].`)}},function(e,t,n){"use strict";var i=n(0);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r{constructor(e,t=i.e){this.size=i.u.clone(e),this.transform=i.m.clone(t),this.invTransform=i.m.invert(i.m.create(),t)}toObject(e){e.size=this.size,e.transform=this.transform}static get(e,t=i.e){let n=r.cache;const s=JSON.stringify([Array.from(e),Array.from(t)]);let o=n.get(s);return void 0===o&&(o=new r(e,t),n.set(s,o)),o}static fromObject(e){return r.get(e.size,e.transform)}localSpatialToGlobal(e,t){return i.u.transformMat4(e,t,this.transform)}globalToLocalSpatial(e,t){return i.u.transformMat4(e,t,this.invTransform)}globalToLocalGrid(e,t){return this.globalToLocalSpatial(e,t),i.u.divide(e,e,this.size),e}localSpatialVectorToGlobal(e,t){return Object(i.r)(e,t,this.transform)}globalToLocalSpatialVector(e,t){return Object(i.r)(e,t,this.invTransform)}assignLocalSpatialToGlobalMat4(e){return i.m.copy(e,this.transform)}}r.cache=new Map;var s=n(42);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */n(12);var o=n(8);n.d(t,"m",function(){return p}),n.d(t,"h",function(){return m}),n.d(t,"l",function(){return b}),n.d(t,"a",function(){return w}),n.d(t,"k",function(){return x}),n.d(t,"j",function(){return S}),n.d(t,"i",function(){return C}),n.d(t,"f",function(){return O}),n.d(t,"d",function(){return L}),n.d(t,"b",function(){return T}),n.d(t,"c",function(){return k}),n.d(t,"g",function(){return E}),n.d(t,"e",function(){return A});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const a=!1,l=!1,c=i.u.create();function u(e,t){const n=t.size,i=t.globalToLocalSpatialVector(c,e);let r=0,s=0,o=1;for(let e=0;e<3;++e){const t=n[e];o*=t;const a=t*i[e];r=Math.min(r,a),s=Math.max(s,a)}return o/(s-r)}var d;function h(e,t,n,i){let r=d.FULLY_INSIDE;for(let c=0;c<3;++c){let u=(s=e[c],o=t[c],a=n[c],l=i[c],s>=l||o<=a?d.FULLY_OUTSIDE:s>=a&&o<=l?d.FULLY_INSIDE:d.PARTIALLY_INSIDE);switch(u){case d.FULLY_OUTSIDE:return u;case d.PARTIALLY_INSIDE:r=u}}var s,o,a,l;return r}function p(e){const{transform:t}=e;let{transformedSources:n}=e;const s=t.changed.count;return s!==e.transformedSourcesGeneration&&(e.transformedSourcesGeneration=s,n=i.m.equals(t.transform,i.e)?e.sources.map(e=>e.map(e=>({source:e,chunkLayout:e.spec.chunkLayout,voxelSize:e.spec.voxelSize}))):e.sources.map(e=>e.map(e=>{const n=e.spec.chunkLayout,s=r.get(n.size,x(n.transform,t));return{chunkLayout:s,source:e,voxelSize:s.localSpatialVectorToGlobal(i.u.create(),e.spec.voxelSize)}})),e.transformedSources=n),n}function f(e,t){let n=t.length,i=0;if(l&&console.log(t),n>1){let r=0;for(let s=0;s<n;++s){let n=t[s];const{chunkLayout:o}=n;let a=u(e,o);l&&console.log(`zAxis = ${e}, chunksize = ${o.size}, sliceArea = ${a}`),a>r&&(r=a,i=s)}}return t[i]}!function(e){e[e.FULLY_OUTSIDE=0]="FULLY_OUTSIDE",e[e.FULLY_INSIDE=1]="FULLY_INSIDE",e[e.PARTIALLY_INSIDE=2]="PARTIALLY_INSIDE"}(d||(d={}));const g=[i.u.create(),i.u.create(),i.u.create(),i.u.create()];class m extends o.b{constructor(){super(),this.width=-1,this.height=-1,this.hasViewportToData=!1,this.hasValidViewport=!1,this.viewportToData=i.m.create(),this.viewportAxes=[i.u.create(),i.u.create(),i.u.create()],this.previousViewportAxes=[i.u.create(),i.u.create()],this.centerDataPosition=i.u.create(),this.viewportPlaneDistanceToOrigin=0,this.visibleChunkLayouts=new Map,this.visibleLayers=new Map,this.visibleSourcesStale=!0,this.pixelSize=0,i.m.identity(this.viewportToData)}onViewportChanged(){}maybeSetHasValidViewport(){!this.hasValidViewport&&-1!==this.width&&-1!==this.height&&this.hasViewportToData&&(this.hasValidViewport=!0,this.onHasValidViewport()),this.hasValidViewport&&this.onViewportChanged()}onHasValidViewport(){}setViewportSize(e,t){return(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.maybeSetHasValidViewport(),!0)}setViewportToDataMatrix(e){if(this.hasViewportToData&&i.m.equals(this.viewportToData,e))return!1;this.hasViewportToData=!0;let{viewportToData:t}=this;i.m.copy(t,e),Object(i.q)(t),i.u.transformMat4(this.centerDataPosition,i.j,e);let n=0,r=this.viewportAxes,s=this.previousViewportAxes;for(var o=0;o<3;++o){let e=r[o];Object(i.r)(e,i.g[o],t),0===o&&(n=i.u.length(e)),i.u.normalize(e,e)}var a,l;return this.viewportAxes=r,this.previousViewportAxes=s,a=n,l=this.pixelSize,(!(a===l||Math.abs(a-l)/Math.min(Math.abs(a),Math.abs(l))<1e-6)||i.u.dot(r[0],s[0])<.95||i.u.dot(r[1],s[1])<.95)&&(i.u.copy(s[0],r[0]),i.u.copy(s[1],r[1]),this.visibleSourcesStale=!0,this.pixelSize=n),this.viewportPlaneDistanceToOrigin=i.u.dot(this.centerDataPosition,this.viewportAxes[2]),this.onViewportToDataMatrixChanged(),this.maybeSetHasValidViewport(),!0}onViewportToDataMatrixChanged(){}updateVisibleSources(){if(!this.visibleSourcesStale)return;this.visibleSourcesStale=!1;let e=1.1*this.pixelSize,t=this.visibleChunkLayouts;const n=this.viewportAxes[2];let i=this.visibleLayers;t.clear();for(let[r,s]of i){s.length=0;let i,o=p(r),a=o.length,l=o[0][0].voxelSize;const c=r.renderScaleTarget.value,u=t=>{const n=e*c;for(let e=0;e<3;++e){const i=t[e];if(i>n&&i>1.01*l[e])return!0}return!1},d=(t,n)=>{const i=e*c;for(let e=0;e<3;++e){const r=t[e],s=n[e];if(Math.abs(i-r)<Math.abs(i-s)&&r<1.01*s)return!0}return!1},h=(e,n)=>{const{source:i,chunkLayout:r}=e;s[s.length++]=e;let o=t.get(r);void 0===o&&(o=new Map,t.set(r,o)),o.set(i,n)};let g;for(i=a-1;;){const e=f(n,o[i]);if(void 0!==g&&!d(e.voxelSize,g))break;if(h(e,i),0===i||!u(e.voxelSize))break;g=e.voxelSize,--i}s.reverse()}}computeVisibleChunks(e,t){this.updateVisibleSources();const n=g;let{width:r,height:o,viewportToData:l}=this;for(let e=0;e<3;++e)n[0][e]=-i.g[0][e]*r/2-i.g[1][e]*o/2,n[1][e]=-i.g[0][e]*r/2+i.g[1][e]*o/2,n[2][e]=i.g[0][e]*r/2-i.g[1][e]*o/2,n[3][e]=i.g[0][e]*r/2+i.g[1][e]*o/2;for(let e=0;e<4;++e)i.u.transformMat4(n[e],n[e],l);var u=i.u.create(),p=i.u.create();let f=i.u.create(),m=i.u.create();var v=i.u.create(),b=i.u.create();let y=new Array,w=new Array;this.visibleChunkLayouts.forEach((r,o)=>{let l=e(o);!function(e,t,n){for(let n=0;n<3;++n)e[n]=Number.POSITIVE_INFINITY,t[n]=Number.NEGATIVE_INFINITY;for(let i of n){let{spec:n}=i,{lowerChunkBound:r,upperChunkBound:s}=n;for(let n=0;n<3;++n)e[n]=Math.min(e[n],r[n]),t[n]=Math.max(t[n],s[n])}}(f,m,r.keys()),a&&console.log("Initial sources chunk bounds: "+`${i.u.str(f)}, ${i.u.str(m)}`),i.u.set(u,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i.u.set(p,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),o.globalToLocalSpatialVector(b,this.viewportAxes[2]);for(let e=0;e<3;++e)v[e]=b[e]>0?1:0;const g=i.u.dot(o.globalToLocalGrid(c,this.centerDataPosition),b);for(let e=0;e<4;++e){const t=o.globalToLocalGrid(c,n[e]);for(let e=0;e<3;++e)u[e]=Math.min(u[e],Math.floor(t[e])),p[e]=Math.max(p[e],Math.floor(t[e])+1)}i.u.max(u,u,f),i.u.min(p,p,m),w.length=0,y.length=0;for(let e of r.keys()){let t=e.spec,n=h(u,p,t.lowerChunkBound,t.upperChunkBound);switch(a&&console.log(`Comparing source bounds lowerBound=${i.u.str(u)}, `+`upperBound=${i.u.str(p)}, `+`lowerChunkBound=${i.u.str(t.lowerChunkBound)}, `+`upperChunkBound=${i.u.str(t.upperChunkBound)}, `+`got ${d[n]}`,t,e),n){case d.FULLY_INSIDE:w.push(e);break;case d.PARTIALLY_INSIDE:y.push(e)}}let x=y.length;!function e(n){if(a&&console.log(`chunk bounds: ${u} ${p} `+`fullyVisible: ${w} partiallyVisible: `+`${y.slice(0,x)}`),0===w.length&&0===x)return void(a&&console.log("  no visible sources"));a&&console.log(`Check bounds: [ ${i.u.str(u)}, ${i.u.str(p)} ]`);var r,c,f,m=1;for(let e=0;e<3;++e)m*=Math.max(0,p[e]-u[e]);if(0===m)return void(a&&console.log("  volume == 0"));if(!function(){var e=0,t=0;for(let n=0;n<3;++n){let i=b[n],r=u[n],s=p[n]-r,o=v[n]*s;e+=i*(r+o),t+=i*(r+s-o)}return a&&(console.log(`    planeNormal = ${b}`),console.log("    {positive,negative}VertexDistanceToOrigin: ",e,t,g),console.log("    intersectsPlane:",t,g,e)),!(e<g)&&t<=g}())return void(a&&console.log("  doesn't intersect plane"));if(a&&console.log("Within bounds: ["+i.u.str(u)+", "+i.u.str(p)+"]"),1===m)return void t(o,l,u,w);for(;r=u[n],1==(f=(c=p[n])-r);)n=(n+1)%3;let S=r+Math.floor(.5*f),C=(n+1)%3,O=w.length;p[n]=S;let L=x;function T(){x=Object(s.c)(y,0,L,e=>{let t=e.spec;switch(h(u,p,t.lowerChunkBound,t.upperChunkBound)){case d.PARTIALLY_INSIDE:return!0;case d.FULLY_INSIDE:w.push(e);default:return!1}})}T(),e(C),w.length=O,x=L,p[n]=c,u[n]=S,T(),e(C),u[n]=r,w.length=O,x=L}(0)})}}const v=18;function b(e){let{voxelSize:t,lowerVoxelBound:n=i.j,upperVoxelBound:r,maxVoxelsPerChunkLog2:s=v,transform:o=i.e,maxBlockSize:a=i.h}=e,l=Object(i.c)(i.u.create(),o);t=i.u.multiply(l,l,t);let c,u=i.u.fromValues(1,1,1);if(void 0===r)c=a;else{c=i.u.create();for(let e=0;e<3;++e)c[e]=Math.pow(2,Math.floor(Math.log2(r[e]-n[e])));i.u.min(c,c,a)}function d(){let e=1/0,n=-1;for(let i=0;i<3;++i){if(u[i]>=c[i])continue;let r=u[i]*t[i];r<e&&(e=r,n=i)}return n}for(let e=0;e<s;++e){let e=d();if(-1===e)break;u[e]*=2}return u}function y(e){let{lowerVoxelBound:t=i.j,upperVoxelBound:n=i.h,flatDimension:r,voxelSize:s,maxVoxelsPerChunkLog2:o,transform:a}=e;return i.u.subtract(c,n,t),c[r]=1,b({voxelSize:s,upperVoxelBound:c,maxVoxelsPerChunkLog2:o,transform:a})}var w;function x(e,t){let n=t.transform;return void 0===n?void 0===e?i.e:e:void 0===e?n:i.m.multiply(i.m.create(),n,e)}function S(e){if(void 0!==e.chunkDataSizes)return e.chunkDataSizes;const{chunkLayoutPreference:t=w.ISOTROPIC}=e;switch(t){case w.ISOTROPIC:return[b(e)];case w.FLAT:let n=function(e){let t=new Array;for(let n=0;n<3;++n)t[n]=y({flatDimension:n,voxelSize:e.voxelSize,lowerVoxelBound:e.lowerVoxelBound,upperVoxelBound:e.upperVoxelBound,maxVoxelsPerChunkLog2:e.maxVoxelsPerChunkLog2,transform:e.transform});return t}(e);return n.push(b(e)),n}throw new Error(`Invalid chunk layout preference: ${t}.`)}!function(e){e[e.ISOTROPIC=0]="ISOTROPIC",e[e.FLAT=1]="FLAT"}(w||(w={}));class C{constructor(e){let{chunkSize:t,voxelSize:n,transform:s,lowerChunkBound:o=i.j,upperChunkBound:a}=e;this.voxelSize=n,this.chunkLayout=r.get(t,s),this.lowerChunkBound=o,this.upperChunkBound=a}toObject(){return{transform:this.chunkLayout.transform,chunkSize:this.chunkLayout.size,voxelSize:this.voxelSize,lowerChunkBound:this.lowerChunkBound,upperChunkBound:this.upperChunkBound}}}const O="SliceView",L="sliceview/RenderLayer",T="SliceView.addVisibleLayer",k="SliceView.removeVisibleLayer",E="SliceView.updateView",A="SliceView.updateTransform"},function(e,t,n){"use strict";n.d(t,"d",function(){return c}),n.d(t,"b",function(){return u}),n.d(t,"c",function(){return d}),n.d(t,"a",function(){return h}),n.d(t,"e",function(){return g}),n.d(t,"f",function(){return m});var i=n(20),r=n(4),s=n(22),o=n(2),a=n(1),l=n(3);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function c(e,t,n,i={}){return s.a.forPromise(new Promise(function(r){r(e.getVolume(t,n,i))}),{initialMessage:`Retrieving metadata for volume ${n}.`,delay:!0,errorPrefix:`Error retrieving metadata for volume ${n}: `})}class u extends i.d{constructor(e,t,n){super(e),this.initialSpecification=t,this.manager=n}toJSON(){let e=this.layer;if(!e)return this.initialSpecification;let t=e.toJSON();return t.name=this.name,this.visible||(t.visible=!1),t}}class d extends o.a{constructor(e,t,n,i,r){super(),this.dataSourceProvider=e,this.layerManager=t,this.chunkManager=n,this.layerSelectedValues=i,this.voxelSize=r,this.changed=new l.a,this.voxelCoordinatesSet=new l.b,this.spatialCoordinatesSet=new l.b,this.registerDisposer(t.layersChanged.add(this.changed.dispatch)),this.registerDisposer(t.specificationChanged.add(this.changed.dispatch))}get worker(){return this.chunkManager.rpc}get rpc(){return this.chunkManager.rpc}reset(){this.layerManager.clear()}restoreState(e){if(this.layerManager.clear(),Array.isArray(e))for(const t of e){Object(a.t)(t);const e=this.layerManager.getUniqueLayerName(Object(a.v)(t,"name",a.A));this.layerManager.addManagedLayer(this.getLayer(e,t))}else{Object(a.t)(e);for(let t of Object.keys(e))this.layerManager.addManagedLayer(this.getLayer(t,e[t]))}}initializeLayerFromSpec(e,t){e.initialSpecification=t,"string"==typeof t&&(t={source:t}),Object(a.t)(t);let n=Object(a.v)(t,"type",a.y);e.visible=Object(a.v)(t,"visible",e=>{if(void 0===e||!0===e)return!0;if(!1===e)return!1;throw new Error(`Expected boolean, but received: ${JSON.stringify(e)}.`)});const i=(t,n)=>{const i=new t(this,n);i.restoreState(n),e.layer=i};let s=e.sourceUrl=Object(a.v)(t,"source",a.y);if(void 0===n){if(void 0===s)throw new Error("Either layer 'type' or 'source' URL must be specified.");c(this.dataSourceProvider,this.chunkManager,s).then(n=>{if(-1===this.layerManager.managedLayers.indexOf(e))return;let s=f.get(n.volumeType);if(void 0===s)throw new Error(`Unsupported volume type: ${r.c[n.volumeType]}.`);i(s,t)})}else{let e=p.get(n);if(void 0===e)throw new Error(`Unsupported layer type: ${JSON.stringify(n)}.`);i(e,t)}}getLayer(e,t){let n=new u(e,t,this);return this.initializeLayerFromSpec(n,t),n}add(e,t){-1===this.layerManager.managedLayers.indexOf(e)&&(e.name=this.layerManager.getUniqueLayerName(e.name)),this.layerManager.addManagedLayer(e,t)}toJSON(){const e=[];let t=0;for(let n of this.layerManager.managedLayers){const i=n.toJSON();null!=i&&(e.push(i),++t)}if(0!==t)return e}setVoxelCoordinates(e){this.voxelCoordinatesSet.dispatch(e)}setSpatialCoordinates(e){this.spatialCoordinatesSet.dispatch(e)}get rootLayers(){return this.layerManager}}class h extends o.a{constructor(e){super(),this.master=e,this.changed=new l.a,this.layerManager=new i.a,this.registerDisposer(e);const{layerManager:t}=this;this.registerDisposer(t.layersChanged.add(this.changed.dispatch)),this.registerDisposer(t.specificationChanged.add(this.changed.dispatch))}get voxelCoordinatesSet(){return this.master.voxelCoordinatesSet}get spatialCoordinatesSet(){return this.master.spatialCoordinatesSet}get worker(){return this.master.rpc}get rpc(){return this.master.rpc}get dataSourceProvider(){return this.master.dataSourceProvider}get chunkManager(){return this.master.chunkManager}get voxelSize(){return this.master.voxelSize}get layerSelectedValues(){return this.master.layerSelectedValues}reset(){this.layerManager.clear()}restoreState(e){const t=this.master.layerManager,n=[];for(const i of new Set(Object(a.a)(e,a.A))){const e=t.getLayerByName(i);if(void 0===e)throw new Error(`Undefined layer referenced in subset specification: ${JSON.stringify(i)}`);n.push(e)}this.layerManager.clear();for(const e of n)this.layerManager.addManagedLayer(e.addRef())}toJSON(){return this.layerManager.managedLayers.map(e=>e.name)}initializeLayerFromSpec(e,t){this.master.initializeLayerFromSpec(e,t)}getLayer(e,t){return this.master.getLayer(e,t)}add(e,t){-1===this.master.layerManager.managedLayers.indexOf(e)&&(e.name=this.master.layerManager.getUniqueLayerName(e.name),this.master.layerManager.addManagedLayer(e.addRef())),this.layerManager.addManagedLayer(e,t)}setVoxelCoordinates(e){this.master.setVoxelCoordinates(e)}setSpatialCoordinates(e){this.master.setSpatialCoordinates(e)}get rootLayers(){return this.master.rootLayers}}const p=new Map,f=new Map;function g(e,t){p.set(e,t)}function m(e,t){f.set(e,t)}},function(e,t,n){"use strict";n.d(t,"d",function(){return i}),n.d(t,"h",function(){return u}),n.d(t,"b",function(){return m}),n.d(t,"f",function(){return v}),n.d(t,"a",function(){return b}),n.d(t,"g",function(){return y}),n.d(t,"c",function(){return x}),n.d(t,"e",function(){return S});var i,r=n(2),s=n(0),o=n(1),a=n(3),l=n(105);!function(e){e[e.LINKED=0]="LINKED",e[e.RELATIVE=1]="RELATIVE",e[e.UNLINKED=2]="UNLINKED"}(i||(i={}));class c extends l.a{constructor(e=i.LINKED){super(i,e)}}class u extends r.a{constructor(e){super(),this.changed=new a.a;let t=!0;null==e&&(e=s.u.create(),t=!1),this.size=e,this.valid=t}reset(){this.valid=!1,this.changed.dispatch()}setValid(){this.valid||(this.valid=!0,this.changed.dispatch())}toJSON(){if(this.valid)return Array.prototype.slice.call(this.size)}restoreState(e){try{Object(o.b)(this.size,e),this.valid=!0,this.changed.dispatch()}catch(e){this.valid=!1,this.changed.dispatch()}}toString(){return this.valid?this.size.toString():null}voxelFromSpatial(e,t){return s.u.divide(e,t,this.size)}spatialFromVoxel(e,t){return s.u.multiply(e,t,this.size)}}const d=s.u.create(),h=s.p.create();function p(e,t,n,r){let s,o=!1;e.registerDisposer(t);let a=i.UNLINKED;const l=()=>{const o=n.value;if(o!==a)switch(o){case i.UNLINKED:s=void 0;break;case i.LINKED:s=void 0,r.assign(e,t);break;case i.RELATIVE:s=r.difference(e,t)}a=o,e.changed.dispatch()};return e.registerDisposer(e.changed.add(()=>{if(!o)switch(n.value){case i.UNLINKED:break;case i.LINKED:r.assign(t,e);break;case i.RELATIVE:r.subtract(t,e,s)}})),e.registerDisposer(t.changed.add(()=>{switch(o=!0,n.value){case i.UNLINKED:if(r.isValid(e))break;case i.LINKED:r.assign(e,t);break;case i.RELATIVE:r.add(e,t,s)}o=!1})),e.registerDisposer(n.changed.add(l)),l(),e}class f extends r.a{constructor(e,t){super(),this.voxelCoordinates=null,this.changed=new a.a,null==e&&(e=new u),this.voxelSize=e;let n=!0;null==t&&(t=s.u.create(),n=!1),this.spatialCoordinates=t,this.spatialCoordinatesValid=n,this.registerDisposer(e),this.registerDisposer(e.changed.add(()=>{this.handleVoxelSizeChanged()}))}get valid(){return this.spatialCoordinatesValid&&this.voxelSize.valid}get voxelCoordinatesValid(){return this.valid||null!=this.voxelCoordinates}reset(){this.spatialCoordinatesValid=!1,this.voxelCoordinates=null,this.voxelSize.reset(),this.changed.dispatch()}getVoxelCoordinates(e){let{voxelCoordinates:t}=this;if(t)s.u.copy(e,t);else{if(!this.valid)return!1;this.voxelSize.voxelFromSpatial(e,this.spatialCoordinates)}return!0}setVoxelCoordinates(e){let t=this.voxelSize;if(t.valid)t.spatialFromVoxel(this.spatialCoordinates,e),this.markSpatialCoordinatesChanged();else{let t=this.voxelCoordinates;t?s.u.copy(t,e):this.voxelCoordinates=t=s.u.clone(e)}this.changed.dispatch()}markSpatialCoordinatesChanged(){this.spatialCoordinatesValid=!0,this.voxelCoordinates=null,this.changed.dispatch()}handleVoxelSizeChanged(){null==this.voxelCoordinates||this.spatialCoordinatesValid||(this.voxelSize.spatialFromVoxel(this.spatialCoordinates,this.voxelCoordinates),this.spatialCoordinatesValid=!0),this.voxelCoordinates=null,this.changed.dispatch()}toJSON(){let e=!0,t=this.voxelSize.toJSON(),n={};if(void 0!==t&&(e=!1,n.voxelSize=t),this.voxelCoordinatesValid){let t=d;this.getVoxelCoordinates(t),n.voxelCoordinates=Array.prototype.slice.call(t),e=!1}else this.spatialCoordinatesValid&&(n.spatialCoordinates=Array.prototype.slice.call(this.spatialCoordinates),e=!1);if(!e)return n}restoreState(e){Object(o.t)(e),Object(o.v)(e,"voxelSize",e=>{void 0!==e&&this.voxelSize.restoreState(e)}),this.spatialCoordinatesValid=!1,Object(o.v)(e,"voxelCoordinates",e=>{void 0!==e&&this.setVoxelCoordinates(Object(o.b)(s.u.create(),e))}),Object(o.v)(e,"spatialCoordinates",e=>{void 0!==e&&(Object(o.b)(this.spatialCoordinates,e),this.markSpatialCoordinatesChanged())})}snapToVoxel(){if(this.valid){let e=this.spatialCoordinates,t=this.voxelSize.size;for(let n=0;n<3;++n){let i=t[n];e[n]=Math.round(e[n]/i)*i}this.changed.dispatch()}else{let{voxelCoordinates:e}=this;if(null!=e){for(let t=0;t<3;++t)e[t]=Math.round(e[t]);this.changed.dispatch()}}}assign(e){this.spatialCoordinatesValid=e.spatialCoordinatesValid,s.u.copy(this.spatialCoordinates,e.spatialCoordinates);const{voxelCoordinates:t}=e;this.voxelCoordinates=t&&s.u.clone(t),this.changed.dispatch()}static getOffset(e,t){if(e.spatialCoordinatesValid&&t.spatialCoordinatesValid)return{spatialOffset:s.u.subtract(s.u.create(),e.spatialCoordinates,t.spatialCoordinates)};if(e.voxelCoordinates&&t.voxelCoordinates){if(e.voxelSize!==t.voxelSize)throw new Error("Voxel offsets are only meaningful with identical voxelSize.");return{voxelOffset:s.u.subtract(s.u.create(),e.voxelCoordinates,t.voxelCoordinates)}}return{}}static addOffset(e,t,n,i=1){const{spatialOffset:r,voxelOffset:o}=n;void 0!==r&&t.spatialCoordinatesValid?(s.u.scaleAndAdd(e.spatialCoordinates,t.spatialCoordinates,r,i),e.markSpatialCoordinatesChanged()):void 0!==o&&t.getVoxelCoordinates(d)&&e.setVoxelCoordinates(s.u.scaleAndAdd(d,d,o,i))}}class g{constructor(e,t=new c){this.peer=e,this.link=t}get changed(){return this.value.changed}toJSON(){const{link:e}=this;if(e.value!==i.LINKED)return{link:e.toJSON(),value:this.getValueJson()}}getValueJson(){return this.value.toJSON()}reset(){this.link.value=i.LINKED}restoreState(e){void 0!==e&&0!==Object.keys(e).length?(Object(o.t)(e),this.link.value=i.UNLINKED,Object(o.v)(e,"value",e=>{void 0!==e&&this.value.restoreState(e)}),Object(o.v)(e,"link",e=>this.link.restoreState(e))):this.link.value=i.LINKED}copyToPeer(){this.link.value!==i.LINKED&&(this.link.value=i.UNLINKED,this.peer.assign(this.value),this.link.value=i.LINKED)}}class m extends g{constructor(){super(...arguments),this.value=p(new f(this.peer.voxelSize.addRef()),this.peer,this.link,{assign:(e,t)=>e.assign(t),isValid:e=>e.spatialCoordinatesValid||e.voxelCoordinatesValid,difference:f.getOffset,add:f.addOffset,subtract:(e,t,n)=>{f.addOffset(e,t,n,-1)}})}getValueJson(){const e=this.value.toJSON()||{};return delete e.voxelSize,e}}class v extends r.a{constructor(e){super(),this.changed=new a.a,null==e&&(e=s.p.create()),this.orientation=e}toJSON(){let{orientation:e}=this;var t;if(s.p.normalize(this.orientation,this.orientation),0!==(t=e)[0]||0!==t[1]||0!==t[2]||1!==t[3])return Array.prototype.slice.call(this.orientation)}restoreState(e){try{Object(o.b)(this.orientation,e),s.p.normalize(this.orientation,this.orientation)}catch(e){s.p.identity(this.orientation)}this.changed.dispatch()}reset(){s.p.identity(this.orientation),this.changed.dispatch()}snap(){let e=s.k.create();s.k.fromQuat(e,this.orientation);let t=[!1,!1,!1];for(let n=0;n<3;++n){let i=0,r=0;for(let s=0;s<3;++s){let o=e[3*n+s];e[3*n+s]=0,t[s]||Math.abs(o)>Math.abs(i)&&(i=o,r=s)}e[3*n+r]=Math.sign(i),t[r]=!0}s.p.fromMat3(this.orientation,e),this.changed.dispatch()}static makeRelative(e,t){let n=new v(s.p.multiply(s.p.create(),e.orientation,t)),i=!1;n.registerDisposer(e.changed.add(()=>{i||(r=!0,s.p.multiply(n.orientation,e.orientation,t),n.changed.dispatch(),r=!1)}));let r=!1;const o=s.p.invert(s.p.create(),t);return n.registerDisposer(n.changed.add(()=>{r||(i=!0,s.p.multiply(e.orientation,n.orientation,o),e.changed.dispatch(),i=!1)})),n}assign(e){s.p.copy(this.orientation,e.orientation),this.changed.dispatch()}}class b extends g{constructor(){super(...arguments),this.value=p(new v,this.peer,this.link,{assign:(e,t)=>e.assign(t),isValid:()=>!0,difference:(e,t)=>{const n=s.p.create();return s.p.multiply(n,s.p.invert(n,t.orientation),e.orientation)},add:(e,t,n)=>{s.p.multiply(e.orientation,t.orientation,n),e.changed.dispatch()},subtract:(e,t,n)=>{s.p.multiply(e.orientation,t.orientation,s.p.invert(h,n)),e.changed.dispatch()}})}}class y extends r.a{constructor(e,t){super(),this.changed=new a.a,null==e&&(e=new f),this.position=e,null==t&&(t=new v),this.orientation=t,this.registerDisposer(this.position),this.registerDisposer(this.orientation),this.registerDisposer(this.position.changed.add(this.changed.dispatch)),this.registerDisposer(this.orientation.changed.add(this.changed.dispatch))}get valid(){return this.position.valid}reset(){this.position.reset(),this.orientation.reset()}toMat4(e){s.m.fromRotationTranslation(e,this.orientation.orientation,this.position.spatialCoordinates)}toJSON(){let e=this.position.toJSON(),t=this.orientation.toJSON();if(void 0!==e||void 0!==t)return{position:e,orientation:t}}restoreState(e){Object(o.t)(e),Object(o.v)(e,"position",e=>{void 0!==e&&this.position.restoreState(e)}),Object(o.v)(e,"orientation",e=>{void 0!==e&&this.orientation.restoreState(e)})}snap(){this.orientation.snap(),this.position.snapToVoxel(),this.changed.dispatch()}translateAbsolute(e){s.u.add(this.position.spatialCoordinates,this.position.spatialCoordinates,e),this.position.changed.dispatch()}translateRelative(e){if(!this.valid)return;const t=d;s.u.transformQuat(t,e,this.orientation.orientation),s.u.add(this.position.spatialCoordinates,this.position.spatialCoordinates,t),this.position.changed.dispatch()}translateVoxelsRelative(e){if(this.valid){var t=s.u.create();s.u.transformQuat(t,e,this.orientation.orientation),s.u.multiply(t,t,this.position.voxelSize.size),s.u.add(this.position.spatialCoordinates,this.position.spatialCoordinates,t),this.position.changed.dispatch()}}rotateRelative(e,t){var n=s.p.create();s.p.setAxisAngle(n,e,t);var i=this.orientation.orientation;s.p.multiply(i,i,n),this.orientation.changed.dispatch()}rotateAbsolute(e,t,n){var i=s.p.create();s.p.setAxisAngle(i,e,t);var r=this.orientation.orientation;if(void 0!==n){let{spatialCoordinates:e}=this.position,t=s.u.subtract(d,n,e),o=s.p.invert(h,r);s.u.transformQuat(t,t,o),s.p.multiply(r,i,r),s.u.transformQuat(e,t,r),s.u.subtract(e,n,e),this.position.changed.dispatch()}else s.p.multiply(r,i,r);this.orientation.changed.dispatch()}}class w extends r.a{constructor(e=Number.NaN,t=e){super(),this.value_=e,this.defaultValue=t,this.changed=new a.a}get value(){return this.value_}set value(e){e!==this.value_&&(this.value_=e,this.changed.dispatch())}toJSON(){let{value_:e,defaultValue:t}=this;if(!(Number.isNaN(e)&&Number.isNaN(t)||e===t))return e}restoreState(e){"number"==typeof e&&Number.isFinite(e)&&e>0?this.value=e:this.value=this.defaultValue}reset(){this.value=this.defaultValue}zoomBy(e){let{value_:t}=this;Number.isNaN(t)||(this.value=t*e)}assign(e){this.value=e.value}get valid(){return!Number.isNaN(this.value)}}class x extends g{constructor(){super(...arguments),this.value=(()=>{return p(new w,this.peer,this.link,{assign:(e,t)=>e.assign(t),isValid:e=>e.valid,difference:(e,t)=>e.value/t.value,add:(e,t,n)=>{e.value=t.value*n},subtract:(e,t,n)=>{e.value=t.value/n}})})()}}class S extends r.a{constructor(e=new y,t=Number.NaN){super(),this.pose=e,this.changed=new a.a,this.zoomFactor="number"==typeof t?new w(t):t,this.registerDisposer(this.zoomFactor),this.registerDisposer(e),this.registerDisposer(this.pose.changed.add(()=>{this.changed.dispatch()})),this.registerDisposer(this.zoomFactor.changed.add(()=>{this.changed.dispatch()})),this.registerDisposer(this.voxelSize.changed.add(()=>{this.handleVoxelSizeChanged()})),this.handleVoxelSizeChanged()}get voxelSize(){return this.pose.position.voxelSize}reset(){this.pose.reset(),this.zoomFactor.reset()}setZoomFactorFromVoxelSize(){let{voxelSize:e}=this;e.valid&&(this.zoomFactor.value=Math.min.apply(null,this.voxelSize.size))}handleVoxelSizeChanged(){this.zoomFactor.valid||this.setZoomFactorFromVoxelSize()}get position(){return this.pose.position}toMat4(e){this.pose.toMat4(e);let t=this.zoomFactor.value;s.m.scale(e,e,s.u.fromValues(t,t,t))}get valid(){return this.pose.valid}toJSON(){let e=this.pose.toJSON(),t=this.zoomFactor.toJSON();if(void 0!==e||void 0!==t)return{pose:e,zoomFactor:t}}restoreState(e){try{Object(o.t)(e),Object(o.v)(e,"pose",e=>{void 0!==e&&this.pose.restoreState(e)}),Object(o.v)(e,"zoomFactor",e=>{void 0!==e&&this.zoomFactor.restoreState(e)}),this.handleVoxelSizeChanged(),this.changed.dispatch()}catch(e){this.reset()}}zoomBy(e){this.zoomFactor.zoomBy(e)}}},function(e,t,n){"use strict";n.d(t,"d",function(){return a}),n.d(t,"c",function(){return u}),n.d(t,"b",function(){return d}),n.d(t,"e",function(){return h}),n.d(t,"a",function(){return p});var i=n(9),r=n(1),s=n(25),o=n(3);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const a=40,l=.5,c=-4;function u(e){return(Math.log2(e)-c)/l}function d(e){return 2**(e*l+c)}function h(e){return new i.c(e,r.o)}class p{constructor(){this.visibility=new s.a,this.changed=new o.a,this.frameNumber=-1,this.spatialScales=new Map,this.numHistogramRows=1,this.value=new Uint32Array(a*this.numHistogramRows*2)}begin(e){e!==this.frameNumber&&(this.value.fill(0),this.frameNumber=e,this.spatialScales.clear(),this.changed.dispatch())}add(e,t,n,i){let{spatialScales:r,numHistogramRows:s,value:o}=this,l=r.get(e);if(void 0===l&&(l=r.size,r.set(e,l)),l>=s){this.numHistogramRows=s*=2;const e=new Uint32Array(s*a*2);e.set(o),this.value=o=e}const c=l*a*2+Math.min(Math.max(0,Math.round(u(t))),a-1);o[c]+=n,o[c+a]+=i}}},function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return c}),n.d(t,"c",function(){return u}),n.d(t,"d",function(){return d});n(143);var i=n(2),r=n(10),s=n(3),o=n(25);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class a extends i.a{constructor(e=new o.b){super(),this.visibility=e,this.element=document.createElement("div");const{element:t}=this;t.classList.add("neuroglancer-tab-content")}get visible(){return this.visibility.visible}disposed(){Object(r.b)(this.element),super.disposed()}}class l extends i.a{constructor(){super(...arguments),this.changed=new s.a,this.options=new Map,this.optionsChanged=new s.a,this.selectedValue=void 0,this.defaultValue=void 0,this.ready_=!0}get value(){const{selectedValue:e}=this;return void 0!==e?e:this.defaultValue}set default(e){this.defaultValue!==e&&(this.defaultValue=e,this.changed.dispatch())}get default(){return this.defaultValue}set value(e){void 0!==e&&this.ready_&&!this.options.has(e)&&(e=void 0);const{selectedValue:t}=this;t!==e&&(this.selectedValue=e,this.changed.dispatch())}get validValue(){const e=this.selectedValue;return void 0!==e&&this.options.has(e)?e:this.defaultValue}add(e,t){const{options:n}=this;if(n.has(e))throw new Error(`Option already defined: ${JSON.stringify(e)}.`);n.set(e,t),this.optionsChanged.dispatch(),void 0===this.defaultValue&&(this.default=e)}toJSON(){const{value:e,defaultValue:t}=this;if(e!==t)return e}reset(){this.value=void 0}get ready(){return this.ready_}set ready(e){e!==this.ready_&&(this.ready_=e,e&&(this.value=this.value),this.changed.dispatch())}restoreState(e){"string"!=typeof e&&(e=void 0),this.value=e}}class c extends i.a{constructor(e,t=new o.b){super(),this.getter=e,this.visibility=t,this.element=document.createElement("div"),this.tabs=new Map,this.tabVisibilityChanged=new s.b;const{element:n}=this;n.className="neuroglancer-stack-view",this.registerDisposer(t.changed.add(()=>this.updateSelectedTab())),this.updateSelectedTab()}get visible(){return this.visibility.visible}get selected(){return this.selectedTabValue}set selected(e){this.selectedTabValue=e,this.updateSelectedTab()}invalidate(e){const{tabs:t}=this,n=t.get(e);void 0!==n&&(n.dispose(),t.delete(e),e===this.displayedTab&&(this.displayedTab=void 0,this.updateSelectedTab()))}hideTab(e){const t=this.tabs.get(e);void 0!==t&&(t.visibility.value=o.b.IGNORED,t.element.style.display="none"),this.tabVisibilityChanged.dispatch(e,!1)}showTab(e){const{tabs:t}=this;let n=t.get(e);void 0===n&&(n=this.getter(e),this.element.appendChild(n.element),t.set(e,n)),n.element.style.display=null,n.visibility.value=o.b.VISIBLE,this.tabVisibilityChanged.dispatch(e,!0)}updateSelectedTab(){const{displayedTab:e}=this,t=this.visible?this.selectedTabValue:void 0;t!==e&&(void 0!==e&&this.hideTab(e),this.displayedTab=t,void 0!==t&&this.showTab(t))}invalidateAll(){const{tabs:e}=this;for(const t of e.values())t.dispose();e.clear(),this.updateSelectedTab()}disposed(){this.selectedTabValue=void 0,this.invalidateAll(),Object(r.b)(this.element),super.disposed()}}class u extends l{}class d extends i.a{constructor(e,t=new o.b){super(),this.state=e,this.visibility=t,this.element=document.createElement("div"),this.tabBar=document.createElement("div"),this.tabLabels=new Map,this.tabsGeneration=-1;const{element:n,tabBar:i}=this;n.className="neuroglancer-tab-view",i.className="neuroglancer-tab-view-bar",n.appendChild(i),this.registerDisposer(t.changed.add(()=>{this.updateTabs()}));const r=this.stack=this.registerDisposer(new c(e=>this.state.options.get(e).getter(),this.visibility));n.appendChild(r.element),this.registerDisposer(this.state.changed.add(()=>this.updateSelectedTab())),this.registerDisposer(this.state.optionsChanged.add(()=>this.updateTabs())),this.stack.tabVisibilityChanged.add((e,t)=>{const n=this.tabLabels.get(e),i="neuroglancer-selected-tab-label";t?n.classList.add(i):n.classList.remove(i)}),this.updateTabs()}get visible(){return this.visibility.visible}updateTabs(){this.tabsGeneration!==this.state.optionsChanged.count&&(this.destroyTabs(),this.visible&&this.makeTabs(),this.updateSelectedTab())}updateSelectedTab(){this.stack.selected=this.state.value}destroyTabs(){-1!==this.tabsGeneration&&(this.stack.selected=void 0,this.tabLabels.clear(),Object(r.a)(this.tabBar),this.tabsGeneration=-1,this.stack.invalidateAll())}makeTabs(){const{tabBar:e,tabLabels:t}=this,n=Array.from(this.state.options);n.sort(([,{order:e=0}],[,{order:t=0}])=>e-t);for(const[i,{label:r}]of n){const n=document.createElement("div");n.classList.add("neuroglancer-tab-label"),n.textContent=r,n.addEventListener("click",()=>{this.state.value=i}),t.set(i,n),e.appendChild(n)}this.tabsGeneration=this.state.optionsChanged.count}disposed(){Object(r.a)(this.tabBar),this.tabLabels.clear(),Object(r.b)(this.element),super.disposed()}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"c",function(){return a}),n.d(t,"b",function(){return l});var i=n(2);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r=new Float32Array(4);class s extends i.a{constructor(e){super(),this.gl=e}setPartIndex(e,...t){let n=`\nvoid setPartIndex(${t.map((e,t)=>`highp uint partIndex${t}`).join()}) {\n  highp uint pickID = uPickID;\n  highp uint pickBaseOffset = getPickBaseOffset();\n${t.map((e,t)=>`highp uint pickOffset${t} = pickBaseOffset + partIndex${t};`).join("\n")}\n`;return 0===t.length&&(n+="\n  highp uint pickOffset0 = pickBaseOffset;\n"),n+=`\n  vPickID = pickID + pickOffset0;\n  highp uint selectedIndex = uSelectedIndex;\nif (selectedIndex == pickBaseOffset${t.map((e,t)=>` || selectedIndex == pickOffset${t}`).join("")}) {\n    vColor = uColorSelected;\n  } else {\n    vColor = uColor;\n  }\n}\n`,e.addVertexCode(n),`setPartIndex(${t.join()})`}getCrossSectionFadeFactor(){return this.targetIsSliceView?"(clamp(1.0 - 2.0 * abs(0.5 - gl_FragCoord.z), 0.0, 1.0))":"(1.0)"}defineShader(e){e.addUniform("highp vec4","uColor"),e.addUniform("highp vec4","uColorSelected"),e.addUniform("highp uint","uSelectedIndex"),e.addVarying("highp vec4","vColor"),e.addUniform("highp mat4","uProjection"),e.addUniform("highp uint","uPickID"),e.addVarying("highp uint","vPickID","flat"),e.addVertexCode(`\nhighp uint getPickBaseOffset() { return uint(gl_InstanceID) * ${this.pickIdsPerInstance}u; }\n`),e.addFragmentCode("\nvoid emitAnnotation(vec4 color) {\n  emit(color, vPickID);\n}\n")}enable(e,t,n){e.bind();const{gl:i}=this,{renderContext:s}=t,{annotationLayer:o}=t;if(i.uniformMatrix4fv(e.uniform("uProjection"),!1,t.projectionMatrix),s.emitPickID&&i.uniform1ui(e.uniform("uPickID"),t.basePickId),s.emitColor){const n=r,s=o.state.color.value;n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=1,i.uniform4fv(e.uniform("uColor"),n);const a=.75;for(let e=0;e<3;++e)n[e]=a+(1-a)*n[e];i.uniform4fv(e.uniform("uColorSelected"),n),i.uniform1ui(e.uniform("uSelectedIndex"),t.selectedIndex)}n()}}const o=new Map;function a(e,t){o.set(e,t)}function l(e){return o.get(e)}},function(e,t,n){"use strict";n(148),n(79);var i=n(85),r=n(32),s=n(113),o=n(102),a=n(71),l=n(7),c=n(0),u=n(36),d=n(86),h=n(67),p=n(87),f=n.n(p),g=n(2);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const m=10,v=1e3,b=400,y=500,w=Math.PI/20,x=20,S=10;function C(e,t){return Math.sqrt(e*e+t*t)}function O(e){let[t,n]=e;t.identifier>n.identifier&&([n,t]=[t,n]);const i=t.clientX-n.clientX,r=t.clientY-n.clientY;return{distance:C(i,r),angle:Math.atan2(i,r)}}class L extends g.a{constructor(e,t){super(),this.target=e,this.eventMap=t,this.prevTouches=new Map,this.moved=!1,this.prevAngle=0,this.rotated=!1,this.prevDistance=0,this.pinched=!1,this.prevCenterX=0,this.prevCenterY=0,this.translated=!1,this.startHold=this.registerCancellable(f()((e,t,n,i)=>{const r={event:e,centerX:n,centerY:i};this.dispatch(`touchhold${e.targetTouches.length}`,e,r,t)},v,{leading:!1,trailing:!0})),this.numPriorTaps=0,this.priorTapNumTouches=0,this.tapStartTime=0,this.tapEndTime=0,this.curTapNumTouches=0,this.registerEventListener(e,"touchstart",e=>{this.handleTouchEvent(e)}),this.registerEventListener(e,"touchmove",e=>{this.handleTouchEvent(e)}),this.registerEventListener(e,"touchend",e=>{this.handleTouchEvent(e)})}dispatch(e,t,n,i=t.eventPhase){Object(l.b)(e,t,i,n,this.eventMap)}handleTouchEvent(e){if(e.target!==this.target)return;e.preventDefault();const t=new Map,{prevTouches:n,prevEvent:i}=this;let r=0,s=0;for(const n of e.targetTouches)t.set(n.identifier,n),r+=n.clientX,s+=n.clientY;r/=t.size,s/=t.size;for(const[e,i]of n.entries()){const r=t.get(e);if(void 0===r)n.delete(e);else{const e=r.clientX-i.clientX,t=r.clientY-i.clientY;(Math.abs(e)>=m||Math.abs(t)>=m)&&(this.moved=!0)}}if(void 0===i||i.targetTouches.length!==t.size||0==t.size){if(this.moved=!1,"touchstart"===e.type)this.startHold(e,e.eventPhase,r,s),void 0!==i&&0!==i.targetTouches.length||(this.tapStartTime=Date.now(),this.curTapNumTouches=0),this.curTapNumTouches=Math.max(this.curTapNumTouches,e.targetTouches.length);else{if("touchend"==e.type){const t=Date.now();if(0===e.targetTouches.length&&t-this.tapStartTime<b){(this.curTapNumTouches!==this.priorTapNumTouches||t-this.tapEndTime>=y)&&(this.numPriorTaps=0),++this.numPriorTaps,this.tapEndTime=t,this.priorTapNumTouches=this.curTapNumTouches;const n={event:e,centerX:r,centerY:s};this.dispatch(`touchtap${this.curTapNumTouches}x${this.numPriorTaps}`,e,n)}}this.startHold.cancel()}if(this.prevTouches=t,this.prevEvent=e,this.prevCenterX=r,this.prevCenterY=s,this.translated=!1,2===t.size){const{distance:e,angle:n}=O(t.values());this.prevDistance=e,this.prevAngle=n,this.rotated=!1,this.pinched=!1}return}if(!this.moved)return;this.tapStartTime=0,this.startHold.cancel(),this.prevTouches=t,this.prevEvent=e;let{prevCenterX:o,prevCenterY:a,translated:l}=this;const c=r-o,u=s-a;if(!1===l&&C(c,u)>=S&&(l=this.translated=!0),!0===l&&(0!==c||0!==u)){this.prevCenterX=r,this.prevCenterY=s;const n={event:e,deltaX:c,deltaY:u,centerX:r,centerY:s};this.dispatch(`touchtranslate${t.size}`,e,n)}if(2===t.size){const{distance:n,angle:i}=O(t.values());let{pinched:o,rotated:a,prevDistance:l,prevAngle:c}=this;!1===o&&Math.abs(n-l)>=x&&(this.pinched=o=!0);const u=function(e,t){const n=2*Math.PI,i=Math.abs(e-t)%n;return Math.min(i,n-i)}(i,c);if(!1===a&&u>=w&&(this.rotated=a=!0),!0===o&&n!=l){this.prevDistance=n;const t={event:e,distance:n,prevDistance:l,centerX:r,centerY:s};this.dispatch("touchpinch",e,t)}!0===a&&i!==c&&(this.prevAngle=i,this.dispatch("touchrotate",e,{event:e,centerX:r,centerY:s,angle:i,prevAngle:c}))}}}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T=0,k=1,E=2;n.d(t,"e",function(){return D}),n.d(t,"c",function(){return R}),n.d(t,"d",function(){return P}),n.d(t,"b",function(){return j}),n.d(t,"a",function(){return V});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const A=c.u.create();class M{constructor(){this.pickIDs=new o.a,this.viewportWidth=0,this.viewportHeight=0,this.invTransform=c.m.create(),this.frameNumber=-1}}class I{constructor(){this.buffer=null,this.glWindowX=0,this.glWindowY=0}}const N=30,D=12,R=1+2*D,P=(()=>{const e=D**2,t=(e,t)=>(e-D)**2+(t-D)**2;let n=new Uint32Array(R*R),i=0;for(let r=0;r<R;++r)for(let s=0;s<R;++s)t(r,s)>e||(n[i++]=s*R+r);return(n=n.subarray(0,i)).sort((e,n)=>{const i=e%R,r=n%R,s=(n-r)/R;return t(i,(e-i)/R)-t(r,s)}),n})();function j(e,t,n,i,r,s,o){const a=i-D,l=r-D;if(!(a>=0&&l>=0&&a+R<=s&&l+R<=o))for(let i=0;i<R;++i)for(let r=0;r<R;++r){const c=a+r,u=l+i;(c<0||u<0||c>=s||u>=o)&&(e[t+(u*R+c)*n]=0)}}class V extends s.b{constructor(e,t,n){super(e,t,n.visibility),this.viewer=n,this.mouseX=-1,this.mouseY=-1,this.pickRequestPending=!1,this.mouseStateForcer=(()=>this.blockOnPickRequest()),this.pickingData=[new M,new M],this.pickRequests=[new I,new I],this.pickBufferContents=new Float32Array(8*R*R),this.pickTimerId=-1,this.nextPickRequestTime=0,this.pendingPickRequestTimerId=-1,this.pendingPickRequestTimerExpired=(()=>{this.pendingPickRequestTimerId=-1,this.pickRequestPending&&this.attemptToIssuePickRequest()}),this.inputEventMap=n.inputEventMap,t.classList.add("neuroglancer-rendered-data-panel"),t.classList.add("neuroglancer-panel"),t.classList.add("neuroglancer-noselect"),this.registerDisposer(new a.a(t)),this.registerDisposer(new u.b(t,this.inputEventMap)),this.registerDisposer(new d.a(t,this.inputEventMap)),this.registerDisposer(new L(t,this.inputEventMap)),this.registerEventListener(t,"mousemove",this.onMousemove.bind(this)),this.registerEventListener(t,"touchstart",this.onTouchstart.bind(this)),this.registerEventListener(t,"mouseleave",this.onMouseout.bind(this)),Object(l.d)(t,"snap",()=>{this.navigationState.pose.snap()}),Object(l.d)(t,"zoom-in",()=>{this.navigationState.zoomBy(.5)}),Object(l.d)(t,"zoom-out",()=>{this.navigationState.zoomBy(2)}),Object(l.d)(t,"highlight",()=>{this.viewer.layerManager.invokeAction("highlight")});for(let e=0;e<3;++e){let n=c.a[e];for(let i of[-1,1]){let r=i<0?"-":"+";Object(l.d)(t,`rotate-relative-${n}${r}`,()=>{this.navigationState.pose.rotateRelative(c.g[e],.1*i)});let s=c.u.create();Object(l.d)(t,`${n}${r}`,()=>{let{navigationState:t}=this,n=s;n[0]=0,n[1]=0,n[2]=0,n[e]=i,t.pose.translateVoxelsRelative(n)})}}Object(l.d)(t,"zoom-via-wheel",e=>{const t=e.detail;this.onMousemove(t),this.zoomByMouse(function(e){let t=0,{deltaMode:n}=e;switch(n){case T:t=.005;break;case k:t=.1;break;case E:t=2}return Math.exp(e.deltaY*t)}(t))}),Object(l.d)(t,"translate-via-mouse-drag",e=>{Object(h.a)(e.detail,(e,t,n)=>{this.translateByViewportPixels(t,n)})}),Object(l.d)(t,"translate-in-plane-via-touchtranslate",e=>{const{detail:t}=e;this.translateByViewportPixels(t.deltaX,t.deltaY)}),Object(l.d)(t,"translate-z-via-touchtranslate",e=>{const{detail:t}=e;let{navigationState:n}=this,i=A;i[0]=0,i[1]=0,i[2]=t.deltaY+t.deltaX,n.pose.translateVoxelsRelative(i)});for(const e of[1,10])Object(l.d)(t,`z+${e}-via-wheel`,t=>{const n=t.detail;let{navigationState:i}=this,r=A,s=0!==n.deltaY?n.deltaY:n.deltaX;r[0]=0,r[1]=0,r[2]=(s>0?-1:1)*e,i.pose.translateVoxelsRelative(r)});Object(l.d)(t,"move-to-mouse-position",()=>{let{mouseState:e}=this.viewer;if(e.updateUnconditionally()){let t=this.navigationState.pose.position;c.u.copy(t.spatialCoordinates,e.position),t.changed.dispatch()}}),Object(l.d)(t,"snap",()=>this.navigationState.pose.snap()),Object(l.d)(t,"select-annotation",()=>{const{mouseState:e,layerManager:t}=this.viewer,n=Object(i.a)(e,t);if(void 0===n)return;const r=n.layer.layer;null!==r&&(this.viewer.selectedLayer.layer=n.layer,this.viewer.selectedLayer.visible=!0,r.tabs.value="annotations",r.selectedAnnotation.value={id:n.id,partIndex:n.partIndex})}),Object(l.d)(t,"move-annotation",e=>{const{mouseState:t}=this.viewer,n=t.pickedAnnotationId,i=t.pickedAnnotationLayer;if(void 0!==i&&void 0!==n){e.stopPropagation();let s=i.source.getReference(n),o=s.value;const a=Object(r.b)(o.type),l=t.pickedOffset;let u=a.getRepresentativePoint(i.objectToGlobal,o,t.pickedOffset),d=c.t.set(c.t.create(),0,0);t.updateUnconditionally()&&Object(h.a)(e.detail,(e,t,n)=>{c.t.add(d,d,[t,n]);let r=this.translateDataPointByViewportPixels(c.u.create(),u,d[0],d[1]),h=a.updateViaRepresentativePoint(o,r,i.globalToObject,l);i.source.update(s,h)},e=>{s.dispose()})}}),Object(l.d)(t,"delete-annotation",()=>{const{mouseState:e}=this.viewer,t=e.pickedAnnotationId,n=e.pickedAnnotationLayer;if(void 0!==n&&!n.source.readonly&&void 0!==t){const e=n.source.getReference(t);try{n.source.delete(e)}finally{e.dispose()}}}),Object(l.d)(t,"zoom-via-touchpinch",e=>{const{detail:t}=e;this.handleMouseMove(t.centerX,t.centerY);const n=t.prevDistance/t.distance;n>.1&&n<10&&this.zoomByMouse(n)})}cancelPickRequests(){const{gl:e}=this;for(const t of this.pickRequests){const{sync:n}=t;null!==n&&e.deleteSync(n),t.sync=null}clearTimeout(this.pickTimerId),this.pickTimerId=-1}checkForResize(){const{clientWidth:e,clientHeight:t}=this.element;e===this.width&&t===this.height||(this.width=e,this.height=t,this.panelSizeChanged())}issuePickRequestInternal(e){const{gl:t}=this;let{buffer:n}=e;null===n?(n=e.buffer=t.createBuffer(),t.bindBuffer(WebGL2RenderingContext.PIXEL_PACK_BUFFER,n),t.bufferData(WebGL2RenderingContext.PIXEL_PACK_BUFFER,32*R*R,WebGL2RenderingContext.STREAM_READ)):t.bindBuffer(WebGL2RenderingContext.PIXEL_PACK_BUFFER,n);let i=this.mouseX,r=this.height-this.mouseY;this.issuePickRequest(i,r),e.sync=t.fenceSync(WebGL2RenderingContext.SYNC_GPU_COMMANDS_COMPLETE,0),e.frameNumber=this.context.frameNumber,e.glWindowX=i,e.glWindowY=r,t.flush(),t.bindBuffer(WebGL2RenderingContext.PIXEL_PACK_BUFFER,null),-1===this.pickTimerId&&this.scheduleCheckForPickRequestCompletion(),this.pickRequestPending=!1;const{pickRequests:s}=this;e!==s[0]&&(s[1]=s[0],s[0]=e),this.nextPickRequestTime=Date.now()+N}completePickInternal(e){const{gl:t}=this,{pickBufferContents:n}=this;t.bindBuffer(WebGL2RenderingContext.PIXEL_PACK_BUFFER,e.buffer),t.getBufferSubData(WebGL2RenderingContext.PIXEL_PACK_BUFFER,0,n),t.bindBuffer(WebGL2RenderingContext.PIXEL_PACK_BUFFER,null);const{pickingData:i}=this,{frameNumber:r}=e;this.completePickRequest(e.glWindowX,e.glWindowY,n,i[0].frameNumber===r?i[0]:i[1])}scheduleCheckForPickRequestCompletion(){this.pickTimerId=setTimeout(()=>{this.pickTimerId=-1,this.checkForPickRequestCompletion()},0)}checkForPickRequestCompletion(e=!1,t=!1){let n=this.context.frameNumber,i=-1;e&&(i=--n-1);const{pickRequests:r}=this,{gl:s}=this;let o,a=!1,l=!1;for(const e of r){const{sync:r}=e;if(null===r)continue;const{frameNumber:c}=e;if(!l&&c>=n-1)if(t||s.getSyncParameter(r,WebGL2RenderingContext.SYNC_STATUS)===WebGL2RenderingContext.SIGNALED)this.completePickInternal(e),l=!0;else if(c!==i){a=!0;continue}s.deleteSync(r),e.sync=null,o=e}const{pickTimerId:c}=this;a&&-1===c?this.scheduleCheckForPickRequestCompletion():a||-1===c||(clearTimeout(c),this.pickTimerId=-1),!e&&void 0!==o&&this.pickRequestPending&&this.canIssuePickRequest()&&this.issuePickRequestInternal(o)}blockOnPickRequest(){this.pickRequestPending&&(this.cancelPickRequests(),this.nextPickRequestTime=0,this.attemptToIssuePickRequest()),this.checkForPickRequestCompletion(!1,!0)}draw(){this.checkForResize();const{width:e,height:t}=this;if(0===e||0===t)return;this.checkForPickRequestCompletion(!0);const{pickingData:n}=this;n[0]=n[1];const i=this.context.frameNumber,r=n[1];r.frameNumber=i,r.viewportWidth=e,r.viewportHeight=t,r.pickIDs.clear(),this.drawWithPicking(r)?(this.nextPickRequestTime=0,this.mouseX>0&&this.attemptToIssuePickRequest()):r.frameNumber=-1}canIssuePickRequest(){const e=Date.now(),{nextPickRequestTime:t,pendingPickRequestTimerId:n}=this;return!(e<t)||(-1==n&&(this.pendingPickRequestTimerId=setTimeout(this.pendingPickRequestTimerExpired,t-e)),!1)}attemptToIssuePickRequest(){if(!this.canIssuePickRequest())return;const e=this.context.frameNumber,{gl:t}=this,{pickRequests:n}=this;for(const i of n){let{sync:n}=i;if(null!==n){if(!(i.frameNumber<e-1))continue;t.deleteSync(n)}return void this.issuePickRequestInternal(i)}}updateMousePosition(e,t){if(e===this.mouseX&&t===this.mouseY)return;if(this.mouseX=e,this.mouseY=t,e<0)return this.pickRequestPending=!1,void this.cancelPickRequests();const n=this.context.frameNumber,i=this.pickingData[1];i.frameNumber===n&&this.width===i.viewportWidth&&this.height===i.viewportHeight&&(this.pickRequestPending=!0,this.attemptToIssuePickRequest())}onMouseout(e){this.updateMousePosition(-1,-1),this.viewer.mouseState.setForcer(void 0)}handleMouseMove(e,t){let{element:n}=this;const i=n.getBoundingClientRect(),r=e-i.left,s=t-i.top,{mouseState:o}=this.viewer;o.pageX=e+window.scrollX,o.pageY=t+window.scrollY,o.setForcer(this.mouseStateForcer),this.updateMousePosition(r,s)}onMousemove(e){let{element:t}=this;e.target===t&&this.handleMouseMove(e.clientX,e.clientY)}onTouchstart(e){let{element:t}=this;if(e.target!==t||1!==e.targetTouches.length)return;const{clientX:n,clientY:i}=e.targetTouches[0];this.handleMouseMove(n,i)}disposed(){let{mouseState:e}=this.viewer;e.removeForcer(this.mouseStateForcer);const{gl:t}=this;this.cancelPickRequests();const{pendingPickRequestTimerId:n}=this;-1!==n&&clearTimeout(n);for(const e of this.pickRequests)t.deleteBuffer(e.buffer);super.disposed()}}},function(e,t,n){"use strict";n.d(t,"c",function(){return l}),n.d(t,"b",function(){return c}),n.d(t,"a",function(){return u});var i=n(45),r=n(0);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const s=r.u.create(),o=r.u.create();var a=new Array;function l(e){a.push(e)}class c extends i.c{constructor(e,t){super(e,t),this.chunkFormatHandler=this.registerDisposer(function(e,t){for(let n of a){let i=n(e,t);if(null!=i)return i}throw new Error("No chunk format handler found.")}(e.chunkQueueManager.gl,this.spec))}get chunkFormat(){return this.chunkFormatHandler.chunkFormat}getValueAt(e,t=this.spec.chunkLayout){const n=s,i=o;let a=this.spec,l=t.size;t.globalToLocalSpatial(i,e);for(let e=0;e<3;++e){const t=l[e],r=i[e];n[e]=Math.floor(r/t)}let c=Object(r.v)(n),u=this.chunks.get(c);if(!u)return null;const d=n,h=a.voxelSize;for(let e=0;e<3;++e)d[e]=Math.floor((i[e]-n[e]*l[e])/h[e]);let p=u.chunkDataSize;for(let e=0;e<3;++e)if(d[e]>=p[e])return;let{numChannels:f}=a;if(1===f)return u.getChannelValueAt(d,0);{let e=new Array(f);for(let t=0;t<f;++t)e[t]=u.getChannelValueAt(d,t);return e}}getChunk(e){return this.chunkFormatHandler.getChunk(this,e)}}class u extends i.b{get chunkFormat(){return this.source.chunkFormat}constructor(e,t){super(e,t),this.chunkDataSize=t.chunkDataSize||e.spec.chunkDataSize}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const i=Symbol("objectId");let r=0;function s(e){if(e instanceof Object){let t=e[i];return void 0===t&&(t=e[i]=r++),`o${t}`}return""+JSON.stringify(e)}},function(e,t,n){"use strict";n.d(t,"b",function(){return a});var i=n(2),r=n(7);n.d(t,"a",function(){return r.a}),n.d(t,"c",function(){return r.d});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const s=new Set(["f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","escape","pause"]),o=new Set(["color","date","datetime","datetime-local","email","month","number","password","search","tel","text","time","url","week"]);class a extends i.a{constructor(e,t){super(),this.target=e,this.eventMap=t,this.modifierShortcutsAreGlobal=!0,this.allShortcutsAreGlobal=!1,this.allowSpaceKeyOnButtons=!1,this.registerEventListener(e,"keydown",this.handleKeyDown.bind(this),!1)}shouldIgnoreEvent(e,t){var n=t.target;let{tagName:i}=n;if(n===this.target)return!1;var r="TEXTAREA"===i||"INPUT"===i||"BUTTON"===i||"SELECT"===i,a=!r&&(n.isContentEditable||n.ownerDocument&&"on"===n.ownerDocument.designMode);return!(!r&&!a)&&(!this.allShortcutsAreGlobal&&!s.has(e)&&(!!a||(!(!this.modifierShortcutsAreGlobal||!(t.altKey||t.ctrlKey||t.metaKey))||("INPUT"===i&&o.has(n.type)?"enter"!==e:"INPUT"!==i&&"BUTTON"!==i||!this.allowSpaceKeyOnButtons&&"space"===e))))}handleKeyDown(e){const t=function(e){return e.code.toLowerCase()}(e);this.shouldIgnoreEvent(t,e)||Object(r.c)(t,e,e,this.eventMap)}}},function(e,t,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function i(e,t){return t.offset+=e,t}function r(e,t){let n=[];for(let i of t)i.startsWith(e)&&n.push({value:i});return n}function s(e,t,n,i){let r=[];for(let s of t){let t=n(s);t.startsWith(e)&&r.push({value:t,description:i(s)})}return r}n.d(t,"a",function(){return i}),n.d(t,"b",function(){return r}),n.d(t,"c",function(){return s})},function(e,t,n){"use strict";n.d(t,"a",function(){return d}),n.d(t,"d",function(){return h}),n.d(t,"e",function(){return f}),n.d(t,"f",function(){return g}),n.d(t,"b",function(){return y}),n.d(t,"c",function(){return w});var i=n(2),r=n(0),s=n(35),o=n(60),a=n(80),l=n(96);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class c extends i.a{constructor(){super(...arguments),this.width=Number.NaN,this.height=Number.NaN}hasSize(e,t){return this.width===e&&this.height===t}resize(e,t){this.hasSize(e,t)||(this.width=e,this.height=t,this.performResize())}}class u extends c{constructor(e,t){super(),this.gl=e,this.internalformat=t,this.renderbuffer=null,this.renderbuffer=e.createRenderbuffer()}performResize(){let{gl:e}=this;e.bindRenderbuffer(e.RENDERBUFFER,this.renderbuffer),e.renderbufferStorage(e.RENDERBUFFER,this.internalformat,this.width,this.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}disposed(){this.gl.deleteRenderbuffer(this.renderbuffer)}attachToFramebuffer(e){let{gl:t}=this;t.framebufferRenderbuffer(t.FRAMEBUFFER,e,t.RENDERBUFFER,this.renderbuffer)}}class d extends u{constructor(e,t=!1){super(e,t?e.DEPTH_STENCIL:e.DEPTH_COMPONENT16),this.gl=e,this.includeStencilBuffer=t}attachToFramebuffer(){let{gl:e}=this;super.attachToFramebuffer(this.includeStencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT)}}const h=class extends d{constructor(e){super(e,!0)}};class p extends i.a{constructor(e){super(),this.gl=e,this.framebuffer=this.gl.createFramebuffer()}disposed(){let{gl:e}=this;e.deleteFramebuffer(this.framebuffer)}bind(){let{gl:e}=this;e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer)}unbind(){let{gl:e}=this;e.bindFramebuffer(e.FRAMEBUFFER,null)}}class f extends c{constructor(e,t,n,i){super(),this.gl=e,this.internalFormat=t,this.format=n,this.dataType=i,this.texture=e.createTexture()}performResize(){Object(a.a)(this.gl,this.texture,this.width,this.height,this.internalFormat,this.format,this.dataType)}disposed(){this.gl.deleteTexture(this.texture)}attachToFramebuffer(e){let{gl:t}=this;t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,this.texture,0)}}function g(e,t,n=WebGL2RenderingContext.RGBA8,i=WebGL2RenderingContext.RGBA,r=WebGL2RenderingContext.UNSIGNED_BYTE){let s=new Array;for(let o=0;o<t;++o)s[o]=new f(e,n,i,r);return s}const m=new Uint8Array(4),v=new Uint32Array(1),b=new Float32Array(4);class y extends i.a{constructor(e,t){super(),this.gl=e,this.width=Number.NaN,this.height=Number.NaN,this.fullAttachmentList=new Array,this.attachmentVerified=!1,this.singleAttachmentList=[this.gl.COLOR_ATTACHMENT0];let{framebuffer:n=new p(e),colorBuffers:i,depthBuffer:r}=t;this.framebuffer=this.registerDisposer(n),this.colorBuffers=i,this.depthBuffer=r,void 0!==r&&this.registerDisposer(r);let{fullAttachmentList:s}=this;i.forEach((t,n)=>{this.registerDisposer(t),s[n]=e.COLOR_ATTACHMENT0+n})}hasSize(e,t){return this.width===e&&this.height===t}bind(e,t){this.width=e,this.height=t,this.framebuffer.bind();let{gl:n,depthBuffer:i}=this;void 0!==i&&(i.resize(e,t),i.attachToFramebuffer()),this.colorBuffers.forEach((i,r)=>{i.resize(e,t),i.attachToFramebuffer(n.COLOR_ATTACHMENT0+r)}),n.drawBuffers(this.fullAttachmentList),this.verifyAttachment(),n.viewport(0,0,e,t)}bindSingle(e){let{gl:t}=this;this.framebuffer.bind(),0!==e&&t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0),t.bindTexture(t.TEXTURE_2D,null),this.colorBuffers[e].attachToFramebuffer(t.COLOR_ATTACHMENT0),t.drawBuffers(this.singleAttachmentList)}unbind(){this.framebuffer.unbind()}readPixel(e,t,n){let{gl:i}=this;try{this.bindSingle(e),i.readPixels(t,n,1,1,i.RGBA,i.UNSIGNED_BYTE,m)}finally{this.framebuffer.unbind()}return m}readPixelUint32(e,t,n){let{gl:i}=this;try{this.bindSingle(e),i.readPixels(t,n,1,1,WebGL2RenderingContext.RED_INTEGER,WebGL2RenderingContext.UNSIGNED_INT,v)}finally{this.framebuffer.unbind()}return v[0]}readPixelFloat32(e,t,n){let{gl:i}=this;try{this.bindSingle(e),i.readPixels(t,n,1,1,WebGL2RenderingContext.RGBA,WebGL2RenderingContext.FLOAT,b)}finally{this.framebuffer.unbind()}return b[0]}readPixelFloat32IntoBuffer(e,t,n,i,r=1,s=1){let{gl:o}=this;try{this.bindSingle(e),o.readPixels(t,n,r,s,WebGL2RenderingContext.RGBA,WebGL2RenderingContext.FLOAT,i)}finally{this.framebuffer.unbind()}}verifyAttachment(){if(this.attachmentVerified)return;let{gl:e}=this;if(e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer configuration not supported");this.attachmentVerified=!0}}class w extends i.a{constructor(e,t){super(),this.gl=e,this.shader=t,this.copyVertexPositionsBuffer=Object(o.a)(this.gl),this.copyTexCoordsBuffer=Object(o.a)(this.gl,0,0,1,1),this.registerDisposer(t)}draw(...e){let{gl:t,shader:n}=this;n.bind();let i=e.length;for(let n=0;n<i;++n)t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,e[n]);t.uniformMatrix4fv(n.uniform("uProjectionMatrix"),!1,r.e);let s=n.attribute("aVertexPosition");this.copyVertexPositionsBuffer.bindToVertexAttrib(s,2);let o=n.attribute("aTexCoord");this.copyTexCoordsBuffer.bindToVertexAttrib(o,2),t.drawArrays(t.TRIANGLE_FAN,0,4),t.disableVertexAttribArray(s),t.disableVertexAttribArray(o);for(let e=0;e<i;++e)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,null)}static get(e,t=l.a,n=1){return e.memoize.get(`OffscreenCopyHelper:${n}:${Object(s.a)(t)}`,()=>new w(e,Object(l.b)(e,t,n)))}}},function(e,t,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function i(e){return`${e.low},${e.high}`}function r(e,t){let{visibleSegments:n,segmentEquivalences:i}=e;for(let e of n)if(i.disjointSets.isMinElement(e))for(let n of i.setElements(e))t(n,e)}n.d(t,"b",function(){return i}),n.d(t,"a",function(){return r})},function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return c});var i=n(14),r=n(37),s=n(2);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function o(e,t){void 0===t&&(t=-1===e.indexOf("/")?":":"/");let n=e.lastIndexOf(t);return-1===n?0:n+1}class a extends s.a{}const l=/^(?:([a-zA-Z][a-zA-Z0-9-+_]*):\/\/)?(.*)$/;class c extends s.a{constructor(){super(...arguments),this.dataSources=new Map}register(e,t){this.dataSources.set(e,this.registerDisposer(t))}getDataSource(e){let t=e.match(l);if(null===t||void 0===t[1])throw new Error('Data source URL must have the form "<protocol>://<path>".');let n=t[1],i=this.dataSources.get(n);if(void 0===i)throw new Error(`Unsupported data source: ${JSON.stringify(n)}.`);return[i,t[2],n]}getVolume(e,t,n={},r=i.e){let[s,o]=this.getDataSource(t);return void 0===n&&(n={}),n.dataSourceProvider=this,new Promise(t=>{t(s.getVolume(e,o,n,r))})}getAnnotationSource(e,t,n=i.e){let[r,s]=this.getDataSource(t);return new Promise(t=>{t(r.getAnnotationSource(e,s,n))})}getVectorGraphicsSource(e,t,n={},r=i.e){let[s,o]=this.getDataSource(t);return new Promise(t=>{t(s.getVectorGraphicsSource(e,o,n,r))})}getMeshSource(e,t,n=i.e){let[r,s]=this.getDataSource(t);return new Promise(t=>{t(r.getMeshSource(e,s,n))})}getSkeletonSource(e,t,n=i.e){let[r,s]=this.getDataSource(t);return new Promise(t=>{t(r.getSkeletonSource(e,s,n))})}volumeCompleter(e,t,n=i.e){let s=e.match(l),o=s[1];if(void 0===o){let t=[];for(let[n,i]of this.dataSources)(n+="://").startsWith(e)&&t.push({value:n,description:i.description});return Promise.resolve({offset:0,completions:t})}{const e=this.dataSources.get(o);return void 0!==e&&void 0!==e.volumeCompleter?e.volumeCompleter(s[2],t,n).then(e=>Object(r.a)(o.length+3,e)):Promise.reject(null)}}suggestLayerName(e){let[t,n]=this.getDataSource(e),i=t.suggestLayerName;return void 0!==i?i(n):function(e,t){let n=o(e,t);return e.substring(n)}(n)}findSourceGroup(e){let[t,n,i]=this.getDataSource(e);return(t.findSourceGroup||o)(n)+i.length+3}}},function(e,t,n){"use strict";n.d(t,"b",function(){return s}),n.d(t,"a",function(){return o});var i=n(40);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r=new Map;function s(e,t){r.set(e,t)}function o(e){const t=new i.b;for(const[n,i]of r)t.register(n,i(e));return t}},function(e,t,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function i(e,t,n,i){for(;t<n;){let r=e[t];i(r)?++t:(--n,e[t]=e[n],e[n]=r)}return n}function r(e,t){if(e.length===t)return e;let n=new e.constructor(t);return n.set(e),n}function s(e,t,n,i){const r=e.length/t,s=e.length*n*i,o=new e.constructor(s),a=e.length*i,l=t,c=t*i;for(let s=0;s<r;++s)for(let r=0;r<t;++r){const u=e[s*t+r],d=s*c+r;for(let e=0;e<n;++e)for(let t=0;t<i;++t)o[e*a+t*l+d]=u}return o}function o(e,t,n,i=0,r=e.length){for(;i<r;){const s=i+r-1>>1,o=n(t,e[s]);if(o>0)i=s+1;else{if(!(o<0))return s;r=s}}return~i}n.d(t,"c",function(){return i}),n.d(t,"b",function(){return r}),n.d(t,"d",function(){return s}),n.d(t,"a",function(){return o})},function(e,t,n){"use strict";var i=n(5),r=n(11),s=n(53),o=n(0);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function a(e,t,n,i,r,s,a){const{octree:l,lodScales:c,chunkGridSpatialOrigin:u,chunkShape:d}=e,h=c.length-1,p=t[0],f=t[4],g=t[8],m=t[1],v=t[5],b=t[9],y=t[3],w=t[7],x=t[11],S=t[15],C=y>0?0:1,O=w>0?0:1,L=x>0?0:1,T=n[16],k=n[17],E=n[18],A=n[19];function M(e,t,n){return y*e+w*t+x*n+S}const I=M(-A*T,-A*k,-A*E),N=e.clipLowerBound[0],D=e.clipLowerBound[1],R=e.clipLowerBound[2],P=e.clipUpperBound[0],j=e.clipUpperBound[1],V=e.clipUpperBound[2],_=Math.sqrt((p*r)**2+(m*s)**2),U=Math.sqrt((f*r)**2+(v*s)**2),F=Math.sqrt((g*r)**2+(b*s)**2),z=Math.max(_,U,F);!function e(t,r,s){const h=1<<t,p=5*r,f=l[p],g=l[p+1],m=l[p+2],v=l[p+3],b=l[p+4];let y=f*h*d[0]+u[0],w=g*h*d[1]+u[1],x=m*h*d[2]+u[2],S=y+h*d[0],T=w+h*d[1],k=x+h*d[2];if(y=Math.max(y,N),w=Math.max(w,D),x=Math.max(x,R),S=Math.min(S,P),T=Math.min(T,j),k=Math.min(k,V),Object(o.f)(y,w,x,S,T,k,n)){const n=Math.max(I,function(e,t,n,i,r,s){return M(e+C*(i-e),t+O*(r-t),n+L*(s-n))}(y,w,x,S,T,k))/z;if(0===s||n*i<s){const o=c[t];if(0!==o&&a(t,r,o/n,b>>>31),t>0&&(0===o||n*i<o)){const n=0===o?s:o,i=(2147483647&b)>>>0;for(let r=v;r<i;++r)e(t-1,r,n)}}}}(h,l.length/5-1,0)}function l(e,t,n,i,r,s,o,l){const{lodScales:c}=e;let u=0;for(;u+1<c.length&&0!==c[u+1];)++u;const d=3,h=[];let p=0,f=0;function g(e,t){for(;;){if(0===p)return;const n=p-1,i=u-n,r=h[n*d],s=0===i?1:8,o=h[n*d+1],a=h[n*d+2];if(e===p){const e=t&s-1;return f!==e&&-1!==r&&l(i,r,f,e,a),void(f=e+1)}f!==s&&-1!==r&&l(i,r,f,s,a),f=o+1,--p}}let m=0;const{octree:v}=e;a(e,t,n,i,r,s,(e,t,n,i)=>{if(!i&&!o(e,t,n))return void(m=Math.max(e,m));if(e<m)return;m=0;const r=5*t,s=
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e,t,n){return 1&e|t<<1&2|n<<2&4}(v[r],v[r+1],v[r+2]),a=u-e;g(a,s);const l=a*d;h[l]=i?-1:t,h[l+1]=s,h[l+2]=n,f=0,p=a+1}),g(0,0)}function c(e,t,n){return`${e}/${t}:${n}`}var u=n(61),d=n(39),h=n(44),p=n(35),f=n(19),g=n(23),m=n(8);n.d(t,"a",function(){return E}),n.d(t,"b",function(){return I}),n.d(t,"c",function(){return R}),n.d(t,"d",function(){return V});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var v=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const b=o.m.create(),y=o.m.create(),w=o.k.create(),x=!1;function S(e,t){t.vertexBuffer=f.a.fromData(e,t.meshData.vertexPositions,e.ARRAY_BUFFER,e.STATIC_DRAW),t.indexBuffer=f.a.fromData(e,t.meshData.indices,e.ELEMENT_ARRAY_BUFFER,e.STATIC_DRAW),t.normalBuffer=f.a.fromData(e,t.meshData.vertexNormals,e.ARRAY_BUFFER,e.STATIC_DRAW)}function C(e){e.vertexBuffer.dispose(),e.indexBuffer.dispose(),e.normalBuffer.dispose()}const O="\nhighp vec3 decodeNormalOctahedronSnorm8(highp vec2 e) {\n  vec3 v = vec3(e.xy, 1.0 - abs(e.x) - abs(e.y));\n  if (v.z < 0.0) v.xy = (1.0 - abs(v.yx)) * vec2(v.x > 0.0 ? 1.0 : -1.0, v.y > 0.0 ? 1.0 : -1.0);\n  return normalize(v);\n}\n";function L(e){return{defineShader:e=>{e.addAttribute("highp vec3","aVertexPosition"),e.addVertexCode("highp vec3 getVertexPosition() { return aVertexPosition; }")},bind(t,n,i){i.vertexBuffer.bindToVertexAttrib(n.attribute("aVertexPosition"),3,e,!0)},endLayer:(e,t)=>{e.disableVertexAttribArray(t.attribute("aVertexPosition"))}}}const T={[s.e.float32]:L(WebGL2RenderingContext.FLOAT),[s.e.uint16]:L(WebGL2RenderingContext.UNSIGNED_SHORT),[s.e.uint10]:{defineShader:e=>{e.addAttribute("highp uint","aVertexPosition"),e.addVertexCode("\nhighp vec3 getVertexPosition() {\n  return vec3(float(aVertexPosition & 1023u),\n              float((aVertexPosition >> 10) & 1023u),\n              float((aVertexPosition >> 20) & 1023u)) / 1023.0;\n}\n")},bind(e,t,n){n.vertexBuffer.bindToVertexAttribI(t.attribute("aVertexPosition"),1,WebGL2RenderingContext.UNSIGNED_INT)},endLayer:(e,t)=>{e.disableVertexAttribArray(t.attribute("aVertexPosition"))}}};class k{constructor(e,t){this.fragmentRelativeVertices=e,this.vertexPositionFormat=t,this.tempLightVec=new Float32Array(4),this.vertexPositionHandler=T[this.vertexPositionFormat]}defineShader(e){this.vertexPositionHandler.defineShader(e),e.addAttribute("highp vec2","aVertexNormal"),e.addVarying("highp vec4","vColor"),e.addUniform("highp vec4","uLightDirection"),e.addUniform("highp vec4","uColor"),e.addUniform("highp mat3","uNormalMatrix"),e.addUniform("highp mat4","uModelViewProjection"),e.addUniform("highp uint","uPickID"),this.fragmentRelativeVertices&&(e.addUniform("highp vec3","uFragmentOrigin"),e.addUniform("highp vec3","uFragmentShape")),e.addVertexCode(O);let t="";this.fragmentRelativeVertices?t+="\nhighp vec3 vertexPosition = uFragmentOrigin + uFragmentShape * getVertexPosition();\nhighp vec3 normalMultiplier = 1.0 / uFragmentShape;\n":t+="\nhighp vec3 vertexPosition = getVertexPosition();\nhighp vec3 normalMultiplier = vec3(1.0, 1.0, 1.0);\n",t+="\ngl_Position = uModelViewProjection * vec4(vertexPosition, 1.0);\nvec3 normal = normalize(uNormalMatrix * normalMultiplier * decodeNormalOctahedronSnorm8(aVertexNormal));\nfloat lightingFactor = abs(dot(normal, uLightDirection.xyz)) + uLightDirection.w;\nvColor = vec4(lightingFactor * uColor.rgb, uColor.a);\n",e.setVertexMain(t),e.setFragmentMain("emit(vColor, uPickID);")}beginLayer(e,t,n){let{lightDirection:i,ambientLighting:r,directionalLighting:s}=n,a=this.tempLightVec;o.u.scale(a,i,s),a[3]=r,e.uniform4fv(t.uniform("uLightDirection"),a)}setColor(e,t,n){e.uniform4fv(t.uniform("uColor"),n)}setPickID(e,t,n){e.uniform1ui(t.uniform("uPickID"),n)}beginModel(e,t,n,i){e.uniformMatrix4fv(t.uniform("uModelViewProjection"),!1,o.m.multiply(b,n.dataToDevice,i)),Object(o.l)(w,i),o.k.invert(w,w),o.k.transpose(w,w),e.uniformMatrix3fv(t.uniform("uNormalMatrix"),!1,w)}getShader(e,t){return e.memoize.get(`mesh/MeshShaderManager:${Object(p.a)(t)}/`+`${this.fragmentRelativeVertices}/${this.vertexPositionFormat}`,()=>{let n=new g.a(e);return n.require(t),this.defineShader(n),n.build()})}drawFragmentHelper(e,t,n,i,r){this.vertexPositionHandler.bind(e,t,n);const{meshData:s}=n;n.normalBuffer.bindToVertexAttrib(t.attribute("aVertexNormal"),2,WebGL2RenderingContext.BYTE,!0),n.indexBuffer.bind();const{indices:o}=s;e.drawElements(s.strips?WebGL2RenderingContext.TRIANGLE_STRIP:WebGL2RenderingContext.TRIANGLES,r-i,2===o.BYTES_PER_ELEMENT?WebGL2RenderingContext.UNSIGNED_SHORT:WebGL2RenderingContext.UNSIGNED_INT,i*o.BYTES_PER_ELEMENT)}drawFragment(e,t,n){const{meshData:i}=n,{indices:r}=i;this.drawFragmentHelper(e,t,n,0,r.length)}drawMultiscaleFragment(e,t,n,i,r){const s=n.meshData.subChunkOffsets[i],o=n.meshData.subChunkOffsets[r];this.drawFragmentHelper(e,t,n,s,o)}endLayer(e,t){this.vertexPositionHandler.endLayer(e,t),e.disableVertexAttribArray(t.attribute("aVertexNormal"))}}class E extends u.a{constructor(e,t,n){super(),this.chunkManager=e,this.source=t,this.displayState=n,this.meshShaderManager=new k(!1,s.e.float32),this.shaders=new Map,Object(h.e)(n,this);let i=this.backend=this.registerDisposer(new h.b(e,n));i.RPC_TYPE_ID=s.b,i.initializeCounterpartWithChunkManager({source:t.addCounterpartRef()}),this.setReady(!0),i.visibility.add(this.visibility),this.registerDisposer(n.renderScaleHistogram.visibility.add(this.visibility))}getShader(e){let{shaders:t}=this,n=t.get(e);return void 0===n&&(n=this.registerDisposer(this.meshShaderManager.getShader(this.gl,e)),t.set(e,n)),n}get isTransparent(){return this.displayState.objectAlpha.value<1}get gl(){return this.chunkManager.chunkQueueManager.gl}draw(e){if(!e.emitColor&&e.alreadyEmittedPickID)return;let{gl:t,displayState:n,meshShaderManager:r}=this,s=Math.min(1,n.objectAlpha.value);if(s<=0)return;let o=this.getShader(e.emitter);o.bind();const a=this.displayState.objectToDataTransform.transform;r.beginLayer(t,o,e),r.beginModel(t,o,e,a);let{pickIDs:l}=e;const c=this.source.chunks;let u=0,p=0;const{renderScaleHistogram:f}=this.displayState,g=this.source.fragmentSource.chunks;Object(d.a)(n,(a,f)=>{const m=Object(d.b)(a),v=c.get(m);if(void 0!==v){e.emitColor&&r.setColor(t,o,Object(h.d)(n,f,s)),e.emitPickID&&r.setPickID(t,o,l.registerUint64(this,a)),u+=v.fragmentIds.length;for(const e of v.fragmentIds){const n=g.get(`${m}/${e}`);void 0!==n&&n.state===i.g.GPU_MEMORY&&(r.drawFragment(t,o,n),++p)}}}),e.emitColor&&(f.begin(this.chunkManager.chunkQueueManager.frameNumberCounter.frameNumber),f.add(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,p,u-p)),r.endLayer(t,o)}isReady(){const{displayState:e,source:t}=this;let n=!0;const r=t.fragmentSource.chunks;return Object(d.a)(e,e=>{const s=Object(d.b)(e),o=t.chunks.get(s);if(void 0!==o)for(const e of o.fragmentIds){const t=r.get(`${s}/${e}`);if(void 0===t||t.state!==i.g.GPU_MEMORY)return void(n=!1)}else n=!1}),n}}class A extends r.b{constructor(e,t){super(e),this.fragmentIds=t.fragmentIds}}class M extends r.b{constructor(e,t){super(e),this.meshData=t}copyToGPU(e){super.copyToGPU(e),S(e,this)}freeGPUMemory(e){super.freeGPUMemory(e),C(this)}}class I extends r.e{constructor(){super(...arguments),this.fragmentSource=this.registerDisposer(new N(this.chunkManager,this))}initializeCounterpart(e,t){this.fragmentSource.initializeCounterpart(this.chunkManager.rpc,{}),t.fragmentSource=this.fragmentSource.addCounterpartRef(),super.initializeCounterpart(e,t)}getChunk(e){return new A(this,e)}}let N=class extends r.e{constructor(e,t){super(e),this.meshSource=t}get key(){return this.meshSource.key}getChunk(e){return new M(this,e)}};function D(e,t,n,r){const s=e.get(c(t,n,r));return void 0!==s&&s.state===i.g.GPU_MEMORY}N=v([Object(m.g)(s.a)],N);class R extends u.a{constructor(e,t,n){super(),this.chunkManager=e,this.source=t,this.displayState=n,this.meshShaderManager=new k(this.source.format.fragmentRelativeVertices,this.source.format.vertexPositionFormat),this.shaders=new Map,Object(h.e)(n,this);let i=this.backend=this.registerDisposer(new h.b(e,n));i.RPC_TYPE_ID=s.d,i.initializeCounterpartWithChunkManager({source:t.addCounterpartRef()}),this.setReady(!0),i.visibility.add(this.visibility),this.registerDisposer(n.renderScaleHistogram.visibility.add(this.visibility))}getShader(e){let{shaders:t}=this,n=t.get(e);return void 0===n&&(n=this.registerDisposer(this.meshShaderManager.getShader(this.gl,e)),t.set(e,n)),n}get isTransparent(){return this.displayState.objectAlpha.value<1}get gl(){return this.chunkManager.chunkQueueManager.gl}draw(e){if(!e.emitColor&&e.alreadyEmittedPickID)return;let{gl:t,displayState:n,meshShaderManager:i}=this,r=Math.min(1,n.objectAlpha.value);if(r<=0)return;let s=this.getShader(e.emitter);s.bind(),i.beginLayer(t,s,e);const{renderScaleHistogram:a}=this.displayState;e.emitColor&&a.begin(this.chunkManager.chunkQueueManager.frameNumberCounter.frameNumber);let{pickIDs:u}=e;const p=o.m.multiply(y,this.displayState.objectToDataTransform.transform,this.source.format.transform);Object(o.l)(w,p);const f=Math.pow(o.k.determinant(w),1/3),{chunks:g}=this.source,m=this.source.fragmentSource.chunks,v=o.m.multiply(o.m.create(),e.dataToDevice,p),b=Object(o.d)(new Float32Array(24),v),S=this.displayState.renderScaleTarget.value,{fragmentRelativeVertices:C}=this.source.format;i.beginModel(t,s,e,p),Object(d.a)(n,(o,p)=>{const y=Object(d.b)(o),w=g.get(y);if(void 0===w)return;const{manifest:O}=w,{octree:L,chunkShape:T,chunkGridSpatialOrigin:k,vertexOffsets:E}=O;e.emitColor&&i.setColor(t,s,Object(h.d)(n,p,r)),e.emitPickID&&i.setPickID(t,s,u.registerUint64(this,o)),x&&console.log("drawing object, numChunks=",O.octree.length/5,O.octree),l(O,v,b,S,e.viewportWidth,e.viewportHeight,(t,n,i)=>{const r=D(m,y,t,n);return e.emitColor&&a.add(O.lodScales[t]*f,i,r?1:0,r?0:1),r},(e,n,r,o)=>{const a=c(y,e,n),l=m.get(a),u=L[5*n],d=L[5*n+1],h=L[5*n+2],p=1<<e;C&&(t.uniform3f(s.uniform("uFragmentOrigin"),k[0]+u*T[0]*p+E[3*e+0],k[1]+d*T[1]*p+E[3*e+1],k[2]+h*T[2]*p+E[3*e+2]),t.uniform3f(s.uniform("uFragmentShape"),T[0]*p,T[1]*p,T[2]*p)),i.drawMultiscaleFragment(t,s,l,r,o)})}),i.endLayer(t,s)}isReady(e){let{displayState:t}=this;if(Math.min(1,t.objectAlpha.value)<=0)return!0;const n=this.displayState.objectToDataTransform.transform,{chunks:i}=this.source,r=this.source.fragmentSource.chunks,s=o.m.multiply(o.m.create(),e.dataToDevice,n),a=Object(o.d)(new Float32Array(24),s),c=this.displayState.renderScaleTarget.value;let u=!0;return Object(d.a)(t,t=>{if(!u)return;const n=Object(d.b)(t),o=i.get(n);if(void 0===o)return void(u=!1);const{manifest:h}=o;l(h,s,a,c,e.viewportWidth,e.viewportHeight,(e,t)=>u=u&&D(r,n,e,t),()=>{})}),u}}class P extends r.b{constructor(e,t){super(e),this.manifest=t.manifest}}class j extends r.b{constructor(e,t){super(e),this.meshData=t}copyToGPU(e){super.copyToGPU(e),S(e,this)}freeGPUMemory(e){super.freeGPUMemory(e),C(this)}}class V extends r.e{constructor(e,t){super(e,t),this.fragmentSource=this.registerDisposer(new _(this.chunkManager,this)),this.format=t.format}initializeCounterpart(e,t){this.fragmentSource.initializeCounterpart(this.chunkManager.rpc,{}),t.fragmentSource=this.fragmentSource.addCounterpartRef(),t.format=this.format,super.initializeCounterpart(e,t)}getChunk(e){return new P(this,e)}}let _=class extends r.e{constructor(e,t){super(e),this.meshSource=t}get key(){return this.meshSource.key}getChunk(e){return new j(this,e)}};_=v([Object(m.g)(s.c)],_)},function(e,t,n){"use strict";n.d(t,"c",function(){return d}),n.d(t,"a",function(){return h}),n.d(t,"f",function(){return p}),n.d(t,"e",function(){return f}),n.d(t,"d",function(){return m}),n.d(t,"b",function(){return b});var i=n(57),r=n(73),s=n(2),o=n(0),a=n(3),l=n(17),c=n(25),u=n(8);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class d{constructor(e,t){this.key=e,this.value=t}toString(){return`${this.key}${this.value}`}}class h extends s.a{constructor(){super(...arguments),this.selectedSegment=new l.a,this.hasSelectedSegment=!1,this.changed=new a.a}set(e){if(null==e)this.hasSelectedSegment&&(this.hasSelectedSegment=!1,this.changed.dispatch());else{let t=this.selectedSegment;this.hasSelectedSegment&&e.low===t.low&&e.high===t.high||(t.low=e.low,t.high=e.high,this.hasSelectedSegment=!0,this.changed.dispatch())}}isSelected(e){return this.hasSelectedSegment&&l.a.equal(e,this.selectedSegment)}bindTo(e,t){let n=new l.a;this.registerDisposer(e.changed.add(()=>{let i=e.get(t);"number"==typeof i?(n.low=i,n.high=0,i=n):i instanceof d&&(i=i.value),this.set(i)}))}}function p(e,t){const n=t.redrawNeeded.dispatch;t.registerDisposer(e.segmentColorHash.changed.add(n)),t.registerDisposer(e.visibleSegments.changed.add(n)),t.registerDisposer(e.saturation.changed.add(n)),t.registerDisposer(e.highlightedSegments.changed.add(n)),t.registerDisposer(e.segmentEquivalences.changed.add(n)),t.registerDisposer(e.segmentSelectionState.changed.add(n))}function f(e,t){!function(e,t){p(e,t),t.registerDisposer(e.objectAlpha.changed.add(t.redrawNeeded.dispatch))}(e,t),t.registerDisposer(e.objectToDataTransform.changed.add(t.redrawNeeded.dispatch)),t.registerDisposer(e.renderScaleTarget.changed.add(t.redrawNeeded.dispatch))}const g=o.w.create();function m(e,t,n=1){const i=g;if(i[3]=n,e.segmentColorHash.compute(i,t),e.segmentSelectionState.isSelected(t))for(let e=0;e<3;++e)i[e]=.5*i[e]+.5;let s=new Float32Array(3);Object(r.b)(s,i[0],i[1],i[2]),s[1]*=e.saturation.value;let o=new Float32Array(3);return Object(r.a)(o,s[0],s[1],s[2]),i[0]=o[0],i[1]=o[1],i[2]=o[2],e.highlightedSegments.has(t)&&(i[0]=.2,i[1]=.2,i[2]=2,i[3]=1),i[0]*=n,i[1]*=n,i[2]*=n,i}const v=Object(c.c)(u.b);class b extends v{constructor(e,t){super(),this.chunkManager=e,this.displayState=t}initializeCounterpartWithChunkManager(e){let{displayState:t}=this;e.chunkManager=this.chunkManager.rpcId,e.visibleSegments=t.visibleSegments.rpcId,e.segmentEquivalences=t.segmentEquivalences.rpcId,e.objectToDataTransform=this.registerDisposer(i.a.makeFromExisting(this.chunkManager.rpc,this.displayState.objectToDataTransform)).rpcId,e.renderScaleTarget=this.registerDisposer(i.a.makeFromExisting(this.chunkManager.rpc,this.displayState.renderScaleTarget)).rpcId,super.initializeCounterpart(this.chunkManager.rpc,e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return x}),n.d(t,"c",function(){return S}),n.d(t,"b",function(){return C}),n.d(t,"d",function(){return O});var i=n(13),r=n.n(i),s=n(5),o=n(11),a=n(27),l=n(70),c=n(2),u=n(0),d=n(35),h=n(3),p=n(25),f=n(38),g=n(23),m=n(60),v=n(8),b=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const y=u.m.create();const w=Object(p.c)(class extends a.h{});let x=class extends w{constructor(e,t,n){super(),this.chunkManager=e,this.layerManager=t,this.navigationState=n,this.gl=this.chunkManager.gl,this.dataToViewport=u.m.create(),this.viewportToDevice=u.m.create(),this.dataToDevice=u.m.create(),this.visibleChunks=new Map,this.viewChanged=new h.a,this.renderingStale=!0,this.visibleChunksStale=!0,this.visibleLayerList=new Array,this.newVisibleLayers=new Set,this.offscreenFramebuffer=this.registerDisposer(new f.b(this.gl,{colorBuffers:Object(f.f)(this.gl,1),depthBuffer:new f.d(this.gl)})),this.numVisibleChunks=0,this.updateVisibleLayers=this.registerCancellable(r()(()=>{this.updateVisibleLayersNow()},0)),this.invalidateVisibleSources=(()=>{this.visibleSourcesStale=!0,this.viewChanged.dispatch()}),this.visibleLayerDisposers=new Map,this.setViewportSizeDebounced=this.registerCancellable(r()((e,t)=>this.setViewportSize(e,t),0)),u.m.identity(this.dataToViewport);const i=this.chunkManager.rpc;this.initializeCounterpart(i,{chunkManager:e.rpcId}),this.registerDisposer(n.changed.add(()=>{this.updateViewportFromNavigationState()})),this.updateViewportFromNavigationState(),this.registerDisposer(t.layersChanged.add(()=>{this.hasValidViewport&&this.updateVisibleLayers()})),this.viewChanged.add(()=>{this.renderingStale=!0}),this.registerDisposer(e.chunkQueueManager.visibleChunksChanged.add(this.viewChanged.dispatch)),this.updateViewportFromNavigationState(),this.updateVisibleLayers()}isReady(){if(this.setViewportSizeDebounced.flush(),!this.hasValidViewport)return!1;this.maybeUpdateVisibleChunks();let e=0;for(const t of this.visibleLayers.values())for(const{chunkLayout:n,source:i}of t){const t=this.visibleChunks.get(n);if(!t)return!1;const{chunks:r}=i;for(const n of t){const t=r.get(n);t&&t.state===s.g.GPU_MEMORY&&++e}}return e===this.numVisibleChunks}updateViewportFromNavigationState(){let{navigationState:e}=this;e.valid&&(e.toMat4(y),this.setViewportToDataMatrix(y))}bindVisibleRenderLayer(e,t){t.push(e.redrawNeeded.add(this.viewChanged.dispatch)),t.push(e.transform.changed.add(this.invalidateVisibleSources)),t.push(e.renderScaleTarget.changed.add(this.invalidateVisibleSources));const{renderScaleHistogram:n}=e;void 0!==n&&t.push(n.visibility.add(this.visibility))}updateVisibleLayersNow(){if(this.wasDisposed)return!1;if(!this.hasValidViewport)return!1;let e=this.visibleLayers,t=this.rpc,n={id:this.rpcId},i=this.newVisibleLayers,r=!1,s=this.visibleLayerList;const{visibleLayerDisposers:o}=this;s.length=0;for(let c of this.layerManager.readyRenderLayers())if(c instanceof l.a&&(i.add(c),s.push(c),!e.has(c))){e.set(c.addRef(),[]);const i=[];o.set(c,i),this.bindVisibleRenderLayer(c,i),n.layerId=c.rpcId,t.invoke(a.b,n),r=!0}for(let s of e.keys())if(!i.has(s)){e.delete(s);const i=this.visibleLayerDisposers.get(s);this.visibleLayerDisposers.delete(s),Object(c.c)(i),n.layerId=s.rpcId,t.invoke(a.c,n),s.dispose(),r=!0}return i.clear(),r&&(this.visibleSourcesStale=!0),this.viewChanged.dispatch(),r}onViewportChanged(){var{width:e,height:t,viewportToDevice:n,dataToViewport:i,dataToDevice:r}=this;u.m.ortho(n,-e/2,e/2,t/2,-t/2,-10,10),u.m.multiply(r,n,i),this.visibleChunksStale=!0,this.viewChanged.dispatch()}setViewportSize(e,t){return this.setViewportSizeDebounced.cancel(),!!super.setViewportSize(e,t)&&(this.rpc.invoke(a.g,{id:this.rpcId,width:e,height:t}),!0)}onViewportToDataMatrixChanged(){let{viewportToData:e,dataToViewport:t}=this;u.m.invert(t,e),Object(u.q)(t),this.rpc.invoke(a.g,{id:this.rpcId,viewportToData:e})}onHasValidViewport(){this.updateVisibleLayers()}updateRendering(){if(this.setViewportSizeDebounced.flush(),!this.renderingStale||!this.hasValidViewport||0===this.width||0===this.height)return;this.renderingStale=!1,this.maybeUpdateVisibleChunks();let{gl:e,offscreenFramebuffer:t,width:n,height:i}=this;t.bind(n,i),e.disable(e.SCISSOR_TEST),e.clearStencil(0),e.clearColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clear(e.COLOR_BUFFER_BIT),e.enable(e.STENCIL_TEST),e.disable(e.DEPTH_TEST),e.stencilOpSeparate(e.FRONT_AND_BACK,e.KEEP,e.KEEP,e.REPLACE);let r=0;for(let t of this.visibleLayerList)e.clear(e.STENCIL_BUFFER_BIT),e.stencilFuncSeparate(e.FRONT_AND_BACK,e.GREATER,1,1),t.setGLBlendMode(e,r),t.draw(this),++r;e.disable(e.BLEND),e.disable(e.STENCIL_TEST),t.unbind()}maybeUpdateVisibleChunks(){return this.updateVisibleLayers.flush(),!(!this.visibleChunksStale&&!this.visibleSourcesStale)&&(this.visibleChunksStale=!1,this.updateVisibleChunks(),!0)}updateVisibleChunks(){let e=this.visibleChunks;let t=0;this.computeVisibleChunks(function(t){let n=e.get(t);return void 0===n?(n=[],e.set(t,n)):n.length=0,n},function(e,n,i,r){let s=Object(u.v)(i);n[n.length]=s,t+=r.length}),this.numVisibleChunks=t}disposed(){for(const[e,t]of this.visibleLayerDisposers)Object(c.c)(t),e.dispose();this.visibleLayerDisposers.clear(),this.visibleLayers.clear(),this.visibleLayerList.length=0}};x=b([Object(v.g)(a.f)],x);class S extends o.e{constructor(e,t){super(e,t),this.spec=t.spec}static encodeOptions(e){const t=super.encodeOptions(e);return t.spec=e.spec.toObject(),t}initializeCounterpart(e,t){t.spec=this.spec.toObject(),super.initializeCounterpart(e,t)}}class C extends o.b{constructor(e,t){super(e),this.chunkGridPosition=t.chunkGridPosition,this.state=s.g.SYSTEM_MEMORY}}class O extends c.a{constructor(e,t){super(),this.gl=e,this.copyVertexPositionsBuffer=Object(m.a)(this.gl),this.textureCoordinateAdjustment=new Float32Array(4);let n=new g.a(e);n.addVarying("vec2","vTexCoord"),n.addUniform("sampler2D","uSampler"),n.addInitializer(t=>{e.uniform1i(t.uniform("uSampler"),0)}),n.addUniform("vec4","uColorFactor"),n.addUniform("vec4","uBackgroundColor"),n.addUniform("mat4","uProjectionMatrix"),n.addUniform("vec4","uTextureCoordinateAdjustment"),n.require(t),n.setFragmentMain("\nvec4 sampledColor = texture(uSampler, vTexCoord);\nif (sampledColor.a == 0.0) {\n  sampledColor = uBackgroundColor;\n}\nemit(sampledColor * uColorFactor, 0u);\n"),n.addAttribute("vec4","aVertexPosition"),n.setVertexMain("\nvTexCoord = uTextureCoordinateAdjustment.xy + 0.5 * (aVertexPosition.xy + 1.0) * uTextureCoordinateAdjustment.zw;\ngl_Position = uProjectionMatrix * aVertexPosition;\n"),this.shader=this.registerDisposer(n.build())}draw(e,t,n,i,r,s,o,a){let{gl:l,shader:c,textureCoordinateAdjustment:u}=this;u[0]=r,u[1]=s,u[2]=o-r,u[3]=a-s,c.bind(),l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,e),l.uniformMatrix4fv(c.uniform("uProjectionMatrix"),!1,t),l.uniform4fv(c.uniform("uColorFactor"),n),l.uniform4fv(c.uniform("uBackgroundColor"),i),l.uniform4fv(c.uniform("uTextureCoordinateAdjustment"),u);let d=c.attribute("aVertexPosition");this.copyVertexPositionsBuffer.bindToVertexAttrib(d,2),l.drawArrays(l.TRIANGLE_FAN,0,4),l.disableVertexAttribArray(d),l.bindTexture(l.TEXTURE_2D,null)}static get(e,t){return e.memoize.get(`sliceview/SliceViewRenderHelper:${Object(d.a)(t)}`,()=>new O(e,t))}}},function(e,t,n){"use strict";n.d(t,"c",function(){return l}),n.d(t,"b",function(){return c}),n.d(t,"a",function(){return u}),n.d(t,"d",function(){return d});var i=n(9),r=n(2),s=n(1),o=n(35),a=n(23);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function l(){return new i.f(void 0)}function c(e){return new i.c(e,s.A)}class u extends r.a{constructor(e,t,n,i=l()){super(),this.gl=e,this.defineShader=t,this.getShaderKey=n,this.shaderError=i,this.shaderUpdated=!0,this.shader=void 0,i.value=void 0}invalidateShader(){this.shaderUpdated=!0}get(){if(!this.shaderUpdated)return this.shader;this.shaderUpdated=!1;try{let e=this.getShader();this.disposeShader(),this.shader=e,this.shaderError.value=null}catch(e){this.shaderError.value=e}return this.shader}getShader(){let e=this.getShaderKey();return this.gl.memoize.get(e,()=>this.buildShader())}buildShader(){let e=new a.a(this.gl);return this.defineShader(e),e.build()}disposed(){super.disposed(),this.disposeShader()}disposeShader(){this.shader&&(this.shader.dispose(),this.shader=void 0)}}function d(e,t,n,i,r,l,c){const u=new Map,d=Object(s.g)(n);function h(e,n){const i=d+"\0"+Object(o.a)(n)+"\0"+JSON.stringify(r);return t.memoize.get(i,()=>{const i=new a.a(t);return i.require(n),c(i,e),i.build()})}return e.registerDisposer(()=>{for(const e of u.values()){const{shader:t}=e;null!==t&&t.dispose()}}),function(e){let t=u.get(e);void 0===t&&(t={generation:-1,shader:null},u.set(e,t));const n=r.changed.count;if(n===t.generation)return t.shader;const s=t.shader;t.generation=n;let o=null;try{o=h(r.value,e),i.value=r.value,l.value=null}catch(t){l.value=t;try{o=h(i.value,e)}catch(e){}}return null!==s&&s.dispose(),t.shader=o,o}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(9),r=n(1);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function s(e=.5){return new i.c(e,r.q)}},function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return l});var i=n(2),r=n(1),s=n(3);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class o extends i.a{constructor(){super(...arguments),this.children=new Map,this.changed=new s.a}add(e,t){const{children:n}=this;if(n.has(e))throw new Error(`Key ${JSON.stringify(e)} already registered.`);return this.children.set(e,t),t.changed.add(this.changed.dispatch),this.changed.dispatch(),()=>{this.remove(e)}}remove(e){const{children:t}=this;if(t.has(e))throw new Error(`Key ${JSON.stringify(e)} not registered.`);const n=t.get(e);this.children.delete(e),n.changed.remove(this.changed.dispatch),this.changed.dispatch()}disposed(){const{changed:e}=this;for(let t of this.children.values())t.changed.remove(e.dispatch);this.children=void 0,super.disposed()}toJSON(){const e=this.baseJSON();for(let[t,n]of this.children)e[t]=n.toJSON();return e}baseJSON(){return{}}reset(){for(let e of this.children.values())e.reset()}restoreState(e){Object(r.t)(e);for(let[t,n]of this.children)try{if(e.hasOwnProperty(t)){const i=e[t];if(void 0===i)continue;n.restoreState(i)}}catch(e){throw new Error(`Error restoring property ${JSON.stringify(t)}: ${e.message}`)}}}const a=new WeakMap;function l(e){let t=a.get(e);const n=e.changed.count;if(void 0!==t&&t.generation===n)return t;let i;if(e instanceof o){i=e.baseJSON();for(let[t,n]of e.children)i[t]=l(n).value}else i=e.toJSON();return void 0===t?(t={generation:n,value:i},a.set(e,t)):(t.generation=n,t.value=i),t}},function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return l});var i=n(71),r=n(2),s=n(36);n(163);let o=0;const a=s.a.fromObject({escape:{action:"close"}});class l extends r.a{constructor(){super(),this.keyMap=new s.a,this.keyMap.addParent(a,Number.NEGATIVE_INFINITY),++o;let e=this.container=document.createElement("div");e.className="overlay";let t=this.content=document.createElement("div");this.registerDisposer(new i.a(t)),t.className="overlay-content",e.appendChild(t),document.body.appendChild(e),this.registerDisposer(new s.b(this.container,this.keyMap)),this.registerEventListener(e,"action:close",()=>{this.dispose()}),t.focus()}disposed(){--o,document.body.removeChild(this.container),super.disposed()}}},function(e,t,n){e.exports=function(){"use strict";var e=navigator.userAgent,t=navigator.platform,n=/gecko\/\d/i.test(e),i=/MSIE \d/.test(e),r=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(e),s=/Edge\/(\d+)/.exec(e),o=i||r||s,a=o&&(i?document.documentMode||6:+(s||r)[1]),l=!s&&/WebKit\//.test(e),c=l&&/Qt\/\d+\.\d+/.test(e),u=!s&&/Chrome\//.test(e),d=/Opera\//.test(e),h=/Apple Computer/.test(navigator.vendor),p=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(e),f=/PhantomJS/.test(e),g=!s&&/AppleWebKit/.test(e)&&/Mobile\/\w+/.test(e),m=/Android/.test(e),v=g||m||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(e),b=g||/Mac/.test(t),y=/\bCrOS\b/.test(e),w=/win/i.test(t),x=d&&e.match(/Version\/(\d*\.\d*)/);x&&(x=Number(x[1])),x&&x>=15&&(d=!1,l=!0);var S=b&&(c||d&&(null==x||x<12.11)),C=n||o&&a>=9;function O(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}var L,T=function(e,t){var n=e.className,i=O(t).exec(n);if(i){var r=n.slice(i.index+i[0].length);e.className=n.slice(0,i.index)+(r?i[1]+r:"")}};function k(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function E(e,t){return k(e).appendChild(t)}function A(e,t,n,i){var r=document.createElement(e);if(n&&(r.className=n),i&&(r.style.cssText=i),"string"==typeof t)r.appendChild(document.createTextNode(t));else if(t)for(var s=0;s<t.length;++s)r.appendChild(t[s]);return r}function M(e,t,n,i){var r=A(e,t,n,i);return r.setAttribute("role","presentation"),r}function I(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if(11==t.nodeType&&(t=t.host),t==e)return!0}while(t=t.parentNode)}function N(){var e;try{e=document.activeElement}catch(t){e=document.body||null}for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}function D(e,t){var n=e.className;O(t).test(n)||(e.className+=(n?" ":"")+t)}function R(e,t){for(var n=e.split(" "),i=0;i<n.length;i++)n[i]&&!O(n[i]).test(t)&&(t+=" "+n[i]);return t}L=document.createRange?function(e,t,n,i){var r=document.createRange();return r.setEnd(i||e,n),r.setStart(e,t),r}:function(e,t,n){var i=document.body.createTextRange();try{i.moveToElementText(e.parentNode)}catch(e){return i}return i.collapse(!0),i.moveEnd("character",n),i.moveStart("character",t),i};var P=function(e){e.select()};function j(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function V(e,t,n){for(var i in t||(t={}),e)!e.hasOwnProperty(i)||!1===n&&t.hasOwnProperty(i)||(t[i]=e[i]);return t}function _(e,t,n,i,r){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var s=i||0,o=r||0;;){var a=e.indexOf("\t",s);if(a<0||a>=t)return o+(t-s);o+=a-s,o+=n-o%n,s=a+1}}g?P=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:o&&(P=function(e){try{e.select()}catch(e){}});var U=function(){this.id=null};function F(e,t){for(var n=0;n<e.length;++n)if(e[n]==t)return n;return-1}U.prototype.set=function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)};var z=30,B={toString:function(){return"CodeMirror.Pass"}},G={scroll:!1},W={origin:"*mouse"},$={origin:"+move"};function H(e,t,n){for(var i=0,r=0;;){var s=e.indexOf("\t",i);-1==s&&(s=e.length);var o=s-i;if(s==e.length||r+o>=t)return i+Math.min(o,t-r);if(r+=s-i,i=s+1,(r+=n-r%n)>=t)return i}}var q=[""];function Y(e){for(;q.length<=e;)q.push(J(q)+" ");return q[e]}function J(e){return e[e.length-1]}function X(e,t){for(var n=[],i=0;i<e.length;i++)n[i]=t(e[i],i);return n}function K(){}function Q(e,t){var n;return Object.create?n=Object.create(e):(K.prototype=e,n=new K),t&&V(t,n),n}var Z=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function ee(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||Z.test(e))}function te(e,t){return t?!!(t.source.indexOf("\\w")>-1&&ee(e))||t.test(e):ee(e)}function ne(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}var ie=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function re(e){return e.charCodeAt(0)>=768&&ie.test(e)}function se(e,t,n){for(;(n<0?t>0:t<e.length)&&re(e.charAt(t));)t+=n;return t}function oe(e,t,n){for(var i=t>n?-1:1;;){if(t==n)return t;var r=(t+n)/2,s=i<0?Math.ceil(r):Math.floor(r);if(s==t)return e(s)?t:n;e(s)?n=s:t=s+i}}function ae(e,t,i){var r=this;this.input=i,r.scrollbarFiller=A("div",null,"CodeMirror-scrollbar-filler"),r.scrollbarFiller.setAttribute("cm-not-content","true"),r.gutterFiller=A("div",null,"CodeMirror-gutter-filler"),r.gutterFiller.setAttribute("cm-not-content","true"),r.lineDiv=M("div",null,"CodeMirror-code"),r.selectionDiv=A("div",null,null,"position: relative; z-index: 1"),r.cursorDiv=A("div",null,"CodeMirror-cursors"),r.measure=A("div",null,"CodeMirror-measure"),r.lineMeasure=A("div",null,"CodeMirror-measure"),r.lineSpace=M("div",[r.measure,r.lineMeasure,r.selectionDiv,r.cursorDiv,r.lineDiv],null,"position: relative; outline: none");var s=M("div",[r.lineSpace],"CodeMirror-lines");r.mover=A("div",[s],null,"position: relative"),r.sizer=A("div",[r.mover],"CodeMirror-sizer"),r.sizerWidth=null,r.heightForcer=A("div",null,null,"position: absolute; height: "+z+"px; width: 1px;"),r.gutters=A("div",null,"CodeMirror-gutters"),r.lineGutter=null,r.scroller=A("div",[r.sizer,r.heightForcer,r.gutters],"CodeMirror-scroll"),r.scroller.setAttribute("tabIndex","-1"),r.wrapper=A("div",[r.scrollbarFiller,r.gutterFiller,r.scroller],"CodeMirror"),o&&a<8&&(r.gutters.style.zIndex=-1,r.scroller.style.paddingRight=0),l||n&&v||(r.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(r.wrapper):e(r.wrapper)),r.viewFrom=r.viewTo=t.first,r.reportedViewFrom=r.reportedViewTo=t.first,r.view=[],r.renderedView=null,r.externalMeasured=null,r.viewOffset=0,r.lastWrapHeight=r.lastWrapWidth=0,r.updateLineNumbers=null,r.nativeBarWidth=r.barHeight=r.barWidth=0,r.scrollbarsClipped=!1,r.lineNumWidth=r.lineNumInnerWidth=r.lineNumChars=null,r.alignWidgets=!1,r.cachedCharWidth=r.cachedTextHeight=r.cachedPaddingH=null,r.maxLine=null,r.maxLineLength=0,r.maxLineChanged=!1,r.wheelDX=r.wheelDY=r.wheelStartX=r.wheelStartY=null,r.shift=!1,r.selForContextMenu=null,r.activeTouch=null,i.init(r)}function le(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var n=e;!n.lines;)for(var i=0;;++i){var r=n.children[i],s=r.chunkSize();if(t<s){n=r;break}t-=s}return n.lines[t]}function ce(e,t,n){var i=[],r=t.line;return e.iter(t.line,n.line+1,function(e){var s=e.text;r==n.line&&(s=s.slice(0,n.ch)),r==t.line&&(s=s.slice(t.ch)),i.push(s),++r}),i}function ue(e,t,n){var i=[];return e.iter(t,n,function(e){i.push(e.text)}),i}function de(e,t){var n=t-e.height;if(n)for(var i=e;i;i=i.parent)i.height+=n}function he(e){if(null==e.parent)return null;for(var t=e.parent,n=F(t.lines,e),i=t.parent;i;t=i,i=i.parent)for(var r=0;i.children[r]!=t;++r)n+=i.children[r].chunkSize();return n+t.first}function pe(e,t){var n=e.first;e:do{for(var i=0;i<e.children.length;++i){var r=e.children[i],s=r.height;if(t<s){e=r;continue e}t-=s,n+=r.chunkSize()}return n}while(!e.lines);for(var o=0;o<e.lines.length;++o){var a=e.lines[o],l=a.height;if(t<l)break;t-=l}return n+o}function fe(e,t){return t>=e.first&&t<e.first+e.size}function ge(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function me(e,t,n){if(void 0===n&&(n=null),!(this instanceof me))return new me(e,t,n);this.line=e,this.ch=t,this.sticky=n}function ve(e,t){return e.line-t.line||e.ch-t.ch}function be(e,t){return e.sticky==t.sticky&&0==ve(e,t)}function ye(e){return me(e.line,e.ch)}function we(e,t){return ve(e,t)<0?t:e}function xe(e,t){return ve(e,t)<0?e:t}function Se(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function Ce(e,t){if(t.line<e.first)return me(e.first,0);var n=e.first+e.size-1;return t.line>n?me(n,le(e,n).text.length):function(e,t){var n=e.ch;return null==n||n>t?me(e.line,t):n<0?me(e.line,0):e}(t,le(e,t.line).text.length)}function Oe(e,t){for(var n=[],i=0;i<t.length;i++)n[i]=Ce(e,t[i]);return n}var Le=!1,Te=!1;function ke(e,t,n){this.marker=e,this.from=t,this.to=n}function Ee(e,t){if(e)for(var n=0;n<e.length;++n){var i=e[n];if(i.marker==t)return i}}function Ae(e,t){for(var n,i=0;i<e.length;++i)e[i]!=t&&(n||(n=[])).push(e[i]);return n}function Me(e,t){if(t.full)return null;var n=fe(e,t.from.line)&&le(e,t.from.line).markedSpans,i=fe(e,t.to.line)&&le(e,t.to.line).markedSpans;if(!n&&!i)return null;var r=t.from.ch,s=t.to.ch,o=0==ve(t.from,t.to),a=function(e,t,n){var i;if(e)for(var r=0;r<e.length;++r){var s=e[r],o=s.marker,a=null==s.from||(o.inclusiveLeft?s.from<=t:s.from<t);if(a||s.from==t&&"bookmark"==o.type&&(!n||!s.marker.insertLeft)){var l=null==s.to||(o.inclusiveRight?s.to>=t:s.to>t);(i||(i=[])).push(new ke(o,s.from,l?null:s.to))}}return i}(n,r,o),l=function(e,t,n){var i;if(e)for(var r=0;r<e.length;++r){var s=e[r],o=s.marker,a=null==s.to||(o.inclusiveRight?s.to>=t:s.to>t);if(a||s.from==t&&"bookmark"==o.type&&(!n||s.marker.insertLeft)){var l=null==s.from||(o.inclusiveLeft?s.from<=t:s.from<t);(i||(i=[])).push(new ke(o,l?null:s.from-t,null==s.to?null:s.to-t))}}return i}(i,s,o),c=1==t.text.length,u=J(t.text).length+(c?r:0);if(a)for(var d=0;d<a.length;++d){var h=a[d];if(null==h.to){var p=Ee(l,h.marker);p?c&&(h.to=null==p.to?null:p.to+u):h.to=r}}if(l)for(var f=0;f<l.length;++f){var g=l[f];if(null!=g.to&&(g.to+=u),null==g.from){var m=Ee(a,g.marker);m||(g.from=u,c&&(a||(a=[])).push(g))}else g.from+=u,c&&(a||(a=[])).push(g)}a&&(a=Ie(a)),l&&l!=a&&(l=Ie(l));var v=[a];if(!c){var b,y=t.text.length-2;if(y>0&&a)for(var w=0;w<a.length;++w)null==a[w].to&&(b||(b=[])).push(new ke(a[w].marker,null,null));for(var x=0;x<y;++x)v.push(b);v.push(l)}return v}function Ie(e){for(var t=0;t<e.length;++t){var n=e[t];null!=n.from&&n.from==n.to&&!1!==n.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function Ne(e){var t=e.markedSpans;if(t){for(var n=0;n<t.length;++n)t[n].marker.detachLine(e);e.markedSpans=null}}function De(e,t){if(t){for(var n=0;n<t.length;++n)t[n].marker.attachLine(e);e.markedSpans=t}}function Re(e){return e.inclusiveLeft?-1:0}function Pe(e){return e.inclusiveRight?1:0}function je(e,t){var n=e.lines.length-t.lines.length;if(0!=n)return n;var i=e.find(),r=t.find(),s=ve(i.from,r.from)||Re(e)-Re(t);if(s)return-s;var o=ve(i.to,r.to)||Pe(e)-Pe(t);return o||t.id-e.id}function Ve(e,t){var n,i=Te&&e.markedSpans;if(i)for(var r=void 0,s=0;s<i.length;++s)(r=i[s]).marker.collapsed&&null==(t?r.from:r.to)&&(!n||je(n,r.marker)<0)&&(n=r.marker);return n}function _e(e){return Ve(e,!0)}function Ue(e){return Ve(e,!1)}function Fe(e,t){var n,i=Te&&e.markedSpans;if(i)for(var r=0;r<i.length;++r){var s=i[r];s.marker.collapsed&&(null==s.from||s.from<t)&&(null==s.to||s.to>t)&&(!n||je(n,s.marker)<0)&&(n=s.marker)}return n}function ze(e,t,n,i,r){var s=le(e,t),o=Te&&s.markedSpans;if(o)for(var a=0;a<o.length;++a){var l=o[a];if(l.marker.collapsed){var c=l.marker.find(0),u=ve(c.from,n)||Re(l.marker)-Re(r),d=ve(c.to,i)||Pe(l.marker)-Pe(r);if(!(u>=0&&d<=0||u<=0&&d>=0)&&(u<=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?ve(c.to,n)>=0:ve(c.to,n)>0)||u>=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?ve(c.from,i)<=0:ve(c.from,i)<0)))return!0}}}function Be(e){for(var t;t=_e(e);)e=t.find(-1,!0).line;return e}function Ge(e,t){var n=le(e,t),i=Be(n);return n==i?t:he(i)}function We(e,t){if(t>e.lastLine())return t;var n,i=le(e,t);if(!$e(e,i))return t;for(;n=Ue(i);)i=n.find(1,!0).line;return he(i)+1}function $e(e,t){var n=Te&&t.markedSpans;if(n)for(var i=void 0,r=0;r<n.length;++r)if((i=n[r]).marker.collapsed){if(null==i.from)return!0;if(!i.marker.widgetNode&&0==i.from&&i.marker.inclusiveLeft&&He(e,t,i))return!0}}function He(e,t,n){if(null==n.to){var i=n.marker.find(1,!0);return He(e,i.line,Ee(i.line.markedSpans,n.marker))}if(n.marker.inclusiveRight&&n.to==t.text.length)return!0;for(var r=void 0,s=0;s<t.markedSpans.length;++s)if((r=t.markedSpans[s]).marker.collapsed&&!r.marker.widgetNode&&r.from==n.to&&(null==r.to||r.to!=n.from)&&(r.marker.inclusiveLeft||n.marker.inclusiveRight)&&He(e,t,r))return!0}function qe(e){e=Be(e);for(var t=0,n=e.parent,i=0;i<n.lines.length;++i){var r=n.lines[i];if(r==e)break;t+=r.height}for(var s=n.parent;s;s=(n=s).parent)for(var o=0;o<s.children.length;++o){var a=s.children[o];if(a==n)break;t+=a.height}return t}function Ye(e){if(0==e.height)return 0;for(var t,n=e.text.length,i=e;t=_e(i);){var r=t.find(0,!0);i=r.from.line,n+=r.from.ch-r.to.ch}for(i=e;t=Ue(i);){var s=t.find(0,!0);n-=i.text.length-s.from.ch,i=s.to.line,n+=i.text.length-s.to.ch}return n}function Je(e){var t=e.display,n=e.doc;t.maxLine=le(n,n.first),t.maxLineLength=Ye(t.maxLine),t.maxLineChanged=!0,n.iter(function(e){var n=Ye(e);n>t.maxLineLength&&(t.maxLineLength=n,t.maxLine=e)})}var Xe=null;function Ke(e,t,n){var i;Xe=null;for(var r=0;r<e.length;++r){var s=e[r];if(s.from<t&&s.to>t)return r;s.to==t&&(s.from!=s.to&&"before"==n?i=r:Xe=r),s.from==t&&(s.from!=s.to&&"before"!=n?i=r:Xe=r)}return null!=i?i:Xe}var Qe=function(){var e="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",t="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";var n=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,i=/[stwN]/,r=/[LRr]/,s=/[Lb1n]/,o=/[1n]/;function a(e,t,n){this.level=e,this.from=t,this.to=n}return function(l,c){var u,d="ltr"==c?"L":"R";if(0==l.length||"ltr"==c&&!n.test(l))return!1;for(var h=l.length,p=[],f=0;f<h;++f)p.push((u=l.charCodeAt(f))<=247?e.charAt(u):1424<=u&&u<=1524?"R":1536<=u&&u<=1785?t.charAt(u-1536):1774<=u&&u<=2220?"r":8192<=u&&u<=8203?"w":8204==u?"b":"L");for(var g=0,m=d;g<h;++g){var v=p[g];"m"==v?p[g]=m:m=v}for(var b=0,y=d;b<h;++b){var w=p[b];"1"==w&&"r"==y?p[b]="n":r.test(w)&&(y=w,"r"==w&&(p[b]="R"))}for(var x=1,S=p[0];x<h-1;++x){var C=p[x];"+"==C&&"1"==S&&"1"==p[x+1]?p[x]="1":","!=C||S!=p[x+1]||"1"!=S&&"n"!=S||(p[x]=S),S=C}for(var O=0;O<h;++O){var L=p[O];if(","==L)p[O]="N";else if("%"==L){var T=void 0;for(T=O+1;T<h&&"%"==p[T];++T);for(var k=O&&"!"==p[O-1]||T<h&&"1"==p[T]?"1":"N",E=O;E<T;++E)p[E]=k;O=T-1}}for(var A=0,M=d;A<h;++A){var I=p[A];"L"==M&&"1"==I?p[A]="L":r.test(I)&&(M=I)}for(var N=0;N<h;++N)if(i.test(p[N])){var D=void 0;for(D=N+1;D<h&&i.test(p[D]);++D);for(var R="L"==(N?p[N-1]:d),P="L"==(D<h?p[D]:d),j=R==P?R?"L":"R":d,V=N;V<D;++V)p[V]=j;N=D-1}for(var _,U=[],F=0;F<h;)if(s.test(p[F])){var z=F;for(++F;F<h&&s.test(p[F]);++F);U.push(new a(0,z,F))}else{var B=F,G=U.length;for(++F;F<h&&"L"!=p[F];++F);for(var W=B;W<F;)if(o.test(p[W])){B<W&&U.splice(G,0,new a(1,B,W));var $=W;for(++W;W<F&&o.test(p[W]);++W);U.splice(G,0,new a(2,$,W)),B=W}else++W;B<F&&U.splice(G,0,new a(1,B,F))}return"ltr"==c&&(1==U[0].level&&(_=l.match(/^\s+/))&&(U[0].from=_[0].length,U.unshift(new a(0,0,_[0].length))),1==J(U).level&&(_=l.match(/\s+$/))&&(J(U).to-=_[0].length,U.push(new a(0,h-_[0].length,h)))),"rtl"==c?U.reverse():U}}();function Ze(e,t){var n=e.order;return null==n&&(n=e.order=Qe(e.text,t)),n}var et=[],tt=function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else if(e.attachEvent)e.attachEvent("on"+t,n);else{var i=e._handlers||(e._handlers={});i[t]=(i[t]||et).concat(n)}};function nt(e,t){return e._handlers&&e._handlers[t]||et}function it(e,t,n){if(e.removeEventListener)e.removeEventListener(t,n,!1);else if(e.detachEvent)e.detachEvent("on"+t,n);else{var i=e._handlers,r=i&&i[t];if(r){var s=F(r,n);s>-1&&(i[t]=r.slice(0,s).concat(r.slice(s+1)))}}}function rt(e,t){var n=nt(e,t);if(n.length)for(var i=Array.prototype.slice.call(arguments,2),r=0;r<n.length;++r)n[r].apply(null,i)}function st(e,t,n){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),rt(e,n||t.type,e,t),dt(t)||t.codemirrorIgnore}function ot(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var n=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),i=0;i<t.length;++i)-1==F(n,t[i])&&n.push(t[i])}function at(e,t){return nt(e,t).length>0}function lt(e){e.prototype.on=function(e,t){tt(this,e,t)},e.prototype.off=function(e,t){it(this,e,t)}}function ct(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function ut(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function dt(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function ht(e){ct(e),ut(e)}function pt(e){return e.target||e.srcElement}function ft(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),b&&e.ctrlKey&&1==t&&(t=3),t}var gt,mt,vt=function(){if(o&&a<9)return!1;var e=A("div");return"draggable"in e||"dragDrop"in e}();function bt(e){if(null==gt){var t=A("span","");E(e,A("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(gt=t.offsetWidth<=1&&t.offsetHeight>2&&!(o&&a<8))}var n=gt?A("span",""):A("span","",null,"display: inline-block; width: 1px; margin-right: -1px");return n.setAttribute("cm-text",""),n}function yt(e){if(null!=mt)return mt;var t=E(e,document.createTextNode("AA")),n=L(t,0,1).getBoundingClientRect(),i=L(t,1,2).getBoundingClientRect();return k(e),!(!n||n.left==n.right)&&(mt=i.right-n.right<3)}var wt,xt=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,n=[],i=e.length;t<=i;){var r=e.indexOf("\n",t);-1==r&&(r=e.length);var s=e.slice(t,"\r"==e.charAt(r-1)?r-1:r),o=s.indexOf("\r");-1!=o?(n.push(s.slice(0,o)),t+=o+1):(n.push(s),t=r+1)}return n}:function(e){return e.split(/\r\n?|\n/)},St=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},Ct="oncopy"in(wt=A("div"))||(wt.setAttribute("oncopy","return;"),"function"==typeof wt.oncopy),Ot=null,Lt={},Tt={};function kt(e){if("string"==typeof e&&Tt.hasOwnProperty(e))e=Tt[e];else if(e&&"string"==typeof e.name&&Tt.hasOwnProperty(e.name)){var t=Tt[e.name];"string"==typeof t&&(t={name:t}),(e=Q(t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return kt("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return kt("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function Et(e,t){t=kt(t);var n=Lt[t.name];if(!n)return Et(e,"text/plain");var i=n(e,t);if(At.hasOwnProperty(t.name)){var r=At[t.name];for(var s in r)r.hasOwnProperty(s)&&(i.hasOwnProperty(s)&&(i["_"+s]=i[s]),i[s]=r[s])}if(i.name=t.name,t.helperType&&(i.helperType=t.helperType),t.modeProps)for(var o in t.modeProps)i[o]=t.modeProps[o];return i}var At={};function Mt(e,t){var n=At.hasOwnProperty(e)?At[e]:At[e]={};V(t,n)}function It(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var n={};for(var i in t){var r=t[i];r instanceof Array&&(r=r.concat([])),n[i]=r}return n}function Nt(e,t){for(var n;e.innerMode&&(n=e.innerMode(t))&&n.mode!=e;)t=n.state,e=n.mode;return n||{mode:e,state:t}}function Dt(e,t,n){return!e.startState||e.startState(t,n)}var Rt=function(e,t,n){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=n};Rt.prototype.eol=function(){return this.pos>=this.string.length},Rt.prototype.sol=function(){return this.pos==this.lineStart},Rt.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},Rt.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},Rt.prototype.eat=function(e){var t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e.test?e.test(t):e(t)))return++this.pos,t},Rt.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},Rt.prototype.eatSpace=function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},Rt.prototype.skipToEnd=function(){this.pos=this.string.length},Rt.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},Rt.prototype.backUp=function(e){this.pos-=e},Rt.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=_(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?_(this.string,this.lineStart,this.tabSize):0)},Rt.prototype.indentation=function(){return _(this.string,null,this.tabSize)-(this.lineStart?_(this.string,this.lineStart,this.tabSize):0)},Rt.prototype.match=function(e,t,n){if("string"!=typeof e){var i=this.string.slice(this.pos).match(e);return i&&i.index>0?null:(i&&!1!==t&&(this.pos+=i[0].length),i)}var r=function(e){return n?e.toLowerCase():e},s=this.string.substr(this.pos,e.length);if(r(s)==r(e))return!1!==t&&(this.pos+=e.length),!0},Rt.prototype.current=function(){return this.string.slice(this.start,this.pos)},Rt.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},Rt.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)},Rt.prototype.baseToken=function(){var e=this.lineOracle;return e&&e.baseToken(this.pos)};var Pt=function(e,t){this.state=e,this.lookAhead=t},jt=function(e,t,n,i){this.state=t,this.doc=e,this.line=n,this.maxLookAhead=i||0,this.baseTokens=null,this.baseTokenPos=1};function Vt(e,t,n,i){var r=[e.state.modeGen],s={};Ht(e,t.text,e.doc.mode,n,function(e,t){return r.push(e,t)},s,i);for(var o=n.state,a=function(i){n.baseTokens=r;var a=e.state.overlays[i],l=1,c=0;n.state=!0,Ht(e,t.text,a.mode,n,function(e,t){for(var n=l;c<e;){var i=r[l];i>e&&r.splice(l,1,e,r[l+1],i),l+=2,c=Math.min(e,i)}if(t)if(a.opaque)r.splice(n,l-n,e,"overlay "+t),l=n+2;else for(;n<l;n+=2){var s=r[n+1];r[n+1]=(s?s+" ":"")+"overlay "+t}},s),n.state=o,n.baseTokens=null,n.baseTokenPos=1},l=0;l<e.state.overlays.length;++l)a(l);return{styles:r,classes:s.bgClass||s.textClass?s:null}}function _t(e,t,n){if(!t.styles||t.styles[0]!=e.state.modeGen){var i=Ut(e,he(t)),r=t.text.length>e.options.maxHighlightLength&&It(e.doc.mode,i.state),s=Vt(e,t,i);r&&(i.state=r),t.stateAfter=i.save(!r),t.styles=s.styles,s.classes?t.styleClasses=s.classes:t.styleClasses&&(t.styleClasses=null),n===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function Ut(e,t,n){var i=e.doc,r=e.display;if(!i.mode.startState)return new jt(i,!0,t);var s=function(e,t,n){for(var i,r,s=e.doc,o=n?-1:t-(e.doc.mode.innerMode?1e3:100),a=t;a>o;--a){if(a<=s.first)return s.first;var l=le(s,a-1),c=l.stateAfter;if(c&&(!n||a+(c instanceof Pt?c.lookAhead:0)<=s.modeFrontier))return a;var u=_(l.text,null,e.options.tabSize);(null==r||i>u)&&(r=a-1,i=u)}return r}(e,t,n),o=s>i.first&&le(i,s-1).stateAfter,a=o?jt.fromSaved(i,o,s):new jt(i,Dt(i.mode),s);return i.iter(s,t,function(n){Ft(e,n.text,a);var i=a.line;n.stateAfter=i==t-1||i%5==0||i>=r.viewFrom&&i<r.viewTo?a.save():null,a.nextLine()}),n&&(i.modeFrontier=a.line),a}function Ft(e,t,n,i){var r=e.doc.mode,s=new Rt(t,e.options.tabSize,n);for(s.start=s.pos=i||0,""==t&&zt(r,n.state);!s.eol();)Bt(r,s,n.state),s.start=s.pos}function zt(e,t){if(e.blankLine)return e.blankLine(t);if(e.innerMode){var n=Nt(e,t);return n.mode.blankLine?n.mode.blankLine(n.state):void 0}}function Bt(e,t,n,i){for(var r=0;r<10;r++){i&&(i[0]=Nt(e,n).mode);var s=e.token(t,n);if(t.pos>t.start)return s}throw new Error("Mode "+e.name+" failed to advance stream.")}jt.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);return null!=t&&e>this.maxLookAhead&&(this.maxLookAhead=e),t},jt.prototype.baseToken=function(e){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=e;)this.baseTokenPos+=2;var t=this.baseTokens[this.baseTokenPos+1];return{type:t&&t.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-e}},jt.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},jt.fromSaved=function(e,t,n){return t instanceof Pt?new jt(e,It(e.mode,t.state),n,t.lookAhead):new jt(e,It(e.mode,t),n)},jt.prototype.save=function(e){var t=!1!==e?It(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new Pt(t,this.maxLookAhead):t};var Gt=function(e,t,n){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=n};function Wt(e,t,n,i){var r,s=e.doc,o=s.mode;t=Ce(s,t);var a,l=le(s,t.line),c=Ut(e,t.line,n),u=new Rt(l.text,e.options.tabSize,c);for(i&&(a=[]);(i||u.pos<t.ch)&&!u.eol();)u.start=u.pos,r=Bt(o,u,c.state),i&&a.push(new Gt(u,r,It(s.mode,c.state)));return i?a:new Gt(u,r,c.state)}function $t(e,t){if(e)for(;;){var n=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!n)break;e=e.slice(0,n.index)+e.slice(n.index+n[0].length);var i=n[1]?"bgClass":"textClass";null==t[i]?t[i]=n[2]:new RegExp("(?:^|s)"+n[2]+"(?:$|s)").test(t[i])||(t[i]+=" "+n[2])}return e}function Ht(e,t,n,i,r,s,o){var a=n.flattenSpans;null==a&&(a=e.options.flattenSpans);var l,c=0,u=null,d=new Rt(t,e.options.tabSize,i),h=e.options.addModeClass&&[null];for(""==t&&$t(zt(n,i.state),s);!d.eol();){if(d.pos>e.options.maxHighlightLength?(a=!1,o&&Ft(e,t,i,d.pos),d.pos=t.length,l=null):l=$t(Bt(n,d,i.state,h),s),h){var p=h[0].name;p&&(l="m-"+(l?p+" "+l:p))}if(!a||u!=l){for(;c<d.start;)c=Math.min(d.start,c+5e3),r(c,u);u=l}d.start=d.pos}for(;c<d.pos;){var f=Math.min(d.pos,c+5e3);r(f,u),c=f}}var qt=function(e,t,n){this.text=e,De(this,t),this.height=n?n(this):1};function Yt(e){e.parent=null,Ne(e)}qt.prototype.lineNo=function(){return he(this)},lt(qt);var Jt={},Xt={};function Kt(e,t){if(!e||/^\s*$/.test(e))return null;var n=t.addModeClass?Xt:Jt;return n[e]||(n[e]=e.replace(/\S+/g,"cm-$&"))}function Qt(e,t){var n=M("span",null,null,l?"padding-right: .1px":null),i={pre:M("pre",[n],"CodeMirror-line"),content:n,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:e.getOption("lineWrapping")};t.measure={};for(var r=0;r<=(t.rest?t.rest.length:0);r++){var s=r?t.rest[r-1]:t.line,o=void 0;i.pos=0,i.addToken=en,yt(e.display.measure)&&(o=Ze(s,e.doc.direction))&&(i.addToken=tn(i.addToken,o)),i.map=[];var a=t!=e.display.externalMeasured&&he(s);rn(s,i,_t(e,s,a)),s.styleClasses&&(s.styleClasses.bgClass&&(i.bgClass=R(s.styleClasses.bgClass,i.bgClass||"")),s.styleClasses.textClass&&(i.textClass=R(s.styleClasses.textClass,i.textClass||""))),0==i.map.length&&i.map.push(0,0,i.content.appendChild(bt(e.display.measure))),0==r?(t.measure.map=i.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(i.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(l){var c=i.content.lastChild;(/\bcm-tab\b/.test(c.className)||c.querySelector&&c.querySelector(".cm-tab"))&&(i.content.className="cm-tab-wrap-hack")}return rt(e,"renderLine",e,t.line,i.pre),i.pre.className&&(i.textClass=R(i.pre.className,i.textClass||"")),i}function Zt(e){var t=A("span","","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function en(e,t,n,i,r,s,l){if(t){var c,u=e.splitSpaces?function(e,t){if(e.length>1&&!/  /.test(e))return e;for(var n=t,i="",r=0;r<e.length;r++){var s=e.charAt(r);" "!=s||!n||r!=e.length-1&&32!=e.charCodeAt(r+1)||(s=""),i+=s,n=" "==s}return i}(t,e.trailingSpace):t,d=e.cm.state.specialChars,h=!1;if(d.test(t)){c=document.createDocumentFragment();for(var p=0;;){d.lastIndex=p;var f=d.exec(t),g=f?f.index-p:t.length-p;if(g){var m=document.createTextNode(u.slice(p,p+g));o&&a<9?c.appendChild(A("span",[m])):c.appendChild(m),e.map.push(e.pos,e.pos+g,m),e.col+=g,e.pos+=g}if(!f)break;p+=g+1;var v=void 0;if("\t"==f[0]){var b=e.cm.options.tabSize,y=b-e.col%b;(v=c.appendChild(A("span",Y(y),"cm-tab"))).setAttribute("role","presentation"),v.setAttribute("cm-text","\t"),e.col+=y}else"\r"==f[0]||"\n"==f[0]?((v=c.appendChild(A("span","\r"==f[0]?"":"","cm-invalidchar"))).setAttribute("cm-text",f[0]),e.col+=1):((v=e.cm.options.specialCharPlaceholder(f[0])).setAttribute("cm-text",f[0]),o&&a<9?c.appendChild(A("span",[v])):c.appendChild(v),e.col+=1);e.map.push(e.pos,e.pos+1,v),e.pos++}}else e.col+=t.length,c=document.createTextNode(u),e.map.push(e.pos,e.pos+t.length,c),o&&a<9&&(h=!0),e.pos+=t.length;if(e.trailingSpace=32==u.charCodeAt(t.length-1),n||i||r||h||s){var w=n||"";i&&(w+=i),r&&(w+=r);var x=A("span",[c],w,s);if(l)for(var S in l)l.hasOwnProperty(S)&&"style"!=S&&"class"!=S&&x.setAttribute(S,l[S]);return e.content.appendChild(x)}e.content.appendChild(c)}}function tn(e,t){return function(n,i,r,s,o,a,l){r=r?r+" cm-force-border":"cm-force-border";for(var c=n.pos,u=c+i.length;;){for(var d=void 0,h=0;h<t.length&&!((d=t[h]).to>c&&d.from<=c);h++);if(d.to>=u)return e(n,i,r,s,o,a,l);e(n,i.slice(0,d.to-c),r,s,null,a,l),s=null,i=i.slice(d.to-c),c=d.to}}}function nn(e,t,n,i){var r=!i&&n.widgetNode;r&&e.map.push(e.pos,e.pos+t,r),!i&&e.cm.display.input.needsContentAttribute&&(r||(r=e.content.appendChild(document.createElement("span"))),r.setAttribute("cm-marker",n.id)),r&&(e.cm.display.input.setUneditable(r),e.content.appendChild(r)),e.pos+=t,e.trailingSpace=!1}function rn(e,t,n){var i=e.markedSpans,r=e.text,s=0;if(i)for(var o,a,l,c,u,d,h,p=r.length,f=0,g=1,m="",v=0;;){if(v==f){l=c=u=a="",h=null,d=null,v=1/0;for(var b=[],y=void 0,w=0;w<i.length;++w){var x=i[w],S=x.marker;if("bookmark"==S.type&&x.from==f&&S.widgetNode)b.push(S);else if(x.from<=f&&(null==x.to||x.to>f||S.collapsed&&x.to==f&&x.from==f)){if(null!=x.to&&x.to!=f&&v>x.to&&(v=x.to,c=""),S.className&&(l+=" "+S.className),S.css&&(a=(a?a+";":"")+S.css),S.startStyle&&x.from==f&&(u+=" "+S.startStyle),S.endStyle&&x.to==v&&(y||(y=[])).push(S.endStyle,x.to),S.title&&((h||(h={})).title=S.title),S.attributes)for(var C in S.attributes)(h||(h={}))[C]=S.attributes[C];S.collapsed&&(!d||je(d.marker,S)<0)&&(d=x)}else x.from>f&&v>x.from&&(v=x.from)}if(y)for(var O=0;O<y.length;O+=2)y[O+1]==v&&(c+=" "+y[O]);if(!d||d.from==f)for(var L=0;L<b.length;++L)nn(t,0,b[L]);if(d&&(d.from||0)==f){if(nn(t,(null==d.to?p+1:d.to)-f,d.marker,null==d.from),null==d.to)return;d.to==f&&(d=!1)}}if(f>=p)break;for(var T=Math.min(p,v);;){if(m){var k=f+m.length;if(!d){var E=k>T?m.slice(0,T-f):m;t.addToken(t,E,o?o+l:l,u,f+E.length==v?c:"",a,h)}if(k>=T){m=m.slice(T-f),f=T;break}f=k,u=""}m=r.slice(s,s=n[g++]),o=Kt(n[g++],t.cm.options)}}else for(var A=1;A<n.length;A+=2)t.addToken(t,r.slice(s,s=n[A]),Kt(n[A+1],t.cm.options))}function sn(e,t,n){this.line=t,this.rest=function(e){for(var t,n;t=Ue(e);)e=t.find(1,!0).line,(n||(n=[])).push(e);return n}(t),this.size=this.rest?he(J(this.rest))-n+1:1,this.node=this.text=null,this.hidden=$e(e,t)}function on(e,t,n){for(var i,r=[],s=t;s<n;s=i){var o=new sn(e.doc,le(e.doc,s),s);i=s+o.size,r.push(o)}return r}var an=null,ln=null;function cn(e,t){var n=nt(e,t);if(n.length){var i,r=Array.prototype.slice.call(arguments,2);an?i=an.delayedCallbacks:ln?i=ln:(i=ln=[],setTimeout(un,0));for(var s=function(e){i.push(function(){return n[e].apply(null,r)})},o=0;o<n.length;++o)s(o)}}function un(){var e=ln;ln=null;for(var t=0;t<e.length;++t)e[t]()}function dn(e,t,n,i){for(var r=0;r<t.changes.length;r++){var s=t.changes[r];"text"==s?fn(e,t):"gutter"==s?mn(e,t,n,i):"class"==s?gn(e,t):"widget"==s&&vn(e,t,i)}t.changes=null}function hn(e){return e.node==e.text&&(e.node=A("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),o&&a<8&&(e.node.style.zIndex=2)),e.node}function pn(e,t){var n=e.display.externalMeasured;return n&&n.line==t.line?(e.display.externalMeasured=null,t.measure=n.measure,n.built):Qt(e,t)}function fn(e,t){var n=t.text.className,i=pn(e,t);t.text==t.node&&(t.node=i.pre),t.text.parentNode.replaceChild(i.pre,t.text),t.text=i.pre,i.bgClass!=t.bgClass||i.textClass!=t.textClass?(t.bgClass=i.bgClass,t.textClass=i.textClass,gn(e,t)):n&&(t.text.className=n)}function gn(e,t){!function(e,t){var n=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(n&&(n+=" CodeMirror-linebackground"),t.background)n?t.background.className=n:(t.background.parentNode.removeChild(t.background),t.background=null);else if(n){var i=hn(t);t.background=i.insertBefore(A("div",null,n),i.firstChild),e.display.input.setUneditable(t.background)}}(e,t),t.line.wrapClass?hn(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var n=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=n||""}function mn(e,t,n,i){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){var r=hn(t);t.gutterBackground=A("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px; width: "+i.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),r.insertBefore(t.gutterBackground,t.text)}var s=t.line.gutterMarkers;if(e.options.lineNumbers||s){var o=hn(t),a=t.gutter=A("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px");if(e.display.input.setUneditable(a),o.insertBefore(a,t.text),t.line.gutterClass&&(a.className+=" "+t.line.gutterClass),!e.options.lineNumbers||s&&s["CodeMirror-linenumbers"]||(t.lineNumber=a.appendChild(A("div",ge(e.options,n),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+i.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),s)for(var l=0;l<e.options.gutters.length;++l){var c=e.options.gutters[l],u=s.hasOwnProperty(c)&&s[c];u&&a.appendChild(A("div",[u],"CodeMirror-gutter-elt","left: "+i.gutterLeft[c]+"px; width: "+i.gutterWidth[c]+"px"))}}}function vn(e,t,n){t.alignable&&(t.alignable=null);for(var i=t.node.firstChild,r=void 0;i;i=r)r=i.nextSibling,"CodeMirror-linewidget"==i.className&&t.node.removeChild(i);yn(e,t,n)}function bn(e,t,n,i){var r=pn(e,t);return t.text=t.node=r.pre,r.bgClass&&(t.bgClass=r.bgClass),r.textClass&&(t.textClass=r.textClass),gn(e,t),mn(e,t,n,i),yn(e,t,i),t.node}function yn(e,t,n){if(wn(e,t.line,t,n,!0),t.rest)for(var i=0;i<t.rest.length;i++)wn(e,t.rest[i],t,n,!1)}function wn(e,t,n,i,r){if(t.widgets)for(var s=hn(n),o=0,a=t.widgets;o<a.length;++o){var l=a[o],c=A("div",[l.node],"CodeMirror-linewidget");l.handleMouseEvents||c.setAttribute("cm-ignore-events","true"),xn(l,c,n,i),e.display.input.setUneditable(c),r&&l.above?s.insertBefore(c,n.gutter||n.text):s.appendChild(c),cn(l,"redraw")}}function xn(e,t,n,i){if(e.noHScroll){(n.alignable||(n.alignable=[])).push(t);var r=i.wrapperWidth;t.style.left=i.fixedPos+"px",e.coverGutter||(r-=i.gutterTotalWidth,t.style.paddingLeft=i.gutterTotalWidth+"px"),t.style.width=r+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-i.gutterTotalWidth+"px"))}function Sn(e){if(null!=e.height)return e.height;var t=e.doc.cm;if(!t)return 0;if(!I(document.body,e.node)){var n="position: relative;";e.coverGutter&&(n+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(n+="width: "+t.display.wrapper.clientWidth+"px;"),E(t.display.measure,A("div",[e.node],null,n))}return e.height=e.node.parentNode.offsetHeight}function Cn(e,t){for(var n=pt(t);n!=e.wrapper;n=n.parentNode)if(!n||1==n.nodeType&&"true"==n.getAttribute("cm-ignore-events")||n.parentNode==e.sizer&&n!=e.mover)return!0}function On(e){return e.lineSpace.offsetTop}function Ln(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function Tn(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=E(e.measure,A("pre","x")),n=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,i={left:parseInt(n.paddingLeft),right:parseInt(n.paddingRight)};return isNaN(i.left)||isNaN(i.right)||(e.cachedPaddingH=i),i}function kn(e){return z-e.display.nativeBarWidth}function En(e){return e.display.scroller.clientWidth-kn(e)-e.display.barWidth}function An(e){return e.display.scroller.clientHeight-kn(e)-e.display.barHeight}function Mn(e,t,n){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var i=0;i<e.rest.length;i++)if(e.rest[i]==t)return{map:e.measure.maps[i],cache:e.measure.caches[i]};for(var r=0;r<e.rest.length;r++)if(he(e.rest[r])>n)return{map:e.measure.maps[r],cache:e.measure.caches[r],before:!0}}function In(e,t,n,i){return Rn(e,Dn(e,t),n,i)}function Nn(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[ci(e,t)];var n=e.display.externalMeasured;return n&&t>=n.lineN&&t<n.lineN+n.size?n:void 0}function Dn(e,t){var n=he(t),i=Nn(e,n);i&&!i.text?i=null:i&&i.changes&&(dn(e,i,n,ri(e)),e.curOp.forceUpdate=!0),i||(i=function(e,t){var n=he(t=Be(t)),i=e.display.externalMeasured=new sn(e.doc,t,n);i.lineN=n;var r=i.built=Qt(e,i);return i.text=r.pre,E(e.display.lineMeasure,r.pre),i}(e,t));var r=Mn(i,t,n);return{line:t,view:i,rect:null,map:r.map,cache:r.cache,before:r.before,hasHeights:!1}}function Rn(e,t,n,i,r){t.before&&(n=-1);var s,l=n+(i||"");return t.cache.hasOwnProperty(l)?s=t.cache[l]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(function(e,t,n){var i=e.options.lineWrapping,r=i&&En(e);if(!t.measure.heights||i&&t.measure.width!=r){var s=t.measure.heights=[];if(i){t.measure.width=r;for(var o=t.text.firstChild.getClientRects(),a=0;a<o.length-1;a++){var l=o[a],c=o[a+1];Math.abs(l.bottom-c.bottom)>2&&s.push((l.bottom+c.top)/2-n.top)}}s.push(n.bottom-n.top)}}(e,t.view,t.rect),t.hasHeights=!0),(s=function(e,t,n,i){var r,s=Vn(t.map,n,i),l=s.node,c=s.start,u=s.end,d=s.collapse;if(3==l.nodeType){for(var h=0;h<4;h++){for(;c&&re(t.line.text.charAt(s.coverStart+c));)--c;for(;s.coverStart+u<s.coverEnd&&re(t.line.text.charAt(s.coverStart+u));)++u;if((r=o&&a<9&&0==c&&u==s.coverEnd-s.coverStart?l.parentNode.getBoundingClientRect():_n(L(l,c,u).getClientRects(),i)).left||r.right||0==c)break;u=c,c-=1,d="right"}o&&a<11&&(r=function(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!function(e){if(null!=Ot)return Ot;var t=E(e,A("span","x")),n=t.getBoundingClientRect(),i=L(t,0,1).getBoundingClientRect();return Ot=Math.abs(n.left-i.left)>1}(e))return t;var n=screen.logicalXDPI/screen.deviceXDPI,i=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*n,right:t.right*n,top:t.top*i,bottom:t.bottom*i}}(e.display.measure,r))}else{var p;c>0&&(d=i="right"),r=e.options.lineWrapping&&(p=l.getClientRects()).length>1?p["right"==i?p.length-1:0]:l.getBoundingClientRect()}if(o&&a<9&&!c&&(!r||!r.left&&!r.right)){var f=l.parentNode.getClientRects()[0];r=f?{left:f.left,right:f.left+ii(e.display),top:f.top,bottom:f.bottom}:jn}for(var g=r.top-t.rect.top,m=r.bottom-t.rect.top,v=(g+m)/2,b=t.view.measure.heights,y=0;y<b.length-1&&!(v<b[y]);y++);var w=y?b[y-1]:0,x=b[y],S={left:("right"==d?r.right:r.left)-t.rect.left,right:("left"==d?r.left:r.right)-t.rect.left,top:w,bottom:x};return r.left||r.right||(S.bogus=!0),e.options.singleCursorHeightPerLine||(S.rtop=g,S.rbottom=m),S}(e,t,n,i)).bogus||(t.cache[l]=s)),{left:s.left,right:s.right,top:r?s.rtop:s.top,bottom:r?s.rbottom:s.bottom}}var Pn,jn={left:0,right:0,top:0,bottom:0};function Vn(e,t,n){for(var i,r,s,o,a,l,c=0;c<e.length;c+=3)if(a=e[c],l=e[c+1],t<a?(r=0,s=1,o="left"):t<l?s=1+(r=t-a):(c==e.length-3||t==l&&e[c+3]>t)&&(r=(s=l-a)-1,t>=l&&(o="right")),null!=r){if(i=e[c+2],a==l&&n==(i.insertLeft?"left":"right")&&(o=n),"left"==n&&0==r)for(;c&&e[c-2]==e[c-3]&&e[c-1].insertLeft;)i=e[2+(c-=3)],o="left";if("right"==n&&r==l-a)for(;c<e.length-3&&e[c+3]==e[c+4]&&!e[c+5].insertLeft;)i=e[(c+=3)+2],o="right";break}return{node:i,start:r,end:s,collapse:o,coverStart:a,coverEnd:l}}function _n(e,t){var n=jn;if("left"==t)for(var i=0;i<e.length&&(n=e[i]).left==n.right;i++);else for(var r=e.length-1;r>=0&&(n=e[r]).left==n.right;r--);return n}function Un(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function Fn(e){e.display.externalMeasure=null,k(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)Un(e.display.view[t])}function zn(e){Fn(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function Bn(){return u&&m?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Gn(){return u&&m?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function Wn(e){var t=0;if(e.widgets)for(var n=0;n<e.widgets.length;++n)e.widgets[n].above&&(t+=Sn(e.widgets[n]));return t}function $n(e,t,n,i,r){if(!r){var s=Wn(t);n.top+=s,n.bottom+=s}if("line"==i)return n;i||(i="local");var o=qe(t);if("local"==i?o+=On(e.display):o-=e.display.viewOffset,"page"==i||"window"==i){var a=e.display.lineSpace.getBoundingClientRect();o+=a.top+("window"==i?0:Gn());var l=a.left+("window"==i?0:Bn());n.left+=l,n.right+=l}return n.top+=o,n.bottom+=o,n}function Hn(e,t,n){if("div"==n)return t;var i=t.left,r=t.top;if("page"==n)i-=Bn(),r-=Gn();else if("local"==n||!n){var s=e.display.sizer.getBoundingClientRect();i+=s.left,r+=s.top}var o=e.display.lineSpace.getBoundingClientRect();return{left:i-o.left,top:r-o.top}}function qn(e,t,n,i,r){return i||(i=le(e.doc,t.line)),$n(e,i,In(e,i,t.ch,r),n)}function Yn(e,t,n,i,r,s){function o(t,o){var a=Rn(e,r,t,o?"right":"left",s);return o?a.left=a.right:a.right=a.left,$n(e,i,a,n)}i=i||le(e.doc,t.line),r||(r=Dn(e,i));var a=Ze(i,e.doc.direction),l=t.ch,c=t.sticky;if(l>=i.text.length?(l=i.text.length,c="before"):l<=0&&(l=0,c="after"),!a)return o("before"==c?l-1:l,"before"==c);function u(e,t,n){var i=a[t],r=1==i.level;return o(n?e-1:e,r!=n)}var d=Ke(a,l,c),h=Xe,p=u(l,d,"before"==c);return null!=h&&(p.other=u(l,h,"before"!=c)),p}function Jn(e,t){var n=0;t=Ce(e.doc,t),e.options.lineWrapping||(n=ii(e.display)*t.ch);var i=le(e.doc,t.line),r=qe(i)+On(e.display);return{left:n,right:n,top:r,bottom:r+i.height}}function Xn(e,t,n,i,r){var s=me(e,t,n);return s.xRel=r,i&&(s.outside=!0),s}function Kn(e,t,n){var i=e.doc;if((n+=e.display.viewOffset)<0)return Xn(i.first,0,null,!0,-1);var r=pe(i,n),s=i.first+i.size-1;if(r>s)return Xn(i.first+i.size-1,le(i,s).text.length,null,!0,1);t<0&&(t=0);for(var o=le(i,r);;){var a=ti(e,o,r,t,n),l=Fe(o,a.ch+(a.xRel>0?1:0));if(!l)return a;var c=l.find(1);if(c.line==r)return c;o=le(i,r=c.line)}}function Qn(e,t,n,i){i-=Wn(t);var r=t.text.length,s=oe(function(t){return Rn(e,n,t-1).bottom<=i},r,0);return r=oe(function(t){return Rn(e,n,t).top>i},s,r),{begin:s,end:r}}function Zn(e,t,n,i){n||(n=Dn(e,t));var r=$n(e,t,Rn(e,n,i),"line").top;return Qn(e,t,n,r)}function ei(e,t,n,i){return!(e.bottom<=n)&&(e.top>n||(i?e.left:e.right)>t)}function ti(e,t,n,i,r){r-=qe(t);var s=Dn(e,t),o=Wn(t),a=0,l=t.text.length,c=!0,u=Ze(t,e.doc.direction);if(u){var d=(e.options.lineWrapping?function(e,t,n,i,r,s,o){var a=Qn(e,t,i,o),l=a.begin,c=a.end;/\s/.test(t.text.charAt(c-1))&&c--;for(var u=null,d=null,h=0;h<r.length;h++){var p=r[h];if(!(p.from>=c||p.to<=l)){var f=1!=p.level,g=Rn(e,i,f?Math.min(c,p.to)-1:Math.max(l,p.from)).right,m=g<s?s-g+1e9:g-s;(!u||d>m)&&(u=p,d=m)}}return u||(u=r[r.length-1]),u.from<l&&(u={from:l,to:u.to,level:u.level}),u.to>c&&(u={from:u.from,to:c,level:u.level}),u}:function(e,t,n,i,r,s,o){var a=oe(function(a){var l=r[a],c=1!=l.level;return ei(Yn(e,me(n,c?l.to:l.from,c?"before":"after"),"line",t,i),s,o,!0)},0,r.length-1),l=r[a];if(a>0){var c=1!=l.level,u=Yn(e,me(n,c?l.from:l.to,c?"after":"before"),"line",t,i);ei(u,s,o,!0)&&u.top>o&&(l=r[a-1])}return l})(e,t,n,s,u,i,r);c=1!=d.level,a=c?d.from:d.to-1,l=c?d.to:d.from-1}var h,p,f=null,g=null,m=oe(function(t){var n=Rn(e,s,t);return n.top+=o,n.bottom+=o,!!ei(n,i,r,!1)&&(n.top<=r&&n.left<=i&&(f=t,g=n),!0)},a,l),v=!1;if(g){var b=i-g.left<g.right-i,y=b==c;m=f+(y?0:1),p=y?"after":"before",h=b?g.left:g.right}else{c||m!=l&&m!=a||m++,p=0==m?"after":m==t.text.length?"before":Rn(e,s,m-(c?1:0)).bottom+o<=r==c?"after":"before";var w=Yn(e,me(n,m,p),"line",t,s);h=w.left,v=r<w.top||r>=w.bottom}return m=se(t.text,m,1),Xn(n,m,p,v,i-h)}function ni(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==Pn){Pn=A("pre");for(var t=0;t<49;++t)Pn.appendChild(document.createTextNode("x")),Pn.appendChild(A("br"));Pn.appendChild(document.createTextNode("x"))}E(e.measure,Pn);var n=Pn.offsetHeight/50;return n>3&&(e.cachedTextHeight=n),k(e.measure),n||1}function ii(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=A("span","xxxxxxxxxx"),n=A("pre",[t]);E(e.measure,n);var i=t.getBoundingClientRect(),r=(i.right-i.left)/10;return r>2&&(e.cachedCharWidth=r),r||10}function ri(e){for(var t=e.display,n={},i={},r=t.gutters.clientLeft,s=t.gutters.firstChild,o=0;s;s=s.nextSibling,++o)n[e.options.gutters[o]]=s.offsetLeft+s.clientLeft+r,i[e.options.gutters[o]]=s.clientWidth;return{fixedPos:si(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:n,gutterWidth:i,wrapperWidth:t.wrapper.clientWidth}}function si(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function oi(e){var t=ni(e.display),n=e.options.lineWrapping,i=n&&Math.max(5,e.display.scroller.clientWidth/ii(e.display)-3);return function(r){if($e(e.doc,r))return 0;var s=0;if(r.widgets)for(var o=0;o<r.widgets.length;o++)r.widgets[o].height&&(s+=r.widgets[o].height);return n?s+(Math.ceil(r.text.length/i)||1)*t:s+t}}function ai(e){var t=e.doc,n=oi(e);t.iter(function(e){var t=n(e);t!=e.height&&de(e,t)})}function li(e,t,n,i){var r=e.display;if(!n&&"true"==pt(t).getAttribute("cm-not-content"))return null;var s,o,a=r.lineSpace.getBoundingClientRect();try{s=t.clientX-a.left,o=t.clientY-a.top}catch(t){return null}var l,c=Kn(e,s,o);if(i&&1==c.xRel&&(l=le(e.doc,c.line).text).length==c.ch){var u=_(l,l.length,e.options.tabSize)-l.length;c=me(c.line,Math.max(0,Math.round((s-Tn(e.display).left)/ii(e.display))-u))}return c}function ci(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var n=e.display.view,i=0;i<n.length;i++)if((t-=n[i].size)<0)return i}function ui(e){e.display.input.showSelection(e.display.input.prepareSelection())}function di(e,t){void 0===t&&(t=!0);for(var n=e.doc,i={},r=i.cursors=document.createDocumentFragment(),s=i.selection=document.createDocumentFragment(),o=0;o<n.sel.ranges.length;o++)if(t||o!=n.sel.primIndex){var a=n.sel.ranges[o];if(!(a.from().line>=e.display.viewTo||a.to().line<e.display.viewFrom)){var l=a.empty();(l||e.options.showCursorWhenSelecting)&&hi(e,a.head,r),l||fi(e,a,s)}}return i}function hi(e,t,n){var i=Yn(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),r=n.appendChild(A("div","","CodeMirror-cursor"));if(r.style.left=i.left+"px",r.style.top=i.top+"px",r.style.height=Math.max(0,i.bottom-i.top)*e.options.cursorHeight+"px",i.other){var s=n.appendChild(A("div","","CodeMirror-cursor CodeMirror-secondarycursor"));s.style.display="",s.style.left=i.other.left+"px",s.style.top=i.other.top+"px",s.style.height=.85*(i.other.bottom-i.other.top)+"px"}}function pi(e,t){return e.top-t.top||e.left-t.left}function fi(e,t,n){var i=e.display,r=e.doc,s=document.createDocumentFragment(),o=Tn(e.display),a=o.left,l=Math.max(i.sizerWidth,En(e)-i.sizer.offsetLeft)-o.right,c="ltr"==r.direction;function u(e,t,n,i){t<0&&(t=0),t=Math.round(t),i=Math.round(i),s.appendChild(A("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(null==n?l-e:n)+"px;\n                             height: "+(i-t)+"px"))}function d(t,n,i){var s,o,d=le(r,t),h=d.text.length;function p(n,i){return qn(e,me(t,n),"div",d,i)}function f(t,n,i){var r=Zn(e,d,null,t),s="ltr"==n==("after"==i)?"left":"right",o="after"==i?r.begin:r.end-(/\s/.test(d.text.charAt(r.end-1))?2:1);return p(o,s)[s]}var g=Ze(d,r.direction);return function(e,t,n,i){if(!e)return i(t,n,"ltr",0);for(var r=!1,s=0;s<e.length;++s){var o=e[s];(o.from<n&&o.to>t||t==n&&o.to==t)&&(i(Math.max(o.from,t),Math.min(o.to,n),1==o.level?"rtl":"ltr",s),r=!0)}r||i(t,n,"ltr")}(g,n||0,null==i?h:i,function(e,t,r,d){var m="ltr"==r,v=p(e,m?"left":"right"),b=p(t-1,m?"right":"left"),y=null==n&&0==e,w=null==i&&t==h,x=0==d,S=!g||d==g.length-1;if(b.top-v.top<=3){var C=(c?y:w)&&x,O=(c?w:y)&&S,L=C?a:(m?v:b).left,T=O?l:(m?b:v).right;u(L,v.top,T-L,v.bottom)}else{var k,E,A,M;m?(k=c&&y&&x?a:v.left,E=c?l:f(e,r,"before"),A=c?a:f(t,r,"after"),M=c&&w&&S?l:b.right):(k=c?f(e,r,"before"):a,E=!c&&y&&x?l:v.right,A=!c&&w&&S?a:b.left,M=c?f(t,r,"after"):l),u(k,v.top,E-k,v.bottom),v.bottom<b.top&&u(a,v.bottom,null,b.top),u(A,b.top,M-A,b.bottom)}(!s||pi(v,s)<0)&&(s=v),pi(b,s)<0&&(s=b),(!o||pi(v,o)<0)&&(o=v),pi(b,o)<0&&(o=b)}),{start:s,end:o}}var h=t.from(),p=t.to();if(h.line==p.line)d(h.line,h.ch,p.ch);else{var f=le(r,h.line),g=le(r,p.line),m=Be(f)==Be(g),v=d(h.line,h.ch,m?f.text.length+1:null).end,b=d(p.line,m?0:null,p.ch).start;m&&(v.top<b.top-2?(u(v.right,v.top,null,v.bottom),u(a,b.top,b.left,b.bottom)):u(v.right,v.top,b.left-v.right,v.bottom)),v.bottom<b.top&&u(a,v.bottom,null,b.top)}n.appendChild(s)}function gi(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var n=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval(function(){return t.cursorDiv.style.visibility=(n=!n)?"":"hidden"},e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function mi(e){e.state.focused||(e.display.input.focus(),bi(e))}function vi(e){e.state.delayingBlurEvent=!0,setTimeout(function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,yi(e))},100)}function bi(e,t){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(rt(e,"focus",e,t),e.state.focused=!0,D(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),l&&setTimeout(function(){return e.display.input.reset(!0)},20)),e.display.input.receivedFocus()),gi(e))}function yi(e,t){e.state.delayingBlurEvent||(e.state.focused&&(rt(e,"blur",e,t),e.state.focused=!1,T(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150))}function wi(e){for(var t=e.display,n=t.lineDiv.offsetTop,i=0;i<t.view.length;i++){var r=t.view[i],s=e.options.lineWrapping,l=void 0,c=0;if(!r.hidden){if(o&&a<8){var u=r.node.offsetTop+r.node.offsetHeight;l=u-n,n=u}else{var d=r.node.getBoundingClientRect();l=d.bottom-d.top,!s&&r.text.firstChild&&(c=r.text.firstChild.getBoundingClientRect().right-d.left-1)}var h=r.line.height-l;if((h>.005||h<-.005)&&(de(r.line,l),xi(r.line),r.rest))for(var p=0;p<r.rest.length;p++)xi(r.rest[p]);if(c>e.display.sizerWidth){var f=Math.ceil(c/ii(e.display));f>e.display.maxLineLength&&(e.display.maxLineLength=f,e.display.maxLine=r.line,e.display.maxLineChanged=!0)}}}}function xi(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t){var n=e.widgets[t],i=n.node.parentNode;i&&(n.height=i.offsetHeight)}}function Si(e,t,n){var i=n&&null!=n.top?Math.max(0,n.top):e.scroller.scrollTop;i=Math.floor(i-On(e));var r=n&&null!=n.bottom?n.bottom:i+e.wrapper.clientHeight,s=pe(t,i),o=pe(t,r);if(n&&n.ensure){var a=n.ensure.from.line,l=n.ensure.to.line;a<s?(s=a,o=pe(t,qe(le(t,a))+e.wrapper.clientHeight)):Math.min(l,t.lastLine())>=o&&(s=pe(t,qe(le(t,l))-e.wrapper.clientHeight),o=l)}return{from:s,to:Math.max(o,s+1)}}function Ci(e){var t=e.display,n=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var i=si(t)-t.scroller.scrollLeft+e.doc.scrollLeft,r=t.gutters.offsetWidth,s=i+"px",o=0;o<n.length;o++)if(!n[o].hidden){e.options.fixedGutter&&(n[o].gutter&&(n[o].gutter.style.left=s),n[o].gutterBackground&&(n[o].gutterBackground.style.left=s));var a=n[o].alignable;if(a)for(var l=0;l<a.length;l++)a[l].style.left=s}e.options.fixedGutter&&(t.gutters.style.left=i+r+"px")}}function Oi(e){if(!e.options.lineNumbers)return!1;var t=e.doc,n=ge(e.options,t.first+t.size-1),i=e.display;if(n.length!=i.lineNumChars){var r=i.measure.appendChild(A("div",[A("div",n)],"CodeMirror-linenumber CodeMirror-gutter-elt")),s=r.firstChild.offsetWidth,o=r.offsetWidth-s;return i.lineGutter.style.width="",i.lineNumInnerWidth=Math.max(s,i.lineGutter.offsetWidth-o)+1,i.lineNumWidth=i.lineNumInnerWidth+o,i.lineNumChars=i.lineNumInnerWidth?n.length:-1,i.lineGutter.style.width=i.lineNumWidth+"px",cr(e),!0}return!1}function Li(e,t){var n=e.display,i=ni(e.display);t.top<0&&(t.top=0);var r=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:n.scroller.scrollTop,s=An(e),o={};t.bottom-t.top>s&&(t.bottom=t.top+s);var a=e.doc.height+Ln(n),l=t.top<i,c=t.bottom>a-i;if(t.top<r)o.scrollTop=l?0:t.top;else if(t.bottom>r+s){var u=Math.min(t.top,(c?a:t.bottom)-s);u!=r&&(o.scrollTop=u)}var d=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:n.scroller.scrollLeft,h=En(e)-(e.options.fixedGutter?n.gutters.offsetWidth:0),p=t.right-t.left>h;return p&&(t.right=t.left+h),t.left<10?o.scrollLeft=0:t.left<d?o.scrollLeft=Math.max(0,t.left-(p?0:10)):t.right>h+d-3&&(o.scrollLeft=t.right+(p?0:10)-h),o}function Ti(e,t){null!=t&&(Ai(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t)}function ki(e){Ai(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function Ei(e,t,n){null==t&&null==n||Ai(e),null!=t&&(e.curOp.scrollLeft=t),null!=n&&(e.curOp.scrollTop=n)}function Ai(e){var t=e.curOp.scrollToPos;if(t){e.curOp.scrollToPos=null;var n=Jn(e,t.from),i=Jn(e,t.to);Mi(e,n,i,t.margin)}}function Mi(e,t,n,i){var r=Li(e,{left:Math.min(t.left,n.left),top:Math.min(t.top,n.top)-i,right:Math.max(t.right,n.right),bottom:Math.max(t.bottom,n.bottom)+i});Ei(e,r.scrollLeft,r.scrollTop)}function Ii(e,t){Math.abs(e.doc.scrollTop-t)<2||(n||lr(e,{top:t}),Ni(e,t,!0),n&&lr(e),ir(e,100))}function Ni(e,t,n){t=Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t),(e.display.scroller.scrollTop!=t||n)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function Di(e,t,n,i){t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),(n?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!i||(e.doc.scrollLeft=t,Ci(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function Ri(e){var t=e.display,n=t.gutters.offsetWidth,i=Math.round(e.doc.height+Ln(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?n:0,docHeight:i,scrollHeight:i+kn(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:n}}var Pi=function(e,t,n){this.cm=n;var i=this.vert=A("div",[A("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),r=this.horiz=A("div",[A("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");i.tabIndex=r.tabIndex=-1,e(i),e(r),tt(i,"scroll",function(){i.clientHeight&&t(i.scrollTop,"vertical")}),tt(r,"scroll",function(){r.clientWidth&&t(r.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,o&&a<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};Pi.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,n=e.scrollHeight>e.clientHeight+1,i=e.nativeBarWidth;if(n){this.vert.style.display="block",this.vert.style.bottom=t?i+"px":"0";var r=e.viewHeight-(t?i:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+r)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=n?i+"px":"0",this.horiz.style.left=e.barLeft+"px";var s=e.viewWidth-e.barLeft-(n?i:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+s)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(0==i&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:n?i:0,bottom:t?i:0}},Pi.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},Pi.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},Pi.prototype.zeroWidthHack=function(){var e=b&&!p?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new U,this.disableVert=new U},Pi.prototype.enableZeroWidthBar=function(e,t,n){e.style.pointerEvents="auto",t.set(1e3,function i(){var r=e.getBoundingClientRect(),s="vert"==n?document.elementFromPoint(r.right-1,(r.top+r.bottom)/2):document.elementFromPoint((r.right+r.left)/2,r.bottom-1);s!=e?e.style.pointerEvents="none":t.set(1e3,i)})},Pi.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};var ji=function(){};function Vi(e,t){t||(t=Ri(e));var n=e.display.barWidth,i=e.display.barHeight;_i(e,t);for(var r=0;r<4&&n!=e.display.barWidth||i!=e.display.barHeight;r++)n!=e.display.barWidth&&e.options.lineWrapping&&wi(e),_i(e,Ri(e)),n=e.display.barWidth,i=e.display.barHeight}function _i(e,t){var n=e.display,i=n.scrollbars.update(t);n.sizer.style.paddingRight=(n.barWidth=i.right)+"px",n.sizer.style.paddingBottom=(n.barHeight=i.bottom)+"px",n.heightForcer.style.borderBottom=i.bottom+"px solid transparent",i.right&&i.bottom?(n.scrollbarFiller.style.display="block",n.scrollbarFiller.style.height=i.bottom+"px",n.scrollbarFiller.style.width=i.right+"px"):n.scrollbarFiller.style.display="",i.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(n.gutterFiller.style.display="block",n.gutterFiller.style.height=i.bottom+"px",n.gutterFiller.style.width=t.gutterWidth+"px"):n.gutterFiller.style.display=""}ji.prototype.update=function(){return{bottom:0,right:0}},ji.prototype.setScrollLeft=function(){},ji.prototype.setScrollTop=function(){},ji.prototype.clear=function(){};var Ui={native:Pi,null:ji};function Fi(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&T(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new Ui[e.options.scrollbarStyle](function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),tt(t,"mousedown",function(){e.state.focused&&setTimeout(function(){return e.display.input.focus()},0)}),t.setAttribute("cm-not-content","true")},function(t,n){"horizontal"==n?Di(e,t):Ii(e,t)},e),e.display.scrollbars.addClass&&D(e.display.wrapper,e.display.scrollbars.addClass)}var zi=0;function Bi(e){var t;e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++zi},t=e.curOp,an?an.ops.push(t):t.ownsGroup=an={ops:[t],delayedCallbacks:[]}}function Gi(e){var t=e.curOp;t&&function(e,t){var n=e.ownsGroup;if(n)try{!function(e){var t=e.delayedCallbacks,n=0;do{for(;n<t.length;n++)t[n].call(null);for(var i=0;i<e.ops.length;i++){var r=e.ops[i];if(r.cursorActivityHandlers)for(;r.cursorActivityCalled<r.cursorActivityHandlers.length;)r.cursorActivityHandlers[r.cursorActivityCalled++].call(null,r.cm)}}while(n<t.length)}(n)}finally{an=null,t(n)}}(t,function(e){for(var t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;!function(e){for(var t=e.ops,n=0;n<t.length;n++)Wi(t[n]);for(var i=0;i<t.length;i++)(r=t[i]).updatedDisplay=r.mustUpdate&&or(r.cm,r.update);for(var r,s=0;s<t.length;s++)$i(t[s]);for(var o=0;o<t.length;o++)Hi(t[o]);for(var a=0;a<t.length;a++)qi(t[a])}(e)})}function Wi(e){var t=e.cm,n=t.display;!function(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=kn(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=kn(e)+"px",t.scrollbarsClipped=!0)}(t),e.updateMaxLine&&Je(t),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<n.viewFrom||e.scrollToPos.to.line>=n.viewTo)||n.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new sr(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function $i(e){var t=e.cm,n=t.display;e.updatedDisplay&&wi(t),e.barMeasure=Ri(t),n.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=In(t,n.maxLine,n.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(n.scroller.clientWidth,n.sizer.offsetLeft+e.adjustWidthTo+kn(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,n.sizer.offsetLeft+e.adjustWidthTo-En(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=n.input.prepareSelection())}function Hi(e){var t=e.cm;null!=e.adjustWidthTo&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&Di(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);var n=e.focus&&e.focus==N();e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,n),(e.updatedDisplay||e.startHeight!=t.doc.height)&&Vi(t,e.barMeasure),e.updatedDisplay&&ur(t,e.barMeasure),e.selectionChanged&&gi(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),n&&mi(e.cm)}function qi(e){var t=e.cm,n=t.display,i=t.doc;if(e.updatedDisplay&&ar(t,e.update),null==n.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(n.wheelStartX=n.wheelStartY=null),null!=e.scrollTop&&Ni(t,e.scrollTop,e.forceScroll),null!=e.scrollLeft&&Di(t,e.scrollLeft,!0,!0),e.scrollToPos){var r=function(e,t,n,i){var r;null==i&&(i=0),e.options.lineWrapping||t!=n||(t=t.ch?me(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t,n="before"==t.sticky?me(t.line,t.ch+1,"before"):t);for(var s=0;s<5;s++){var o=!1,a=Yn(e,t),l=n&&n!=t?Yn(e,n):a;r={left:Math.min(a.left,l.left),top:Math.min(a.top,l.top)-i,right:Math.max(a.left,l.left),bottom:Math.max(a.bottom,l.bottom)+i};var c=Li(e,r),u=e.doc.scrollTop,d=e.doc.scrollLeft;if(null!=c.scrollTop&&(Ii(e,c.scrollTop),Math.abs(e.doc.scrollTop-u)>1&&(o=!0)),null!=c.scrollLeft&&(Di(e,c.scrollLeft),Math.abs(e.doc.scrollLeft-d)>1&&(o=!0)),!o)break}return r}(t,Ce(i,e.scrollToPos.from),Ce(i,e.scrollToPos.to),e.scrollToPos.margin);!function(e,t){if(!st(e,"scrollCursorIntoView")){var n=e.display,i=n.sizer.getBoundingClientRect(),r=null;if(t.top+i.top<0?r=!0:t.bottom+i.top>(window.innerHeight||document.documentElement.clientHeight)&&(r=!1),null!=r&&!f){var s=A("div","",null,"position: absolute;\n                         top: "+(t.top-n.viewOffset-On(e.display))+"px;\n                         height: "+(t.bottom-t.top+kn(e)+n.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(s),s.scrollIntoView(r),e.display.lineSpace.removeChild(s)}}}(t,r)}var s=e.maybeHiddenMarkers,o=e.maybeUnhiddenMarkers;if(s)for(var a=0;a<s.length;++a)s[a].lines.length||rt(s[a],"hide");if(o)for(var l=0;l<o.length;++l)o[l].lines.length&&rt(o[l],"unhide");n.wrapper.offsetHeight&&(i.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&rt(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function Yi(e,t){if(e.curOp)return t();Bi(e);try{return t()}finally{Gi(e)}}function Ji(e,t){return function(){if(e.curOp)return t.apply(e,arguments);Bi(e);try{return t.apply(e,arguments)}finally{Gi(e)}}}function Xi(e){return function(){if(this.curOp)return e.apply(this,arguments);Bi(this);try{return e.apply(this,arguments)}finally{Gi(this)}}}function Ki(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);Bi(t);try{return e.apply(this,arguments)}finally{Gi(t)}}}function Qi(e,t,n,i){null==t&&(t=e.doc.first),null==n&&(n=e.doc.first+e.doc.size),i||(i=0);var r=e.display;if(i&&n<r.viewTo&&(null==r.updateLineNumbers||r.updateLineNumbers>t)&&(r.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=r.viewTo)Te&&Ge(e.doc,t)<r.viewTo&&er(e);else if(n<=r.viewFrom)Te&&We(e.doc,n+i)>r.viewFrom?er(e):(r.viewFrom+=i,r.viewTo+=i);else if(t<=r.viewFrom&&n>=r.viewTo)er(e);else if(t<=r.viewFrom){var s=tr(e,n,n+i,1);s?(r.view=r.view.slice(s.index),r.viewFrom=s.lineN,r.viewTo+=i):er(e)}else if(n>=r.viewTo){var o=tr(e,t,t,-1);o?(r.view=r.view.slice(0,o.index),r.viewTo=o.lineN):er(e)}else{var a=tr(e,t,t,-1),l=tr(e,n,n+i,1);a&&l?(r.view=r.view.slice(0,a.index).concat(on(e,a.lineN,l.lineN)).concat(r.view.slice(l.index)),r.viewTo+=i):er(e)}var c=r.externalMeasured;c&&(n<c.lineN?c.lineN+=i:t<c.lineN+c.size&&(r.externalMeasured=null))}function Zi(e,t,n){e.curOp.viewChanged=!0;var i=e.display,r=e.display.externalMeasured;if(r&&t>=r.lineN&&t<r.lineN+r.size&&(i.externalMeasured=null),!(t<i.viewFrom||t>=i.viewTo)){var s=i.view[ci(e,t)];if(null!=s.node){var o=s.changes||(s.changes=[]);-1==F(o,n)&&o.push(n)}}}function er(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function tr(e,t,n,i){var r,s=ci(e,t),o=e.display.view;if(!Te||n==e.doc.first+e.doc.size)return{index:s,lineN:n};for(var a=e.display.viewFrom,l=0;l<s;l++)a+=o[l].size;if(a!=t){if(i>0){if(s==o.length-1)return null;r=a+o[s].size-t,s++}else r=a-t;t+=r,n+=r}for(;Ge(e.doc,n)!=n;){if(s==(i<0?0:o.length-1))return null;n+=i*o[s-(i<0?1:0)].size,s+=i}return{index:s,lineN:n}}function nr(e){for(var t=e.display.view,n=0,i=0;i<t.length;i++){var r=t[i];r.hidden||r.node&&!r.changes||++n}return n}function ir(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,j(rr,e))}function rr(e){var t=e.doc;if(!(t.highlightFrontier>=e.display.viewTo)){var n=+new Date+e.options.workTime,i=Ut(e,t.highlightFrontier),r=[];t.iter(i.line,Math.min(t.first+t.size,e.display.viewTo+500),function(s){if(i.line>=e.display.viewFrom){var o=s.styles,a=s.text.length>e.options.maxHighlightLength?It(t.mode,i.state):null,l=Vt(e,s,i,!0);a&&(i.state=a),s.styles=l.styles;var c=s.styleClasses,u=l.classes;u?s.styleClasses=u:c&&(s.styleClasses=null);for(var d=!o||o.length!=s.styles.length||c!=u&&(!c||!u||c.bgClass!=u.bgClass||c.textClass!=u.textClass),h=0;!d&&h<o.length;++h)d=o[h]!=s.styles[h];d&&r.push(i.line),s.stateAfter=i.save(),i.nextLine()}else s.text.length<=e.options.maxHighlightLength&&Ft(e,s.text,i),s.stateAfter=i.line%5==0?i.save():null,i.nextLine();if(+new Date>n)return ir(e,e.options.workDelay),!0}),t.highlightFrontier=i.line,t.modeFrontier=Math.max(t.modeFrontier,i.line),r.length&&Yi(e,function(){for(var t=0;t<r.length;t++)Zi(e,r[t],"text")})}}var sr=function(e,t,n){var i=e.display;this.viewport=t,this.visible=Si(i,e.doc,t),this.editorIsHidden=!i.wrapper.offsetWidth,this.wrapperHeight=i.wrapper.clientHeight,this.wrapperWidth=i.wrapper.clientWidth,this.oldDisplayWidth=En(e),this.force=n,this.dims=ri(e),this.events=[]};function or(e,t){var n=e.display,i=e.doc;if(t.editorIsHidden)return er(e),!1;if(!t.force&&t.visible.from>=n.viewFrom&&t.visible.to<=n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo)&&n.renderedView==n.view&&0==nr(e))return!1;Oi(e)&&(er(e),t.dims=ri(e));var r=i.first+i.size,s=Math.max(t.visible.from-e.options.viewportMargin,i.first),o=Math.min(r,t.visible.to+e.options.viewportMargin);n.viewFrom<s&&s-n.viewFrom<20&&(s=Math.max(i.first,n.viewFrom)),n.viewTo>o&&n.viewTo-o<20&&(o=Math.min(r,n.viewTo)),Te&&(s=Ge(e.doc,s),o=We(e.doc,o));var a=s!=n.viewFrom||o!=n.viewTo||n.lastWrapHeight!=t.wrapperHeight||n.lastWrapWidth!=t.wrapperWidth;!function(e,t,n){var i=e.display;0==i.view.length||t>=i.viewTo||n<=i.viewFrom?(i.view=on(e,t,n),i.viewFrom=t):(i.viewFrom>t?i.view=on(e,t,i.viewFrom).concat(i.view):i.viewFrom<t&&(i.view=i.view.slice(ci(e,t))),i.viewFrom=t,i.viewTo<n?i.view=i.view.concat(on(e,i.viewTo,n)):i.viewTo>n&&(i.view=i.view.slice(0,ci(e,n)))),i.viewTo=n}(e,s,o),n.viewOffset=qe(le(e.doc,n.viewFrom)),e.display.mover.style.top=n.viewOffset+"px";var c=nr(e);if(!a&&0==c&&!t.force&&n.renderedView==n.view&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo))return!1;var u=function(e){if(e.hasFocus())return null;var t=N();if(!t||!I(e.display.lineDiv,t))return null;var n={activeElt:t};if(window.getSelection){var i=window.getSelection();i.anchorNode&&i.extend&&I(e.display.lineDiv,i.anchorNode)&&(n.anchorNode=i.anchorNode,n.anchorOffset=i.anchorOffset,n.focusNode=i.focusNode,n.focusOffset=i.focusOffset)}return n}(e);return c>4&&(n.lineDiv.style.display="none"),function(e,t,n){var i=e.display,r=e.options.lineNumbers,s=i.lineDiv,o=s.firstChild;function a(t){var n=t.nextSibling;return l&&b&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),n}for(var c=i.view,u=i.viewFrom,d=0;d<c.length;d++){var h=c[d];if(h.hidden);else if(h.node&&h.node.parentNode==s){for(;o!=h.node;)o=a(o);var p=r&&null!=t&&t<=u&&h.lineNumber;h.changes&&(F(h.changes,"gutter")>-1&&(p=!1),dn(e,h,u,n)),p&&(k(h.lineNumber),h.lineNumber.appendChild(document.createTextNode(ge(e.options,u)))),o=h.node.nextSibling}else{var f=bn(e,h,u,n);s.insertBefore(f,o)}u+=h.size}for(;o;)o=a(o)}(e,n.updateLineNumbers,t.dims),c>4&&(n.lineDiv.style.display=""),n.renderedView=n.view,function(e){if(e&&e.activeElt&&e.activeElt!=N()&&(e.activeElt.focus(),e.anchorNode&&I(document.body,e.anchorNode)&&I(document.body,e.focusNode))){var t=window.getSelection(),n=document.createRange();n.setEnd(e.anchorNode,e.anchorOffset),n.collapse(!1),t.removeAllRanges(),t.addRange(n),t.extend(e.focusNode,e.focusOffset)}}(u),k(n.cursorDiv),k(n.selectionDiv),n.gutters.style.height=n.sizer.style.minHeight=0,a&&(n.lastWrapHeight=t.wrapperHeight,n.lastWrapWidth=t.wrapperWidth,ir(e,400)),n.updateLineNumbers=null,!0}function ar(e,t){for(var n=t.viewport,i=!0;(i&&e.options.lineWrapping&&t.oldDisplayWidth!=En(e)||(n&&null!=n.top&&(n={top:Math.min(e.doc.height+Ln(e.display)-An(e),n.top)}),t.visible=Si(e.display,e.doc,n),!(t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)))&&or(e,t);i=!1){wi(e);var r=Ri(e);ui(e),Vi(e,r),ur(e,r),t.force=!1}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function lr(e,t){var n=new sr(e,t);if(or(e,n)){wi(e),ar(e,n);var i=Ri(e);ui(e),Vi(e,i),ur(e,i),n.finish()}}function cr(e){var t=e.display.gutters.offsetWidth;e.display.sizer.style.marginLeft=t+"px"}function ur(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+kn(e)+"px"}function dr(e){var t=e.display.gutters,n=e.options.gutters;k(t);for(var i=0;i<n.length;++i){var r=n[i],s=t.appendChild(A("div",null,"CodeMirror-gutter "+r));"CodeMirror-linenumbers"==r&&(e.display.lineGutter=s,s.style.width=(e.display.lineNumWidth||1)+"px")}t.style.display=i?"":"none",cr(e)}function hr(e){var t=F(e.gutters,"CodeMirror-linenumbers");-1==t&&e.lineNumbers?e.gutters=e.gutters.concat(["CodeMirror-linenumbers"]):t>-1&&!e.lineNumbers&&(e.gutters=e.gutters.slice(0),e.gutters.splice(t,1))}sr.prototype.signal=function(e,t){at(e,t)&&this.events.push(arguments)},sr.prototype.finish=function(){for(var e=0;e<this.events.length;e++)rt.apply(null,this.events[e])};var pr=0,fr=null;function gr(e){var t=e.wheelDeltaX,n=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==n&&e.detail&&e.axis==e.VERTICAL_AXIS?n=e.detail:null==n&&(n=e.wheelDelta),{x:t,y:n}}function mr(e){var t=gr(e);return t.x*=fr,t.y*=fr,t}function vr(e,t){var i=gr(t),r=i.x,s=i.y,o=e.display,a=o.scroller,c=a.scrollWidth>a.clientWidth,u=a.scrollHeight>a.clientHeight;if(r&&c||s&&u){if(s&&b&&l)e:for(var h=t.target,p=o.view;h!=a;h=h.parentNode)for(var f=0;f<p.length;f++)if(p[f].node==h){e.display.currentWheelTarget=h;break e}if(r&&!n&&!d&&null!=fr)return s&&u&&Ii(e,Math.max(0,a.scrollTop+s*fr)),Di(e,Math.max(0,a.scrollLeft+r*fr)),(!s||s&&u)&&ct(t),void(o.wheelStartX=null);if(s&&null!=fr){var g=s*fr,m=e.doc.scrollTop,v=m+o.wrapper.clientHeight;g<0?m=Math.max(0,m+g-50):v=Math.min(e.doc.height,v+g+50),lr(e,{top:m,bottom:v})}pr<20&&(null==o.wheelStartX?(o.wheelStartX=a.scrollLeft,o.wheelStartY=a.scrollTop,o.wheelDX=r,o.wheelDY=s,setTimeout(function(){if(null!=o.wheelStartX){var e=a.scrollLeft-o.wheelStartX,t=a.scrollTop-o.wheelStartY,n=t&&o.wheelDY&&t/o.wheelDY||e&&o.wheelDX&&e/o.wheelDX;o.wheelStartX=o.wheelStartY=null,n&&(fr=(fr*pr+n)/(pr+1),++pr)}},200)):(o.wheelDX+=r,o.wheelDY+=s))}}o?fr=-.53:n?fr=15:u?fr=-.7:h&&(fr=-1/3);var br=function(e,t){this.ranges=e,this.primIndex=t};br.prototype.primary=function(){return this.ranges[this.primIndex]},br.prototype.equals=function(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var t=0;t<this.ranges.length;t++){var n=this.ranges[t],i=e.ranges[t];if(!be(n.anchor,i.anchor)||!be(n.head,i.head))return!1}return!0},br.prototype.deepCopy=function(){for(var e=[],t=0;t<this.ranges.length;t++)e[t]=new yr(ye(this.ranges[t].anchor),ye(this.ranges[t].head));return new br(e,this.primIndex)},br.prototype.somethingSelected=function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1},br.prototype.contains=function(e,t){t||(t=e);for(var n=0;n<this.ranges.length;n++){var i=this.ranges[n];if(ve(t,i.from())>=0&&ve(e,i.to())<=0)return n}return-1};var yr=function(e,t){this.anchor=e,this.head=t};function wr(e,t,n){var i=e&&e.options.selectionsMayTouch,r=t[n];t.sort(function(e,t){return ve(e.from(),t.from())}),n=F(t,r);for(var s=1;s<t.length;s++){var o=t[s],a=t[s-1],l=ve(a.to(),o.from());if(i&&!o.empty()?l>0:l>=0){var c=xe(a.from(),o.from()),u=we(a.to(),o.to()),d=a.empty()?o.from()==o.head:a.from()==a.head;s<=n&&--n,t.splice(--s,2,new yr(d?u:c,d?c:u))}}return new br(t,n)}function xr(e,t){return new br([new yr(e,t||e)],0)}function Sr(e){return e.text?me(e.from.line+e.text.length-1,J(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function Cr(e,t){if(ve(e,t.from)<0)return e;if(ve(e,t.to)<=0)return Sr(t);var n=e.line+t.text.length-(t.to.line-t.from.line)-1,i=e.ch;return e.line==t.to.line&&(i+=Sr(t).ch-t.to.ch),me(n,i)}function Or(e,t){for(var n=[],i=0;i<e.sel.ranges.length;i++){var r=e.sel.ranges[i];n.push(new yr(Cr(r.anchor,t),Cr(r.head,t)))}return wr(e.cm,n,e.sel.primIndex)}function Lr(e,t,n){return e.line==t.line?me(n.line,e.ch-t.ch+n.ch):me(n.line+(e.line-t.line),e.ch)}function Tr(e){e.doc.mode=Et(e.options,e.doc.modeOption),kr(e)}function kr(e){e.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,ir(e,100),e.state.modeGen++,e.curOp&&Qi(e)}function Er(e,t){return 0==t.from.ch&&0==t.to.ch&&""==J(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function Ar(e,t,n,i){function r(e){return n?n[e]:null}function s(e,n,r){!function(e,t,n,i){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),Ne(e),De(e,n);var r=i?i(e):1;r!=e.height&&de(e,r)}(e,n,r,i),cn(e,"change",e,t)}function o(e,t){for(var n=[],s=e;s<t;++s)n.push(new qt(c[s],r(s),i));return n}var a=t.from,l=t.to,c=t.text,u=le(e,a.line),d=le(e,l.line),h=J(c),p=r(c.length-1),f=l.line-a.line;if(t.full)e.insert(0,o(0,c.length)),e.remove(c.length,e.size-c.length);else if(Er(e,t)){var g=o(0,c.length-1);s(d,d.text,p),f&&e.remove(a.line,f),g.length&&e.insert(a.line,g)}else if(u==d)if(1==c.length)s(u,u.text.slice(0,a.ch)+h+u.text.slice(l.ch),p);else{var m=o(1,c.length-1);m.push(new qt(h+u.text.slice(l.ch),p,i)),s(u,u.text.slice(0,a.ch)+c[0],r(0)),e.insert(a.line+1,m)}else if(1==c.length)s(u,u.text.slice(0,a.ch)+c[0]+d.text.slice(l.ch),r(0)),e.remove(a.line+1,f);else{s(u,u.text.slice(0,a.ch)+c[0],r(0)),s(d,h+d.text.slice(l.ch),p);var v=o(1,c.length-1);f>1&&e.remove(a.line+1,f-1),e.insert(a.line+1,v)}cn(e,"change",e,t)}function Mr(e,t,n){!function e(i,r,s){if(i.linked)for(var o=0;o<i.linked.length;++o){var a=i.linked[o];if(a.doc!=r){var l=s&&a.sharedHist;n&&!l||(t(a.doc,l),e(a.doc,i,l))}}}(e,null,!0)}function Ir(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,ai(e),Tr(e),Nr(e),e.options.lineWrapping||Je(e),e.options.mode=t.modeOption,Qi(e)}function Nr(e){("rtl"==e.doc.direction?D:T)(e.display.lineDiv,"CodeMirror-rtl")}function Dr(e){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function Rr(e,t){var n={from:ye(t.from),to:Sr(t),text:ce(e,t.from,t.to)};return Ur(e,n,t.from.line,t.to.line+1),Mr(e,function(e){return Ur(e,n,t.from.line,t.to.line+1)},!0),n}function Pr(e){for(;e.length;){var t=J(e);if(!t.ranges)break;e.pop()}}function jr(e,t,n,i){var r=e.history;r.undone.length=0;var s,o,a=+new Date;if((r.lastOp==i||r.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&r.lastModTime>a-(e.cm?e.cm.options.historyEventDelay:500)||"*"==t.origin.charAt(0)))&&(s=function(e,t){return t?(Pr(e.done),J(e.done)):e.done.length&&!J(e.done).ranges?J(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),J(e.done)):void 0}(r,r.lastOp==i)))o=J(s.changes),0==ve(t.from,t.to)&&0==ve(t.from,o.to)?o.to=Sr(t):s.changes.push(Rr(e,t));else{var l=J(r.done);for(l&&l.ranges||_r(e.sel,r.done),s={changes:[Rr(e,t)],generation:r.generation},r.done.push(s);r.done.length>r.undoDepth;)r.done.shift(),r.done[0].ranges||r.done.shift()}r.done.push(n),r.generation=++r.maxGeneration,r.lastModTime=r.lastSelTime=a,r.lastOp=r.lastSelOp=i,r.lastOrigin=r.lastSelOrigin=t.origin,o||rt(e,"historyAdded")}function Vr(e,t,n,i){var r=e.history,s=i&&i.origin;n==r.lastSelOp||s&&r.lastSelOrigin==s&&(r.lastModTime==r.lastSelTime&&r.lastOrigin==s||function(e,t,n,i){var r=t.charAt(0);return"*"==r||"+"==r&&n.ranges.length==i.ranges.length&&n.somethingSelected()==i.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}(e,s,J(r.done),t))?r.done[r.done.length-1]=t:_r(t,r.done),r.lastSelTime=+new Date,r.lastSelOrigin=s,r.lastSelOp=n,i&&!1!==i.clearRedo&&Pr(r.undone)}function _r(e,t){var n=J(t);n&&n.ranges&&n.equals(e)||t.push(e)}function Ur(e,t,n,i){var r=t["spans_"+e.id],s=0;e.iter(Math.max(e.first,n),Math.min(e.first+e.size,i),function(n){n.markedSpans&&((r||(r=t["spans_"+e.id]={}))[s]=n.markedSpans),++s})}function Fr(e){if(!e)return null;for(var t,n=0;n<e.length;++n)e[n].marker.explicitlyCleared?t||(t=e.slice(0,n)):t&&t.push(e[n]);return t?t.length?t:null:e}function zr(e,t){var n=function(e,t){var n=t["spans_"+e.id];if(!n)return null;for(var i=[],r=0;r<t.text.length;++r)i.push(Fr(n[r]));return i}(e,t),i=Me(e,t);if(!n)return i;if(!i)return n;for(var r=0;r<n.length;++r){var s=n[r],o=i[r];if(s&&o)e:for(var a=0;a<o.length;++a){for(var l=o[a],c=0;c<s.length;++c)if(s[c].marker==l.marker)continue e;s.push(l)}else o&&(n[r]=o)}return n}function Br(e,t,n){for(var i=[],r=0;r<e.length;++r){var s=e[r];if(s.ranges)i.push(n?br.prototype.deepCopy.call(s):s);else{var o=s.changes,a=[];i.push({changes:a});for(var l=0;l<o.length;++l){var c=o[l],u=void 0;if(a.push({from:c.from,to:c.to,text:c.text}),t)for(var d in c)(u=d.match(/^spans_(\d+)$/))&&F(t,Number(u[1]))>-1&&(J(a)[d]=c[d],delete c[d])}}}return i}function Gr(e,t,n,i){if(i){var r=e.anchor;if(n){var s=ve(t,r)<0;s!=ve(n,r)<0?(r=t,t=n):s!=ve(t,n)<0&&(t=n)}return new yr(r,t)}return new yr(n||t,t)}function Wr(e,t,n,i,r){null==r&&(r=e.cm&&(e.cm.display.shift||e.extend)),Jr(e,new br([Gr(e.sel.primary(),t,n,r)],0),i)}function $r(e,t,n){for(var i=[],r=e.cm&&(e.cm.display.shift||e.extend),s=0;s<e.sel.ranges.length;s++)i[s]=Gr(e.sel.ranges[s],t[s],null,r);var o=wr(e.cm,i,e.sel.primIndex);Jr(e,o,n)}function Hr(e,t,n,i){var r=e.sel.ranges.slice(0);r[t]=n,Jr(e,wr(e.cm,r,e.sel.primIndex),i)}function qr(e,t,n,i){Jr(e,xr(t,n),i)}function Yr(e,t,n){var i=e.history.done,r=J(i);r&&r.ranges?(i[i.length-1]=t,Xr(e,t,n)):Jr(e,t,n)}function Jr(e,t,n){Xr(e,t,n),Vr(e,e.sel,e.cm?e.cm.curOp.id:NaN,n)}function Xr(e,t,n){(at(e,"beforeSelectionChange")||e.cm&&at(e.cm,"beforeSelectionChange"))&&(t=function(e,t,n){var i={ranges:t.ranges,update:function(t){this.ranges=[];for(var n=0;n<t.length;n++)this.ranges[n]=new yr(Ce(e,t[n].anchor),Ce(e,t[n].head))},origin:n&&n.origin};return rt(e,"beforeSelectionChange",e,i),e.cm&&rt(e.cm,"beforeSelectionChange",e.cm,i),i.ranges!=t.ranges?wr(e.cm,i.ranges,i.ranges.length-1):t}(e,t,n));var i=n&&n.bias||(ve(t.primary().head,e.sel.primary().head)<0?-1:1);Kr(e,Zr(e,t,i,!0)),n&&!1===n.scroll||!e.cm||ki(e.cm)}function Kr(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=1,e.cm.curOp.selectionChanged=!0,ot(e.cm)),cn(e,"cursorActivity",e))}function Qr(e){Kr(e,Zr(e,e.sel,null,!1))}function Zr(e,t,n,i){for(var r,s=0;s<t.ranges.length;s++){var o=t.ranges[s],a=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[s],l=ts(e,o.anchor,a&&a.anchor,n,i),c=ts(e,o.head,a&&a.head,n,i);(r||l!=o.anchor||c!=o.head)&&(r||(r=t.ranges.slice(0,s)),r[s]=new yr(l,c))}return r?wr(e.cm,r,t.primIndex):t}function es(e,t,n,i,r){var s=le(e,t.line);if(s.markedSpans)for(var o=0;o<s.markedSpans.length;++o){var a=s.markedSpans[o],l=a.marker;if((null==a.from||(l.inclusiveLeft?a.from<=t.ch:a.from<t.ch))&&(null==a.to||(l.inclusiveRight?a.to>=t.ch:a.to>t.ch))){if(r&&(rt(l,"beforeCursorEnter"),l.explicitlyCleared)){if(s.markedSpans){--o;continue}break}if(!l.atomic)continue;if(n){var c=l.find(i<0?1:-1),u=void 0;if((i<0?l.inclusiveRight:l.inclusiveLeft)&&(c=ns(e,c,-i,c&&c.line==t.line?s:null)),c&&c.line==t.line&&(u=ve(c,n))&&(i<0?u<0:u>0))return es(e,c,t,i,r)}var d=l.find(i<0?-1:1);return(i<0?l.inclusiveLeft:l.inclusiveRight)&&(d=ns(e,d,i,d.line==t.line?s:null)),d?es(e,d,t,i,r):null}}return t}function ts(e,t,n,i,r){var s=i||1,o=es(e,t,n,s,r)||!r&&es(e,t,n,s,!0)||es(e,t,n,-s,r)||!r&&es(e,t,n,-s,!0);return o||(e.cantEdit=!0,me(e.first,0))}function ns(e,t,n,i){return n<0&&0==t.ch?t.line>e.first?Ce(e,me(t.line-1)):null:n>0&&t.ch==(i||le(e,t.line)).text.length?t.line<e.first+e.size-1?me(t.line+1,0):null:new me(t.line,t.ch+n)}function is(e){e.setSelection(me(e.firstLine(),0),me(e.lastLine()),G)}function rs(e,t,n){var i={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){return i.canceled=!0}};return n&&(i.update=function(t,n,r,s){t&&(i.from=Ce(e,t)),n&&(i.to=Ce(e,n)),r&&(i.text=r),void 0!==s&&(i.origin=s)}),rt(e,"beforeChange",e,i),e.cm&&rt(e.cm,"beforeChange",e.cm,i),i.canceled?(e.cm&&(e.cm.curOp.updateInput=2),null):{from:i.from,to:i.to,text:i.text,origin:i.origin}}function ss(e,t,n){if(e.cm){if(!e.cm.curOp)return Ji(e.cm,ss)(e,t,n);if(e.cm.state.suppressEdits)return}if(!(at(e,"beforeChange")||e.cm&&at(e.cm,"beforeChange"))||(t=rs(e,t,!0))){var i=Le&&!n&&function(e,t,n){var i=null;if(e.iter(t.line,n.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var n=e.markedSpans[t].marker;!n.readOnly||i&&-1!=F(i,n)||(i||(i=[])).push(n)}}),!i)return null;for(var r=[{from:t,to:n}],s=0;s<i.length;++s)for(var o=i[s],a=o.find(0),l=0;l<r.length;++l){var c=r[l];if(!(ve(c.to,a.from)<0||ve(c.from,a.to)>0)){var u=[l,1],d=ve(c.from,a.from),h=ve(c.to,a.to);(d<0||!o.inclusiveLeft&&!d)&&u.push({from:c.from,to:a.from}),(h>0||!o.inclusiveRight&&!h)&&u.push({from:a.to,to:c.to}),r.splice.apply(r,u),l+=u.length-3}}return r}(e,t.from,t.to);if(i)for(var r=i.length-1;r>=0;--r)os(e,{from:i[r].from,to:i[r].to,text:r?[""]:t.text,origin:t.origin});else os(e,t)}}function os(e,t){if(1!=t.text.length||""!=t.text[0]||0!=ve(t.from,t.to)){var n=Or(e,t);jr(e,t,n,e.cm?e.cm.curOp.id:NaN),cs(e,t,n,Me(e,t));var i=[];Mr(e,function(e,n){n||-1!=F(i,e.history)||(ps(e.history,t),i.push(e.history)),cs(e,t,null,Me(e,t))})}}function as(e,t,n){var i=e.cm&&e.cm.state.suppressEdits;if(!i||n){for(var r,s=e.history,o=e.sel,a="undo"==t?s.done:s.undone,l="undo"==t?s.undone:s.done,c=0;c<a.length&&(r=a[c],n?!r.ranges||r.equals(e.sel):r.ranges);c++);if(c!=a.length){for(s.lastOrigin=s.lastSelOrigin=null;;){if(!(r=a.pop()).ranges){if(i)return void a.push(r);break}if(_r(r,l),n&&!r.equals(e.sel))return void Jr(e,r,{clearRedo:!1});o=r}var u=[];_r(o,l),l.push({changes:u,generation:s.generation}),s.generation=r.generation||++s.maxGeneration;for(var d=at(e,"beforeChange")||e.cm&&at(e.cm,"beforeChange"),h=function(n){var i=r.changes[n];if(i.origin=t,d&&!rs(e,i,!1))return a.length=0,{};u.push(Rr(e,i));var s=n?Or(e,i):J(a);cs(e,i,s,zr(e,i)),!n&&e.cm&&e.cm.scrollIntoView({from:i.from,to:Sr(i)});var o=[];Mr(e,function(e,t){t||-1!=F(o,e.history)||(ps(e.history,i),o.push(e.history)),cs(e,i,null,zr(e,i))})},p=r.changes.length-1;p>=0;--p){var f=h(p);if(f)return f.v}}}}function ls(e,t){if(0!=t&&(e.first+=t,e.sel=new br(X(e.sel.ranges,function(e){return new yr(me(e.anchor.line+t,e.anchor.ch),me(e.head.line+t,e.head.ch))}),e.sel.primIndex),e.cm)){Qi(e.cm,e.first,e.first-t,t);for(var n=e.cm.display,i=n.viewFrom;i<n.viewTo;i++)Zi(e.cm,i,"gutter")}}function cs(e,t,n,i){if(e.cm&&!e.cm.curOp)return Ji(e.cm,cs)(e,t,n,i);if(t.to.line<e.first)ls(e,t.text.length-1-(t.to.line-t.from.line));else if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var r=t.text.length-1-(e.first-t.from.line);ls(e,r),t={from:me(e.first,0),to:me(t.to.line+r,t.to.ch),text:[J(t.text)],origin:t.origin}}var s=e.lastLine();t.to.line>s&&(t={from:t.from,to:me(s,le(e,s).text.length),text:[t.text[0]],origin:t.origin}),t.removed=ce(e,t.from,t.to),n||(n=Or(e,t)),e.cm?function(e,t,n){var i=e.doc,r=e.display,s=t.from,o=t.to,a=!1,l=s.line;e.options.lineWrapping||(l=he(Be(le(i,s.line))),i.iter(l,o.line+1,function(e){if(e==r.maxLine)return a=!0,!0})),i.sel.contains(t.from,t.to)>-1&&ot(e),Ar(i,t,n,oi(e)),e.options.lineWrapping||(i.iter(l,s.line+t.text.length,function(e){var t=Ye(e);t>r.maxLineLength&&(r.maxLine=e,r.maxLineLength=t,r.maxLineChanged=!0,a=!1)}),a&&(e.curOp.updateMaxLine=!0)),function(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),!(e.highlightFrontier<t-10)){for(var n=e.first,i=t-1;i>n;i--){var r=le(e,i).stateAfter;if(r&&(!(r instanceof Pt)||i+r.lookAhead<t)){n=i+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,n)}}(i,s.line),ir(e,400);var c=t.text.length-(o.line-s.line)-1;t.full?Qi(e):s.line!=o.line||1!=t.text.length||Er(e.doc,t)?Qi(e,s.line,o.line+1,c):Zi(e,s.line,"text");var u=at(e,"changes"),d=at(e,"change");if(d||u){var h={from:s,to:o,text:t.text,removed:t.removed,origin:t.origin};d&&cn(e,"change",e,h),u&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(h)}e.display.selForContextMenu=null}(e.cm,t,i):Ar(e,t,i),Xr(e,n,G)}}function us(e,t,n,i,r){var s;i||(i=n),ve(i,n)<0&&(n=(s=[i,n])[0],i=s[1]),"string"==typeof t&&(t=e.splitLines(t)),ss(e,{from:n,to:i,text:t,origin:r})}function ds(e,t,n,i){n<e.line?e.line+=i:t<e.line&&(e.line=t,e.ch=0)}function hs(e,t,n,i){for(var r=0;r<e.length;++r){var s=e[r],o=!0;if(s.ranges){s.copied||((s=e[r]=s.deepCopy()).copied=!0);for(var a=0;a<s.ranges.length;a++)ds(s.ranges[a].anchor,t,n,i),ds(s.ranges[a].head,t,n,i)}else{for(var l=0;l<s.changes.length;++l){var c=s.changes[l];if(n<c.from.line)c.from=me(c.from.line+i,c.from.ch),c.to=me(c.to.line+i,c.to.ch);else if(t<=c.to.line){o=!1;break}}o||(e.splice(0,r+1),r=0)}}}function ps(e,t){var n=t.from.line,i=t.to.line,r=t.text.length-(i-n)-1;hs(e.done,n,i,r),hs(e.undone,n,i,r)}function fs(e,t,n,i){var r=t,s=t;return"number"==typeof t?s=le(e,Se(e,t)):r=he(t),null==r?null:(i(s,r)&&e.cm&&Zi(e.cm,r,n),s)}function gs(e){this.lines=e,this.parent=null;for(var t=0,n=0;n<e.length;++n)e[n].parent=this,t+=e[n].height;this.height=t}function ms(e){this.children=e;for(var t=0,n=0,i=0;i<e.length;++i){var r=e[i];t+=r.chunkSize(),n+=r.height,r.parent=this}this.size=t,this.height=n,this.parent=null}yr.prototype.from=function(){return xe(this.anchor,this.head)},yr.prototype.to=function(){return we(this.anchor,this.head)},yr.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},gs.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var n=e,i=e+t;n<i;++n){var r=this.lines[n];this.height-=r.height,Yt(r),cn(r,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,n){this.height+=n,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var i=0;i<t.length;++i)t[i].parent=this},iterN:function(e,t,n){for(var i=e+t;e<i;++e)if(n(this.lines[e]))return!0}},ms.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var n=0;n<this.children.length;++n){var i=this.children[n],r=i.chunkSize();if(e<r){var s=Math.min(t,r-e),o=i.height;if(i.removeInner(e,s),this.height-=o-i.height,r==s&&(this.children.splice(n--,1),i.parent=null),0==(t-=s))break;e=0}else e-=r}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof gs))){var a=[];this.collapse(a),this.children=[new gs(a)],this.children[0].parent=this}},collapse:function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner:function(e,t,n){this.size+=t.length,this.height+=n;for(var i=0;i<this.children.length;++i){var r=this.children[i],s=r.chunkSize();if(e<=s){if(r.insertInner(e,t,n),r.lines&&r.lines.length>50){for(var o=r.lines.length%25+25,a=o;a<r.lines.length;){var l=new gs(r.lines.slice(a,a+=25));r.height-=l.height,this.children.splice(++i,0,l),l.parent=this}r.lines=r.lines.slice(0,o),this.maybeSpill()}break}e-=s}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=e.children.splice(e.children.length-5,5),n=new ms(t);if(e.parent){e.size-=n.size,e.height-=n.height;var i=F(e.parent.children,e);e.parent.children.splice(i+1,0,n)}else{var r=new ms(e.children);r.parent=e,e.children=[r,n],e=r}n.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,n){for(var i=0;i<this.children.length;++i){var r=this.children[i],s=r.chunkSize();if(e<s){var o=Math.min(t,s-e);if(r.iterN(e,o,n))return!0;if(0==(t-=o))break;e=0}else e-=s}}};var vs=function(e,t,n){if(n)for(var i in n)n.hasOwnProperty(i)&&(this[i]=n[i]);this.doc=e,this.node=t};function bs(e,t,n){qe(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&Ti(e,n)}vs.prototype.clear=function(){var e=this.doc.cm,t=this.line.widgets,n=this.line,i=he(n);if(null!=i&&t){for(var r=0;r<t.length;++r)t[r]==this&&t.splice(r--,1);t.length||(n.widgets=null);var s=Sn(this);de(n,Math.max(0,n.height-s)),e&&(Yi(e,function(){bs(e,n,-s),Zi(e,i,"widget")}),cn(e,"lineWidgetCleared",e,this,i))}},vs.prototype.changed=function(){var e=this,t=this.height,n=this.doc.cm,i=this.line;this.height=null;var r=Sn(this)-t;r&&($e(this.doc,i)||de(i,i.height+r),n&&Yi(n,function(){n.curOp.forceUpdate=!0,bs(n,i,r),cn(n,"lineWidgetChanged",n,e,he(i))}))},lt(vs);var ys=0,ws=function(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++ys};function xs(e,t,n,i,r){if(i&&i.shared)return function(e,t,n,i,r){(i=V(i)).shared=!1;var s=[xs(e,t,n,i,r)],o=s[0],a=i.widgetNode;return Mr(e,function(e){a&&(i.widgetNode=a.cloneNode(!0)),s.push(xs(e,Ce(e,t),Ce(e,n),i,r));for(var l=0;l<e.linked.length;++l)if(e.linked[l].isParent)return;o=J(s)}),new Ss(s,o)}(e,t,n,i,r);if(e.cm&&!e.cm.curOp)return Ji(e.cm,xs)(e,t,n,i,r);var s=new ws(e,r),o=ve(t,n);if(i&&V(i,s,!1),o>0||0==o&&!1!==s.clearWhenEmpty)return s;if(s.replacedWith&&(s.collapsed=!0,s.widgetNode=M("span",[s.replacedWith],"CodeMirror-widget"),i.handleMouseEvents||s.widgetNode.setAttribute("cm-ignore-events","true"),i.insertLeft&&(s.widgetNode.insertLeft=!0)),s.collapsed){if(ze(e,t.line,t,n,s)||t.line!=n.line&&ze(e,n.line,t,n,s))throw new Error("Inserting collapsed marker partially overlapping an existing one");Te=!0}s.addToHistory&&jr(e,{from:t,to:n,origin:"markText"},e.sel,NaN);var a,l=t.line,c=e.cm;if(e.iter(l,n.line+1,function(e){c&&s.collapsed&&!c.options.lineWrapping&&Be(e)==c.display.maxLine&&(a=!0),s.collapsed&&l!=t.line&&de(e,0),function(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}(e,new ke(s,l==t.line?t.ch:null,l==n.line?n.ch:null)),++l}),s.collapsed&&e.iter(t.line,n.line+1,function(t){$e(e,t)&&de(t,0)}),s.clearOnEnter&&tt(s,"beforeCursorEnter",function(){return s.clear()}),s.readOnly&&(Le=!0,(e.history.done.length||e.history.undone.length)&&e.clearHistory()),s.collapsed&&(s.id=++ys,s.atomic=!0),c){if(a&&(c.curOp.updateMaxLine=!0),s.collapsed)Qi(c,t.line,n.line+1);else if(s.className||s.startStyle||s.endStyle||s.css||s.attributes||s.title)for(var u=t.line;u<=n.line;u++)Zi(c,u,"text");s.atomic&&Qr(c.doc),cn(c,"markerAdded",c,s)}return s}ws.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&Bi(e),at(this,"clear")){var n=this.find();n&&cn(this,"clear",n.from,n.to)}for(var i=null,r=null,s=0;s<this.lines.length;++s){var o=this.lines[s],a=Ee(o.markedSpans,this);e&&!this.collapsed?Zi(e,he(o),"text"):e&&(null!=a.to&&(r=he(o)),null!=a.from&&(i=he(o))),o.markedSpans=Ae(o.markedSpans,a),null==a.from&&this.collapsed&&!$e(this.doc,o)&&e&&de(o,ni(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var l=0;l<this.lines.length;++l){var c=Be(this.lines[l]),u=Ye(c);u>e.display.maxLineLength&&(e.display.maxLine=c,e.display.maxLineLength=u,e.display.maxLineChanged=!0)}null!=i&&e&&this.collapsed&&Qi(e,i,r+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&Qr(e.doc)),e&&cn(e,"markerCleared",e,this,i,r),t&&Gi(e),this.parent&&this.parent.clear()}},ws.prototype.find=function(e,t){var n,i;null==e&&"bookmark"==this.type&&(e=1);for(var r=0;r<this.lines.length;++r){var s=this.lines[r],o=Ee(s.markedSpans,this);if(null!=o.from&&(n=me(t?s:he(s),o.from),-1==e))return n;if(null!=o.to&&(i=me(t?s:he(s),o.to),1==e))return i}return n&&{from:n,to:i}},ws.prototype.changed=function(){var e=this,t=this.find(-1,!0),n=this,i=this.doc.cm;t&&i&&Yi(i,function(){var r=t.line,s=he(t.line),o=Nn(i,s);if(o&&(Un(o),i.curOp.selectionChanged=i.curOp.forceUpdate=!0),i.curOp.updateMaxLine=!0,!$e(n.doc,r)&&null!=n.height){var a=n.height;n.height=null;var l=Sn(n)-a;l&&de(r,r.height+l)}cn(i,"markerChanged",i,e)})},ws.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=F(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},ws.prototype.detachLine=function(e){if(this.lines.splice(F(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},lt(ws);var Ss=function(e,t){this.markers=e,this.primary=t;for(var n=0;n<e.length;++n)e[n].parent=this};function Cs(e){return e.findMarks(me(e.first,0),e.clipPos(me(e.lastLine())),function(e){return e.parent})}function Os(e){for(var t=function(t){var n=e[t],i=[n.primary.doc];Mr(n.primary.doc,function(e){return i.push(e)});for(var r=0;r<n.markers.length;r++){var s=n.markers[r];-1==F(i,s.doc)&&(s.parent=null,n.markers.splice(r--,1))}},n=0;n<e.length;n++)t(n)}Ss.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();cn(this,"clear")}},Ss.prototype.find=function(e,t){return this.primary.find(e,t)},lt(Ss);var Ls=0,Ts=function(e,t,n,i,r){if(!(this instanceof Ts))return new Ts(e,t,n,i,r);null==n&&(n=0),ms.call(this,[new gs([new qt("",null)])]),this.first=n,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=n;var s=me(n,0);this.sel=xr(s),this.history=new Dr(null),this.id=++Ls,this.modeOption=t,this.lineSep=i,this.direction="rtl"==r?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),Ar(this,{from:s,to:s,text:e}),Jr(this,xr(s),G)};Ts.prototype=Q(ms.prototype,{constructor:Ts,iter:function(e,t,n){n?this.iterN(e-this.first,t-e,n):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var n=0,i=0;i<t.length;++i)n+=t[i].height;this.insertInner(e-this.first,t,n)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=ue(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:Ki(function(e){var t=me(this.first,0),n=this.first+this.size-1;ss(this,{from:t,to:me(n,le(this,n).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&Ei(this.cm,0,0),Jr(this,xr(t),G)}),replaceRange:function(e,t,n,i){t=Ce(this,t),n=n?Ce(this,n):t,us(this,e,t,n,i)},getRange:function(e,t,n){var i=ce(this,Ce(this,e),Ce(this,t));return!1===n?i:i.join(n||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(fe(this,e))return le(this,e)},getLineNumber:function(e){return he(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=le(this,e)),Be(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return Ce(this,e)},getCursor:function(e){var t=this.sel.primary();return null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Ki(function(e,t,n){qr(this,Ce(this,"number"==typeof e?me(e,t||0):e),null,n)}),setSelection:Ki(function(e,t,n){qr(this,Ce(this,e),Ce(this,t||e),n)}),extendSelection:Ki(function(e,t,n){Wr(this,Ce(this,e),t&&Ce(this,t),n)}),extendSelections:Ki(function(e,t){$r(this,Oe(this,e),t)}),extendSelectionsBy:Ki(function(e,t){var n=X(this.sel.ranges,e);$r(this,Oe(this,n),t)}),setSelections:Ki(function(e,t,n){if(e.length){for(var i=[],r=0;r<e.length;r++)i[r]=new yr(Ce(this,e[r].anchor),Ce(this,e[r].head));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),Jr(this,wr(this.cm,i,t),n)}}),addSelection:Ki(function(e,t,n){var i=this.sel.ranges.slice(0);i.push(new yr(Ce(this,e),Ce(this,t||e))),Jr(this,wr(this.cm,i,i.length-1),n)}),getSelection:function(e){for(var t,n=this.sel.ranges,i=0;i<n.length;i++){var r=ce(this,n[i].from(),n[i].to());t=t?t.concat(r):r}return!1===e?t:t.join(e||this.lineSeparator())},getSelections:function(e){for(var t=[],n=this.sel.ranges,i=0;i<n.length;i++){var r=ce(this,n[i].from(),n[i].to());!1!==e&&(r=r.join(e||this.lineSeparator())),t[i]=r}return t},replaceSelection:function(e,t,n){for(var i=[],r=0;r<this.sel.ranges.length;r++)i[r]=e;this.replaceSelections(i,t,n||"+input")},replaceSelections:Ki(function(e,t,n){for(var i=[],r=this.sel,s=0;s<r.ranges.length;s++){var o=r.ranges[s];i[s]={from:o.from(),to:o.to(),text:this.splitLines(e[s]),origin:n}}for(var a=t&&"end"!=t&&function(e,t,n){for(var i=[],r=me(e.first,0),s=r,o=0;o<t.length;o++){var a=t[o],l=Lr(a.from,r,s),c=Lr(Sr(a),r,s);if(r=a.to,s=c,"around"==n){var u=e.sel.ranges[o],d=ve(u.head,u.anchor)<0;i[o]=new yr(d?c:l,d?l:c)}else i[o]=new yr(l,l)}return new br(i,e.sel.primIndex)}(this,i,t),l=i.length-1;l>=0;l--)ss(this,i[l]);a?Yr(this,a):this.cm&&ki(this.cm)}),undo:Ki(function(){as(this,"undo")}),redo:Ki(function(){as(this,"redo")}),undoSelection:Ki(function(){as(this,"undo",!0)}),redoSelection:Ki(function(){as(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,n=0,i=0;i<e.done.length;i++)e.done[i].ranges||++t;for(var r=0;r<e.undone.length;r++)e.undone[r].ranges||++n;return{undo:t,redo:n}},clearHistory:function(){this.history=new Dr(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:Br(this.history.done),undone:Br(this.history.undone)}},setHistory:function(e){var t=this.history=new Dr(this.history.maxGeneration);t.done=Br(e.done.slice(0),null,!0),t.undone=Br(e.undone.slice(0),null,!0)},setGutterMarker:Ki(function(e,t,n){return fs(this,e,"gutter",function(e){var i=e.gutterMarkers||(e.gutterMarkers={});return i[t]=n,!n&&ne(i)&&(e.gutterMarkers=null),!0})}),clearGutter:Ki(function(e){var t=this;this.iter(function(n){n.gutterMarkers&&n.gutterMarkers[e]&&fs(t,n,"gutter",function(){return n.gutterMarkers[e]=null,ne(n.gutterMarkers)&&(n.gutterMarkers=null),!0})})}),lineInfo:function(e){var t;if("number"==typeof e){if(!fe(this,e))return null;if(t=e,!(e=le(this,e)))return null}else if(null==(t=he(e)))return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:Ki(function(e,t,n){return fs(this,e,"gutter"==t?"gutter":"class",function(e){var i="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass";if(e[i]){if(O(n).test(e[i]))return!1;e[i]+=" "+n}else e[i]=n;return!0})}),removeLineClass:Ki(function(e,t,n){return fs(this,e,"gutter"==t?"gutter":"class",function(e){var i="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass",r=e[i];if(!r)return!1;if(null==n)e[i]=null;else{var s=r.match(O(n));if(!s)return!1;var o=s.index+s[0].length;e[i]=r.slice(0,s.index)+(s.index&&o!=r.length?" ":"")+r.slice(o)||null}return!0})}),addLineWidget:Ki(function(e,t,n){return function(e,t,n,i){var r=new vs(e,n,i),s=e.cm;return s&&r.noHScroll&&(s.display.alignWidgets=!0),fs(e,t,"widget",function(t){var n=t.widgets||(t.widgets=[]);if(null==r.insertAt?n.push(r):n.splice(Math.min(n.length-1,Math.max(0,r.insertAt)),0,r),r.line=t,s&&!$e(e,t)){var i=qe(t)<e.scrollTop;de(t,t.height+Sn(r)),i&&Ti(s,r.height),s.curOp.forceUpdate=!0}return!0}),s&&cn(s,"lineWidgetAdded",s,r,"number"==typeof t?t:he(t)),r}(this,e,t,n)}),removeLineWidget:function(e){e.clear()},markText:function(e,t,n){return xs(this,Ce(this,e),Ce(this,t),n,n&&n.type||"range")},setBookmark:function(e,t){var n={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return xs(this,e=Ce(this,e),e,n,"bookmark")},findMarksAt:function(e){e=Ce(this,e);var t=[],n=le(this,e.line).markedSpans;if(n)for(var i=0;i<n.length;++i){var r=n[i];(null==r.from||r.from<=e.ch)&&(null==r.to||r.to>=e.ch)&&t.push(r.marker.parent||r.marker)}return t},findMarks:function(e,t,n){e=Ce(this,e),t=Ce(this,t);var i=[],r=e.line;return this.iter(e.line,t.line+1,function(s){var o=s.markedSpans;if(o)for(var a=0;a<o.length;a++){var l=o[a];null!=l.to&&r==e.line&&e.ch>=l.to||null==l.from&&r!=e.line||null!=l.from&&r==t.line&&l.from>=t.ch||n&&!n(l.marker)||i.push(l.marker.parent||l.marker)}++r}),i},getAllMarks:function(){var e=[];return this.iter(function(t){var n=t.markedSpans;if(n)for(var i=0;i<n.length;++i)null!=n[i].from&&e.push(n[i].marker)}),e},posFromIndex:function(e){var t,n=this.first,i=this.lineSeparator().length;return this.iter(function(r){var s=r.text.length+i;if(s>e)return t=e,!0;e-=s,++n}),Ce(this,me(n,t))},indexFromPos:function(e){var t=(e=Ce(this,e)).ch;if(e.line<this.first||e.ch<0)return 0;var n=this.lineSeparator().length;return this.iter(this.first,e.line,function(e){t+=e.text.length+n}),t},copy:function(e){var t=new Ts(ue(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,n=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<n&&(n=e.to);var i=new Ts(ue(this,t,n),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(i.history=this.history),(this.linked||(this.linked=[])).push({doc:i,sharedHist:e.sharedHist}),i.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n],r=i.find(),s=e.clipPos(r.from),o=e.clipPos(r.to);if(ve(s,o)){var a=xs(e,s,o,i.primary,i.primary.type);i.markers.push(a),a.parent=i}}}(i,Cs(this)),i},unlinkDoc:function(e){if(e instanceof Oo&&(e=e.doc),this.linked)for(var t=0;t<this.linked.length;++t){var n=this.linked[t];if(n.doc==e){this.linked.splice(t,1),e.unlinkDoc(this),Os(Cs(this));break}}if(e.history==this.history){var i=[e.id];Mr(e,function(e){return i.push(e.id)},!0),e.history=new Dr(null),e.history.done=Br(this.history.done,i),e.history.undone=Br(this.history.undone,i)}},iterLinkedDocs:function(e){Mr(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):xt(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:Ki(function(e){var t;"rtl"!=e&&(e="ltr"),e!=this.direction&&(this.direction=e,this.iter(function(e){return e.order=null}),this.cm&&Yi(t=this.cm,function(){Nr(t),Qi(t)}))})}),Ts.prototype.eachLine=Ts.prototype.iter;var ks=0;function Es(e){var t=this;if(As(t),!st(t,e)&&!Cn(t.display,e)){ct(e),o&&(ks=+new Date);var n=li(t,e,!0),i=e.dataTransfer.files;if(n&&!t.isReadOnly())if(i&&i.length&&window.FileReader&&window.File)for(var r=i.length,s=Array(r),a=0,l=function(e,i){if(!t.options.allowDropFileTypes||-1!=F(t.options.allowDropFileTypes,e.type)){var o=new FileReader;o.onload=Ji(t,function(){var e=o.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(e)&&(e=""),s[i]=e,++a==r){var l={from:n=Ce(t.doc,n),to:n,text:t.doc.splitLines(s.join(t.doc.lineSeparator())),origin:"paste"};ss(t.doc,l),Yr(t.doc,xr(n,Sr(l)))}}),o.readAsText(e)}},c=0;c<r;++c)l(i[c],c);else{if(t.state.draggingText&&t.doc.sel.contains(n)>-1)return t.state.draggingText(e),void setTimeout(function(){return t.display.input.focus()},20);try{var u=e.dataTransfer.getData("Text");if(u){var d;if(t.state.draggingText&&!t.state.draggingText.copy&&(d=t.listSelections()),Xr(t.doc,xr(n,n)),d)for(var h=0;h<d.length;++h)us(t.doc,"",d[h].anchor,d[h].head,"drag");t.replaceSelection(u,"around","paste"),t.display.input.focus()}}catch(e){}}}}function As(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function Ms(e){if(document.getElementsByClassName){for(var t=document.getElementsByClassName("CodeMirror"),n=[],i=0;i<t.length;i++){var r=t[i].CodeMirror;r&&n.push(r)}n.length&&n[0].operation(function(){for(var t=0;t<n.length;t++)e(n[t])})}}var Is=!1;function Ns(){var e;Is||(tt(window,"resize",function(){null==e&&(e=setTimeout(function(){e=null,Ms(Ds)},100))}),tt(window,"blur",function(){return Ms(yi)}),Is=!0)}function Ds(e){var t=e.display;t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize()}for(var Rs={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Ps=0;Ps<10;Ps++)Rs[Ps+48]=Rs[Ps+96]=String(Ps);for(var js=65;js<=90;js++)Rs[js]=String.fromCharCode(js);for(var Vs=1;Vs<=12;Vs++)Rs[Vs+111]=Rs[Vs+63235]="F"+Vs;var _s={};function Us(e){var t,n,i,r,s=e.split(/-(?!$)/);e=s[s.length-1];for(var o=0;o<s.length-1;o++){var a=s[o];if(/^(cmd|meta|m)$/i.test(a))r=!0;else if(/^a(lt)?$/i.test(a))t=!0;else if(/^(c|ctrl|control)$/i.test(a))n=!0;else{if(!/^s(hift)?$/i.test(a))throw new Error("Unrecognized modifier name: "+a);i=!0}}return t&&(e="Alt-"+e),n&&(e="Ctrl-"+e),r&&(e="Cmd-"+e),i&&(e="Shift-"+e),e}function Fs(e){var t={};for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];if(/^(name|fallthrough|(de|at)tach)$/.test(n))continue;if("..."==i){delete e[n];continue}for(var r=X(n.split(" "),Us),s=0;s<r.length;s++){var o=void 0,a=void 0;s==r.length-1?(a=r.join(" "),o=i):(a=r.slice(0,s+1).join(" "),o="...");var l=t[a];if(l){if(l!=o)throw new Error("Inconsistent bindings for "+a)}else t[a]=o}delete e[n]}for(var c in t)e[c]=t[c];return e}function zs(e,t,n,i){var r=(t=$s(t)).call?t.call(e,i):t[e];if(!1===r)return"nothing";if("..."===r)return"multi";if(null!=r&&n(r))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return zs(e,t.fallthrough,n,i);for(var s=0;s<t.fallthrough.length;s++){var o=zs(e,t.fallthrough[s],n,i);if(o)return o}}}function Bs(e){var t="string"==typeof e?e:Rs[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function Gs(e,t,n){var i=e;return t.altKey&&"Alt"!=i&&(e="Alt-"+e),(S?t.metaKey:t.ctrlKey)&&"Ctrl"!=i&&(e="Ctrl-"+e),(S?t.ctrlKey:t.metaKey)&&"Cmd"!=i&&(e="Cmd-"+e),!n&&t.shiftKey&&"Shift"!=i&&(e="Shift-"+e),e}function Ws(e,t){if(d&&34==e.keyCode&&e.char)return!1;var n=Rs[e.keyCode];return null!=n&&!e.altGraphKey&&(3==e.keyCode&&e.code&&(n=e.code),Gs(n,e,t))}function $s(e){return"string"==typeof e?_s[e]:e}function Hs(e,t){for(var n=e.doc.sel.ranges,i=[],r=0;r<n.length;r++){for(var s=t(n[r]);i.length&&ve(s.from,J(i).to)<=0;){var o=i.pop();if(ve(o.from,s.from)<0){s.from=o.from;break}}i.push(s)}Yi(e,function(){for(var t=i.length-1;t>=0;t--)us(e.doc,"",i[t].from,i[t].to,"+delete");ki(e)})}function qs(e,t,n){var i=se(e.text,t+n,n);return i<0||i>e.text.length?null:i}function Ys(e,t,n){var i=qs(e,t.ch,n);return null==i?null:new me(t.line,i,n<0?"after":"before")}function Js(e,t,n,i,r){if(e){var s=Ze(n,t.doc.direction);if(s){var o,a=r<0?J(s):s[0],l=r<0==(1==a.level),c=l?"after":"before";if(a.level>0||"rtl"==t.doc.direction){var u=Dn(t,n);o=r<0?n.text.length-1:0;var d=Rn(t,u,o).top;o=oe(function(e){return Rn(t,u,e).top==d},r<0==(1==a.level)?a.from:a.to-1,o),"before"==c&&(o=qs(n,o,1))}else o=r<0?a.to:a.from;return new me(i,o,c)}}return new me(i,r<0?n.text.length:0,r<0?"before":"after")}_s.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},_s.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},_s.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},_s.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},_s.default=b?_s.macDefault:_s.pcDefault;var Xs={selectAll:is,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),G)},killLine:function(e){return Hs(e,function(t){if(t.empty()){var n=le(e.doc,t.head.line).text.length;return t.head.ch==n&&t.head.line<e.lastLine()?{from:t.head,to:me(t.head.line+1,0)}:{from:t.head,to:me(t.head.line,n)}}return{from:t.from(),to:t.to()}})},deleteLine:function(e){return Hs(e,function(t){return{from:me(t.from().line,0),to:Ce(e.doc,me(t.to().line+1,0))}})},delLineLeft:function(e){return Hs(e,function(e){return{from:me(e.from().line,0),to:e.from()}})},delWrappedLineLeft:function(e){return Hs(e,function(t){var n=e.charCoords(t.head,"div").top+5,i=e.coordsChar({left:0,top:n},"div");return{from:i,to:t.from()}})},delWrappedLineRight:function(e){return Hs(e,function(t){var n=e.charCoords(t.head,"div").top+5,i=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:n},"div");return{from:t.from(),to:i}})},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(me(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(me(e.lastLine()))},goLineStart:function(e){return e.extendSelectionsBy(function(t){return Ks(e,t.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(e){return e.extendSelectionsBy(function(t){return Qs(e,t.head)},{origin:"+move",bias:1})},goLineEnd:function(e){return e.extendSelectionsBy(function(t){return function(e,t){var n=le(e.doc,t),i=function(e){for(var t;t=Ue(e);)e=t.find(1,!0).line;return e}(n);return i!=n&&(t=he(i)),Js(!0,e,n,t,-1)}(e,t.head.line)},{origin:"+move",bias:-1})},goLineRight:function(e){return e.extendSelectionsBy(function(t){var n=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:n},"div")},$)},goLineLeft:function(e){return e.extendSelectionsBy(function(t){var n=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:n},"div")},$)},goLineLeftSmart:function(e){return e.extendSelectionsBy(function(t){var n=e.cursorCoords(t.head,"div").top+5,i=e.coordsChar({left:0,top:n},"div");return i.ch<e.getLine(i.line).search(/\S/)?Qs(e,t.head):i},$)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"char")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){for(var t=[],n=e.listSelections(),i=e.options.tabSize,r=0;r<n.length;r++){var s=n[r].from(),o=_(e.getLine(s.line),s.ch,i);t.push(Y(i-o%i))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){return Yi(e,function(){for(var t=e.listSelections(),n=[],i=0;i<t.length;i++)if(t[i].empty()){var r=t[i].head,s=le(e.doc,r.line).text;if(s)if(r.ch==s.length&&(r=new me(r.line,r.ch-1)),r.ch>0)r=new me(r.line,r.ch+1),e.replaceRange(s.charAt(r.ch-1)+s.charAt(r.ch-2),me(r.line,r.ch-2),r,"+transpose");else if(r.line>e.doc.first){var o=le(e.doc,r.line-1).text;o&&(r=new me(r.line,1),e.replaceRange(s.charAt(0)+e.doc.lineSeparator()+o.charAt(o.length-1),me(r.line-1,o.length-1),r,"+transpose"))}n.push(new yr(r,r))}e.setSelections(n)})},newlineAndIndent:function(e){return Yi(e,function(){for(var t=e.listSelections(),n=t.length-1;n>=0;n--)e.replaceRange(e.doc.lineSeparator(),t[n].anchor,t[n].head,"+input");t=e.listSelections();for(var i=0;i<t.length;i++)e.indentLine(t[i].from().line,null,!0);ki(e)})},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}};function Ks(e,t){var n=le(e.doc,t),i=Be(n);return i!=n&&(t=he(i)),Js(!0,e,i,t,1)}function Qs(e,t){var n=Ks(e,t.line),i=le(e.doc,n.line),r=Ze(i,e.doc.direction);if(!r||0==r[0].level){var s=Math.max(0,i.text.search(/\S/)),o=t.line==n.line&&t.ch<=s&&t.ch;return me(n.line,o?0:s,n.sticky)}return n}function Zs(e,t,n){if("string"==typeof t&&!(t=Xs[t]))return!1;e.display.input.ensurePolled();var i=e.display.shift,r=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),n&&(e.display.shift=!1),r=t(e)!=B}finally{e.display.shift=i,e.state.suppressEdits=!1}return r}var eo=new U;function to(e,t,n,i){var r=e.state.keySeq;if(r){if(Bs(t))return"handled";if(/\'$/.test(t)?e.state.keySeq=null:eo.set(50,function(){e.state.keySeq==r&&(e.state.keySeq=null,e.display.input.reset())}),no(e,r+" "+t,n,i))return!0}return no(e,t,n,i)}function no(e,t,n,i){var r=function(e,t,n){for(var i=0;i<e.state.keyMaps.length;i++){var r=zs(t,e.state.keyMaps[i],n,e);if(r)return r}return e.options.extraKeys&&zs(t,e.options.extraKeys,n,e)||zs(t,e.options.keyMap,n,e)}(e,t,i);return"multi"==r&&(e.state.keySeq=t),"handled"==r&&cn(e,"keyHandled",e,t,n),"handled"!=r&&"multi"!=r||(ct(n),gi(e)),!!r}function io(e,t){var n=Ws(t,!0);return!!n&&(t.shiftKey&&!e.state.keySeq?to(e,"Shift-"+n,t,function(t){return Zs(e,t,!0)})||to(e,n,t,function(t){if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return Zs(e,t)}):to(e,n,t,function(t){return Zs(e,t)}))}var ro=null;function so(e){var t=this;if(t.curOp.focus=N(),!st(t,e)){o&&a<11&&27==e.keyCode&&(e.returnValue=!1);var n=e.keyCode;t.display.shift=16==n||e.shiftKey;var i=io(t,e);d&&(ro=i?n:null,!i&&88==n&&!Ct&&(b?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),18!=n||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||function(e){var t=e.display.lineDiv;function n(e){18!=e.keyCode&&e.altKey||(T(t,"CodeMirror-crosshair"),it(document,"keyup",n),it(document,"mouseover",n))}D(t,"CodeMirror-crosshair"),tt(document,"keyup",n),tt(document,"mouseover",n)}(t)}}function oo(e){16==e.keyCode&&(this.doc.sel.shift=!1),st(this,e)}function ao(e){var t=this;if(!(Cn(t.display,e)||st(t,e)||e.ctrlKey&&!e.altKey||b&&e.metaKey)){var n=e.keyCode,i=e.charCode;if(d&&n==ro)return ro=null,void ct(e);if(!d||e.which&&!(e.which<10)||!io(t,e)){var r=String.fromCharCode(null==i?n:i);"\b"!=r&&(function(e,t,n){return to(e,"'"+n+"'",t,function(t){return Zs(e,t,!0)})}(t,e,r)||t.display.input.onKeyPress(e))}}}var lo,co,uo=function(e,t,n){this.time=e,this.pos=t,this.button=n};function ho(e){var t=this,n=t.display;if(!(st(t,e)||n.activeTouch&&n.input.supportsTouch()))if(n.input.ensurePolled(),n.shift=e.shiftKey,Cn(n,e))l||(n.scroller.draggable=!1,setTimeout(function(){return n.scroller.draggable=!0},100));else if(!go(t,e)){var i=li(t,e),r=ft(e),s=i?function(e,t){var n=+new Date;return co&&co.compare(n,e,t)?(lo=co=null,"triple"):lo&&lo.compare(n,e,t)?(co=new uo(n,e,t),lo=null,"double"):(lo=new uo(n,e,t),co=null,"single")}(i,r):"single";window.focus(),1==r&&t.state.selectingText&&t.state.selectingText(e),i&&function(e,t,n,i,r){var s="Click";return"double"==i?s="Double"+s:"triple"==i&&(s="Triple"+s),to(e,Gs(s=(1==t?"Left":2==t?"Middle":"Right")+s,r),r,function(t){if("string"==typeof t&&(t=Xs[t]),!t)return!1;var i=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),i=t(e,n)!=B}finally{e.state.suppressEdits=!1}return i})}(t,r,i,s,e)||(1==r?i?function(e,t,n,i){o?setTimeout(j(mi,e),0):e.curOp.focus=N();var r,s=function(e,t,n){var i=e.getOption("configureMouse"),r=i?i(e,t,n):{};if(null==r.unit){var s=y?n.shiftKey&&n.metaKey:n.altKey;r.unit=s?"rectangle":"single"==t?"char":"double"==t?"word":"line"}return(null==r.extend||e.doc.extend)&&(r.extend=e.doc.extend||n.shiftKey),null==r.addNew&&(r.addNew=b?n.metaKey:n.ctrlKey),null==r.moveOnDrag&&(r.moveOnDrag=!(b?n.altKey:n.ctrlKey)),r}(e,n,i),c=e.doc.sel;e.options.dragDrop&&vt&&!e.isReadOnly()&&"single"==n&&(r=c.contains(t))>-1&&(ve((r=c.ranges[r]).from(),t)<0||t.xRel>0)&&(ve(r.to(),t)>0||t.xRel<0)?function(e,t,n,i){var r=e.display,s=!1,c=Ji(e,function(t){l&&(r.scroller.draggable=!1),e.state.draggingText=!1,it(r.wrapper.ownerDocument,"mouseup",c),it(r.wrapper.ownerDocument,"mousemove",u),it(r.scroller,"dragstart",d),it(r.scroller,"drop",c),s||(ct(t),i.addNew||Wr(e.doc,n,null,null,i.extend),l||o&&9==a?setTimeout(function(){r.wrapper.ownerDocument.body.focus(),r.input.focus()},20):r.input.focus())}),u=function(e){s=s||Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)>=10},d=function(){return s=!0};l&&(r.scroller.draggable=!0),e.state.draggingText=c,c.copy=!i.moveOnDrag,r.scroller.dragDrop&&r.scroller.dragDrop(),tt(r.wrapper.ownerDocument,"mouseup",c),tt(r.wrapper.ownerDocument,"mousemove",u),tt(r.scroller,"dragstart",d),tt(r.scroller,"drop",c),vi(e),setTimeout(function(){return r.input.focus()},20)}(e,i,t,s):function(e,t,n,i){var r=e.display,s=e.doc;ct(t);var o,a,l=s.sel,c=l.ranges;if(i.addNew&&!i.extend?(a=s.sel.contains(n),o=a>-1?c[a]:new yr(n,n)):(o=s.sel.primary(),a=s.sel.primIndex),"rectangle"==i.unit)i.addNew||(o=new yr(n,n)),n=li(e,t,!0,!0),a=-1;else{var u=po(e,n,i.unit);o=i.extend?Gr(o,u.anchor,u.head,i.extend):u}i.addNew?-1==a?(a=c.length,Jr(s,wr(e,c.concat([o]),a),{scroll:!1,origin:"*mouse"})):c.length>1&&c[a].empty()&&"char"==i.unit&&!i.extend?(Jr(s,wr(e,c.slice(0,a).concat(c.slice(a+1)),0),{scroll:!1,origin:"*mouse"}),l=s.sel):Hr(s,a,o,W):(a=0,Jr(s,new br([o],0),W),l=s.sel);var d=n;function h(t){if(0!=ve(d,t))if(d=t,"rectangle"==i.unit){for(var r=[],c=e.options.tabSize,u=_(le(s,n.line).text,n.ch,c),h=_(le(s,t.line).text,t.ch,c),p=Math.min(u,h),f=Math.max(u,h),g=Math.min(n.line,t.line),m=Math.min(e.lastLine(),Math.max(n.line,t.line));g<=m;g++){var v=le(s,g).text,b=H(v,p,c);p==f?r.push(new yr(me(g,b),me(g,b))):v.length>b&&r.push(new yr(me(g,b),me(g,H(v,f,c))))}r.length||r.push(new yr(n,n)),Jr(s,wr(e,l.ranges.slice(0,a).concat(r),a),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{var y,w=o,x=po(e,t,i.unit),S=w.anchor;ve(x.anchor,S)>0?(y=x.head,S=xe(w.from(),x.anchor)):(y=x.anchor,S=we(w.to(),x.head));var C=l.ranges.slice(0);C[a]=function(e,t){var n=t.anchor,i=t.head,r=le(e.doc,n.line);if(0==ve(n,i)&&n.sticky==i.sticky)return t;var s=Ze(r);if(!s)return t;var o=Ke(s,n.ch,n.sticky),a=s[o];if(a.from!=n.ch&&a.to!=n.ch)return t;var l,c=o+(a.from==n.ch==(1!=a.level)?0:1);if(0==c||c==s.length)return t;if(i.line!=n.line)l=(i.line-n.line)*("ltr"==e.doc.direction?1:-1)>0;else{var u=Ke(s,i.ch,i.sticky),d=u-o||(i.ch-n.ch)*(1==a.level?-1:1);l=u==c-1||u==c?d<0:d>0}var h=s[c+(l?-1:0)],p=l==(1==h.level),f=p?h.from:h.to,g=p?"after":"before";return n.ch==f&&n.sticky==g?t:new yr(new me(n.line,f,g),i)}(e,new yr(Ce(s,S),y)),Jr(s,wr(e,C,a),W)}}var p=r.wrapper.getBoundingClientRect(),f=0;function g(t){e.state.selectingText=!1,f=1/0,ct(t),r.input.focus(),it(r.wrapper.ownerDocument,"mousemove",m),it(r.wrapper.ownerDocument,"mouseup",v),s.history.lastSelOrigin=null}var m=Ji(e,function(t){0!==t.buttons&&ft(t)?function t(n){var o=++f,a=li(e,n,!0,"rectangle"==i.unit);if(a)if(0!=ve(a,d)){e.curOp.focus=N(),h(a);var l=Si(r,s);(a.line>=l.to||a.line<l.from)&&setTimeout(Ji(e,function(){f==o&&t(n)}),150)}else{var c=n.clientY<p.top?-20:n.clientY>p.bottom?20:0;c&&setTimeout(Ji(e,function(){f==o&&(r.scroller.scrollTop+=c,t(n))}),50)}}(t):g(t)}),v=Ji(e,g);e.state.selectingText=v,tt(r.wrapper.ownerDocument,"mousemove",m),tt(r.wrapper.ownerDocument,"mouseup",v)}(e,i,t,s)}(t,i,s,e):pt(e)==n.scroller&&ct(e):2==r?(i&&Wr(t.doc,i),setTimeout(function(){return n.input.focus()},20)):3==r&&(C?t.display.input.onContextMenu(e):vi(t)))}}function po(e,t,n){if("char"==n)return new yr(t,t);if("word"==n)return e.findWordAt(t);if("line"==n)return new yr(me(t.line,0),Ce(e.doc,me(t.line+1,0)));var i=n(e,t);return new yr(i.from,i.to)}function fo(e,t,n,i){var r,s;if(t.touches)r=t.touches[0].clientX,s=t.touches[0].clientY;else try{r=t.clientX,s=t.clientY}catch(t){return!1}if(r>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;i&&ct(t);var o=e.display,a=o.lineDiv.getBoundingClientRect();if(s>a.bottom||!at(e,n))return dt(t);s-=a.top-o.viewOffset;for(var l=0;l<e.options.gutters.length;++l){var c=o.gutters.childNodes[l];if(c&&c.getBoundingClientRect().right>=r){var u=pe(e.doc,s),d=e.options.gutters[l];return rt(e,n,e,u,d,t),dt(t)}}}function go(e,t){return fo(e,t,"gutterClick",!0)}function mo(e,t){Cn(e.display,t)||function(e,t){return!!at(e,"gutterContextMenu")&&fo(e,t,"gutterContextMenu",!1)}(e,t)||st(e,t,"contextmenu")||C||e.display.input.onContextMenu(t)}function vo(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),zn(e)}uo.prototype.compare=function(e,t,n){return this.time+400>e&&0==ve(t,this.pos)&&n==this.button};var bo={toString:function(){return"CodeMirror.Init"}},yo={},wo={};function xo(e){dr(e),Qi(e),Ci(e)}function So(e,t,n){var i=n&&n!=bo;if(!t!=!i){var r=e.display.dragFunctions,s=t?tt:it;s(e.display.scroller,"dragstart",r.start),s(e.display.scroller,"dragenter",r.enter),s(e.display.scroller,"dragover",r.over),s(e.display.scroller,"dragleave",r.leave),s(e.display.scroller,"drop",r.drop)}}function Co(e){e.options.lineWrapping?(D(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(T(e.display.wrapper,"CodeMirror-wrap"),Je(e)),ai(e),Qi(e),zn(e),setTimeout(function(){return Vi(e)},100)}function Oo(e,t){var n=this;if(!(this instanceof Oo))return new Oo(e,t);this.options=t=t?V(t):{},V(yo,t,!1),hr(t);var i=t.value;"string"==typeof i?i=new Ts(i,t.mode,null,t.lineSeparator,t.direction):t.mode&&(i.modeOption=t.mode),this.doc=i;var r=new Oo.inputStyles[t.inputStyle](this),s=this.display=new ae(e,i,r);for(var c in s.wrapper.CodeMirror=this,dr(this),vo(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),Fi(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new U,keySeq:null,specialChars:null},t.autofocus&&!v&&s.input.focus(),o&&a<11&&setTimeout(function(){return n.display.input.reset(!0)},20),function(e){var t=e.display;tt(t.scroller,"mousedown",Ji(e,ho)),tt(t.scroller,"dblclick",o&&a<11?Ji(e,function(t){if(!st(e,t)){var n=li(e,t);if(n&&!go(e,t)&&!Cn(e.display,t)){ct(t);var i=e.findWordAt(n);Wr(e.doc,i.anchor,i.head)}}}):function(t){return st(e,t)||ct(t)}),tt(t.scroller,"contextmenu",function(t){return mo(e,t)});var n,i={end:0};function r(){t.activeTouch&&(n=setTimeout(function(){return t.activeTouch=null},1e3),(i=t.activeTouch).end=+new Date)}function s(e,t){if(null==t.left)return!0;var n=t.left-e.left,i=t.top-e.top;return n*n+i*i>400}tt(t.scroller,"touchstart",function(r){if(!st(e,r)&&!function(e){if(1!=e.touches.length)return!1;var t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}(r)&&!go(e,r)){t.input.ensurePolled(),clearTimeout(n);var s=+new Date;t.activeTouch={start:s,moved:!1,prev:s-i.end<=300?i:null},1==r.touches.length&&(t.activeTouch.left=r.touches[0].pageX,t.activeTouch.top=r.touches[0].pageY)}}),tt(t.scroller,"touchmove",function(){t.activeTouch&&(t.activeTouch.moved=!0)}),tt(t.scroller,"touchend",function(n){var i=t.activeTouch;if(i&&!Cn(t,n)&&null!=i.left&&!i.moved&&new Date-i.start<300){var o,a=e.coordsChar(t.activeTouch,"page");o=!i.prev||s(i,i.prev)?new yr(a,a):!i.prev.prev||s(i,i.prev.prev)?e.findWordAt(a):new yr(me(a.line,0),Ce(e.doc,me(a.line+1,0))),e.setSelection(o.anchor,o.head),e.focus(),ct(n)}r()}),tt(t.scroller,"touchcancel",r),tt(t.scroller,"scroll",function(){t.scroller.clientHeight&&(Ii(e,t.scroller.scrollTop),Di(e,t.scroller.scrollLeft,!0),rt(e,"scroll",e))}),tt(t.scroller,"mousewheel",function(t){return vr(e,t)}),tt(t.scroller,"DOMMouseScroll",function(t){return vr(e,t)}),tt(t.wrapper,"scroll",function(){return t.wrapper.scrollTop=t.wrapper.scrollLeft=0}),t.dragFunctions={enter:function(t){st(e,t)||ht(t)},over:function(t){st(e,t)||(function(e,t){var n=li(e,t);if(n){var i=document.createDocumentFragment();hi(e,n,i),e.display.dragCursor||(e.display.dragCursor=A("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),E(e.display.dragCursor,i)}}(e,t),ht(t))},start:function(t){return function(e,t){if(o&&(!e.state.draggingText||+new Date-ks<100))ht(t);else if(!st(e,t)&&!Cn(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!h)){var n=A("img",null,null,"position: fixed; left: 0; top: 0;");n.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",d&&(n.width=n.height=1,e.display.wrapper.appendChild(n),n._top=n.offsetTop),t.dataTransfer.setDragImage(n,0,0),d&&n.parentNode.removeChild(n)}}(e,t)},drop:Ji(e,Es),leave:function(t){st(e,t)||As(e)}};var l=t.input.getField();tt(l,"keyup",function(t){return oo.call(e,t)}),tt(l,"keydown",Ji(e,so)),tt(l,"keypress",Ji(e,ao)),tt(l,"focus",function(t){return bi(e,t)}),tt(l,"blur",function(t){return yi(e,t)})}(this),Ns(),Bi(this),this.curOp.forceUpdate=!0,Ir(this,i),t.autofocus&&!v||this.hasFocus()?setTimeout(j(bi,this),20):yi(this),wo)wo.hasOwnProperty(c)&&wo[c](n,t[c],bo);Oi(this),t.finishInit&&t.finishInit(this);for(var u=0;u<Lo.length;++u)Lo[u](n);Gi(this),l&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(s.lineDiv).textRendering&&(s.lineDiv.style.textRendering="auto")}Oo.defaults=yo,Oo.optionHandlers=wo;var Lo=[];function To(e,t,n,i){var r,s=e.doc;null==n&&(n="add"),"smart"==n&&(s.mode.indent?r=Ut(e,t).state:n="prev");var o=e.options.tabSize,a=le(s,t),l=_(a.text,null,o);a.stateAfter&&(a.stateAfter=null);var c,u=a.text.match(/^\s*/)[0];if(i||/\S/.test(a.text)){if("smart"==n&&((c=s.mode.indent(r,a.text.slice(u.length),a.text))==B||c>150)){if(!i)return;n="prev"}}else c=0,n="not";"prev"==n?c=t>s.first?_(le(s,t-1).text,null,o):0:"add"==n?c=l+e.options.indentUnit:"subtract"==n?c=l-e.options.indentUnit:"number"==typeof n&&(c=l+n),c=Math.max(0,c);var d="",h=0;if(e.options.indentWithTabs)for(var p=Math.floor(c/o);p;--p)h+=o,d+="\t";if(h<c&&(d+=Y(c-h)),d!=u)return us(s,d,me(t,0),me(t,u.length),"+input"),a.stateAfter=null,!0;for(var f=0;f<s.sel.ranges.length;f++){var g=s.sel.ranges[f];if(g.head.line==t&&g.head.ch<u.length){var m=me(t,u.length);Hr(s,f,new yr(m,m));break}}}Oo.defineInitHook=function(e){return Lo.push(e)};var ko=null;function Eo(e){ko=e}function Ao(e,t,n,i,r){var s=e.doc;e.display.shift=!1,i||(i=s.sel);var o=+new Date-200,a="paste"==r||e.state.pasteIncoming>o,l=xt(t),c=null;if(a&&i.ranges.length>1)if(ko&&ko.text.join("\n")==t){if(i.ranges.length%ko.text.length==0){c=[];for(var u=0;u<ko.text.length;u++)c.push(s.splitLines(ko.text[u]))}}else l.length==i.ranges.length&&e.options.pasteLinesPerSelection&&(c=X(l,function(e){return[e]}));for(var d=e.curOp.updateInput,h=i.ranges.length-1;h>=0;h--){var p=i.ranges[h],f=p.from(),g=p.to();p.empty()&&(n&&n>0?f=me(f.line,f.ch-n):e.state.overwrite&&!a?g=me(g.line,Math.min(le(s,g.line).text.length,g.ch+J(l).length)):a&&ko&&ko.lineWise&&ko.text.join("\n")==t&&(f=g=me(f.line,0)));var m={from:f,to:g,text:c?c[h%c.length]:l,origin:r||(a?"paste":e.state.cutIncoming>o?"cut":"+input")};ss(e.doc,m),cn(e,"inputRead",e,m)}t&&!a&&Io(e,t),ki(e),e.curOp.updateInput<2&&(e.curOp.updateInput=d),e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=-1}function Mo(e,t){var n=e.clipboardData&&e.clipboardData.getData("Text");if(n)return e.preventDefault(),t.isReadOnly()||t.options.disableInput||Yi(t,function(){return Ao(t,n,0,null,"paste")}),!0}function Io(e,t){if(e.options.electricChars&&e.options.smartIndent)for(var n=e.doc.sel,i=n.ranges.length-1;i>=0;i--){var r=n.ranges[i];if(!(r.head.ch>100||i&&n.ranges[i-1].head.line==r.head.line)){var s=e.getModeAt(r.head),o=!1;if(s.electricChars){for(var a=0;a<s.electricChars.length;a++)if(t.indexOf(s.electricChars.charAt(a))>-1){o=To(e,r.head.line,"smart");break}}else s.electricInput&&s.electricInput.test(le(e.doc,r.head.line).text.slice(0,r.head.ch))&&(o=To(e,r.head.line,"smart"));o&&cn(e,"electricInput",e,r.head.line)}}}function No(e){for(var t=[],n=[],i=0;i<e.doc.sel.ranges.length;i++){var r=e.doc.sel.ranges[i].head.line,s={anchor:me(r,0),head:me(r+1,0)};n.push(s),t.push(e.getRange(s.anchor,s.head))}return{text:t,ranges:n}}function Do(e,t,n,i){e.setAttribute("autocorrect",!!n),e.setAttribute("autocapitalize",!!i),e.setAttribute("spellcheck",!!t)}function Ro(){var e=A("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),t=A("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return l?e.style.width="1000px":e.setAttribute("wrap","off"),g&&(e.style.border="1px solid black"),Do(e),t}function Po(e,t,n,i,r){var s=t,o=n,a=le(e,t.line);function l(i){var s,o;if(null==(s=r?function(e,t,n,i){var r=Ze(t,e.doc.direction);if(!r)return Ys(t,n,i);n.ch>=t.text.length?(n.ch=t.text.length,n.sticky="before"):n.ch<=0&&(n.ch=0,n.sticky="after");var s=Ke(r,n.ch,n.sticky),o=r[s];if("ltr"==e.doc.direction&&o.level%2==0&&(i>0?o.to>n.ch:o.from<n.ch))return Ys(t,n,i);var a,l=function(e,n){return qs(t,e instanceof me?e.ch:e,n)},c=function(n){return e.options.lineWrapping?(a=a||Dn(e,t),Zn(e,t,a,n)):{begin:0,end:t.text.length}},u=c("before"==n.sticky?l(n,-1):n.ch);if("rtl"==e.doc.direction||1==o.level){var d=1==o.level==i<0,h=l(n,d?1:-1);if(null!=h&&(d?h<=o.to&&h<=u.end:h>=o.from&&h>=u.begin)){var p=d?"before":"after";return new me(n.line,h,p)}}var f=function(e,t,i){for(var s=function(e,t){return t?new me(n.line,l(e,1),"before"):new me(n.line,e,"after")};e>=0&&e<r.length;e+=t){var o=r[e],a=t>0==(1!=o.level),c=a?i.begin:l(i.end,-1);if(o.from<=c&&c<o.to)return s(c,a);if(c=a?o.from:l(o.to,-1),i.begin<=c&&c<i.end)return s(c,a)}},g=f(s+i,i,u);if(g)return g;var m=i>0?u.end:l(u.begin,-1);return null==m||i>0&&m==t.text.length||!(g=f(i>0?0:r.length-1,i,c(m)))?null:g}(e.cm,a,t,n):Ys(a,t,n))){if(i||((o=t.line+n)<e.first||o>=e.first+e.size||(t=new me(o,t.ch,t.sticky),!(a=le(e,o)))))return!1;t=Js(r,e.cm,a,t.line,n)}else t=s;return!0}if("char"==i)l();else if("column"==i)l(!0);else if("word"==i||"group"==i)for(var c=null,u="group"==i,d=e.cm&&e.cm.getHelper(t,"wordChars"),h=!0;!(n<0)||l(!h);h=!1){var p=a.text.charAt(t.ch)||"\n",f=te(p,d)?"w":u&&"\n"==p?"n":!u||/\s/.test(p)?null:"p";if(!u||h||f||(f="s"),c&&c!=f){n<0&&(n=1,l(),t.sticky="after");break}if(f&&(c=f),n>0&&!l(!h))break}var g=ts(e,t,s,o,!0);return be(s,g)&&(g.hitSide=!0),g}function jo(e,t,n,i){var r,s,o=e.doc,a=t.left;if("page"==i){var l=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),c=Math.max(l-.5*ni(e.display),3);r=(n>0?t.bottom:t.top)+n*c}else"line"==i&&(r=n>0?t.bottom+3:t.top-3);for(;(s=Kn(e,a,r)).outside;){if(n<0?r<=0:r>=o.height){s.hitSide=!0;break}r+=5*n}return s}var Vo=function(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new U,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};function _o(e,t){var n=Nn(e,t.line);if(!n||n.hidden)return null;var i=le(e.doc,t.line),r=Mn(n,i,t.line),s=Ze(i,e.doc.direction),o="left";if(s){var a=Ke(s,t.ch);o=a%2?"right":"left"}var l=Vn(r.map,t.ch,o);return l.offset="right"==l.collapse?l.end:l.start,l}function Uo(e,t){return t&&(e.bad=!0),e}function Fo(e,t,n){var i;if(t==e.display.lineDiv){if(!(i=e.display.lineDiv.childNodes[n]))return Uo(e.clipPos(me(e.display.viewTo-1)),!0);t=null,n=0}else for(i=t;;i=i.parentNode){if(!i||i==e.display.lineDiv)return null;if(i.parentNode&&i.parentNode==e.display.lineDiv)break}for(var r=0;r<e.display.view.length;r++){var s=e.display.view[r];if(s.node==i)return zo(s,t,n)}}function zo(e,t,n){var i=e.text.firstChild,r=!1;if(!t||!I(i,t))return Uo(me(he(e.line),0),!0);if(t==i&&(r=!0,t=i.childNodes[n],n=0,!t)){var s=e.rest?J(e.rest):e.line;return Uo(me(he(s),s.text.length),r)}var o=3==t.nodeType?t:null,a=t;for(o||1!=t.childNodes.length||3!=t.firstChild.nodeType||(o=t.firstChild,n&&(n=o.nodeValue.length));a.parentNode!=i;)a=a.parentNode;var l=e.measure,c=l.maps;function u(t,n,i){for(var r=-1;r<(c?c.length:0);r++)for(var s=r<0?l.map:c[r],o=0;o<s.length;o+=3){var a=s[o+2];if(a==t||a==n){var u=he(r<0?e.line:e.rest[r]),d=s[o]+i;return(i<0||a!=t)&&(d=s[o+(i?1:0)]),me(u,d)}}}var d=u(o,a,n);if(d)return Uo(d,r);for(var h=a.nextSibling,p=o?o.nodeValue.length-n:0;h;h=h.nextSibling){if(d=u(h,h.firstChild,0))return Uo(me(d.line,d.ch-p),r);p+=h.textContent.length}for(var f=a.previousSibling,g=n;f;f=f.previousSibling){if(d=u(f,f.firstChild,-1))return Uo(me(d.line,d.ch+g),r);g+=f.textContent.length}}Vo.prototype.init=function(e){var t=this,n=this,i=n.cm,r=n.div=e.lineDiv;function s(e){if(!st(i,e)){if(i.somethingSelected())Eo({lineWise:!1,text:i.getSelections()}),"cut"==e.type&&i.replaceSelection("",null,"cut");else{if(!i.options.lineWiseCopyCut)return;var t=No(i);Eo({lineWise:!0,text:t.text}),"cut"==e.type&&i.operation(function(){i.setSelections(t.ranges,0,G),i.replaceSelection("",null,"cut")})}if(e.clipboardData){e.clipboardData.clearData();var s=ko.text.join("\n");if(e.clipboardData.setData("Text",s),e.clipboardData.getData("Text")==s)return void e.preventDefault()}var o=Ro(),a=o.firstChild;i.display.lineSpace.insertBefore(o,i.display.lineSpace.firstChild),a.value=ko.text.join("\n");var l=document.activeElement;P(a),setTimeout(function(){i.display.lineSpace.removeChild(o),l.focus(),l==r&&n.showPrimarySelection()},50)}}Do(r,i.options.spellcheck,i.options.autocorrect,i.options.autocapitalize),tt(r,"paste",function(e){st(i,e)||Mo(e,i)||a<=11&&setTimeout(Ji(i,function(){return t.updateFromDOM()}),20)}),tt(r,"compositionstart",function(e){t.composing={data:e.data,done:!1}}),tt(r,"compositionupdate",function(e){t.composing||(t.composing={data:e.data,done:!1})}),tt(r,"compositionend",function(e){t.composing&&(e.data!=t.composing.data&&t.readFromDOMSoon(),t.composing.done=!0)}),tt(r,"touchstart",function(){return n.forceCompositionEnd()}),tt(r,"input",function(){t.composing||t.readFromDOMSoon()}),tt(r,"copy",s),tt(r,"cut",s)},Vo.prototype.prepareSelection=function(){var e=di(this.cm,!1);return e.focus=this.cm.state.focused,e},Vo.prototype.showSelection=function(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},Vo.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},Vo.prototype.showPrimarySelection=function(){var e=this.getSelection(),t=this.cm,i=t.doc.sel.primary(),r=i.from(),s=i.to();if(t.display.viewTo==t.display.viewFrom||r.line>=t.display.viewTo||s.line<t.display.viewFrom)e.removeAllRanges();else{var o=Fo(t,e.anchorNode,e.anchorOffset),a=Fo(t,e.focusNode,e.focusOffset);if(!o||o.bad||!a||a.bad||0!=ve(xe(o,a),r)||0!=ve(we(o,a),s)){var l=t.display.view,c=r.line>=t.display.viewFrom&&_o(t,r)||{node:l[0].measure.map[2],offset:0},u=s.line<t.display.viewTo&&_o(t,s);if(!u){var d=l[l.length-1].measure,h=d.maps?d.maps[d.maps.length-1]:d.map;u={node:h[h.length-1],offset:h[h.length-2]-h[h.length-3]}}if(c&&u){var p,f=e.rangeCount&&e.getRangeAt(0);try{p=L(c.node,c.offset,u.offset,u.node)}catch(e){}p&&(!n&&t.state.focused?(e.collapse(c.node,c.offset),p.collapsed||(e.removeAllRanges(),e.addRange(p))):(e.removeAllRanges(),e.addRange(p)),f&&null==e.anchorNode?e.addRange(f):n&&this.startGracePeriod()),this.rememberSelection()}else e.removeAllRanges()}}},Vo.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation(function(){return e.cm.curOp.selectionChanged=!0})},20)},Vo.prototype.showMultipleSelections=function(e){E(this.cm.display.cursorDiv,e.cursors),E(this.cm.display.selectionDiv,e.selection)},Vo.prototype.rememberSelection=function(){var e=this.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},Vo.prototype.selectionInEditor=function(){var e=this.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return I(this.div,t)},Vo.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())},Vo.prototype.blur=function(){this.div.blur()},Vo.prototype.getField=function(){return this.div},Vo.prototype.supportsTouch=function(){return!0},Vo.prototype.receivedFocus=function(){var e=this;this.selectionInEditor()?this.pollSelection():Yi(this.cm,function(){return e.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,function t(){e.cm.state.focused&&(e.pollSelection(),e.polling.set(e.cm.options.pollInterval,t))})},Vo.prototype.selectionChanged=function(){var e=this.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},Vo.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var e=this.getSelection(),t=this.cm;if(m&&u&&this.cm.options.gutters.length&&function(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}(e.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var n=Fo(t,e.anchorNode,e.anchorOffset),i=Fo(t,e.focusNode,e.focusOffset);n&&i&&Yi(t,function(){Jr(t.doc,xr(n,i),G),(n.bad||i.bad)&&(t.curOp.selectionChanged=!0)})}}},Vo.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e,t,n,i=this.cm,r=i.display,s=i.doc.sel.primary(),o=s.from(),a=s.to();if(0==o.ch&&o.line>i.firstLine()&&(o=me(o.line-1,le(i.doc,o.line-1).length)),a.ch==le(i.doc,a.line).text.length&&a.line<i.lastLine()&&(a=me(a.line+1,0)),o.line<r.viewFrom||a.line>r.viewTo-1)return!1;o.line==r.viewFrom||0==(e=ci(i,o.line))?(t=he(r.view[0].line),n=r.view[0].node):(t=he(r.view[e].line),n=r.view[e-1].node.nextSibling);var l,c,u=ci(i,a.line);if(u==r.view.length-1?(l=r.viewTo-1,c=r.lineDiv.lastChild):(l=he(r.view[u+1].line)-1,c=r.view[u+1].node.previousSibling),!n)return!1;for(var d=i.doc.splitLines(function(e,t,n,i,r){var s="",o=!1,a=e.doc.lineSeparator(),l=!1;function c(){o&&(s+=a,l&&(s+=a),o=l=!1)}function u(e){e&&(c(),s+=e)}function d(t){if(1==t.nodeType){var n=t.getAttribute("cm-text");if(n)return void u(n);var s,h=t.getAttribute("cm-marker");if(h){var p=e.findMarks(me(i,0),me(r+1,0),(m=+h,function(e){return e.id==m}));return void(p.length&&(s=p[0].find(0))&&u(ce(e.doc,s.from,s.to).join(a)))}if("false"==t.getAttribute("contenteditable"))return;var f=/^(pre|div|p|li|table|br)$/i.test(t.nodeName);if(!/^br$/i.test(t.nodeName)&&0==t.textContent.length)return;f&&c();for(var g=0;g<t.childNodes.length;g++)d(t.childNodes[g]);/^(pre|p)$/i.test(t.nodeName)&&(l=!0),f&&(o=!0)}else 3==t.nodeType&&u(t.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "));var m}for(;d(t),t!=n;)t=t.nextSibling,l=!1;return s}(i,n,c,t,l)),h=ce(i.doc,me(t,0),me(l,le(i.doc,l).text.length));d.length>1&&h.length>1;)if(J(d)==J(h))d.pop(),h.pop(),l--;else{if(d[0]!=h[0])break;d.shift(),h.shift(),t++}for(var p=0,f=0,g=d[0],m=h[0],v=Math.min(g.length,m.length);p<v&&g.charCodeAt(p)==m.charCodeAt(p);)++p;for(var b=J(d),y=J(h),w=Math.min(b.length-(1==d.length?p:0),y.length-(1==h.length?p:0));f<w&&b.charCodeAt(b.length-f-1)==y.charCodeAt(y.length-f-1);)++f;if(1==d.length&&1==h.length&&t==o.line)for(;p&&p>o.ch&&b.charCodeAt(b.length-f-1)==y.charCodeAt(y.length-f-1);)p--,f++;d[d.length-1]=b.slice(0,b.length-f).replace(/^\u200b+/,""),d[0]=d[0].slice(p).replace(/\u200b+$/,"");var x=me(t,p),S=me(l,h.length?J(h).length-f:0);return d.length>1||d[0]||ve(x,S)?(us(i.doc,d,x,S,"+input"),!0):void 0},Vo.prototype.ensurePolled=function(){this.forceCompositionEnd()},Vo.prototype.reset=function(){this.forceCompositionEnd()},Vo.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},Vo.prototype.readFromDOMSoon=function(){var e=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){if(e.readDOMTimeout=null,e.composing){if(!e.composing.done)return;e.composing=null}e.updateFromDOM()},80))},Vo.prototype.updateFromDOM=function(){var e=this;!this.cm.isReadOnly()&&this.pollContent()||Yi(this.cm,function(){return Qi(e.cm)})},Vo.prototype.setUneditable=function(e){e.contentEditable="false"},Vo.prototype.onKeyPress=function(e){0==e.charCode||this.composing||(e.preventDefault(),this.cm.isReadOnly()||Ji(this.cm,Ao)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))},Vo.prototype.readOnlyChanged=function(e){this.div.contentEditable=String("nocursor"!=e)},Vo.prototype.onContextMenu=function(){},Vo.prototype.resetPosition=function(){},Vo.prototype.needsContentAttribute=!0;var Bo=function(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new U,this.hasSelection=!1,this.composing=null};Bo.prototype.init=function(e){var t=this,n=this,i=this.cm;this.createField(e);var r=this.textarea;function s(e){if(!st(i,e)){if(i.somethingSelected())Eo({lineWise:!1,text:i.getSelections()});else{if(!i.options.lineWiseCopyCut)return;var t=No(i);Eo({lineWise:!0,text:t.text}),"cut"==e.type?i.setSelections(t.ranges,null,G):(n.prevInput="",r.value=t.text.join("\n"),P(r))}"cut"==e.type&&(i.state.cutIncoming=+new Date)}}e.wrapper.insertBefore(this.wrapper,e.wrapper.firstChild),g&&(r.style.width="0px"),tt(r,"input",function(){o&&a>=9&&t.hasSelection&&(t.hasSelection=null),n.poll()}),tt(r,"paste",function(e){st(i,e)||Mo(e,i)||(i.state.pasteIncoming=+new Date,n.fastPoll())}),tt(r,"cut",s),tt(r,"copy",s),tt(e.scroller,"paste",function(t){if(!Cn(e,t)&&!st(i,t)){if(!r.dispatchEvent)return i.state.pasteIncoming=+new Date,void n.focus();var s=new Event("paste");s.clipboardData=t.clipboardData,r.dispatchEvent(s)}}),tt(e.lineSpace,"selectstart",function(t){Cn(e,t)||ct(t)}),tt(r,"compositionstart",function(){var e=i.getCursor("from");n.composing&&n.composing.range.clear(),n.composing={start:e,range:i.markText(e,i.getCursor("to"),{className:"CodeMirror-composing"})}}),tt(r,"compositionend",function(){n.composing&&(n.poll(),n.composing.range.clear(),n.composing=null)})},Bo.prototype.createField=function(e){this.wrapper=Ro(),this.textarea=this.wrapper.firstChild},Bo.prototype.prepareSelection=function(){var e=this.cm,t=e.display,n=e.doc,i=di(e);if(e.options.moveInputWithCursor){var r=Yn(e,n.sel.primary().head,"div"),s=t.wrapper.getBoundingClientRect(),o=t.lineDiv.getBoundingClientRect();i.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,r.top+o.top-s.top)),i.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,r.left+o.left-s.left))}return i},Bo.prototype.showSelection=function(e){var t=this.cm,n=t.display;E(n.cursorDiv,e.cursors),E(n.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},Bo.prototype.reset=function(e){if(!this.contextMenuPending&&!this.composing){var t=this.cm;if(t.somethingSelected()){this.prevInput="";var n=t.getSelection();this.textarea.value=n,t.state.focused&&P(this.textarea),o&&a>=9&&(this.hasSelection=n)}else e||(this.prevInput=this.textarea.value="",o&&a>=9&&(this.hasSelection=null))}},Bo.prototype.getField=function(){return this.textarea},Bo.prototype.supportsTouch=function(){return!1},Bo.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!v||N()!=this.textarea))try{this.textarea.focus()}catch(e){}},Bo.prototype.blur=function(){this.textarea.blur()},Bo.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},Bo.prototype.receivedFocus=function(){this.slowPoll()},Bo.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){e.poll(),e.cm.state.focused&&e.slowPoll()})},Bo.prototype.fastPoll=function(){var e=!1,t=this;t.pollingFast=!0,t.polling.set(20,function n(){var i=t.poll();i||e?(t.pollingFast=!1,t.slowPoll()):(e=!0,t.polling.set(60,n))})},Bo.prototype.poll=function(){var e=this,t=this.cm,n=this.textarea,i=this.prevInput;if(this.contextMenuPending||!t.state.focused||St(n)&&!i&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var r=n.value;if(r==i&&!t.somethingSelected())return!1;if(o&&a>=9&&this.hasSelection===r||b&&/[\uf700-\uf7ff]/.test(r))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var s=r.charCodeAt(0);if(8203!=s||i||(i=""),8666==s)return this.reset(),this.cm.execCommand("undo")}for(var l=0,c=Math.min(i.length,r.length);l<c&&i.charCodeAt(l)==r.charCodeAt(l);)++l;return Yi(t,function(){Ao(t,r.slice(l),i.length-l,null,e.composing?"*compose":null),r.length>1e3||r.indexOf("\n")>-1?n.value=e.prevInput="":e.prevInput=r,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},Bo.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},Bo.prototype.onKeyPress=function(){o&&a>=9&&(this.hasSelection=null),this.fastPoll()},Bo.prototype.onContextMenu=function(e){var t=this,n=t.cm,i=n.display,r=t.textarea;t.contextMenuPending&&t.contextMenuPending();var s=li(n,e),c=i.scroller.scrollTop;if(s&&!d){var u=n.options.resetSelectionOnContextMenu;u&&-1==n.doc.sel.contains(s)&&Ji(n,Jr)(n.doc,xr(s),G);var h,p=r.style.cssText,f=t.wrapper.style.cssText,g=t.wrapper.offsetParent.getBoundingClientRect();if(t.wrapper.style.cssText="position: static",r.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-g.top-5)+"px; left: "+(e.clientX-g.left-5)+"px;\n      z-index: 1000; background: "+(o?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",l&&(h=window.scrollY),i.input.focus(),l&&window.scrollTo(null,h),i.input.reset(),n.somethingSelected()||(r.value=t.prevInput=" "),t.contextMenuPending=b,i.selForContextMenu=n.doc.sel,clearTimeout(i.detectingSelectAll),o&&a>=9&&v(),C){ht(e);var m=function(){it(window,"mouseup",m),setTimeout(b,20)};tt(window,"mouseup",m)}else setTimeout(b,50)}function v(){if(null!=r.selectionStart){var e=n.somethingSelected(),s=""+(e?r.value:"");r.value="",r.value=s,t.prevInput=e?"":"",r.selectionStart=1,r.selectionEnd=s.length,i.selForContextMenu=n.doc.sel}}function b(){if(t.contextMenuPending==b&&(t.contextMenuPending=!1,t.wrapper.style.cssText=f,r.style.cssText=p,o&&a<9&&i.scrollbars.setScrollTop(i.scroller.scrollTop=c),null!=r.selectionStart)){(!o||o&&a<9)&&v();var e=0,s=function(){i.selForContextMenu==n.doc.sel&&0==r.selectionStart&&r.selectionEnd>0&&""==t.prevInput?Ji(n,is)(n):e++<10?i.detectingSelectAll=setTimeout(s,500):(i.selForContextMenu=null,i.input.reset())};i.detectingSelectAll=setTimeout(s,200)}}},Bo.prototype.readOnlyChanged=function(e){e||this.reset(),this.textarea.disabled="nocursor"==e},Bo.prototype.setUneditable=function(){},Bo.prototype.needsContentAttribute=!1,function(e){var t=e.optionHandlers;function n(n,i,r,s){e.defaults[n]=i,r&&(t[n]=s?function(e,t,n){n!=bo&&r(e,t,n)}:r)}e.defineOption=n,e.Init=bo,n("value","",function(e,t){return e.setValue(t)},!0),n("mode",null,function(e,t){e.doc.modeOption=t,Tr(e)},!0),n("indentUnit",2,Tr,!0),n("indentWithTabs",!1),n("smartIndent",!0),n("tabSize",4,function(e){kr(e),zn(e),Qi(e)},!0),n("lineSeparator",null,function(e,t){if(e.doc.lineSep=t,t){var n=[],i=e.doc.first;e.doc.iter(function(e){for(var r=0;;){var s=e.text.indexOf(t,r);if(-1==s)break;r=s+t.length,n.push(me(i,s))}i++});for(var r=n.length-1;r>=0;r--)us(e.doc,t,n[r],me(n[r].line,n[r].ch+t.length))}}),n("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(e,t,n){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),n!=bo&&e.refresh()}),n("specialCharPlaceholder",Zt,function(e){return e.refresh()},!0),n("electricChars",!0),n("inputStyle",v?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),n("spellcheck",!1,function(e,t){return e.getInputField().spellcheck=t},!0),n("autocorrect",!1,function(e,t){return e.getInputField().autocorrect=t},!0),n("autocapitalize",!1,function(e,t){return e.getInputField().autocapitalize=t},!0),n("rtlMoveVisually",!w),n("wholeLineUpdateBefore",!0),n("theme","default",function(e){vo(e),xo(e)},!0),n("keyMap","default",function(e,t,n){var i=$s(t),r=n!=bo&&$s(n);r&&r.detach&&r.detach(e,i),i.attach&&i.attach(e,r||null)}),n("extraKeys",null),n("configureMouse",null),n("lineWrapping",!1,Co,!0),n("gutters",[],function(e){hr(e.options),xo(e)},!0),n("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?si(e.display)+"px":"0",e.refresh()},!0),n("coverGutterNextToScrollbar",!1,function(e){return Vi(e)},!0),n("scrollbarStyle","native",function(e){Fi(e),Vi(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)},!0),n("lineNumbers",!1,function(e){hr(e.options),xo(e)},!0),n("firstLineNumber",1,xo,!0),n("lineNumberFormatter",function(e){return e},xo,!0),n("showCursorWhenSelecting",!1,ui,!0),n("resetSelectionOnContextMenu",!0),n("lineWiseCopyCut",!0),n("pasteLinesPerSelection",!0),n("selectionsMayTouch",!1),n("readOnly",!1,function(e,t){"nocursor"==t&&(yi(e),e.display.input.blur()),e.display.input.readOnlyChanged(t)}),n("disableInput",!1,function(e,t){t||e.display.input.reset()},!0),n("dragDrop",!0,So),n("allowDropFileTypes",null),n("cursorBlinkRate",530),n("cursorScrollMargin",0),n("cursorHeight",1,ui,!0),n("singleCursorHeightPerLine",!0,ui,!0),n("workTime",100),n("workDelay",100),n("flattenSpans",!0,kr,!0),n("addModeClass",!1,kr,!0),n("pollInterval",100),n("undoDepth",200,function(e,t){return e.doc.history.undoDepth=t}),n("historyEventDelay",1250),n("viewportMargin",10,function(e){return e.refresh()},!0),n("maxHighlightLength",1e4,kr,!0),n("moveInputWithCursor",!0,function(e,t){t||e.display.input.resetPosition()}),n("tabindex",null,function(e,t){return e.display.input.getField().tabIndex=t||""}),n("autofocus",null),n("direction","ltr",function(e,t){return e.doc.setDirection(t)},!0),n("phrases",null)}(Oo),function(e){var t=e.optionHandlers,n=e.helpers={};e.prototype={constructor:e,focus:function(){window.focus(),this.display.input.focus()},setOption:function(e,n){var i=this.options,r=i[e];i[e]==n&&"mode"!=e||(i[e]=n,t.hasOwnProperty(e)&&Ji(this,t[e])(this,n,r),rt(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"]($s(e))},removeKeyMap:function(e){for(var t=this.state.keyMaps,n=0;n<t.length;++n)if(t[n]==e||t[n].name==e)return t.splice(n,1),!0},addOverlay:Xi(function(t,n){var i=t.token?t:e.getMode(this.options,t);if(i.startState)throw new Error("Overlays may not be stateful.");!function(e,t,n){for(var i=0,r=n(t);i<e.length&&n(e[i])<=r;)i++;e.splice(i,0,t)}(this.state.overlays,{mode:i,modeSpec:t,opaque:n&&n.opaque,priority:n&&n.priority||0},function(e){return e.priority}),this.state.modeGen++,Qi(this)}),removeOverlay:Xi(function(e){for(var t=this.state.overlays,n=0;n<t.length;++n){var i=t[n].modeSpec;if(i==e||"string"==typeof e&&i.name==e)return t.splice(n,1),this.state.modeGen++,void Qi(this)}}),indentLine:Xi(function(e,t,n){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),fe(this.doc,e)&&To(this,e,t,n)}),indentSelection:Xi(function(e){for(var t=this.doc.sel.ranges,n=-1,i=0;i<t.length;i++){var r=t[i];if(r.empty())r.head.line>n&&(To(this,r.head.line,e,!0),n=r.head.line,i==this.doc.sel.primIndex&&ki(this));else{var s=r.from(),o=r.to(),a=Math.max(n,s.line);n=Math.min(this.lastLine(),o.line-(o.ch?0:1))+1;for(var l=a;l<n;++l)To(this,l,e);var c=this.doc.sel.ranges;0==s.ch&&t.length==c.length&&c[i].from().ch>0&&Hr(this.doc,i,new yr(s,c[i].to()),G)}}}),getTokenAt:function(e,t){return Wt(this,e,t)},getLineTokens:function(e,t){return Wt(this,me(e),t,!0)},getTokenTypeAt:function(e){e=Ce(this.doc,e);var t,n=_t(this,le(this.doc,e.line)),i=0,r=(n.length-1)/2,s=e.ch;if(0==s)t=n[2];else for(;;){var o=i+r>>1;if((o?n[2*o-1]:0)>=s)r=o;else{if(!(n[2*o+1]<s)){t=n[2*o+2];break}i=o+1}}var a=t?t.indexOf("overlay "):-1;return a<0?t:0==a?null:t.slice(0,a-1)},getModeAt:function(t){var n=this.doc.mode;return n.innerMode?e.innerMode(n,this.getTokenAt(t).state).mode:n},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var i=[];if(!n.hasOwnProperty(t))return i;var r=n[t],s=this.getModeAt(e);if("string"==typeof s[t])r[s[t]]&&i.push(r[s[t]]);else if(s[t])for(var o=0;o<s[t].length;o++){var a=r[s[t][o]];a&&i.push(a)}else s.helperType&&r[s.helperType]?i.push(r[s.helperType]):r[s.name]&&i.push(r[s.name]);for(var l=0;l<r._global.length;l++){var c=r._global[l];c.pred(s,this)&&-1==F(i,c.val)&&i.push(c.val)}return i},getStateAfter:function(e,t){var n=this.doc;return Ut(this,(e=Se(n,null==e?n.first+n.size-1:e))+1,t).state},cursorCoords:function(e,t){var n=this.doc.sel.primary();return Yn(this,null==e?n.head:"object"==typeof e?Ce(this.doc,e):e?n.from():n.to(),t||"page")},charCoords:function(e,t){return qn(this,Ce(this.doc,e),t||"page")},coordsChar:function(e,t){return Kn(this,(e=Hn(this,e,t||"page")).left,e.top)},lineAtHeight:function(e,t){return e=Hn(this,{top:e,left:0},t||"page").top,pe(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,n){var i,r=!1;if("number"==typeof e){var s=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>s&&(e=s,r=!0),i=le(this.doc,e)}else i=e;return $n(this,i,{top:0,left:0},t||"page",n||r).top+(r?this.doc.height-qe(i):0)},defaultTextHeight:function(){return ni(this.display)},defaultCharWidth:function(){return ii(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,n,i,r){var s,o,a,l=this.display,c=(e=Yn(this,Ce(this.doc,e))).bottom,u=e.left;if(t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),l.sizer.appendChild(t),"over"==i)c=e.top;else if("above"==i||"near"==i){var d=Math.max(l.wrapper.clientHeight,this.doc.height),h=Math.max(l.sizer.clientWidth,l.lineSpace.clientWidth);("above"==i||e.bottom+t.offsetHeight>d)&&e.top>t.offsetHeight?c=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=d&&(c=e.bottom),u+t.offsetWidth>h&&(u=h-t.offsetWidth)}t.style.top=c+"px",t.style.left=t.style.right="","right"==r?(u=l.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==r?u=0:"middle"==r&&(u=(l.sizer.clientWidth-t.offsetWidth)/2),t.style.left=u+"px"),n&&(s=this,o={left:u,top:c,right:u+t.offsetWidth,bottom:c+t.offsetHeight},null!=(a=Li(s,o)).scrollTop&&Ii(s,a.scrollTop),null!=a.scrollLeft&&Di(s,a.scrollLeft))},triggerOnKeyDown:Xi(so),triggerOnKeyPress:Xi(ao),triggerOnKeyUp:oo,triggerOnMouseDown:Xi(ho),execCommand:function(e){if(Xs.hasOwnProperty(e))return Xs[e].call(null,this)},triggerElectric:Xi(function(e){Io(this,e)}),findPosH:function(e,t,n,i){var r=1;t<0&&(r=-1,t=-t);for(var s=Ce(this.doc,e),o=0;o<t&&!(s=Po(this.doc,s,r,n,i)).hitSide;++o);return s},moveH:Xi(function(e,t){var n=this;this.extendSelectionsBy(function(i){return n.display.shift||n.doc.extend||i.empty()?Po(n.doc,i.head,e,t,n.options.rtlMoveVisually):e<0?i.from():i.to()},$)}),deleteH:Xi(function(e,t){var n=this.doc.sel,i=this.doc;n.somethingSelected()?i.replaceSelection("",null,"+delete"):Hs(this,function(n){var r=Po(i,n.head,e,t,!1);return e<0?{from:r,to:n.head}:{from:n.head,to:r}})}),findPosV:function(e,t,n,i){var r=1,s=i;t<0&&(r=-1,t=-t);for(var o=Ce(this.doc,e),a=0;a<t;++a){var l=Yn(this,o,"div");if(null==s?s=l.left:l.left=s,(o=jo(this,l,r,n)).hitSide)break}return o},moveV:Xi(function(e,t){var n=this,i=this.doc,r=[],s=!this.display.shift&&!i.extend&&i.sel.somethingSelected();if(i.extendSelectionsBy(function(o){if(s)return e<0?o.from():o.to();var a=Yn(n,o.head,"div");null!=o.goalColumn&&(a.left=o.goalColumn),r.push(a.left);var l=jo(n,a,e,t);return"page"==t&&o==i.sel.primary()&&Ti(n,qn(n,l,"div").top-a.top),l},$),r.length)for(var o=0;o<i.sel.ranges.length;o++)i.sel.ranges[o].goalColumn=r[o]}),findWordAt:function(e){var t=this.doc,n=le(t,e.line).text,i=e.ch,r=e.ch;if(n){var s=this.getHelper(e,"wordChars");"before"!=e.sticky&&r!=n.length||!i?++r:--i;for(var o=n.charAt(i),a=te(o,s)?function(e){return te(e,s)}:/\s/.test(o)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!te(e)};i>0&&a(n.charAt(i-1));)--i;for(;r<n.length&&a(n.charAt(r));)++r}return new yr(me(e.line,i),me(e.line,r))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?D(this.display.cursorDiv,"CodeMirror-overwrite"):T(this.display.cursorDiv,"CodeMirror-overwrite"),rt(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==N()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:Xi(function(e,t){Ei(this,e,t)}),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-kn(this)-this.display.barHeight,width:e.scrollWidth-kn(this)-this.display.barWidth,clientHeight:An(this),clientWidth:En(this)}},scrollIntoView:Xi(function(e,t){null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:me(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?function(e,t){Ai(e),e.curOp.scrollToPos=t}(this,e):Mi(this,e.from,e.to,e.margin)}),setSize:Xi(function(e,t){var n=this,i=function(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e};null!=e&&(this.display.wrapper.style.width=i(e)),null!=t&&(this.display.wrapper.style.height=i(t)),this.options.lineWrapping&&Fn(this);var r=this.display.viewFrom;this.doc.iter(r,this.display.viewTo,function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){Zi(n,r,"widget");break}++r}),this.curOp.forceUpdate=!0,rt(this,"refresh",this)}),operation:function(e){return Yi(this,e)},startOperation:function(){return Bi(this)},endOperation:function(){return Gi(this)},refresh:Xi(function(){var e=this.display.cachedTextHeight;Qi(this),this.curOp.forceUpdate=!0,zn(this),Ei(this,this.doc.scrollLeft,this.doc.scrollTop),cr(this),(null==e||Math.abs(e-ni(this.display))>.5)&&ai(this),rt(this,"refresh",this)}),swapDoc:Xi(function(e){var t=this.doc;return t.cm=null,Ir(this,e),zn(this),this.display.input.reset(),Ei(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,cn(this,"swapDoc",this,t),t}),phrase:function(e){var t=this.options.phrases;return t&&Object.prototype.hasOwnProperty.call(t,e)?t[e]:e},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},lt(e),e.registerHelper=function(t,i,r){n.hasOwnProperty(t)||(n[t]=e[t]={_global:[]}),n[t][i]=r},e.registerGlobalHelper=function(t,i,r,s){e.registerHelper(t,i,s),n[t]._global.push({pred:r,val:s})}}(Oo);var Go="iter insert remove copy getEditor constructor".split(" ");for(var Wo in Ts.prototype)Ts.prototype.hasOwnProperty(Wo)&&F(Go,Wo)<0&&(Oo.prototype[Wo]=function(e){return function(){return e.apply(this.doc,arguments)}}(Ts.prototype[Wo]));return lt(Ts),Oo.inputStyles={textarea:Bo,contenteditable:Vo},Oo.defineMode=function(e){Oo.defaults.mode||"null"==e||(Oo.defaults.mode=e),function(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),Lt[e]=t}.apply(this,arguments)},Oo.defineMIME=function(e,t){Tt[e]=t},Oo.defineMode("null",function(){return{token:function(e){return e.skipToEnd()}}}),Oo.defineMIME("text/plain","null"),Oo.defineExtension=function(e,t){Oo.prototype[e]=t},Oo.defineDocExtension=function(e,t){Ts.prototype[e]=t},Oo.fromTextArea=function(e,t){if((t=t?V(t):{}).value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){var n=N();t.autofocus=n==e||null!=e.getAttribute("autofocus")&&n==document.body}function i(){e.value=a.getValue()}var r;if(e.form&&(tt(e.form,"submit",i),!t.leaveSubmitMethodAlone)){var s=e.form;r=s.submit;try{var o=s.submit=function(){i(),s.submit=r,s.submit(),s.submit=o}}catch(e){}}t.finishInit=function(t){t.save=i,t.getTextArea=function(){return e},t.toTextArea=function(){t.toTextArea=isNaN,i(),e.parentNode.removeChild(t.getWrapperElement()),e.style.display="",e.form&&(it(e.form,"submit",i),"function"==typeof e.form.submit&&(e.form.submit=r))}},e.style.display="none";var a=Oo(function(t){return e.parentNode.insertBefore(t,e.nextSibling)},t);return a},function(e){e.off=it,e.on=tt,e.wheelEventPixels=mr,e.Doc=Ts,e.splitLines=xt,e.countColumn=_,e.findColumn=H,e.isWordChar=ee,e.Pass=B,e.signal=rt,e.Line=qt,e.changeEnd=Sr,e.scrollbarModel=Ui,e.Pos=me,e.cmpPos=ve,e.modes=Lt,e.mimeModes=Tt,e.resolveMode=kt,e.getMode=Et,e.modeExtensions=At,e.extendMode=Mt,e.copyState=It,e.startState=Dt,e.innerMode=Nt,e.commands=Xs,e.keyMap=_s,e.keyName=Ws,e.isModifierKey=Bs,e.lookupKey=zs,e.normalizeKeyMap=Fs,e.StringStream=Rt,e.SharedTextMarker=Ss,e.TextMarker=ws,e.LineWidget=vs,e.e_preventDefault=ct,e.e_stopPropagation=ut,e.e_stop=ht,e.addClass=D,e.contains=I,e.rmClass=T,e.keyNames=Rs}(Oo),Oo.version="5.45.0",Oo}()},function(e,t,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function i(e=128){const t=Math.ceil(e/32),n=new Uint32Array(t);crypto.getRandomValues(n);let i="";for(let e=0;e<t;++e)i+=("00000000"+n[e].toString(16)).slice(-8);return i}function r(e){let t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);for(let e=0,n=t.length;e<n;e+=65536)crypto.getRandomValues(t.subarray(e,Math.min(n,e+65536)));return e}function s(){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}n.d(t,"a",function(){return i}),n.d(t,"c",function(){return r}),n.d(t,"b",function(){return s})},function(e,t,n){"use strict";n.d(t,"d",function(){return r}),n.d(t,"c",function(){return s}),n.d(t,"j",function(){return o}),n.d(t,"f",function(){return a}),n.d(t,"g",function(){return l}),n.d(t,"b",function(){return c}),n.d(t,"a",function(){return u}),n.d(t,"k",function(){return d}),n.d(t,"e",function(){return h}),n.d(t,"h",function(){return p}),n.d(t,"i",function(){return f});var i=n(27);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r="annotation.MetadataChunkSource",s="annotation.GeometryChunkSource",o="annotation.SubsetGeometryChunkSource",a="annotation.reference.add",l="annotation.reference.delete",c="annotation.commit",u="annotation.commit";class d extends i.i{}const h="annotation/PerspectiveRenderLayer",p="annotation/RenderLayer",f="annotation/RenderLayer.updateSegmentation"},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"d",function(){return r}),n.d(t,"a",function(){return s}),n.d(t,"c",function(){return o}),n.d(t,"e",function(){return a});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const i="mesh/MeshLayer",r="mesh/MultiscaleMeshLayer",s="mesh/FragmentSource",o="mesh/MultiscaleFragmentSource";var a;!function(e){e[e.float32=0]="float32",e[e.uint10=1]="uint10",e[e.uint16=2]="uint16"}(a||(a={}))},function(e,t,n){"use strict";n.d(t,"c",function(){return c}),n.d(t,"d",function(){return u}),n.d(t,"a",function(){return h}),n.d(t,"b",function(){return m});var i=n(9),r=n(2),s=n(1),o=n(80);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const a=[1.5,2,3,5,7.5,10],l=[{unit:"km",lengthInNanometers:1e12},{unit:"m",lengthInNanometers:1e9},{unit:"mm",lengthInNanometers:1e6},{unit:"m",lengthInNanometers:1e3},{unit:"nm",lengthInNanometers:1},{unit:"pm",lengthInNanometers:.001}];function c(e){const t=l.length;let n=l[t-1];for(let i=0;i<t;++i){const t=l[i];if(e>=t.lengthInNanometers){n=t;break}}return n}function u(e){const t=l.length;let n=l[t-1];for(let i=0;i<t;++i){const t=l[i];if(e>=Math.pow(t.lengthInNanometers,3)){n=t;break}}return n}class d{constructor(){this.allowedSignificands=a,this.targetLengthInPixels=0,this.nanometersPerPixel=0,this.prevNanometersPerPixel=0,this.prevTargetLengthInPixels=0}update(){let{nanometersPerPixel:e,targetLengthInPixels:t}=this;if(this.prevNanometersPerPixel===e&&this.prevTargetLengthInPixels===t)return!1;this.prevNanometersPerPixel=e,this.prevTargetLengthInPixels=t;const n=t*e,i=Math.floor(Math.log(n)/Math.LN10),r=Math.pow(10,i),s=n/r;let o=1;for(let e of this.allowedSignificands){if(!(Math.abs(e-s)<Math.abs(o-s)))break;o=e}const a=o*r,l=c(a);return this.lengthInPixels=Math.round(a/e),this.physicalUnit=l.unit,this.physicalLength=a/l.lengthInNanometers,!0}}class h extends r.a{constructor(e,t=new d){super(),this.gl=e,this.dimensions=t,this.texture=null,this.width=0,this.height=0,this.priorOptions=void 0}update(e){let{dimensions:t}=this,{texture:n}=this;if(!t.update()&&null!==n&&e===this.priorOptions)return;null===n&&(n=this.texture=this.gl.createTexture());const{width:i,height:r}=function(e,t,n,i=p){const r=document.createElement("canvas"),s=r.getContext("2d"),a=i.textHeightInPixels*i.scaleFactor,l=`bold ${a}px ${i.fontName}`;s.font=l,s.fillStyle="white";const c=`${e.physicalLength} ${e.physicalUnit}`,u=s.measureText(c),d=Math.max(e.lengthInPixels,u.width),h=i.barHeightInPixels*i.scaleFactor,f=i.barTopMarginInPixels*i.scaleFactor,g=h+f+a,m=i.paddingInPixels*i.scaleFactor,v=g+2*m,b=d+2*m;return r.width=b,r.height=v,s.font=l,s.textAlign="center",s.fillStyle="rgba(0, 0, 0, 0.3)",s.fillRect(0,0,b,v),s.fillStyle="white",s.fillText(c,b/2,v-m-h-f),s.fillRect(m,v-m-h,e.lengthInPixels,h),Object(o.d)(t,n,r),{width:b,height:v}}(t,this.gl,n,e);this.priorOptions=e,this.width=i,this.height=r}disposed(){this.gl.deleteTexture(this.texture),this.texture=null,super.disposed()}}const p={scaleFactor:1,textHeightInPixels:15,barHeightInPixels:8,barTopMarginInPixels:5,fontName:"sans-serif",paddingInPixels:2},f=Object.assign({},p,{maxWidthInPixels:100,maxWidthFraction:.25,leftPixelOffset:10,bottomPixelOffset:10});function g(e){const t=Object.assign({},f);for(const n of["textHeightInPixels","barTopMarginInPixels","barHeightInPixels","paddingInPixels","scaleFactor","maxWidthInPixels","maxWidthFraction","leftPixelOffset","bottomPixelOffset"])Object(s.v)(e,n,e=>{void 0!==e&&(t[n]=Object(s.p)(e))});return Object(s.v)(e,"fontName",e=>{void 0!==e&&(t.fontName=Object(s.A)(e))}),t}class m extends i.c{constructor(){super(f,g)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(2),r=n(10);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(169);class s extends i.a{constructor(e,{min:t=0,max:n=1,step:i=.01}={}){super(),this.value=e,this.element=document.createElement("label"),this.promptElement=document.createElement("span"),this.inputElement=document.createElement("input");let{element:r,promptElement:s,inputElement:o}=this;r.className="range-slider",s.className="range-prompt",o.type="range",o.min=""+t,o.max=""+n,o.step=""+i,o.valueAsNumber=this.value.value,r.appendChild(s),r.appendChild(o);const a=()=>{this.value.value=this.inputElement.valueAsNumber};this.registerEventListener(o,"change",a),this.registerEventListener(o,"input",a),this.registerEventListener(o,"wheel",e=>{let{deltaY:t}=e;t>0?(this.inputElement.stepUp(),a()):t<0&&(this.inputElement.stepDown(),a())}),e.changed.add(()=>{this.inputElement.valueAsNumber=this.value.value})}disposed(){Object(r.b)(this.element),super.disposed()}}},function(e,t,n){"use strict";var i=n(5),r=n(11),s=n(61),o=n(39),a=n(44);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const l="skeleton/SkeletonLayer";var c=n(72),u=n(9),d=n(12),h=n(2),p=n(0),f=n(1),g=n(3),m=n(48),v=n(105),b=n(19),y=n(64),w=n(82),x=n(46),S=n(68),C=n(21);n.d(t,"a",function(){return T}),n.d(t,"d",function(){return D}),n.d(t,"c",function(){return R}),n.d(t,"b",function(){return P}),n.d(t,"f",function(){return j}),n.d(t,"e",function(){return z});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const O=p.m.create(),L="void main() {\n  emitDefault();\n}\n",T="//NEUROGLANCER_SKELETON_LAYER_FRAGMENT_MAIN_START";const k=[],E=Object(C.e)(new C.b,d.b.FLOAT32,3);class A extends h.a{constructor(e,t){super(),this.base=e,this.targetIsSliceView=t,this.textureAccessHelper=new C.a("vertexData"),this.lineShader=this.registerDisposer(new S.a(this.gl,1)),this.circleShader=this.registerDisposer(new y.a(this.gl,2)),this.edgeShaderGetter=Object(x.d)(this,this.gl,{type:"skeleton/SkeletonShaderManager/edge",vertexAttributes:this.vertexAttributes},this.base.fallbackFragmentMain,this.base.displayState.skeletonRenderingOptions.shader,this.base.displayState.shaderError,(e,t)=>{this.defineAttributeAccess(e),this.lineShader.defineShader(e),e.addAttribute("highp uvec2","aVertexIndex"),this.defineCommonShader(e);let n="\nhighp vec3 vertexA = readAttribute0(aVertexIndex.x);\nhighp vec3 vertexB = readAttribute0(aVertexIndex.y);\nemitLine(uProjection, vertexA, vertexB);\nhighp uint lineEndpointIndex = getLineEndpointIndex();\nhighp uint vertexIndex = aVertexIndex.x * lineEndpointIndex + aVertexIndex.y * (1u - lineEndpointIndex);\n";e.addFragmentCode(`\nvec4 segmentColor() {\n  return uColor;\n}\nvoid emitRGB(vec3 color) {\n  emit(vec4(color * uColor.a, uColor.a * getLineAlpha() * ${this.getCrossSectionFadeFactor()}), uPickID);\n}\nvoid emitDefault() {\n  //emit(vec4(uColor.rgb, uColor.a * ${this.getCrossSectionFadeFactor()}), uPickID);\n  emit(vec4(uColor.rgb, uColor.a * getLineAlpha() * ${this.getCrossSectionFadeFactor()}), uPickID);\n}\n`),e.addFragmentCode(w.a);const{vertexAttributes:i}=this,r=i.length;for(let t=1;t<r;++t){const r=i[t];e.addVarying(`highp ${r.glslDataType}`,`vCustom${t}`),n+=`vCustom${t} = readAttribute${t}(vertexIndex);\n`,e.addFragmentCode(`#define ${r.name} vCustom${t}\n`)}e.setVertexMain(n),e.setFragmentMainFunction(T+"\n"+t)}),this.nodeShaderGetter=Object(x.d)(this,this.gl,{type:"skeleton/SkeletonShaderManager/node",vertexAttributes:this.vertexAttributes},this.base.fallbackFragmentMain,this.base.displayState.skeletonRenderingOptions.shader,this.base.displayState.shaderError,(e,t)=>{this.defineAttributeAccess(e),this.circleShader.defineShader(e,this.targetIsSliceView),this.defineCommonShader(e);let n="\nhighp uint vertexIndex = uint(gl_InstanceID);\nhighp vec3 vertexPosition = readAttribute0(vertexIndex);\nemitCircle(uProjection * vec4(vertexPosition, 1.0));\n";e.addFragmentCode("\nvec4 segmentColor() {\n  return uColor;\n}\nvoid emitRGBA(vec4 color) {\n  vec4 borderColor = color;\n  emit(getCircleColor(color, borderColor), uPickID);\n}\nvoid emitRGB(vec3 color) {\n  emitRGBA(vec4(color, 1.0));\n}\nvoid emitDefault() {\n  emitRGBA(uColor);\n}\n"),e.addFragmentCode(w.a);const{vertexAttributes:i}=this,r=i.length;for(let t=1;t<r;++t){const r=i[t];e.addVarying(`highp ${r.glslDataType}`,`vCustom${t}`),n+=`vCustom${t} = readAttribute${t}(vertexIndex);\n`,e.addFragmentCode(`#define ${r.name} vCustom${t}\n`)}e.setVertexMain(n),e.setFragmentMainFunction(T+"\n"+t)})}get vertexAttributes(){return this.base.vertexAttributes}defineCommonShader(e){e.addUniform("highp vec4","uColor"),e.addUniform("highp mat4","uProjection"),e.addUniform("highp uint","uPickID")}get gl(){return this.base.gl}defineAttributeAccess(e){const{textureAccessHelper:t}=this;t.defineShader(e);const n=this.vertexAttributes.length;for(let e=k.length;e<n;++e)k[e]=Symbol(`SkeletonShader.vertexAttributeTextureUnit${e}`);this.vertexAttributes.forEach((n,i)=>{e.addTextureSampler(`${Object(C.f)(n.dataType)}sampler2D`,`uVertexAttributeSampler${i}`,k[i]),e.addVertexCode(t.getAccessor(`readAttribute${i}`,`uVertexAttributeSampler${i}`,n.dataType,n.numComponents))})}getCrossSectionFadeFactor(){return this.targetIsSliceView?"(clamp(1.0 - 2.0 * abs(0.5 - gl_FragCoord.z), 0.0, 1.0))":"(1.0)"}beginLayer(e,t,n,i){let{dataToDevice:r}=n,s=p.m.multiply(O,r,i);e.uniformMatrix4fv(t.uniform("uProjection"),!1,s)}setColor(e,t,n){e.uniform4fv(t.uniform("uColor"),n)}setPickID(e,t,n){e.uniform1ui(t.uniform("uPickID"),n)}drawSkeleton(e,t,n,i,r,s,o){const{vertexAttributes:a}=this,l=a.length,{vertexAttributeTextures:c}=i;for(let n=0;n<l;++n){const i=WebGL2RenderingContext.TEXTURE0+t.textureUnit(k[n]);e.activeTexture(i),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,c[n])}{t.bind(),this.textureAccessHelper.setupTextureLayout(e,t,i);const n=t.attribute("aVertexIndex");i.indexBuffer.bindToVertexAttribI(n,2,WebGL2RenderingContext.UNSIGNED_INT),e.vertexAttribDivisor(n,1),this.lineShader.draw(t,r,s,this.targetIsSliceView?1:0,i.numIndices/2),e.vertexAttribDivisor(n,0),e.disableVertexAttribArray(n)}null!==n&&(n.bind(),this.textureAccessHelper.setupTextureLayout(e,n,i),this.circleShader.draw(n,r,{interiorRadiusInPixels:o/2,borderWidthInPixels:0,featherWidthInPixels:this.targetIsSliceView?1:0},i.numVertices))}endLayer(e,t){const{vertexAttributes:n}=this,i=n.length;for(let n=0;n<i;++n){let i=t.textureUnit(k[n])+WebGL2RenderingContext.TEXTURE0;e.activeTexture(i),e.bindTexture(e.TEXTURE_2D,null)}}}var M;!function(e){e[e.LINES=0]="LINES",e[e.LINES_AND_POINTS=1]="LINES_AND_POINTS"}(M||(M={}));class I extends v.a{constructor(e,t=e){super(M,e,t)}}class N extends u.c{constructor(e,t=e){super(e,f.o,t)}}class D{constructor(){this.compound=new m.a,this.shader=function(e=L){return new u.c(e,f.A)}(),this.params2d={mode:new I(M.LINES_AND_POINTS),lineWidth:new N(5)},this.params3d={mode:new I(M.LINES),lineWidth:new N(2)};const{compound:e}=this;e.add("shader",this.shader),e.add("mode2d",this.params2d.mode),e.add("lineWidth2d",this.params2d.lineWidth),e.add("mode3d",this.params3d.mode),e.add("lineWidth3d",this.params3d.lineWidth)}get changed(){return this.compound.changed}reset(){this.compound.reset()}restoreState(e){void 0!==e&&this.compound.restoreState(e)}toJSON(){const e=this.compound.toJSON();for(const t in e)return e}}class R extends h.a{constructor(e,t,n,i){super(),this.chunkManager=e,this.source=t,this.voxelSizeObject=n,this.displayState=i,this.tempMat=p.m.create(),this.redrawNeeded=new g.a,this.fallbackFragmentMain=new u.f(L),Object(a.e)(i,this),this.displayState.shaderError.value=void 0;const{skeletonRenderingOptions:r}=i;this.registerDisposer(r.shader.changed.add(()=>{this.displayState.shaderError.value=void 0,this.redrawNeeded.dispatch()}));let s=this.sharedObject=this.registerDisposer(new a.b(e,i));s.RPC_TYPE_ID=l,s.initializeCounterpartWithChunkManager({source:t.addCounterpartRef()});const o=this.vertexAttributes=[_];for(let[e,n]of t.vertexAttributes)o.push({name:e,dataType:n.dataType,numComponents:n.numComponents,webglDataType:V(n.dataType),glslDataType:n.numComponents>1?`vec${n.numComponents}`:"float"})}get visibility(){return this.sharedObject.visibility}get gl(){return this.chunkManager.chunkQueueManager.gl}draw(e,t,n,r){let s,l=r.lineWidth.value,{gl:c,source:u,displayState:d}=this,h=Math.min(1,d.objectAlpha.value);if(h<=0)return;s=r.mode.value===M.LINES_AND_POINTS?Math.max(10,2*l):l;const f=n.edgeShaderGetter(e.emitter),g=n.nodeShaderGetter(e.emitter);if(null===f||null===g)return;let m=this.tempMat;p.m.identity(m),u.skeletonVertexCoordinatesInVoxels&&p.m.scale(m,m,this.voxelSizeObject.size),p.m.multiply(m,m,u.transform),p.m.multiply(m,this.displayState.objectToDataTransform.transform,m),f.bind(),n.beginLayer(c,f,e,m),g.bind(),n.beginLayer(c,g,e,m);const v=u.chunks,{pickIDs:b}=e;Object(o.a)(d,(r,u)=>{const p=Object(o.b)(r),m=v.get(p);void 0!==m&&m.state===i.g.GPU_MEMORY&&(e.emitColor&&(f.bind(),n.setColor(c,f,Object(a.d)(d,u,h)),g.bind(),n.setColor(c,g,Object(a.d)(d,u,h))),e.emitPickID&&(f.bind(),n.setPickID(c,f,b.registerUint64(t,r)),g.bind(),n.setPickID(c,g,b.registerUint64(t,r))),n.drawSkeleton(c,f,g,m,e,l,s))}),n.endLayer(c,f)}}class P extends s.a{constructor(e){super(),this.base=e,this.renderHelper=this.registerDisposer(new A(this.base,!1)),this.renderOptions=this.base.displayState.skeletonRenderingOptions.params3d,this.registerDisposer(e),this.registerDisposer(e.redrawNeeded.add(this.redrawNeeded.dispatch));const{renderOptions:t}=this;this.registerDisposer(t.mode.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(t.lineWidth.changed.add(this.redrawNeeded.dispatch)),this.setReady(!0),this.registerDisposer(e.visibility.add(this.visibility))}get gl(){return this.base.gl}get isTransparent(){return this.base.displayState.objectAlpha.value<1}draw(e){!e.emitColor&&e.alreadyEmittedPickID||this.base.draw(e,this,this.renderHelper,this.renderOptions)}}class j extends c.b{constructor(e){super(),this.base=e,this.renderHelper=this.registerDisposer(new A(this.base,!0)),this.renderOptions=this.base.displayState.skeletonRenderingOptions.params2d,this.registerDisposer(e);const{renderOptions:t}=this;this.registerDisposer(t.mode.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(t.lineWidth.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(e.redrawNeeded.add(this.redrawNeeded.dispatch)),this.setReady(!0),this.registerDisposer(e.visibility.add(this.visibility))}get gl(){return this.base.gl}draw(e){this.base.draw(e,this,this.renderHelper,this.renderOptions)}}function V(e){switch(e){case d.b.FLOAT32:return WebGL2RenderingContext.FLOAT;default:throw new Error("Data type not supported by WebGL: ${DataType[dataType]}")}}const _={dataType:d.b.FLOAT32,numComponents:3,name:"",webglDataType:WebGL2RenderingContext.FLOAT,glslDataType:"vec3"};class U extends r.b{constructor(e,t){super(e),this.vertexAttributes=t.vertexAttributes;let n=this.indices=t.indices;this.numVertices=t.numVertices,this.vertexAttributeOffsets=t.vertexAttributeOffsets,this.numIndices=n.length}copyToGPU(e){super.copyToGPU(e),Object(C.d)(this,e,1,this.numVertices);const{attributeTextureFormats:t}=this.source,{vertexAttributes:n,vertexAttributeOffsets:i}=this,r=this.vertexAttributeTextures=[];for(let s=0,o=i.length;s<o;++s){const a=e.createTexture();e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,a),Object(C.g)(e,this,t[s],n.subarray(i[s],s+1!==o?i[s+1]:n.length)),r[s]=a}e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,null),this.indexBuffer=b.a.fromData(e,this.indices,WebGL2RenderingContext.ARRAY_BUFFER,WebGL2RenderingContext.STATIC_DRAW)}freeGPUMemory(e){super.freeGPUMemory(e);const{vertexAttributeTextures:t}=this;for(const n of t)e.deleteTexture(n);t.length=0,this.indexBuffer.dispose()}}const F=new Map;class z extends r.e{get attributeTextureFormats(){let e=this.attributeTextureFormats_;return void 0===e&&(e=this.attributeTextureFormats_=function(e){const t=[E];for(const n of e.values())t.push(Object(C.e)(new C.b,n.dataType,n.numComponents));return t}(this.vertexAttributes)),e}getChunk(e){return new U(this,e)}constructor(e,t){super(e,t);const{transform:n=p.m.create()}=t;this.transform=n}get skeletonVertexCoordinatesInVoxels(){return!0}get vertexAttributes(){return F}}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i,r=n(9),s=n(8);let o=i=class extends s.c{constructor(e,t={}){super(e,t),this.updatingValue_=!1,void 0!==e&&(this.base=new r.f(t.value),this.setupChangedHandler())}initializeCounterpart(e,t={}){t.value=this.value,super.initializeCounterpart(e,t)}setupChangedHandler(){this.registerDisposer(this.base.changed.add(()=>{if(this.updatingValue_)this.updatingValue_=!1;else{const{rpc:e}=this;null!==e&&e.invoke("SharedWatchableValue.changed",{id:this.rpcId,value:this.value})}}))}static makeFromExisting(e,t){let n=new i;return n.base=t,n.setupChangedHandler(),n.initializeCounterpart(e),n}static make(e,t){return i.makeFromExisting(e,new r.f(t))}get value(){return this.base.value}set value(e){this.base.value=e}get changed(){return this.base.changed}};o=i=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([Object(s.f)("SharedWatchableValue")],o),Object(s.e)("SharedWatchableValue.changed",function(e){const t=this.get(e.id);t.updatingValue_=!0,t.base.value=e.value,t.updatingValue_=!1})},function(e,t,n){"use strict";n.r(t),n.d(t,"VolumeComputationFrontend",function(){return h}),n.d(t,"ComputedMultiscaleVolumeChunkSource",function(){return p}),n.d(t,"ComputedDataSource",function(){return f});var i=n(11),r=n(40),s=n(89),o=n(4),a=n(34),l=n(0),c=n(1),u=n(8);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class d extends(Object(i.f)(a.b,s.b)){}class h extends u.b{constructor(e){super(),this.params=e}}class p{constructor(e,t,n,i){this.params=e,this.sources=t,this.computation=n,this.chunkManager=i,this.numChannels=e.computationParameters.outputSpec.numChannels,this.dataType=e.computationParameters.outputSpec.dataType,this.volumeType=e.computationParameters.outputSpec.volumeType}getSources(e){const t=o.b.getDefaults({voxelSize:this.params.outputVoxelSize,dataType:this.dataType,numChannels:this.numChannels,chunkDataSizes:[this.params.computationParameters.outputSpec.size],transform:l.m.fromTranslation(l.m.create(),l.u.multiply(l.u.create(),this.params.outputVoxelSize,this.params.outputVoxelOffset)),upperVoxelBound:this.params.outputVolumeSize,volumeType:this.volumeType,baseVoxelOffset:this.params.outputVoxelOffset,volumeSourceOptions:e})[0],n=this.sources[this.params.inputScaleIndex][this.params.inputSourceIndex],i=n.spec.voxelSize,r={computationRef:this.computation.addCounterpartRef(),sourceRef:n.addCounterpartRef(),inputSize:this.params.computationParameters.inputSpec.size,scaleFactor:l.u.divide(l.u.create(),this.params.outputVoxelSize,i)};return[[this.chunkManager.getChunkSource(d,{spec:t,parameters:r})]]}getMeshSource(){return null}}class f extends r.a{getOriginVolumes(e,t,n,i){return e.getVolume(n,t,{},i).then(e=>{const t=e.getSources({});return{specs:t.map(e=>e.map(e=>e.spec)),sources:t,volumeType:e.volumeType,dataType:e.dataType,numChannels:e.numChannels}})}defaultParams(e,t,n){const i=e.sources[0][0].spec,{dataType:r,volumeType:s,numChannels:o}=e,a=i.chunkDataSize;return{originUrl:t,computationParameters:{inputSpec:{size:l.u.copy(l.u.create(),a),dataType:r,volumeType:s,numChannels:o},outputSpec:{size:l.u.copy(l.u.create(),a),dataType:r,volumeType:s,numChannels:o}},inputScaleIndex:0,inputSourceIndex:0,outputVoxelSize:l.u.copy(l.u.create(),i.voxelSize),outputVolumeSize:l.u.copy(l.u.create(),i.upperVoxelBound),outputVoxelOffset:l.u.copy(l.u.create(),i.baseVoxelOffset),dataSourceProvider:n}}get description(){return"Computed data source."}getVolume(e,t,n,i){if(console.log("Computed datasource config:",t),!n.dataSourceProvider)return Promise.reject(new Error("Need a DataSourceProvider"));const r=n.dataSourceProvider;let s;try{s=Object(c.t)(JSON.parse(t))}catch(e){return Promise.reject(new Error(`Could not parse JSON configuration while initializing computational datasource: ${e}`))}if(!s)return Promise.reject(new Error("Could not verify configuration JSON"));if(void 0===s.origin)return Promise.reject(new Error("Config is missing origin"));if(void 0===s.computation)return Promise.reject(new Error("Config is missing computation"));const o=Object(c.A)(s.computation),a=f.computationMap.get(o),l=Object(c.A)(s.origin);return a?this.getOriginVolumes(r,l,e,i).then(t=>{const n=this.defaultParams(t,l,r);return e.memoize.getUncounted({type:"computed:getVolume",config:s},()=>a.getComputation(s,t.sources,n).then(i=>(i.initializeCounterpart(e.rpc,i.params),new p(n,t.sources,i,e))))}):Promise.reject(new Error(`Unable to find computation ${o}`))}static registerComputation(e,t){this.computationMap.set(e,t)}}f.computationMap=new Map},function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return a});var i=n(0),r=n(1),s=n(3);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class o{constructor(e=i.m.create()){this.transform=e,this.changed=new s.a}get value(){return this.transform}reset(){i.m.copy(this.transform,i.e),this.changed.dispatch()}toJSON(){if(i.m.equals(i.e,this.transform))return;const e=this.transform;return[[e[0],e[4],e[8],e[12]],[e[1],e[5],e[9],e[13]],[e[2],e[6],e[10],e[14]],[e[3],e[7],e[11],e[15]]]}restoreState(e){if(null!=e)if(Array.isArray(e)){if(4===e.length){try{for(let t=0;t<4;++t)Object(r.b)(this.transform.subarray(4*t,4*(t+1)),e[t]);i.m.transpose(this.transform,this.transform)}catch(e){this.reset()}return}if(16===e.length){try{Object(r.b)(this.transform,e),i.m.transpose(this.transform,this.transform)}catch(e){this.reset()}return}this.reset()}else if("object"==typeof e){const t=i.p.create(),n=i.u.create(),s=i.u.fromValues(1,1,1);try{Object(r.b)(t,e.rotation),i.p.normalize(t,t)}catch(e){i.p.identity(t)}try{Object(r.b)(n,e.translation)}catch(e){i.u.copy(n,i.j)}try{Object(r.b)(s,e.scale)}catch(e){i.u.copy(s,i.i)}i.m.fromRotationTranslationScale(this.transform,t,n,s),this.changed.dispatch()}else this.reset();else this.reset()}clone(){return new o(i.m.clone(this.transform))}}function a(e,t,n){return n(e.transform,t.transform),t.changed.add(()=>{n(e.transform,t.transform),e.changed.dispatch()})}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(42),r=n(19);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function s(e=-1,t=-1,n=1,r=1,s=1,o=1){return Object(i.d)(new Float32Array([e,t,e,r,n,r,n,t]),2,s,o)}function o(e,t=-1,n=-1,i=1,o=1,a=1,l=1){return Object(r.b)(e,WebGL2RenderingContext.ARRAY_BUFFER,s,t,n,i,o,a,l).value}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(20);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r extends i.j{draw(e){}isReady(e){return!0}}},function(e,t,n){"use strict";var i=n(59),r=n(20),s=n(18),o=n(9),a=n(2),l=n(0);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class c extends o.f{}class u extends a.a{constructor(e){super(),this.transformCacheGeneration=-1,this.cachedObjectToGlobal=l.m.create(),this.cachedGlobalToObject=l.m.create();const{transform:t=new i.a,source:n,hoverState:a=new c(void 0),role:u=r.g.ANNOTATION,color:d,fillOpacity:h,segmentationState:p=new o.f(null),filterBySegmentation:f=new s.b(!1)}=e;this.transform=t,this.source=this.registerDisposer(n),this.hoverState=a,this.role=u,this.color=d,this.fillOpacity=h,this.segmentationState=p,this.filterBySegmentation=f}updateTransforms(){const{transform:e,transformCacheGeneration:t}=this;if(e.changed.count===t)return;const{cachedObjectToGlobal:n}=this;l.m.multiply(n,this.transform.transform,this.source.objectToLocal),l.m.invert(this.cachedGlobalToObject,n)}get objectToGlobal(){return this.updateTransforms(),this.cachedObjectToGlobal}get globalToObject(){return this.updateTransforms(),this.cachedGlobalToObject}}var d=n(66),h=n(6),p=n(32),f=n(94),g=n(42),m=n(19),v=n(64),b=n(68),y=n(23);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const w=12,x=8,S=1,C=S+x,O=C+w,L=O+6,T=Float32Array.from([0,0,0,0,0,1,C+0,1,0,0,1,0,1,C+1,0,1,0,0,1,1,C+2,1,1,0,1,1,1,C+3,0,0,0,0,1,0,C+4,0,0,1,0,1,1,C+5,1,0,0,1,1,0,C+6,1,0,1,1,1,1,C+7,0,0,0,1,0,0,C+8,0,0,1,1,0,1,C+9,0,1,0,1,1,0,C+10,0,1,1,1,1,1,C+11]);class k extends p.a{defineShader(e){super.defineShader(e),e.addAttribute("highp vec3","aLower"),e.addAttribute("highp vec3","aUpper")}enable(e,t,n){super.enable(e,t,()=>{const{gl:i}=e,r=e.attribute("aLower"),s=e.attribute("aUpper");t.buffer.bindToVertexAttrib(r,3,WebGL2RenderingContext.FLOAT,!1,24,t.bufferOffset),t.buffer.bindToVertexAttrib(s,3,WebGL2RenderingContext.FLOAT,!1,24,t.bufferOffset+12),i.vertexAttribDivisor(r,1),i.vertexAttribDivisor(s,1),n(),i.vertexAttribDivisor(r,0),i.vertexAttribDivisor(s,0),i.disableVertexAttribArray(r),i.disableVertexAttribArray(s)})}}function E(){return new Float32Array([0,1,2,3,4,5])}function A(){return Object(g.d)(E(),1,1,b.b)}function M(e,t,n,i){let r=function(e,t){const n=7*t,i=l.u.create(),r=l.u.create();for(let t=0;t<3;++t){const s=T[n+t],o=T[n+t+3],a=Math.min(e[t],e[t+3]),l=Math.max(e[t],e[t+3]);i[t]=(1-s)*a+s*l,r[t]=(1-o)*a+o*l}return{cornerA:i,cornerB:r}}(n,i);l.u.transformMat4(r.cornerA,r.cornerA,t),l.u.transformMat4(r.cornerB,r.cornerB,t),Object(l.o)(e,r.cornerA,r.cornerB,e)}Object(p.c)(h.c.AXIS_ALIGNED_BOUNDING_BOX,{bytes:24,serializer:(e,t,n)=>{const i=new Float32Array(e,t,6*n);return(e,t)=>{const{pointA:n,pointB:r}=e,s=6*t;i[s]=Math.min(n[0],r[0]),i[s+1]=Math.min(n[1],r[1]),i[s+2]=Math.min(n[2],r[2]),i[s+3]=Math.max(n[0],r[0]),i[s+4]=Math.max(n[1],r[1]),i[s+5]=Math.max(n[2],r[2])}},sliceViewRenderHelper:class extends k{constructor(e){super(e),this.gl=e,this.lineShader=new b.a(this.gl,6),this.intersectionVertexIndexBuffer=Object(m.b)(this.gl,WebGL2RenderingContext.ARRAY_BUFFER,A).value,this.filledIntersectionVertexIndexBuffer=Object(m.b)(this.gl,WebGL2RenderingContext.ARRAY_BUFFER,E).value,this.boundingBoxCrossSectionHelper=this.registerDisposer(new f.a(this.gl)),this.faceShaderGetter=Object(y.b)(this,this.gl,e=>{super.defineShader(e),this.boundingBoxCrossSectionHelper.defineShader(e),this.lineShader.defineShader(e),e.addAttribute("highp float","aVertexIndexFloat"),e.setVertexMain(`\nint vertexIndex1 = int(aVertexIndexFloat);\nint vertexIndex2 = vertexIndex1 == 5 ? 0 : vertexIndex1 + 1;\nvec3 vertexPosition1 = getBoundingBoxPlaneIntersectionVertexPosition(aUpper - aLower, aLower, aLower, aUpper, vertexIndex1);\nvec3 vertexPosition2 = getBoundingBoxPlaneIntersectionVertexPosition(aUpper - aLower, aLower, aLower, aUpper, vertexIndex2);\nemitLine(uProjection, vertexPosition1, vertexPosition2);\n${this.setPartIndex(e)};\n`),e.setFragmentMain("\nemitAnnotation(vec4(vColor.rgb, vColor.a * getLineAlpha()));\n")}),this.fillShaderGetter=Object(y.b)(this,this.gl,e=>{super.defineShader(e),this.boundingBoxCrossSectionHelper.defineShader(e),e.addAttribute("highp float","aVertexIndexFloat"),e.addUniform("highp float","uFillOpacity"),e.setVertexMain(`\nint vertexIndex = int(aVertexIndexFloat);\nvec3 vertexPosition = getBoundingBoxPlaneIntersectionVertexPosition(aUpper - aLower, aLower, aLower, aUpper, vertexIndex);\ngl_Position = uProjection * vec4(vertexPosition, 1);\n${this.setPartIndex(e)};\n`),e.setFragmentMain("\nemitAnnotation(vec4(vColor.rgb, uFillOpacity));\n")})}draw(e){const t=e.annotationLayer.state.fillOpacity.value,n=(t?this.fillShaderGetter:this.faceShaderGetter)(e.renderContext.emitter);let{gl:i}=this;this.enable(n,e,()=>{this.boundingBoxCrossSectionHelper.setViewportPlane(n,e.renderContext.sliceView.viewportAxes[2],e.renderContext.sliceView.centerDataPosition,e.annotationLayer.state.globalToObject);const r=n.attribute("aVertexIndexFloat");if((t?this.filledIntersectionVertexIndexBuffer:this.intersectionVertexIndexBuffer).bindToVertexAttrib(r,1,WebGL2RenderingContext.FLOAT,!1),t)i.uniform1f(n.uniform("uFillOpacity"),t),i.drawArraysInstanced(WebGL2RenderingContext.TRIANGLE_FAN,0,6,e.count);else{const t=e.renderContext.emitColor?1:5;this.lineShader.draw(n,e.renderContext,t,1,e.count)}i.disableVertexAttribArray(r)})}},perspectiveViewRenderHelper:class extends k{constructor(){super(...arguments),this.lineShader=this.registerDisposer(new b.a(this.gl,w)),this.edgeBoxCornerOffsetsBuffer=this.registerDisposer(m.a.fromData(this.gl,Object(g.d)(T,7,1,b.b))),this.edgeShaderGetter=Object(y.b)(this,this.gl,e=>{this.defineShader(e),this.lineShader.defineShader(e),e.addAttribute("highp vec3","aBoxCornerOffset1"),e.addAttribute("highp vec4","aBoxCornerOffset2"),e.setVertexMain(`\nvec3 vertexPosition1 = mix(aLower, aUpper, aBoxCornerOffset1);\nvec3 vertexPosition2 = mix(aLower, aUpper, aBoxCornerOffset2.xyz);\nemitLine(uProjection, vertexPosition1, vertexPosition2);\n${this.setPartIndex(e,"uint(aBoxCornerOffset2.w)")};\n`),e.setFragmentMain("\nemitAnnotation(vec4(vColor.rgb, getLineAlpha()));\n")}),this.circleShader=this.registerDisposer(new v.a(this.gl,x)),this.boxCornerOffsetsBuffer=this.registerDisposer(m.a.fromData(this.gl,Object(g.d)(f.b,3,1,v.b))),this.cornerShaderGetter=Object(y.b)(this,this.gl,e=>{this.defineShader(e),this.circleShader.defineShader(e,this.targetIsSliceView),e.addAttribute("highp vec3","aBoxCornerOffset"),e.setVertexMain(`\nvec3 vertexPosition = mix(aLower, aUpper, aBoxCornerOffset);\nemitCircle(uProjection * vec4(vertexPosition, 1.0));\nuint cornerIndex = uint(aBoxCornerOffset.x + aBoxCornerOffset.y * 2.0 + aBoxCornerOffset.z * 4.0);\nuint cornerPickOffset = ${S}u + cornerIndex;\n${this.setPartIndex(e,"cornerPickOffset")};\n`),e.setFragmentMain("\nvec4 borderColor = vec4(0.0, 0.0, 0.0, 1.0);\nemitAnnotation(getCircleColor(vColor, borderColor));\n")})}drawEdges(e){const t=this.edgeShaderGetter(e.renderContext.emitter),{gl:n}=this;this.enable(t,e,()=>{const i=t.attribute("aBoxCornerOffset1"),r=t.attribute("aBoxCornerOffset2");this.edgeBoxCornerOffsetsBuffer.bindToVertexAttrib(i,3,WebGL2RenderingContext.FLOAT,!1,28,0),this.edgeBoxCornerOffsetsBuffer.bindToVertexAttrib(r,4,WebGL2RenderingContext.FLOAT,!1,28,12),this.lineShader.draw(t,e.renderContext,1,1,e.count),n.disableVertexAttribArray(i),n.disableVertexAttribArray(r)})}drawCorners(e){const t=this.cornerShaderGetter(e.renderContext.emitter),{gl:n}=this;this.enable(t,e,()=>{const i=t.attribute("aBoxCornerOffset");this.boxCornerOffsetsBuffer.bindToVertexAttrib(i,3,WebGL2RenderingContext.FLOAT,!1),this.circleShader.draw(t,e.renderContext,{interiorRadiusInPixels:1,borderWidthInPixels:0,featherWidthInPixels:1},e.count),n.disableVertexAttribArray(i)})}draw(e){this.drawEdges(e),this.drawCorners(e)}},pickIdsPerInstance:L,snapPosition:(e,t,n,i,r)=>{const s=new Float32Array(n,i,6);r>=S&&r<C?function(e,t,n,i){const r=3*i;for(let t=0;t<3;++t){const i=f.b[r+t],s=Math.min(n[t],n[t+3]),o=Math.max(n[t],n[t+3]);e[t]=(1-i)*s+i*o}l.u.transformMat4(e,e,t)}(e,t,s,r-S):r>=C&&r<O&&M(e,t,s,r-C)},getRepresentativePoint:(e,t,n)=>{let i=l.u.create();return l.u.transformMat4(i,t.pointA,e),i},updateViaRepresentativePoint:(e,t,n,i)=>{let r=l.u.transformMat4(l.u.create(),t,n),s=Object.assign({},e),o=l.u.sub(l.u.create(),e.pointB,e.pointA);return s.pointA=r,s.pointB=l.u.add(l.u.create(),r,o),s}});function I(){return Object(g.d)(new Uint8Array([0,1]),1,1,v.b)}class N extends p.a{constructor(){super(...arguments),this.lineShader=this.registerDisposer(new b.a(this.gl,1)),this.circleShader=this.registerDisposer(new v.a(this.gl,2)),this.edgeShaderGetter=Object(y.b)(this,this.gl,e=>{this.defineShader(e),this.lineShader.defineShader(e),e.setVertexMain(`\nemitLine(uProjection, aEndpointA, aEndpointB);\n${this.setPartIndex(e)};\n`),e.setFragmentMain(`\nemitAnnotation(vec4(vColor.rgb, vColor.a * getLineAlpha() * ${this.getCrossSectionFadeFactor()}));\n`)}),this.endpointIndexBuffer=this.registerDisposer(Object(m.b)(this.gl,WebGL2RenderingContext.ARRAY_BUFFER,I)).value,this.endpointShaderGetter=Object(y.b)(this,this.gl,e=>{this.defineShader(e),this.circleShader.defineShader(e,this.targetIsSliceView),e.addAttribute("highp uint","aEndpointIndex"),e.setVertexMain(`\nvec3 vertexPosition = mix(aEndpointA, aEndpointB, float(aEndpointIndex));\nemitCircle(uProjection * vec4(vertexPosition, 1.0));\n${this.setPartIndex(e,"aEndpointIndex + 1u")};\n`),e.setFragmentMain("\nvec4 borderColor = vec4(0.0, 0.0, 0.0, 1.0);\nemitAnnotation(getCircleColor(vColor, borderColor));\n")})}defineShader(e){super.defineShader(e),e.addAttribute("highp vec3","aEndpointA"),e.addAttribute("highp vec3","aEndpointB")}enable(e,t,n){super.enable(e,t,()=>{const{gl:i}=e,r=e.attribute("aEndpointA"),s=e.attribute("aEndpointB");t.buffer.bindToVertexAttrib(r,3,WebGL2RenderingContext.FLOAT,!1,24,t.bufferOffset),t.buffer.bindToVertexAttrib(s,3,WebGL2RenderingContext.FLOAT,!1,24,t.bufferOffset+12),i.vertexAttribDivisor(r,1),i.vertexAttribDivisor(s,1),n(),i.vertexAttribDivisor(r,0),i.vertexAttribDivisor(s,0),i.disableVertexAttribArray(r),i.disableVertexAttribArray(s)})}drawEdges(e){const t=this.edgeShaderGetter(e.renderContext.emitter);this.enable(t,e,()=>{this.lineShader.draw(t,e.renderContext,1,1,e.count)})}drawEndpoints(e){const t=this.endpointShaderGetter(e.renderContext.emitter);this.enable(t,e,()=>{const n=t.attribute("aEndpointIndex");this.endpointIndexBuffer.bindToVertexAttribI(n,1,WebGL2RenderingContext.UNSIGNED_BYTE),this.circleShader.draw(t,e.renderContext,{interiorRadiusInPixels:6,borderWidthInPixels:2,featherWidthInPixels:1},e.count),t.gl.disableVertexAttribArray(n)})}draw(e){this.drawEdges(e),this.drawEndpoints(e)}}Object(p.c)(h.c.LINE,{bytes:24,serializer:(e,t,n)=>{const i=new Float32Array(e,t,6*n);return(e,t)=>{const{pointA:n,pointB:r}=e,s=6*t;i[s]=n[0],i[s+1]=n[1],i[s+2]=n[2],i[s+3]=r[0],i[s+4]=r[1],i[s+5]=r[2]}},sliceViewRenderHelper:N,perspectiveViewRenderHelper:N,pickIdsPerInstance:3,snapPosition:(e,t,n,i,r)=>{const s=new Float32Array(n,i,6);0===r?function(e,t,n){const i=l.u.transformMat4(l.u.create(),n.subarray(0,3),t),r=l.u.transformMat4(l.u.create(),n.subarray(3,6),t);Object(l.o)(e,i,r,e)}(e,t,s):function(e,t,n,i){const r=3*i,s=n.subarray(r,r+3);l.u.transformMat4(e,s,t)}(e,t,s,r-1)},getRepresentativePoint:(e,t,n)=>{let i=l.u.create();return 0===n?l.u.transformMat4(i,t.pointA,e):n-1==0?l.u.transformMat4(i,t.pointA,e):l.u.transformMat4(i,t.pointB,e),i},updateViaRepresentativePoint:(e,t,n,i)=>{let r=l.u.transformMat4(l.u.create(),t,n),s=Object.assign({},e);switch(i){case 0:let t=l.u.sub(l.u.create(),e.pointB,e.pointA);s.pointA=r,s.pointB=l.u.add(l.u.create(),r,t);break;case 1:s.pointA=r,s.pointB=e.pointB;break;case 2:s.pointA=e.pointA,s.pointB=r}return s}});
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class D extends p.a{constructor(){super(...arguments),this.circleShader=this.registerDisposer(new v.a(this.gl)),this.shaderGetter=Object(y.b)(this,this.gl,e=>this.defineShader(e))}defineShader(e){super.defineShader(e),this.circleShader.defineShader(e,this.targetIsSliceView),e.addAttribute("highp vec3","aVertexPosition"),e.setVertexMain(`\nemitCircle(uProjection * vec4(aVertexPosition, 1.0));\n${this.setPartIndex(e)};\n`),e.setFragmentMain("\nvec4 borderColor = vec4(0.0, 0.0, 0.0, 1.0);\nemitAnnotation(getCircleColor(vColor, borderColor));\n")}draw(e){const t=this.shaderGetter(e.renderContext.emitter);this.enable(t,e,()=>{const{gl:n}=this,i=t.attribute("aVertexPosition");e.buffer.bindToVertexAttrib(i,3,WebGL2RenderingContext.FLOAT,!1,0,e.bufferOffset),n.vertexAttribDivisor(i,1),this.circleShader.draw(t,e.renderContext,{interiorRadiusInPixels:6,borderWidthInPixels:2,featherWidthInPixels:1},e.count),n.vertexAttribDivisor(i,0),n.disableVertexAttribArray(i)})}}Object(p.c)(h.c.POINT,{bytes:12,serializer:(e,t,n)=>{const i=new Float32Array(e,t,3*n);return(e,t)=>{const{point:n}=e,r=3*t;i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2]}},sliceViewRenderHelper:D,perspectiveViewRenderHelper:D,pickIdsPerInstance:1,snapPosition:(e,t,n,i)=>{l.u.transformMat4(e,new Float32Array(n,i,3),t)},getRepresentativePoint:(e,t)=>{let n=l.u.create();return l.u.transformMat4(n,t.point,e),n},updateViaRepresentativePoint:(e,t,n)=>{let i=Object.assign({},e);return i.point=l.u.transformMat4(l.u.create(),t,n),i}});
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const R="\nstruct EllipseQuadraticForm {\n  highp float A;  // x*x coefficient\n  highp float B;  // x*y coefficient\n  highp float C;  // y*y coefficient\n  highp float D;  // x coefficient\n  highp float E;  // y coefficient\n  highp float F;  // 1 coefficient\n};\n",P=[R,"\nEllipseQuadraticForm computeCrossSectionEllipse(mat3 A, vec3 c) {\n  EllipseQuadraticForm p;\n  p.A = A[0][0];\n  p.B = A[0][1] + A[1][0];\n  p.C = A[1][1];\n  p.D = -2.0 * c[0] * A[0][0] - c[1] * (A[0][1] + A[1][0]) +\n        c[2] * (A[0][2] + A[2][0]);\n  p.E = -c[0] * (A[0][1] + A[1][0]) - 2.0 * c[1] * A[1][1] +\n        c[2] * (A[1][2] + A[2][1]);\n  p.F = c[0] * c[0] * A[0][0] + c[0] * c[1] * (A[0][1] + A[1][0]) -\n        c[0] * c[2] * (A[0][2] + A[2][0]) + c[1] * c[1] * A[1][1] -\n        c[1] * c[2] * (A[1][2] + A[2][1]) + c[2] * c[2] * A[2][2] - 1.0;\n  return p;\n}\n"];const j=[R,"\nstruct CenterOrientEllipse {\n  vec2 k;   // center\n  vec2 u1;  // minor axis direction\n  vec2 u2;  // major axis direction\n  float a;  // semimajor axis\n  float b;  // semiminor axis\n  bool valid; // indicates if the ellipse is valid\n};\n","\nCenterOrientEllipse computeCenterOrientEllipse(EllipseQuadraticForm p) {\n  CenterOrientEllipse r;\n  float a11 = p.A;\n  float a12 = p.B / 2.0;\n  float a22 = p.C;\n  float b1 = p.D;\n  float b2 = p.E;\n  float c = p.F;\n  float kdenom = 2.0 * (a12 * a12 - a11 * a22);\n  float k1 = r.k.x = (a22 * b1 - a12 * b2) / kdenom;\n  float k2 = r.k.y = (a11 * b2 - a12 * b1) / kdenom;\n  float mu = 1.0 / (a11 * k1 * k1 + 2.0 * a12 * k1 * k2 + a22 * k2 * k2 - c);\n  float m11 = mu * a11;\n  float m12 = mu * a12;\n  float m22 = mu * a22;\n  float lambdaTerm1 = m11 + m22;\n  float lambdaTerm2 = sqrt((m11 - m22) * (m11 - m22) + 4.0 * m12 * m12);\n  float lambda1 = ((lambdaTerm1 + lambdaTerm2) / 2.0);\n  float lambda2 = ((lambdaTerm1 - lambdaTerm2) / 2.0);\n  r.a = 1.0 / sqrt(lambda1);\n  r.b = 1.0 / sqrt(lambda2);\n  r.valid = lambda1 > 0.0 && lambda2 > 0.0;\n  if (abs(m12) < 1e-10) {\n    r.u1 = vec2(1.0, 0.0);\n  } else if (m11 >= m22) {\n    r.u1 = normalize(vec2(lambda1 - m22, m12));\n  } else {\n    r.u1 = normalize(vec2(m12, lambda1 - m11));\n  }\n  r.u2 = vec2(-r.u1.y, r.u1.x);\n  return r;\n}\n"];var V=n(81);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _(e,t){const n=new Float32Array((e+1)*(t+1)*3);let i=0;for(let r=0;r<=e;++r){const s=r*Math.PI/e,o=Math.sin(s),a=Math.cos(s);for(let e=0;e<=t;++e){const r=2*e*Math.PI/t,s=Math.sin(r),l=Math.cos(r);n[i++]=l*o,n[i++]=a,n[i++]=s*o}}return n}function U(e,t){const n=new Uint16Array(e*t*6);let i=0;for(let r=0;r<e;r++)for(let e=0;e<t;e++){const s=r*(t+1)+e,o=s+t+1;n[i++]=s,n[i++]=o,n[i++]=s+1,n[i++]=o,n[i++]=o+1,n[i++]=s+1}return n}class F extends a.a{constructor(e,t,n){super(),this.vertexBuffer=this.registerDisposer(Object(m.b)(e,WebGL2RenderingContext.ARRAY_BUFFER,_,t,n)).value,this.indexBuffer=this.registerDisposer(Object(m.b)(e,WebGL2RenderingContext.ELEMENT_ARRAY_BUFFER,U,t,n)).value,this.numIndices=t*n*6}defineShader(e){e.addAttribute("highp vec3","aSphereVertex"),e.addVarying("highp float","vLightingFactor"),e.addVertexCode("\nvoid emitSphere(mat4 projectionMatrix, mat4 normalTransformMatrix, vec3 centerPosition, vec3 radii, vec4 lightDirection) {\n  vec3 vertexPosition = aSphereVertex * radii + centerPosition;\n  gl_Position = projectionMatrix * vec4(vertexPosition, 1.0);\n  vec3 normal = normalize((normalTransformMatrix * vec4(aSphereVertex / radii, 0.0)).xyz);\n  vLightingFactor = abs(dot(normal, uLightDirection.xyz)) + uLightDirection.w;\n}\n")}draw(e,t){const n=e.attribute("aSphereVertex");this.vertexBuffer.bindToVertexAttrib(n,3,WebGL2RenderingContext.FLOAT,!1),this.indexBuffer.bind(),e.gl.drawElementsInstanced(WebGL2RenderingContext.TRIANGLES,this.numIndices,WebGL2RenderingContext.UNSIGNED_SHORT,0,t),e.gl.disableVertexAttribArray(n)}}var z=n(60);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B=l.m.create(),G=!1;class W extends p.a{defineShader(e){super.defineShader(e),e.addAttribute("highp vec3","aCenter"),e.addAttribute("highp vec3","aRadii")}enable(e,t,n){super.enable(e,t,()=>{const i=e.attribute("aCenter"),r=e.attribute("aRadii"),{gl:s}=e;t.buffer.bindToVertexAttrib(i,3,WebGL2RenderingContext.FLOAT,!1,24,t.bufferOffset),t.buffer.bindToVertexAttrib(r,3,WebGL2RenderingContext.FLOAT,!1,24,t.bufferOffset+12),s.vertexAttribDivisor(i,1),s.vertexAttribDivisor(r,1),n(),s.vertexAttribDivisor(i,0),s.vertexAttribDivisor(r,0),s.disableVertexAttribArray(i),s.disableVertexAttribArray(r)})}}Object(p.c)(h.c.ELLIPSOID,{bytes:24,serializer:(e,t,n)=>{const i=new Float32Array(e,t,6*n);return(e,t)=>{const{center:n,radii:r}=e,s=6*t;i.set(n,s),i.set(r,s+3)}},sliceViewRenderHelper:class extends W{constructor(){super(...arguments),this.quadRenderHelper=this.registerDisposer(new V.a(this.gl,1)),this.squareCornersBuffer=Object(z.a)(this.gl,-1,-1,1,1,1,1),this.shaderGetter=Object(y.b)(this,this.gl,e=>{this.defineShader(e),e.addUniform("highp mat4","uViewportToObject"),e.addUniform("highp mat4","uObjectToViewport"),e.addUniform("highp mat4","uViewportToDevice"),e.addAttribute("highp vec2","aCornerOffset"),e.addVarying("highp vec2","vCircleCoord"),e.addVertexCode(P),e.addVertexCode(j),e.setVertexMain(`\nmat3 Aobject = mat3(0.0);\nfor (int i = 0; i < 3; ++i) {\n  Aobject[i][i] = 1.0 / (aRadii[i] * aRadii[i]);\n}\nmat3 RviewportToObject = mat3(uViewportToObject);\nmat3 Aviewport = transpose(RviewportToObject) * Aobject * RviewportToObject;\nvec3 cViewport = (uObjectToViewport * vec4(aCenter, 1.0)).xyz;\nEllipseQuadraticForm quadraticForm = computeCrossSectionEllipse(Aviewport, cViewport);\nvec2 u1, u2;\nfloat a, b;\nCenterOrientEllipse centerOrient = computeCenterOrientEllipse(quadraticForm);\nvec2 viewportCorner = centerOrient.k +\n  centerOrient.u1 * aCornerOffset.x * centerOrient.a +\n  centerOrient.u2 * aCornerOffset.y * centerOrient.b;\nif (centerOrient.valid) {\n  gl_Position = uViewportToDevice * vec4(viewportCorner, 0.0, 1.0);\n} else {\n  gl_Position = vec4(1.0, 1.0, 0.0, -100.0);\n}\nvCircleCoord = aCornerOffset;\n${this.setPartIndex(e)};\n`),e.setFragmentMain("\nif (dot(vCircleCoord, vCircleCoord) > 1.0) {\n  discard;\n}\nemitAnnotation(vec4(vColor.rgb, 0.5));\n")})}draw(e){const t=this.shaderGetter(e.renderContext.emitter);this.enable(t,e,()=>{const{gl:n}=t,i=t.attribute("aCornerOffset");this.squareCornersBuffer.bindToVertexAttrib(i,2);const r=l.m.multiply(B,e.annotationLayer.state.globalToObject,e.renderContext.sliceView.viewportToData);n.uniformMatrix4fv(t.uniform("uViewportToObject"),!1,r),n.uniformMatrix4fv(t.uniform("uViewportToDevice"),!1,e.renderContext.sliceView.viewportToDevice);const s=B;if(l.m.invert(s,r),n.uniformMatrix4fv(t.uniform("uObjectToViewport"),!1,s),this.quadRenderHelper.draw(n,e.count),t.gl.disableVertexAttribArray(i),G){const e=l.u.fromValues(2184,1700,3981),t=l.u.fromValues(133,133,133),n=l.k.create();n[0]=1/(t[0]*t[0]),n[4]=1/(t[1]*t[1]),n[8]=1/(t[2]*t[2]);const i=l.k.fromMat4(l.k.create(),r),o=l.k.multiply(l.k.create(),l.k.transpose(l.k.create(),i),n);l.k.multiply(o,o,i);const a=l.u.transformMat4(l.u.create(),e,s);console.log("Aviewport",o),console.log("cViewport",a);const c=function(e,t){const n=[[e[0],e[1],e[2]],[e[3],e[4],e[5]],[e[6],e[7],e[8]]];return{A:n[0][0],B:n[0][1]+n[1][0],C:n[1][1],D:-2*t[0]*n[0][0]-t[1]*(n[0][1]+n[1][0])+t[2]*(n[0][2]+n[2][0]),E:-t[0]*(n[0][1]+n[1][0])-2*t[1]*n[1][1]+t[2]*(n[1][2]+n[2][1]),F:t[0]*t[0]*n[0][0]+t[0]*t[1]*(n[0][1]+n[1][0])-t[0]*t[2]*(n[0][2]+n[2][0])+t[1]*t[1]*n[1][1]-t[1]*t[2]*(n[1][2]+n[2][1])+t[2]*t[2]*n[2][2]-1}}(o,a),u=function(e){const t=e.A,n=e.B/2,i=e.C,r=e.D,s=e.E,o=2*(n*n-t*i),a=(i*r-n*s)/o,c=(t*s-n*r)/o,u=1/(t*a*a+2*n*a*c+i*c*c-e.F),d=u*t,h=u*n,p=u*i,f=d+p,g=Math.sqrt((d-p)*(d-p)+4*h*h),m=(f+g)/2,v=(f-g)/2,b=1/Math.sqrt(m),y=1/Math.sqrt(v);let w;w=Math.abs(h)<1e-10?l.t.fromValues(1,0):d>=p?l.t.fromValues(m-p,h):l.t.fromValues(h,m-d),l.t.normalize(w,w);const x=l.t.fromValues(-w[1],w[0]);return{k:l.t.fromValues(a,c),u1:w,u2:x,a:b,b:y,lambda1:m,lambda2:v,m11:d,m12:h,m22:p}}(c);console.log(c),console.log(u)}})}},perspectiveViewRenderHelper:class extends W{constructor(){super(...arguments),this.sphereRenderHelper=this.registerDisposer(new F(this.gl,10,10)),this.shaderGetter=Object(y.b)(this,this.gl,e=>{this.defineShader(e),this.sphereRenderHelper.defineShader(e),e.addUniform("highp vec4","uLightDirection"),e.addUniform("highp mat4","uNormalTransform"),e.setVertexMain(`\nemitSphere(uProjection, uNormalTransform, aCenter, aRadii, uLightDirection);\n${this.setPartIndex(e)};\n`),e.setFragmentMain("\nemitAnnotation(vec4(vColor.rgb * vLightingFactor, vColor.a));\n")}),this.tempLightVec=new Float32Array(4)}draw(e){const t=this.shaderGetter(e.renderContext.emitter);this.enable(t,e,()=>{const{gl:n}=t;let i=this.tempLightVec,{lightDirection:r,ambientLighting:s,directionalLighting:o}=e.renderContext;l.u.scale(i,r,o),i[3]=s,n.uniform4fv(t.uniform("uLightDirection"),i),n.uniformMatrix4fv(t.uniform("uNormalTransform"),!1,l.m.transpose(l.m.create(),e.annotationLayer.state.globalToObject)),this.sphereRenderHelper.draw(t,e.count)})}},pickIdsPerInstance:1,snapPosition:()=>{},getRepresentativePoint:(e,t)=>{let n=l.u.create();return l.u.transformMat4(n,t.center,e),n},updateViaRepresentativePoint:(e,t,n)=>{let i=Object.assign({},e);return i.center=l.u.transformMat4(l.u.create(),t,n),i}});var $=n(52),H=n(5),q=n(61),Y=n(39),J=n(57),X=n(72),K=n(3),Q=n(25),Z=n(8),ee=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const te=l.m.create();let ne=class extends(Object(Q.c)(Z.b)){constructor(e,t,n,i){super(),this.chunkManager=e,this.source=t,this.state=n,this.filterBySegmentation=i,this.initializeCounterpart(this.chunkManager.rpc,{chunkManager:this.chunkManager.rpcId,source:t.rpcId,segmentationState:this.serializeDisplayState()});const r=()=>{const e={id:this.rpcId,segmentationState:this.serializeDisplayState()};this.rpc.invoke($.i,e)};this.registerDisposer(n.changed.add(r)),this.registerDisposer(i.changed.add(r))}serializeDisplayState(){const e=this.state.value;return null==e?e:this.filterBySegmentation.value?{segmentEquivalences:e.segmentEquivalences.rpcId,visibleSegments:e.visibleSegments.rpcId}:null}};ne=ee([Object(Z.g)($.h)],ne);class ie extends a.a{constructor(e,t){super(),this.chunkManager=e,this.state=t,this.generation=-1,this.redrawNeeded=new K.a,this.handleChangeAffectingBuffer=(()=>{this.generation=-1,this.redrawNeeded.dispatch()}),this.handleSegmentationChanged=(()=>{this.state.filterBySegmentation.value&&this.handleChangeAffectingBuffer()}),this.registerDisposer(t),this.buffer=this.registerDisposer(new m.a(e.gl)),this.registerDisposer(this.source.changed.add(this.handleChangeAffectingBuffer)),this.registerDisposer(t.filterBySegmentation.changed.add(this.handleChangeAffectingBuffer)),this.registerDisposer(()=>this.unregisterSegmentationState()),this.registerDisposer(t.segmentationState.changed.add(()=>{const e=t.segmentationState.value;e!==this.segmentationState&&(this.unregisterSegmentationState(),null!=e&&(e.visibleSegments.changed.add(this.handleSegmentationChanged),e.segmentEquivalences.changed.add(this.handleSegmentationChanged)),this.segmentationState=e,this.handleSegmentationChanged())})),this.source instanceof h.b||(this.sharedObject=this.registerDisposer(new ne(e,this.source,t.segmentationState,t.filterBySegmentation))),this.registerDisposer(this.state.color.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(this.state.fillOpacity.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(this.hoverState.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(this.transform.changed.add(this.redrawNeeded.dispatch))}get source(){return this.state.source}get transform(){return this.state.transform}get hoverState(){return this.state.hoverState}unregisterSegmentationState(){const{segmentationState:e}=this;null!=e&&(e.visibleSegments.changed.remove(this.handleSegmentationChanged),e.segmentEquivalences.changed.remove(this.handleSegmentationChanged),this.segmentationState=void 0)}get visibility(){const{sharedObject:e}=this;if(void 0!==e)return e.visibility}get gl(){return this.chunkManager.gl}updateBuffer(){const{source:e}=this;if(e instanceof h.b){const t=e.changed.count;if(this.generation!==t){this.generation=t;const{data:n,typeToIds:i,typeToOffset:r,numPickIds:s}=function(e,t){const n=[];for(const e of h.e)n[e]=[];for(const i of e)(void 0===t||t(i))&&n[i.type].push(i.id);let i=0,r=0;const s=[];for(const e of h.e){s[e]=i;const t=n[e].length,o=Object(p.b)(e);i+=t*o.bytes,r+=o.pickIdsPerInstance*t}const o=new ArrayBuffer(i);for(const t of h.e){const i=n[t],r=Object(p.b)(t).serializer(o,s[t],i.length);i.forEach((t,n)=>r(e.get(t),n))}return{typeToIds:n,typeToOffset:s,data:o,numPickIds:r}}(e,this.state.filterBySegmentation.value?function(e){if(null==e)return()=>!1;const{visibleSegments:t,segmentEquivalences:n}=e;return e=>{const{segments:i}=e;if(void 0===i)return!1;for(const e of i)if(t.has(n.get(e)))return!0;return!1}}(this.segmentationState):void 0);this.data=new Uint8Array(n),this.buffer.setData(this.data),this.typeToIds=i,this.typeToOffset=r,this.numPickIds=s}}}}function re(e,t){return class extends e{constructor(...e){super(...e),this.renderHelpers=[],this.isAnnotation=!0;const n=this.registerDisposer(this.base),i=n.visibility;void 0!==i&&this.registerDisposer(i.add(this.visibility)),this.role=n.state.role;const{renderHelpers:r,gl:s}=this;for(const e of h.e){const n=Object(p.b)(e),i=n[t],o=r[e]=this.registerDisposer(new i(s));o.pickIdsPerInstance=n.pickIdsPerInstance,o.targetIsSliceView="sliceViewRenderHelper"===t}this.registerDisposer(n.redrawNeeded.add(()=>{this.redrawNeeded.dispatch()})),this.setReady(!0)}get gl(){return this.base.chunkManager.gl}drawGeometryChunkData(e,t){if(!e.bufferValid){let{buffer:t}=e;void 0===t&&(t=e.buffer=new m.a(this.gl)),t.setData(e.data),e.bufferValid=!0}this.drawGeometry(e,t)}drawGeometry(e,t){const{base:n}=this,i=e.typeToIds,r=e.typeToOffset;let s=0;t.emitPickID&&(s=t.pickIDs.register(this,e.numPickIds,0,0,e));const o=n.hoverState.value,a=l.m.multiply(te,t.dataToDevice,n.state.objectToGlobal);for(const l of h.e){const c=i[l];if(c.length>0){const i=c.length,u=Object(p.b)(l);let d=4294967295;if(void 0!==o){const e=Object(g.a)(c,o.id,(e,t)=>e<t?-1:e===t?0:1);e>=0&&(d=e*u.pickIdsPerInstance)}const h={annotationLayer:n,renderContext:t,selectedIndex:d,basePickId:s,buffer:e.buffer,bufferOffset:r[l],count:i,projectionMatrix:a};this.renderHelpers[l].draw(h),s+=i*u.pickIdsPerInstance}}}draw(e){const{source:t}=this.base;if(t instanceof h.b){const{base:t}=this;t.updateBuffer(),this.drawGeometry(t,e)}else if(this.drawGeometryChunkData(t.temporary.data,e),this.base.state.filterBySegmentation.value){const n=this.base.state.segmentationState.value;if(null==n)return;const i=t.segmentFilteredSource.chunks;Object(Y.a)(n,t=>{const n=Object(Y.b)(t),r=i.get(n);void 0!==r&&this.drawGeometryChunkData(r.data,e)})}else for(const n of t.sources)for(const t of n)for(const n of t.chunks.values())n.state===H.g.GPU_MEMORY&&this.drawGeometryChunkData(n.data,e)}updateMouseState(e,t,n,i){const r=i,s=r.typeToIds,o=r.typeToOffset;for(const t of h.e){const i=s[t],a=Object(p.b)(t),{pickIdsPerInstance:l}=a;if(n<i.length*l){const s=Math.floor(n/l),c=i[s],u=n%l;return e.pickedAnnotationId=c,e.pickedAnnotationLayer=this.base.state,e.pickedOffset=u,e.pickedAnnotationBuffer=r.data.buffer,e.pickedAnnotationBufferOffset=r.data.byteOffset+o[t]+s*a.bytes,void a.snapPosition(e.position,this.base.state.objectToGlobal,e.pickedAnnotationBuffer,e.pickedAnnotationBufferOffset,u)}n-=i.length*l}}transformPickedValue(e,t){}isReady(){const{base:e}=this,{source:t}=e;if(!(t instanceof d.b))return!0;if(!e.state.filterBySegmentation.value)return!0;const n=this.base.state.segmentationState.value;if(void 0===n)return!1;if(null===n)return!0;const i=t.segmentFilteredSource.chunks;let r=!1;return Object(Y.a)(n,e=>{const t=Object(Y.b)(e);i.has(t)||(r=!0)}),!r}}}const se=re(class extends q.a{constructor(e){super(),this.base=e}},"perspectiveViewRenderHelper");class oe extends se{constructor(){super(...arguments),this.backend=(()=>{const{source:e}=this.base;if(e instanceof d.b){const t=this.registerDisposer(new Z.b),n=e.chunkManager.rpc;return t.RPC_TYPE_ID=$.e,t.initializeCounterpart(n,{source:e.rpcId,filterBySegmentation:this.registerDisposer(J.a.makeFromExisting(n,this.base.state.filterBySegmentation)).rpcId}),t}})()}isReady(){if(!super.isReady())return!1;const{base:e}=this,{source:t}=e;if(t instanceof d.b&&!e.state.filterBySegmentation.value){const e=t.sources[0][0].chunks.get("0,0,0");if(void 0===e||e.state!==H.g.GPU_MEMORY)return!1}return!0}}const ae=re(class extends X.b{constructor(e){super(),this.base=e}},"sliceViewRenderHelper");n.d(t,"b",function(){return u}),n.d(t,"c",function(){return d.b}),n.d(t,"a",function(){return ie}),n.d(t,"d",function(){return oe}),n.d(t,"e",function(){return ae})},function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return a});var i=n(104),r=n(14),s=n(24);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const o="google-brainmaps";function a(e,t,n,o=r.e){return Object(i.a)(t,`${e.serverUrl}${n.path}`,{method:n.method,body:n.payload},"json"===n.responseType?s.f:s.e,(e,t)=>{const n=new Headers(t.headers);return n.set("Authorization",`${e.tokenType} ${e.accessToken}`),Object.assign({},t,{headers:n})},e=>{const{status:t}=e;if(401===t)return"refresh";if(504===t||503===t)return"retry";throw e},o)}},function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return a});var i=n(2),r=n(81),s=n(60);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const o=4;class a extends i.a{constructor(e,t=1){super(),this.circlesPerInstance=t,this.squareCornersBuffer=Object(s.a)(e,-1,-1,1,1,t,1),this.quadHelper=this.registerDisposer(new r.a(e,t))}defineShader(e,t){e.addAttribute("highp vec2","aCircleCornerOffset"),e.addUniform("highp vec4","uCircleParams"),e.addVarying("highp vec2","vCircleCoord"),e.addVertexCode("\nvoid emitCircle(vec4 position) {\n  gl_Position = position;\n  gl_Position.xy += aCircleCornerOffset * uCircleParams.xy * gl_Position.w;\n  vCircleCoord = aCircleCornerOffset;\n}\n"),t?e.addFragmentCode("\nfloat getCircleAlphaMultiplier() {\n  return 1.0 - 2.0 * abs(0.5 - gl_FragCoord.z);\n}\n"):e.addFragmentCode("\nfloat getCircleAlphaMultiplier() {\n  return 1.0;\n}\n"),e.addFragmentCode("\nvec4 getCircleColor(vec4 interiorColor, vec4 borderColor) {\n  float radius = length(vCircleCoord);\n  if (radius > 1.0) {\n    discard;\n  }\n\n  float borderColorFraction = clamp((radius - uCircleParams.z) / uCircleParams.w, 0.0, 1.0);\n  float feather = clamp((1.0 - radius) / uCircleParams.w, 0.0, 1.0);\n  vec4 color = mix(interiorColor, borderColor, borderColorFraction);\n\n  return vec4(color.rgb, color.a * feather * getCircleAlphaMultiplier());\n}\n")}draw(e,t,n,i){const{gl:r}=e,s=e.attribute("aCircleCornerOffset");this.squareCornersBuffer.bindToVertexAttrib(s,2);const o=n.interiorRadiusInPixels+n.borderWidthInPixels+n.featherWidthInPixels;r.uniform4f(e.uniform("uCircleParams"),o/t.viewportWidth,o/t.viewportHeight,n.interiorRadiusInPixels/o,0===n.featherWidthInPixels?1e-6:n.featherWidthInPixels/o),this.quadHelper.draw(r,i),e.gl.disableVertexAttribArray(s)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"b",function(){return o});var i=n(104),r=n(14);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const s="boss";function o(e,t,n,s,o=r.e){return Object(i.a)(e,t,n,s,e=>{const t=new Headers(n.headers);return t.set("Authorization",`Bearer ${e}`),Object.assign({},n,{headers:t})},e=>{const{status:t}=e;if(403===t||401===t)return"refresh";if(504===t)return"retry";throw e},o)}},function(e,t,n){"use strict";n.d(t,"b",function(){return L}),n.d(t,"a",function(){return T});var i=n(6),r=n(52),s=n(32),o=n(11),a=n(39),l=n(45),c=n(70),u=n(22),d=n(42),h=n(0),p=n(3),f=n(8),g=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class m{constructor(e){this.bufferValid=!1,this.data=e.data;const t=this.typeToIds=e.typeToIds;let n=0;for(const e of i.e)n+=Object(s.b)(e).pickIdsPerInstance*t[e].length;this.numPickIds=n,this.typeToOffset=e.typeToOffset}freeGPUMemory(e){const{buffer:t}=this;void 0!==t&&(t.dispose(),this.bufferValid=!1,this.buffer=void 0)}}class v extends o.b{constructor(e,t){super(e),this.data=new m(t)}freeGPUMemory(e){super.freeGPUMemory(e),this.data.freeGPUMemory(e)}dispose(){this.data=void 0}}class b extends l.b{constructor(e,t){super(e,t),this.data=new m(t)}freeGPUMemory(e){super.freeGPUMemory(e),this.data.freeGPUMemory(e)}dispose(){this.data=void 0}}let y=class extends l.c{constructor(e,t){super(e,t),this.immediateChunkUpdates=!0,this.parent=t.parent,this.parameters=t.parameters,this.spec=t.spec}initializeCounterpart(e,t){t.parameters=this.parameters,t.parent=this.parent.rpcId,super.initializeCounterpart(e,t)}addChunk(e,t){super.addChunk(e,t)}getChunk(e){return new b(this,e)}};y=g([Object(f.g)(r.c)],y);let w=class extends o.e{constructor(e,t){super(e,{}),this.parent=t,this.immediateChunkUpdates=!0}initializeCounterpart(e,t){t.parent=this.parent.rpcId,super.initializeCounterpart(e,t)}addChunk(e,t){super.addChunk(e,t)}getChunk(e){return new v(this,e)}};w=g([Object(f.g)(r.j)],w);class x extends o.b{constructor(e,t){super(e),this.annotation=Object(i.f)(t.annotation)}}let S=class extends o.e{constructor(e,t){super(e),this.parent=t}getChunk(e){return new x(this,e)}addChunk(e,t){super.addChunk(e,t);const{references:n}=this.parent,i=n.get(e);void 0!==i&&(i.value=t.annotation,i.changed.dispatch())}deleteChunk(e){const{references:t}=this.parent,n=t.get(e);void 0!==n&&(n.value=void 0,n.changed.dispatch())}initializeCounterpart(e,t){t.parent=this.parent.rpcId,super.initializeCounterpart(e,t)}};function C(e,t){const n=t.type;let r=e.typeToIds[n];const o=Object(i.g)(n),a=o.serializedBytes,l=Object(s.b)(n);let c=Object(d.a)(r,t.id,(e,t)=>e<t?-1:e===t?0:1),u=0;if(c<0){c=~c,r.splice(c,0,t.id);const i=new Uint8Array(e.data.length+a);e.numPickIds+=l.pickIdsPerInstance,u=e.typeToOffset[n]+a*c,i.set(e.data.subarray(0,u),0),i.set(e.data.subarray(u),u+a),e.data=i}else u=e.typeToOffset[n]+o.serializedBytes*c;o.serializer(e.data.buffer,e.typeToOffset[n],r.length)(t,c);for(const t of i.e)t>n&&(e.typeToOffset[t]+=a);e.bufferValid=!1}function O(e,t,n){let r=e.typeToIds[t];const o=Object(s.b)(t),a=o.bytes;let l=Object(d.a)(r,n,(e,t)=>e<t?-1:e===t?0:1);if(l<0)return!1;e.numPickIds-=o.pickIdsPerInstance,r.splice(l,1);const c=e.typeToOffset[t]+o.bytes*l,u=new Uint8Array(e.data.length-a);u.set(e.data.subarray(0,c),0),u.set(e.data.subarray(c+a),c),e.data=u;for(const n of i.e)n>t&&(e.typeToOffset[n]-=a);return e.bufferValid=!1,!0}S=g([Object(f.g)(r.d)],S);class L extends f.b{constructor(e,t){super(),this.chunkManager=e,this.metadataChunkSource=this.registerDisposer(new S(this.chunkManager,this)),this.objectToLocal=h.m.create(),this.temporary=function(){const e=[],t=[];for(const n of i.e)e[n]=[],t[n]=0;return new b(void 0,{data:new Uint8Array(0),numPickIds:0,typeToOffset:t,typeToIds:e})}(),this.references=new Map,this.localUpdates=new Map,this.numCommitsInProgress=0,this.changed=new p.a,this.readonly=!1,this.sources=t.sourceSpecifications.map(t=>t.map(({parameters:t,spec:n})=>this.registerDisposer(new y(e,{spec:n,parameters:t,parent:this})))),this.segmentFilteredSource=this.registerDisposer(new w(e,this))}getSources(e){const{sources:t}=this;return t.forEach(e=>e.forEach(e=>e.addRef())),t}initializeCounterpart(e,t){this.metadataChunkSource.initializeCounterpart(e,{});for(const t of this.sources)for(const n of t)n.initializeCounterpart(e,{});this.segmentFilteredSource.initializeCounterpart(e,{}),t.segmentFilteredSource=this.segmentFilteredSource.addCounterpartRef(),t.metadataChunkSource=this.metadataChunkSource.addCounterpartRef(),t.sources=this.sources.map(e=>e.map(e=>e.addCounterpartRef())),t.chunkManager=this.chunkManager.rpcId,super.initializeCounterpart(e,t)}add(e,t=!0){e.id=Object(i.h)();const n=new i.a(e.id);return n.value=e,this.references.set(n.id,n),n.registerDisposer(()=>{this.references.delete(n.id)}),this.applyLocalUpdate(n,!1,t,e),n}applyLocalUpdate(e,t,n,i){const{localUpdates:r}=this,{id:s}=e;let o=this.localUpdates.get(s);const a=e.value;if(null==a)throw new Error("Cannot create local update from null annotation");if(void 0===o?(o={type:a.type,reference:e.addRef(),existingAnnotation:t?a:void 0,pendingCommit:void 0,commitInProgress:void 0},r.set(s,o),this.forEachPossibleChunk(a,e=>{O(e.data,a.type,s)}),null!==i&&C(this.temporary.data,i)):(null===i?O(this.temporary.data,a.type,a.id):C(this.temporary.data,i),e.value=i),n)if(void 0!==o.commitInProgress)o.pendingCommit=i;else{if(null===i&&void 0===o.existingAnnotation)return r.delete(s),void o.reference.dispose();this.sendCommitRequest(o,i)}this.notifyChanged(e.id,i||void 0)}sendCommitRequest(e,t){this.updateCommitsInProgress(1),e.commitInProgress=t,this.rpc.invoke(r.b,{id:this.rpcId,annotationId:e.existingAnnotation&&e.reference.id,newAnnotation:t})}delete(e){this.applyLocalUpdate(e,!0,!0,null)}update(e,t){this.applyLocalUpdate(e,!0,!1,t)}notifyChanged(e,t){const n=this.references.get(e),i=this.metadataChunkSource.chunks.get(e);void 0!==i&&(i.annotation=t||null),void 0!==n&&(n.value=t||null,n.changed.dispatch()),this.chunkManager.chunkQueueManager.visibleChunksChanged.dispatch()}commit(e){this.applyLocalUpdate(e,!0,!0,e.value)}getReference(e){let t=this.references.get(e);if(void 0!==t)return t.addRef();t=new i.a(e),this.references.set(e,t),this.rpc.invoke(r.f,{id:this.rpcId,annotation:e}),t.registerDisposer(()=>{this.references.delete(e),this.rpc.invoke(r.g,{id:this.rpcId,annotation:e})});const n=this.metadataChunkSource.chunks.get(e);return void 0!==n&&(t.value=n.annotation),t}forEachPossibleChunk(e,t){const{sources:n}=this;if(1!==n.length||1!==n[0].length)throw new Error("Not implemented");const i=n[0][0];if(i.chunks.size>1)throw new Error("Not implemented");for(const e of i.chunks.values())t(e);const{segments:r}=e;if(void 0===r||0===r.length)return;const{segmentFilteredSource:s}=this;for(const e of r){const n=s.chunks.get(Object(a.b)(e));void 0!==n&&t(n)}}static encodeOptions(e){return{}}handleSuccessfulUpdate(e,t){const n=this.localUpdates.get(e);if(void 0===n||void 0===n.commitInProgress)throw new Error("Received invalid successful update notification");if(this.updateCommitsInProgress(-1),null!==t&&n.reference.id!==t.id){if(null===n.commitInProgress)throw new Error("Received invalid successful update notification");n.reference.id=t.id,this.references.delete(e),this.references.set(t.id,n.reference),this.localUpdates.delete(e),this.localUpdates.set(t.id,n),null!==n.reference.value&&(n.reference.value.id=t.id,O(this.temporary.data,n.type,e),C(this.temporary.data,n.reference.value)),n.reference.changed.dispatch()}n.existingAnnotation=t||void 0,n.commitInProgress=void 0;let{pendingCommit:i}=n;n.pendingCommit=void 0,null===t&&(i=void 0),void 0!==i?(null!==i&&(i.id=t.id),this.sendCommitRequest(n,i)):this.revertLocalUpdate(n)}disposed(){const{commitStatus:e}=this;void 0!==e&&e.dispose()}updateCommitsInProgress(e){if(this.numCommitsInProgress+=e,0===this.numCommitsInProgress)void 0!==this.commitStatus&&(this.commitStatus.dispose(),this.commitStatus=void 0);else if(void 0===this.commitStatus){(this.commitStatus=new u.a(!0)).setText("Commiting annotations")}}handleFailedUpdate(e,t){const n=this.localUpdates.get(e);if(void 0===n||void 0===n.commitInProgress)throw new Error("Received invalid update notification");(new u.a).setErrorMessage(`Error commiting annotation update: ${t}`),this.revertLocalUpdate(n),this.updateCommitsInProgress(-1)}revertLocalUpdate(e){O(this.temporary.data,e.type,e.reference.id);const{existingAnnotation:t}=e;void 0!==t&&this.forEachPossibleChunk(t,e=>{C(e.data,t)});const{reference:n}=e,{id:i}=n;n.value=t||null,n.changed.dispatch(),n.dispose(),this.localUpdates.delete(i)}*[Symbol.iterator](){}}Object(f.e)(r.a,function(e){const t=this.get(e.id),n=e.annotationId,r=e.error;if(void 0!==r)t.handleFailedUpdate(n,r);else{const r=Object(i.f)(e.newAnnotation);t.handleSuccessfulUpdate(n,r)}});class T extends c.a{constructor(e){super(e.chunkManager,e.getSources({}),{})}draw(){}}},function(e,t,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function i(e,t,n){let{document:i}=e.view,r=e.clientX,s=e.clientY;const o=e=>{const n=e.clientX-r,i=e.clientY-s;r=e.clientX,s=e.clientY,t(e,n,i)},a=e.button,l=e=>{i.removeEventListener("pointermove",o,!0),i.removeEventListener("pointerup",c,!1),void 0!==n&&n(e,e.clientX-r,e.clientY-s)},c=e=>{e.button===a&&l(e)};i.addEventListener("pointermove",o,!0),i.addEventListener("pointerup",c,!1),i.addEventListener("pointercancel",l,!1)}n.d(t,"a",function(){return i})},function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return a});var i=n(2),r=n(81),s=n(60);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const o=r.b;class a extends i.a{constructor(e,t=1){super(),this.linesPerInstance=t,this.lineOffsetsBuffer=Object(s.a)(e,0,-1,1,1,t,1),this.quadHelper=this.registerDisposer(new r.a(e,t))}defineShader(e){e.addAttribute("highp vec2","aLineOffset"),e.addUniform("highp vec3","uLineParams"),e.addVarying("highp float","vLineCoord"),e.addVertexCode("\nuint getLineEndpointIndex() { return uint(aLineOffset.x); }\n"),e.addVertexCode("\nvoid emitLine(mat4 projection, vec3 vertexA, vec3 vertexB) {\n  vec3 vertexPosition = mix(vertexA, vertexB, aLineOffset.x);\n  vec3 otherVertexPosition = mix(vertexB, vertexA, aLineOffset.x);\n\n  vec4 vertexPositionClip = projection * vec4(vertexPosition, 1.0);\n  vec4 otherVertexPositionClip = projection * vec4(otherVertexPosition, 1.0);\n\n  vec3 vertexPositionDevice = vertexPositionClip.xyz / vertexPositionClip.w;\n  vec3 otherVertexPositionDevice = otherVertexPositionClip.xyz / otherVertexPositionClip.w;\n\n  vec2 lineDirection = normalize(otherVertexPositionDevice.xy - vertexPositionDevice.xy);\n  vec2 lineNormal = vec2(lineDirection.y, -lineDirection.x);\n\n  gl_Position = vertexPositionClip;\n  gl_Position.xy += aLineOffset.y * (2.0 * aLineOffset.x - 1.0) * lineNormal * uLineParams.xy * 0.5 * gl_Position.w;\n  vLineCoord = aLineOffset.y;\n}\n"),e.addFragmentCode("\nfloat getLineAlpha() {\n  return clamp((1.0 - abs(vLineCoord)) / uLineParams.z, 0.0, 1.0);\n}\n")}draw(e,t,n,i,r){const s=e.attribute("aLineOffset");this.lineOffsetsBuffer.bindToVertexAttrib(s,2);const o=n+i,{gl:a}=e;a.uniform3f(e.uniform("uLineParams"),o/t.viewportWidth,o/t.viewportHeight,0===i?1e-6:i/o),this.quadHelper.draw(a,r),a.disableVertexAttribArray(s)}}},function(e,t,n){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var i=n(8);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r=class extends i.b{constructor(e,t){super(),this.provider=e,this.registerDisposer(e),this.initializeCounterpart(t)}get(e,t){return this.provider.get(e,t)}};r=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([Object(i.g)("CredentialsProvider")],r),Object(i.d)("CredentialsProvider.get",function(e,t){return this.get(e.providerId).get(e.invalidCredentials,t).then(e=>({value:e}))});var s=n(35);function o(){return function(e){return class extends e{constructor(...e){super(...e);const t=e[1];this.credentialsProvider=t.credentialsProvider.addRef()}initializeCounterpart(e,t){t.credentialsProvider=
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e,t){const n=e.memoize.get({type:"getSharedCredentialsProvider",credentialsProvider:Object(s.a)(t)},()=>new r(t.addRef(),e.rpc)),i=n.addCounterpartRef();return n.dispose(),i}(this.chunkManager,this.credentialsProvider),super.initializeCounterpart(e,t)}static encodeOptions(e){const t=super.encodeOptions(e);return t.credentialsProvider=Object(s.a)(e.credentialsProvider),t}}}}n.d(t,"a",function(){return o})},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(59),r=n(20),s=n(30),o=n(57),a=n(27),l=n(0),c=n(8);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class u extends r.f{constructor(e,t,n){super(),this.chunkManager=e,this.sources=t,this.rpcId=null,this.transformedSourcesGeneration=-1;const{transform:r=new i.a,renderScaleTarget:u=Object(s.e)(1)}=n;this.renderScaleTarget=u,this.renderScaleHistogram=n.renderScaleHistogram,this.transform=r;const d=Object(a.m)(this);{const{source:e,chunkLayout:t}=d[0][0],{spec:n}=e,i=this.voxelSize=t.localSpatialVectorToGlobal(l.u.create(),n.voxelSize);for(let e=0;e<3;++e)i[e]=Math.abs(i[e])}const h=this.registerDisposer(new c.b),p=this.chunkManager.rpc;h.RPC_TYPE_ID=a.d;const f=t.map(e=>e.map(e=>e.rpcId));h.initializeCounterpart(p,{sources:f,transform:r.transform,renderScaleTarget:this.registerDisposer(o.a.makeFromExisting(p,this.renderScaleTarget)).rpcId}),this.rpcId=h.rpcId,this.registerDisposer(r.changed.add(()=>{p.invoke(a.e,{id:this.rpcId,value:r.transform})})),this.setReady(!0)}get gl(){return this.chunkManager.chunkQueueManager.gl}setGLBlendMode(e,t){t>0&&(e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA))}}},function(e,t,n){"use strict";var i=n(13),r=n.n(i),s=n(2),o=class{static insertAfter(e,t){let n=e.next0;t.next0=n,t.prev0=e,e.next0=t,n.prev0=t}static insertBefore(e,t){let n=e.prev0;t.prev0=n,t.next0=e,e.prev0=t,n.next0=t}static front(e){let t=e.next0;return t===e?null:t}static back(e){let t=e.prev0;return t===e?null:t}static pop(e){let t=e.next0,n=e.prev0;return t.prev0=n,n.next0=t,e.next0=null,e.prev0=null,e}static*iterator(e){for(let t=e.next0;t!==e;t=t.next0)yield t}static*reverseIterator(e){for(let t=e.prev0;t!==e;t=t.prev0)yield t}static initializeHead(e){e.next0=e.prev0=e}};n.d(t,"a",function(){return c});const a=new
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class{constructor(){o.initializeHead(this)}},l=r()(()=>{const{activeElement:e}=document;if(null===e||e===document.body){const e=o.front(a);null!==e&&e.element.focus()}});window.addEventListener("focus",()=>{l()},!0),window.addEventListener("blur",()=>{l()},!0);class c extends s.a{constructor(e){super(),this.element=e,this.prev0=null,this.next0=null,this.lastFocusedElement=null,this.scheduleUpdateFocus=this.registerCancellable(r()(()=>{const{activeElement:e}=document,{element:t}=this;t.contains(e)||(null==e||e!==this.lastFocusedElement&&!e.contains(t)||this.element.focus(),this.lastFocusedElement=null)},0)),e.tabIndex=-1,this.registerEventListener(e,"mouseenter",()=>{this.lastFocusedElement=document.activeElement,this.scheduleUpdateFocus()}),this.registerEventListener(e,"mouseleave",()=>{this.scheduleUpdateFocus.cancel()}),o.insertBefore(a,this),this.registerEventListener(e,"focus",()=>{o.pop(this),o.insertAfter(a,this)}),l()}disposed(){o.pop(this),super.disposed()}}},function(e,t,n){"use strict";n.d(t,"b",function(){return m}),n.d(t,"a",function(){return b});var i,r=n(101),s=n(20),o=n(102),a=n(33),l=n(45),c=n(7),u=n(0),d=n(67),h=n(38),p=n(54);function f(e){e.addOutputBuffer("vec4","out_fragColor",null),e.addFragmentCode("\nvoid emit(vec4 color, highp uint pickId) {\n  out_fragColor = color;\n}\n")}function g(e){e.addOutputBuffer("highp float","out_pickId",null),e.addFragmentCode("\nvoid emit(vec4 color, highp uint pickId) {\n  out_pickId = float(pickId);\n}\n")}!function(e){e[e.COLOR=0]="COLOR",e[e.PICK=1]="PICK",e[e.NUM_TEXTURES=2]="NUM_TEXTURES"}(i||(i={}));class m extends s.j{draw(e){}isReady(){return!0}}const v=u.w.create();class b extends a.a{constructor(e,t,n,i){super(e,t,i),this.sliceView=n,this.axesLineHelper=this.registerDisposer(r.a.get(this.gl)),this.sliceViewRenderHelper=this.registerDisposer(l.d.get(this.gl,f)),this.colorFactor=u.w.fromValues(1,1,1,1),this.pickIDs=new o.a,this.visibleLayerTracker=Object(s.l)(this.viewer.layerManager,m,this.viewer.visibleLayerRoles,this),this.offscreenFramebuffer=this.registerDisposer(new h.b(this.gl,{colorBuffers:[new h.e(this.gl,WebGL2RenderingContext.RGBA8,WebGL2RenderingContext.RGBA,WebGL2RenderingContext.UNSIGNED_BYTE),new h.e(this.gl,WebGL2RenderingContext.R32F,WebGL2RenderingContext.RED,WebGL2RenderingContext.FLOAT)]})),this.offscreenCopyHelper=this.registerDisposer(h.c.get(this.gl)),this.scaleBarCopyHelper=this.registerDisposer(h.c.get(this.gl)),this.scaleBarTexture=this.registerDisposer(new p.a(this.gl)),Object(c.d)(t,"rotate-via-mouse-drag",e=>{const{mouseState:t}=this.viewer;if(t.updateUnconditionally()){const n=u.u.clone(t.position);Object(d.a)(e.detail,(e,t,i)=>{let{viewportAxes:r}=this.sliceView;this.viewer.navigationState.pose.rotateAbsolute(r[1],-t/4*Math.PI/180,n),this.viewer.navigationState.pose.rotateAbsolute(r[0],-i/4*Math.PI/180,n)})}}),Object(c.d)(t,"rotate-in-plane-via-touchrotate",e=>{const{detail:t}=e,{mouseState:n}=this.viewer;if(this.handleMouseMove(t.centerX,t.centerY),n.updateUnconditionally()){const{viewportAxes:e}=this.sliceView;this.navigationState.pose.rotateAbsolute(e[2],t.angle-t.prevAngle,n.position)}}),this.registerDisposer(n),this.registerDisposer(i.crossSectionBackgroundColor.changed.add(()=>this.scheduleRedraw())),this.registerDisposer(n.visibility.add(this.visibility)),this.registerDisposer(n.viewChanged.add(()=>{this.visible&&e.scheduleRedraw()})),this.registerDisposer(i.showAxisLines.changed.add(()=>{this.visible&&this.scheduleRedraw()})),this.registerDisposer(i.showScaleBar.changed.add(()=>{this.visible&&this.context.scheduleRedraw()})),this.registerDisposer(i.scaleBarOptions.changed.add(()=>{this.visible&&this.context.scheduleRedraw()}))}get navigationState(){return this.sliceView.navigationState}translateByViewportPixels(e,t){const{position:n}=this.viewer.navigationState,i=n.spatialCoordinates;u.u.set(i,-e,-t,0),u.u.transformMat4(i,i,this.sliceView.viewportToData),n.changed.dispatch()}translateDataPointByViewportPixels(e,t,n,i){return u.u.transformMat4(e,t,this.sliceView.dataToViewport),u.u.set(e,e[0]+n,e[1]+i,e[2]),u.u.transformMat4(e,e,this.sliceView.viewportToData),e}isReady(){if(!this.visible)return!1;if(!this.sliceView.isReady())return!1;let e=this.visibleLayerTracker.getVisibleLayers();for(let t of e)if(!t.isReady())return!1;return!0}drawWithPicking(e){let{sliceView:t}=this;if(t.setViewportSize(this.width,this.height),t.updateRendering(),!t.hasValidViewport)return!1;u.m.copy(e.invTransform,t.viewportToData);const{gl:n}=this,{width:r,height:s,dataToDevice:o}=t;this.offscreenFramebuffer.bind(r,s),n.disable(WebGL2RenderingContext.SCISSOR_TEST),this.gl.clearColor(0,0,0,0),n.clear(WebGL2RenderingContext.COLOR_BUFFER_BIT);let a=u.m.create();const l=v,c=this.viewer.crossSectionBackgroundColor.value;l[0]=c[0],l[1]=c[1],l[2]=c[2],l[3]=1,this.offscreenFramebuffer.bindSingle(i.COLOR),this.sliceViewRenderHelper.draw(t.offscreenFramebuffer.colorBuffers[0].texture,u.e,this.colorFactor,l,0,0,1,1);let d=this.visibleLayerTracker.getVisibleLayers(),{pickIDs:h}=this;h.clear();let p={dataToDevice:t.dataToDevice,pickIDs:h,emitter:f,emitColor:!0,emitPickID:!1,viewportWidth:r,viewportHeight:s,sliceView:t};n.enable(WebGL2RenderingContext.BLEND),n.blendFunc(WebGL2RenderingContext.SRC_ALPHA,WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA);for(let e of d)e.draw(p);n.disable(WebGL2RenderingContext.BLEND),this.offscreenFramebuffer.bindSingle(i.PICK),p.emitColor=!1,p.emitPickID=!0,p.emitter=g;for(let e of d)e.draw(p);if(this.viewer.showAxisLines.value||this.viewer.showScaleBar.value){if(this.viewer.showAxisLines.value){u.m.copy(a,o);for(let e=0;e<3;++e)a[12+e]=0;for(let e=0;e<4;++e)a[2+4*e]=0;let e=Math.min(r,s)/4*1.5,n=t.pixelSize;for(let t=0;t<12;++t)a[t]*=e*n}if(this.offscreenFramebuffer.bindSingle(i.COLOR),this.viewer.showAxisLines.value&&this.axesLineHelper.draw(a),this.viewer.showScaleBar.value){n.enable(WebGL2RenderingContext.BLEND),n.blendFunc(WebGL2RenderingContext.SRC_ALPHA,WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA);const e=this.viewer.scaleBarOptions.value,{scaleBarTexture:i}=this,{dimensions:s}=i;s.targetLengthInPixels=Math.min(e.maxWidthFraction*r,e.maxWidthInPixels*e.scaleFactor),s.nanometersPerPixel=t.pixelSize,i.update(e),n.viewport(e.leftPixelOffset*e.scaleFactor,e.bottomPixelOffset*e.scaleFactor,i.width,i.height),this.scaleBarCopyHelper.draw(i.texture),n.disable(WebGL2RenderingContext.BLEND)}}return this.offscreenFramebuffer.unbind(),this.setGLViewport(),this.offscreenCopyHelper.draw(this.offscreenFramebuffer.colorBuffers[i.COLOR].texture),!0}panelSizeChanged(){this.sliceView.setViewportSizeDebounced(this.width,this.height)}issuePickRequest(e,t){const{offscreenFramebuffer:n}=this;n.readPixelFloat32IntoBuffer(i.PICK,e,t,0)}completePickRequest(e,t,n,i){const{mouseState:r}=this.viewer;r.pickedRenderLayer=null;const s=r.position,{viewportWidth:o,viewportHeight:a}=i,l=i.viewportHeight-t;u.u.set(s,e-o/2,l-a/2,0),u.u.transformMat4(s,s,i.invTransform),this.pickIDs.setMouseState(r,n[0]),r.setActive(!0)}zoomByMouse(e){let{navigationState:t}=this;if(!t.valid)return;let{sliceView:n}=this,{width:i,height:r}=n,{mouseX:s,mouseY:o}=this;s-=i/2,o-=r/2;let a=this.navigationState.zoomFactor.value;t.zoomBy(e);let l=t.zoomFactor.value,{spatialCoordinates:c}=t.position;u.u.scaleAndAdd(c,c,n.viewportAxes[0],s*(a-l)),u.u.scaleAndAdd(c,c,n.viewportAxes[1],o*(a-l)),t.position.changed.dispatch()}}},function(e,t,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function i(e,t,n,i){t*=6;let r=Math.floor(t),s=t-r,o=i*(1-n),a=i*(1-n*s),l=i*(1-n*(1-s));switch(r%6){case 0:e[0]=i,e[1]=l,e[2]=o;break;case 1:e[0]=a,e[1]=i,e[2]=o;break;case 2:e[0]=o,e[1]=i,e[2]=l;break;case 3:e[0]=o,e[1]=a,e[2]=i;break;case 4:e[0]=l,e[1]=o,e[2]=i;break;case 5:e[0]=i,e[1]=o,e[2]=a}return e}function r(e,t,n,i){const r=Math.max(Math.max(t,n),i),s=Math.min(Math.min(t,n),i);if(e[2]=r,s===r)e[0]=0,e[1]=0;else{const o=r-s;e[1]=o/r,e[0]=t===r?(n-i)/o:n===r?2+(i-t)/o:4+(t-n)/o,e[0]/=6,e[0]<0&&(e[0]+=1),e[0]>1&&(e[0]-=1)}return e}n.d(t,"a",function(){return i}),n.d(t,"b",function(){return r})},function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"c",function(){return a}),n.d(t,"a",function(){return u});var i=n(14),r=n(2),s=n(84);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class o extends r.a{}function a(e){let t=0;return function(e){let t,n,r;return(s,o)=>void 0===n||void 0!==t&&void 0!==s&&t.generation===s.generation?(t=void 0,r=new i.c,n=e(s,r).then(e=>(t=e,r=void 0,e),e=>{throw r.isCanceled&&(r=void 0,n=void 0),e})):(void 0===t&&r.addConsumer(o),n)}((n,i)=>e(i).then(e=>({generation:++t,credentials:e})))}class l{constructor(){this.providers=new Map}register(e,t){this.providers.set(e,t)}getCredentialsProvider(e,t){const n=this.providers.get(e);if(void 0===n)throw new Error(`No registered credentials provider: ${JSON.stringify(e)}`);return n(t)}}class c extends r.a{constructor(e){super(),this.base=e,this.memoize=new s.b}getCredentialsProvider(e,t){return this.memoize.get({key:e,parameters:t},()=>this.registerDisposer(this.base.getCredentialsProvider(e,t).addRef()))}}class u extends c{constructor(){super(new l)}register(e,t){this.base.register(e,t)}}},function(e,t,n){"use strict";n.d(t,"b",function(){return l}),n.d(t,"a",function(){return c});var i=n(9),r=n(90),s=n(0),o=n(97);function a(e){try{if("string"!=typeof e)throw new Error(`Expected string, but received ${JSON.stringify(e)}.`);const t=document.createElement("canvas").getContext("2d");t.fillStyle=e;const n=
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e){const t=/^rgba\(([0-9]+), ([0-9]+), ([0-9]+), (0(?:\.[0-9]+)?)\)$/;{const n=e.match(t);if(null!==n)return[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10),parseFloat(n[4])]}const n=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/;{const t=e.match(n);if(null!==t)return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),1]}throw new Error(`Invalid serialized color: ${JSON.stringify(e)}.`)}(t.fillStyle);return s.w.fromValues(n[0]/255,n[1]/255,n[2]/255,n[3])}catch(e){throw new Error(`Failed to parse color specification: ${e.message}`)}}function l(e){if(void 0===e[3]||1===e[3]){let t="#";for(let n=0;n<3;++n)t+=Object(o.c)(Math.min(255,Math.max(0,Math.round(255*e[n]))));return t}{let t="rgba(";for(let n=0;n<3;++n)0!==n&&(t+=", "),t+=Math.min(255,Math.max(0,Math.round(255*e[n])));return t+=`, ${Object(r.a)(e[3])})`}}class c extends i.f{constructor(e){super(s.u.clone(e)),this.defaultValue=e}toString(){return l(this.value)}toJSON(){return s.u.equals(this.value,this.defaultValue)?void 0:l(this.value)}reset(){this.value=s.u.clone(this.defaultValue)}restoreState(e){if(void 0===e)return void this.reset();const{value:t}=this,n=function(e){return a(e).subarray(0,3)}(e);s.u.equals(t,n)||(this.value=n)}}},function(e,t,n){"use strict";n(165);var i=n(13),r=n.n(i),s=n(6),o=n(62),a=n(66),l=n(85),c=n(47),u=n(9),d=n(77),h=n(75),p=n(2),f=n(10),g=n(0),m=n(1),v=n(3),b=n(78),y=n(17),w=n(25),x=n(91);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class S extends p.a{constructor(e){super(),this.model=e,this.element=document.createElement("input");const{element:t}=this;t.classList.add("neuroglancer-color-widget"),t.type="color",t.addEventListener("change",()=>this.updateModel()),this.registerDisposer(e.changed.add(()=>this.updateView())),this.updateView()}updateView(){this.element.value=this.model.toString()}updateModel(){this.model.restoreState(this.element.value)}disposed(){Object(f.b)(this.element),super.disposed()}}var C=n(55),O=n(31),L=n(83),T=n(109);n.d(t,"c",function(){return M}),n.d(t,"b",function(){return q}),n.d(t,"a",function(){return K});
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class k extends p.a{constructor(e,t){super(),this.reference=e,this.annotationLayer=t,this.element=document.createElement("div"),this.addSegmentWidget=this.registerDisposer(new T.a),this.debouncedUpdateView=r()(()=>this.updateView(),0),this.element.className="neuroglancer-annotation-segment-list";const{addSegmentWidget:n}=this;n.element.style.display="inline-block",n.element.title="Associate segments",this.element.appendChild(n.element),this.registerDisposer(t.segmentationState.changed.add(this.debouncedUpdateView)),this.registerDisposer(()=>this.unregisterSegmentationState()),this.registerDisposer(this.addSegmentWidget.valuesEntered.add(e=>{const t=this.reference.value;if(null==t)return;const n=[...t.segments||[],...e],i=Object.assign({},t,{segments:n});this.annotationLayer.source.update(this.reference,i),this.annotationLayer.source.commit(this.reference)})),this.registerDisposer(e.changed.add(this.debouncedUpdateView)),this.updateView()}unregisterSegmentationState(){const{segmentationState:e}=this;null!=e&&(e.visibleSegments.changed.remove(this.debouncedUpdateView),e.segmentColorHash.changed.remove(this.debouncedUpdateView),e.segmentSelectionState.changed.remove(this.debouncedUpdateView),this.segmentationState=void 0)}updateView(){const e=this.annotationLayer.segmentationState.value;e!==this.segmentationState&&(this.unregisterSegmentationState(),this.segmentationState=e,null!=e&&(e.visibleSegments.changed.add(this.debouncedUpdateView),e.segmentColorHash.changed.add(this.debouncedUpdateView),e.segmentSelectionState.changed.add(this.debouncedUpdateView)));const{element:t}=this;for(let e=this.addSegmentWidget.element.nextElementSibling;null!==e;){const n=e.nextElementSibling;t.removeChild(e),e=n}t.style.display="none";const n=this.reference.value;if(null==n)return;const i=n.segments;if(null===e)return;if(t.style.display="",void 0===i||0===i.length)return;const r=e?e.segmentColorHash:void 0;i.forEach((i,s)=>{0!==s&&t.appendChild(document.createTextNode(" "));const o=document.createElement("span");o.title="Double click to toggle segment visibility, control+click to disassociate segment from annotation.",o.className="neuroglancer-annotation-segment-item",o.textContent=i.toString(),void 0!==e&&(o.style.backgroundColor=r.computeCssColor(i),o.addEventListener("mouseenter",()=>{e.segmentSelectionState.set(i)}),o.addEventListener("mouseleave",()=>{e.segmentSelectionState.set(null)}),o.addEventListener("dblclick",t=>{t.ctrlKey||(e.visibleSegments.has(i)?e.visibleSegments.delete(i):e.visibleSegments.add(i))})),o.addEventListener("click",e=>{if(!e.ctrlKey)return;const t=(n.segments||[]).filter(e=>!y.a.equal(i,e)),r=Object.assign({},n,{segments:t||void 0});this.annotationLayer.source.update(this.reference,r),this.annotationLayer.source.commit(this.reference)}),t.appendChild(o)})}}class E extends p.a{constructor(e){super(),this.annotationLayerState=e,this.changed=new v.a,this.referenceChanged=(()=>{this.validate(),this.changed.dispatch()}),this.validate=(()=>{const e=this.updateAnnotationLayer(),{annotationLayer:t}=this;if(void 0!==t){const e=this.value_;if(void 0!==e){let n=this.reference_;if(void 0!==n&&n.id!==e.id?e.id=n.id:void 0===n&&(n=this.reference_=t.source.getReference(e.id)).changed.add(this.referenceChanged),null===n.value)return this.unbindReference(),void(this.value=void 0)}else this.unbindReference()}e&&this.changed.dispatch()}),this.registerDisposer(e),this.registerDisposer(e.changed.add(this.validate)),this.updateAnnotationLayer(),this.reference_=void 0,this.value_=void 0}get reference(){return this.reference_}get value(){return this.value_}get validValue(){return this.annotationLayer&&this.value_}set value(e){this.value_=e;const t=this.reference_;void 0!==t&&(void 0!==e&&t.id===e.id||this.unbindReference()),this.validate(),this.changed.dispatch()}updateAnnotationLayer(){const e=this.annotationLayerState.value;return e!==this.annotationLayer&&(this.unbindLayer(),this.annotationLayer=e,void 0!==e&&e.source.changed.add(this.validate),!0)}unbindLayer(){void 0!==this.annotationLayer&&(this.annotationLayer.source.changed.remove(this.validate),this.annotationLayer=void 0)}disposed(){this.unbindLayer(),this.unbindReference(),super.disposed()}unbindReference(){const e=this.reference_;void 0!==e&&(e.changed.remove(this.referenceChanged),this.reference_=void 0)}toJSON(){const e=this.value_;if(void 0!==e)return 0===e.partIndex?e.id:e}reset(){this.value=void 0}restoreState(e){void 0!==e?"string"!=typeof e?(Object(m.t)(e),this.value={id:Object(m.v)(e,"id",m.A),partIndex:Object(m.v)(e,"partIndex",m.x)}):this.value={id:e,partIndex:0}:this.value=void 0}}const A=g.u.create();function M(e,t,n,i,r){const o=e=>(function(e,t,n,i){const r=g.u.transformMat4(g.u.create(),e,t),s=Object(b.c)(n.voxelFromSpatial(A,r));if(void 0!==i){const e=document.createElement("span");return e.className="neuroglancer-voxel-coordinates-link",e.textContent=s,e.title=`Center view on voxel coordinates ${s}.`,e.addEventListener("click",()=>{i(r)}),e}return document.createTextNode(s)})(e,n,i,r);switch(t.type){case s.c.AXIS_ALIGNED_BOUNDING_BOX:case s.c.LINE:e.appendChild(o(t.pointA)),e.appendChild(document.createTextNode("")),e.appendChild(o(t.pointB));break;case s.c.POINT:e.appendChild(o(t.point));break;case s.c.ELLIPSOID:e.appendChild(o(t.center));const r=Object(g.r)(A,t.radii,n);i.voxelFromSpatial(r,r),e.appendChild(document.createTextNode(""+Object(b.b)(r)))}}class I extends O.b{constructor(e,t,n,i,r){super(),this.layer=e,this.state=t,this.annotationLayer=n,this.voxelSize=i,this.setSpatialCoordinates=r,this.annotationListContainer=document.createElement("ul"),this.annotationListElements=new Map,this.updated=!1,this.element.classList.add("neuroglancer-annotation-layer-view"),this.annotationListContainer.classList.add("neuroglancer-annotation-list"),this.registerDisposer(t),this.registerDisposer(i),this.registerDisposer(n);const{source:o}=n;this.registerDisposer(o.childAdded.add(e=>this.addAnnotationElement(e))),this.registerDisposer(o.childUpdated.add(e=>this.updateAnnotationElement(e))),this.registerDisposer(o.childDeleted.add(e=>this.deleteAnnotationElement(e))),this.registerDisposer(this.visibility.changed.add(()=>this.updateView())),this.registerDisposer(n.transform.changed.add(()=>{this.updated=!1,this.updateView()})),this.updateView();const a=document.createElement("div");a.className="neuroglancer-annotation-toolbox",e.initializeAnnotationLayerViewTab(this);{const e=this.registerDisposer(new C.a(this.annotationLayer.fillOpacity));e.promptElement.textContent="Fill opacity",this.element.appendChild(e.element)}const l=this.registerDisposer(new S(this.annotationLayer.color));if(l.element.title="Change annotation display color",a.appendChild(l.element),!n.source.readonly){const e=document.createElement("button");e.textContent=Object(s.g)(s.c.POINT).icon,e.title="Annotate point",e.addEventListener("click",()=>{this.layer.tool.value=new F(this.layer,{})}),a.appendChild(e);const t=document.createElement("button");t.textContent=Object(s.g)(s.c.AXIS_ALIGNED_BOUNDING_BOX).icon,t.title="Annotate bounding box",t.addEventListener("click",()=>{this.layer.tool.value=new W(this.layer,{})}),a.appendChild(t);const n=document.createElement("button");n.textContent=Object(s.g)(s.c.LINE).icon,n.title="Annotate line",n.addEventListener("click",()=>{this.layer.tool.value=new $(this.layer,{})}),a.appendChild(n);const i=document.createElement("button");i.textContent=Object(s.g)(s.c.ELLIPSOID).icon,i.title="Annotate ellipsoid",i.addEventListener("click",()=>{this.layer.tool.value=new H(this.layer,{})}),a.appendChild(i)}this.element.appendChild(a),this.element.appendChild(this.annotationListContainer),this.annotationListContainer.addEventListener("mouseleave",()=>{this.annotationLayer.hoverState.value=void 0}),this.registerDisposer(this.annotationLayer.hoverState.changed.add(()=>this.updateHoverView())),this.registerDisposer(this.state.changed.add(()=>this.updateSelectionView()))}updateSelectionView(){const e=this.state.value;let t;void 0!==e&&(t=e.id);const{previousSelectedId:n}=this;if(t!==n){if(void 0!==n){const e=this.annotationListElements.get(n);void 0!==e&&e.classList.remove("neuroglancer-annotation-selected")}if(void 0!==t){const e=this.annotationListElements.get(t);void 0!==e&&(e.classList.add("neuroglancer-annotation-selected"),e.scrollIntoView())}this.previousSelectedId=t}}updateHoverView(){const e=this.annotationLayer.hoverState.value;let t;void 0!==e&&(t=e.id);const{previousHoverId:n}=this;if(t!==n){if(void 0!==n){const e=this.annotationListElements.get(n);void 0!==e&&e.classList.remove("neuroglancer-annotation-hover")}if(void 0!==t){const e=this.annotationListElements.get(t);void 0!==e&&e.classList.add("neuroglancer-annotation-hover")}this.previousHoverId=t}}addAnnotationElementHelper(e){const{annotationLayer:t,annotationListContainer:n,annotationListElements:i}=this,{objectToGlobal:r}=t,o=this.makeAnnotationListElement(e,r);n.appendChild(o),i.set(e.id,o),o.addEventListener("mouseenter",()=>{this.annotationLayer.hoverState.value={id:e.id,partIndex:0}}),o.addEventListener("click",()=>{this.state.value={id:e.id,partIndex:0}}),o.addEventListener("mouseup",t=>{2===t.button&&this.setSpatialCoordinates(function(e,t){const n=g.u.create();switch(e.type){case s.c.AXIS_ALIGNED_BOUNDING_BOX:case s.c.LINE:g.u.add(n,e.pointA,e.pointB),g.u.scale(n,n,.5);break;case s.c.POINT:g.u.copy(n,e.point);break;case s.c.ELLIPSOID:g.u.copy(n,e.center)}return g.u.transformMat4(n,n,t)}(e,this.annotationLayer.objectToGlobal))})}updateView(){if(!this.visible)return;if(this.updated)return;const{annotationLayer:e,annotationListContainer:t,annotationListElements:n}=this,{source:i}=e;Object(f.a)(t),n.clear();for(const e of i)this.addAnnotationElementHelper(e);this.resetOnUpdate()}addAnnotationElement(e){this.visible&&(this.addAnnotationElementHelper(e),this.resetOnUpdate())}updateAnnotationElement(e){if(this.visible){var t=this.annotationListElements.get(e.id);if(t){if(t.lastElementChild&&3===t.children.length)e.description?t.lastElementChild.innerHTML=e.description:t.removeChild(t.lastElementChild);else{const n=document.createElement("div");n.className="neuroglancer-annotation-description",n.textContent=e.description||"",t.appendChild(n)}this.resetOnUpdate()}}}deleteAnnotationElement(e){if(!this.visible)return;let t=this.annotationListElements.get(e);t&&(Object(f.b)(t),this.annotationListElements.delete(e)),this.resetOnUpdate()}resetOnUpdate(){this.previousSelectedId=void 0,this.previousHoverId=void 0,this.updated=!0,this.updateHoverView(),this.updateSelectionView()}makeAnnotationListElement(e,t){const n=document.createElement("li");n.title="Click to select, right click to recenter view.";const i=document.createElement("div");i.className="neuroglancer-annotation-icon",i.textContent=Object(s.g)(e.type).icon,n.appendChild(i);const r=document.createElement("div");if(r.className="neuroglancer-annotation-position",M(r,e,t,this.voxelSize,this.setSpatialCoordinates),n.appendChild(r),e.description){const t=document.createElement("div");t.className="neuroglancer-annotation-description",t.textContent=e.description,n.appendChild(t)}return n}}class N extends O.b{constructor(e,t,n){super(),this.state=e,this.voxelSize=t,this.setSpatialCoordinates=n,this.valid=!1,this.mouseEntered=!1,this.element.classList.add("neuroglancer-annotation-details"),this.registerDisposer(e),this.registerDisposer(t),this.registerDisposer(this.state.changed.add(()=>{this.valid=!1,this.updateView()})),this.registerDisposer(this.visibility.changed.add(()=>this.updateView())),this.state.changed.add(()=>{this.valid=!1,this.updateView()}),this.element.addEventListener("mouseenter",()=>{this.mouseEntered=!0,void 0!==this.hoverState&&(this.hoverState.value=this.state.value)}),this.element.addEventListener("mouseleave",()=>{this.mouseEntered=!1,void 0!==this.hoverState&&(this.hoverState.value=void 0)}),this.updateView()}updateView(){if(!this.visible)return this.element.style.display="none",void(this.hoverState=void 0);if(this.element.style.display=null,this.valid)return;const{element:e}=this;Object(f.a)(e),this.valid=!0;const{reference:t}=this.state;if(void 0===t)return;const n=this.state.value,i=t.value;if(null==i)return;const r=this.state.annotationLayerState.value;this.hoverState=r.hoverState,this.mouseEntered&&(this.hoverState.value=n);const{objectToGlobal:o}=r,{voxelSize:a}=this,l=Object(s.g)(i.type),c=document.createElement("div");c.className="neuroglancer-annotation-details-title";const u=document.createElement("div");u.className="neuroglancer-annotation-details-icon",u.textContent=l.icon;const d=document.createElement("div");if(d.className="neuroglancer-annotation-details-title-text",d.textContent=`${l.description}`,c.appendChild(u),c.appendChild(d),!r.source.readonly){const e=Object(L.a)("","Delete annotation");e.addEventListener("click",()=>{const e=r.source.getReference(n.id);try{r.source.delete(e)}finally{e.dispose()}}),c.appendChild(e)}const h=Object(x.a)();h.title="Hide annotation details",h.addEventListener("click",()=>{this.state.value=void 0}),c.appendChild(h),e.appendChild(c);const p=document.createElement("div");if(p.className="neuroglancer-annotation-details-position",M(p,i,o,a,this.setSpatialCoordinates),e.appendChild(p),i.type===s.c.AXIS_ALIGNED_BOUNDING_BOX){const t=document.createElement("div");t.className="neuroglancer-annotation-details-volume",t.textContent=Object(b.a)(i.pointA,i.pointB,o),e.appendChild(t);const n=Object(g.r)(A,g.u.subtract(A,i.pointA,i.pointB),o),r=document.createElement("div");r.className="neuroglancer-annotation-details-volume-in-voxels";const s=a.voxelFromSpatial(A,n);r.textContent=`${Object(b.b)(s)}`,e.appendChild(r)}else if(i.type===s.c.LINE){const t=Object(g.r)(A,g.u.subtract(A,i.pointA,i.pointB),o),n=document.createElement("div");n.className="neuroglancer-annotation-details-length";const r=Object(b.d)(g.u.length(t));let s="";if(a.valid){const e=g.u.length(a.voxelFromSpatial(A,t));s=`, ${Math.round(e)} vx`}n.textContent=r+s,e.appendChild(n)}let{segmentListWidget:m}=this;void 0!==m&&m.reference!==t&&(m.dispose(),this.unregisterDisposer(m),m=this.segmentListWidget=void 0),void 0===m&&(this.segmentListWidget=m=this.registerDisposer(new k(t,r))),e.appendChild(m.element);const v=document.createElement("textarea");v.value=i.description||"",v.rows=3,v.className="neuroglancer-annotation-details-description",v.placeholder="Description",r.source.readonly?v.readOnly=!0:v.addEventListener("change",()=>{const e=v.value;r.source.update(t,Object.assign({},i,{description:e||void 0})),r.source.commit(t)}),e.appendChild(v)}}class D extends O.b{constructor(e,t,n,i){super(),this.layer=e,this.state=t,this.voxelSize=n,this.setSpatialCoordinates=i,this.stack=this.registerDisposer(new O.a(e=>new I(this.layer,this.state.addRef(),e.addRef(),this.voxelSize.addRef(),this.setSpatialCoordinates),this.visibility)),this.detailsTab=this.registerDisposer(new N(this.state,this.voxelSize.addRef(),this.setSpatialCoordinates)),this.registerDisposer(t),this.registerDisposer(n);const{element:r}=this;r.classList.add("neuroglancer-annotations-tab"),this.stack.element.classList.add("neuroglancer-annotations-stack"),r.appendChild(this.stack.element),r.appendChild(this.detailsTab.element);const s=()=>{this.detailsTab.visibility.value=void 0!==this.state.validValue&&this.visible?w.b.VISIBLE:w.b.IGNORED};this.registerDisposer(this.state.changed.add(s)),this.registerDisposer(this.visibility.changed.add(s));const o=()=>{this.stack.selected=this.state.annotationLayerState.value};this.registerDisposer(this.state.annotationLayerState.changed.add(o)),o()}}function R(e){let t;const n=e.segmentationState.value;return null!=n&&n.segmentSelectionState.hasSelectedSegment&&(t=[n.segmentSelectionState.selectedSegment.clone()]),t}class P extends d.a{constructor(e,t){if(super(),this.layer=e,void 0===e.annotationLayerState)throw new Error("Invalid layer for annotation tool.");this.annotationDescription=Object(m.v)(t,"description",m.y)}get annotationLayer(){return this.layer.annotationLayerState.value}}const j="annotatePoint",V="annotateLine",_="annotateBoundingBox",U="annotateSphere";class F extends P{constructor(e,t){super(e,t)}trigger(e){const{annotationLayer:t}=this;if(void 0!==t&&e.active){const n={id:"",description:"",segments:R(t),point:g.u.transformMat4(g.u.create(),e.position,t.globalToObject),type:s.c.POINT},i=t.source.add(n,!0);this.layer.selectedAnnotation.value={id:i.id},i.dispose()}}get description(){return"annotate point"}toJSON(){return j}}function z(e,t){return g.u.transformMat4(g.u.create(),e.position,t.globalToObject)}class B extends P{trigger(e){const{annotationLayer:t}=this;if(void 0!==t&&e.active){const n=()=>{const n=this.inProgressAnnotation,i=n.reference,r=this.getUpdatedAnnotation(i.value,e,t);n.annotationLayer.source.update(i,r),this.layer.selectedAnnotation.value={id:i.id}};if(void 0===this.inProgressAnnotation){const i=t.source.add(this.getInitialAnnotation(e,t),!1);this.layer.selectedAnnotation.value={id:i.id};const r=e.changed.add(n),s=()=>{r(),i.dispose()};this.inProgressAnnotation={annotationLayer:t,reference:i,disposer:s}}else n(),this.inProgressAnnotation.annotationLayer.source.commit(this.inProgressAnnotation.reference),this.inProgressAnnotation.disposer(),this.inProgressAnnotation=void 0}}disposed(){this.deactivate(),super.disposed()}deactivate(){void 0!==this.inProgressAnnotation&&(this.inProgressAnnotation.annotationLayer.source.delete(this.inProgressAnnotation.reference),this.inProgressAnnotation.disposer(),this.inProgressAnnotation=void 0)}}class G extends B{getInitialAnnotation(e,t){const n=z(e,t);return{id:"",type:this.annotationType,description:"",pointA:n,pointB:n}}getUpdatedAnnotation(e,t,n){const i=z(t,n);return Object.assign({},e,{pointB:i})}}class W extends G{get description(){return"annotate bounding box"}toJSON(){return _}}W.prototype.annotationType=s.c.AXIS_ALIGNED_BOUNDING_BOX;class $ extends G{get description(){return"annotate line"}getInitialAnnotation(e,t){const n=super.getInitialAnnotation(e,t);return n.segments=R(t),n}getUpdatedAnnotation(e,t,n){const i=super.getUpdatedAnnotation(e,t,n),r=i.segments;void 0!==r&&r.length>0&&(r.length=1);let s=R(n);return s&&r&&(s=s.filter(e=>-1===r.findIndex(t=>y.a.equal(e,t)))),i.segments=[...r||[],...s||[]]||!1,i}toJSON(){return V}}$.prototype.annotationType=s.c.LINE;class H extends B{getInitialAnnotation(e,t){const n=z(e,t);return{type:s.c.ELLIPSOID,id:"",description:"",segments:R(t),center:n,radii:g.u.fromValues(0,0,0)}}getUpdatedAnnotation(e,t,n){const i=g.u.transformMat4(g.u.create(),e.center,n.objectToGlobal),r=g.u.distance(i,t.position),s=g.k.create();s[0]=s[4]=s[8]=1/(r*r);const o=Object(g.l)(g.k.create(),n.objectToGlobal);return g.k.multiply(s,s,o),g.k.transpose(o,o),g.k.multiply(s,o,s),Object.assign({},e,{radii:g.u.fromValues(1/Math.sqrt(s[0]),1/Math.sqrt(s[4]),1/Math.sqrt(s[8]))})}get description(){return"annotate ellipsoid"}toJSON(){return U}}function q(e){return{color:e.annotationColor,fillOpacity:e.annotationFillOpacity}}Object(d.b)(j,(e,t)=>new F(e,t)),Object(d.b)(_,(e,t)=>new W(e,t)),Object(d.b)(V,(e,t)=>new $(e,t)),Object(d.b)(U,(e,t)=>new H(e,t));const Y="selectedAnnotation",J="annotationColor",X="annotationFillOpacity";function K(e){return class extends e{constructor(...e){super(...e),this.annotationLayerState=this.registerDisposer(new u.d),this.selectedAnnotation=this.registerDisposer(new E(this.annotationLayerState.addRef())),this.annotationColor=new h.a(g.u.fromValues(1,1,0)),this.annotationFillOpacity=Object(c.a)(0),this.selectedAnnotation.changed.add(this.specificationChanged.dispatch),this.annotationColor.changed.add(this.specificationChanged.dispatch),this.annotationFillOpacity.changed.add(this.specificationChanged.dispatch),this.tabs.add("annotations",{label:"Annotations",order:10,getter:()=>new D(this,this.selectedAnnotation.addRef(),this.manager.voxelSize.addRef(),e=>this.manager.setSpatialCoordinates(e))}),this.annotationLayerState.changed.add(()=>{const e=this.annotationLayerState.value;if(void 0!==e){const t=new o.a(this.manager.chunkManager,e.addRef());if(Object(l.b)(e,this.manager.layerSelectedValues.mouseState),this.addRenderLayer(new o.e(t)),this.addRenderLayer(new o.d(t.addRef())),t.source instanceof a.b){const n=this.registerDisposer(new a.a(t.source.addRef()));this.registerDisposer(Object(u.h)(e.filterBySegmentation,(e,t)=>{t||(this.addRenderLayer(n.addRef()),e.registerDisposer(()=>this.removeRenderLayer(n)))}))}}})}restoreState(e){super.restoreState(e),this.selectedAnnotation.restoreState(e[Y]),this.annotationColor.restoreState(e[J]),this.annotationFillOpacity.restoreState(e[X])}toJSON(){const e=super.toJSON();return e[Y]=this.selectedAnnotation.toJSON(),e[J]=this.annotationColor.toJSON(),e[X]=this.annotationFillOpacity.toJSON(),e}initializeAnnotationLayerViewTab(e){}}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"c",function(){return o}),n.d(t,"b",function(){return l});var i=n(2),r=n(1);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class s extends i.a{setActive(e){}deactivate(){}}function o(e,t){if(void 0===t)return;"string"==typeof t&&(t={type:t}),Object(r.t)(t);const n=Object(r.v)(t,"type",r.A),i=a.get(n);if(void 0===i)throw new Error(`Invalid tool type: ${JSON.stringify(t)}.`);return i(e,t)}const a=new Map;function l(e,t){a.set(e,t)}},function(e,t,n){"use strict";n.d(t,"c",function(){return s}),n.d(t,"b",function(){return o}),n.d(t,"d",function(){return a}),n.d(t,"a",function(){return l});var i=n(0),r=n(54);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function s(e){return`(${Math.floor(e[0])}, ${Math.floor(e[1])}, ${Math.floor(e[2])})`}function o(e){let t="";for(let n=0;n<3;++n)0!==n&&(t+="  "),t+=Math.round(Math.abs(e[n]));return t}function a(e){const t=Object(r.c)(e);return`${(e/t.lengthInNanometers).toPrecision(3)}${t.unit}`}function l(e,t,n){let s="";const o=i.u.create();for(let r=0;r<3;++r){i.u.set(o,0,0,0),o[r]=t[r]-e[r];const l=Object(i.r)(o,o,n);0!==r&&(s+="  "),s+=a(i.u.length(l))}const l=Math.abs(Object(i.n)(i.u.subtract(o,t,e)));return`${s}  [${function(e){const t=Object(r.d)(e);return`${(e/Math.pow(t.lengthInNanometers,3)).toPrecision(6)}${t.unit}`}(i.k.determinant(i.k.fromMat4(i.k.create(),n))*l)}]`}},function(e,t,n){var i=n(150);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function i(e){e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_MIN_FILTER,WebGL2RenderingContext.NEAREST),e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_MAG_FILTER,WebGL2RenderingContext.NEAREST),e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_WRAP_S,WebGL2RenderingContext.CLAMP_TO_EDGE),e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_WRAP_T,WebGL2RenderingContext.CLAMP_TO_EDGE)}function r(e){e.texParameteri(WebGL2RenderingContext.TEXTURE_3D,WebGL2RenderingContext.TEXTURE_MIN_FILTER,WebGL2RenderingContext.NEAREST),e.texParameteri(WebGL2RenderingContext.TEXTURE_3D,WebGL2RenderingContext.TEXTURE_MAG_FILTER,WebGL2RenderingContext.NEAREST),e.texParameteri(WebGL2RenderingContext.TEXTURE_3D,WebGL2RenderingContext.TEXTURE_WRAP_S,WebGL2RenderingContext.CLAMP_TO_EDGE),e.texParameteri(WebGL2RenderingContext.TEXTURE_3D,WebGL2RenderingContext.TEXTURE_WRAP_T,WebGL2RenderingContext.CLAMP_TO_EDGE),e.texParameteri(WebGL2RenderingContext.TEXTURE_3D,WebGL2RenderingContext.TEXTURE_WRAP_R,WebGL2RenderingContext.CLAMP_TO_EDGE)}function s(e,t,n,r,s=WebGL2RenderingContext.RGBA8,o=WebGL2RenderingContext.RGBA,a=WebGL2RenderingContext.UNSIGNED_BYTE){e.activeTexture(WebGL2RenderingContext.TEXTURE0+e.tempTextureUnit),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,t),i(e),e.texImage2D(WebGL2RenderingContext.TEXTURE_2D,0,s,n,r,0,o,a,null),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,null)}function o(e,t,n){e.activeTexture(WebGL2RenderingContext.TEXTURE0+e.tempTextureUnit),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,t),e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_MIN_FILTER,WebGL2RenderingContext.LINEAR),e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_MAG_FILTER,WebGL2RenderingContext.LINEAR),e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_WRAP_S,WebGL2RenderingContext.CLAMP_TO_EDGE),e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_WRAP_T,WebGL2RenderingContext.CLAMP_TO_EDGE),e.pixelStorei(WebGL2RenderingContext.UNPACK_FLIP_Y_WEBGL,1),e.pixelStorei(WebGL2RenderingContext.UNPACK_ALIGNMENT,4),e.texImage2D(WebGL2RenderingContext.TEXTURE_2D,0,WebGL2RenderingContext.RGBA8,WebGL2RenderingContext.RGBA,WebGL2RenderingContext.UNSIGNED_BYTE,n),e.pixelStorei(WebGL2RenderingContext.UNPACK_FLIP_Y_WEBGL,0),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,null)}n.d(t,"c",function(){return i}),n.d(t,"b",function(){return r}),n.d(t,"a",function(){return s}),n.d(t,"d",function(){return o})},function(e,t,n){"use strict";n.d(t,"b",function(){return s}),n.d(t,"a",function(){return l});var i=n(2),r=n(19);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const s=4,o=6;function a(e){const t=new Uint16Array(e*o);for(let n=0;n<e;++n){const e=n*s;let i=n*o;t[i]=e,t[i+1]=e+1,t[i+2]=e+2,t[i+3]=e+2,t[i+4]=e+3,t[i+5]=e}return t}class l extends i.a{constructor(e,t){super(),this.quadsPerInstance=t,1!==t&&(this.quadIndexBuffer=this.registerDisposer(Object(r.b)(e,WebGL2RenderingContext.ELEMENT_ARRAY_BUFFER,a,t)).value)}draw(e,t){1===this.quadsPerInstance?e.drawArraysInstanced(WebGL2RenderingContext.TRIANGLE_FAN,0,4,t):(this.quadIndexBuffer.bind(),e.drawElementsInstanced(WebGL2RenderingContext.TRIANGLES,o*this.quadsPerInstance,WebGL2RenderingContext.UNSIGNED_SHORT,0,t))}}},function(e,t,n){"use strict";t.a="\n\nvec3 colormapJet(float x) {\n  vec3 result;\n  result.r = x < 0.89 ? ((x - 0.35) / 0.31) : (1.0 - (x - 0.89) / 0.11 * 0.5);\n  result.g = x < 0.64 ? ((x - 0.125) * 4.0) : (1.0 - (x - 0.64) / 0.27);\n  result.b = x < 0.34 ? (0.5 + x * 0.5 / 0.11) : (1.0 - (x - 0.34) / 0.31);\n  return clamp(result, 0.0, 1.0);\n}\n\n\nvec3 colormapCubehelix(float x) {\n    float xclamp = clamp(x, 0.0, 1.0);\n    float angle = 2.0 * 3.1415926 * (4.0 / 3.0 + xclamp);\n    float amp = xclamp * (1.0 - xclamp) / 2.0;\n    vec3 result;\n    float cosangle = cos(angle);\n    float sinangle = sin(angle);\n    result.r = -0.14861 * cosangle + 1.78277 * sinangle;\n    result.g = -0.29227 * cosangle + -0.90649 * sinangle;\n    result.b = 1.97294 * cosangle;\n    result = clamp(xclamp + amp * result, 0.0, 1.0);\n    return result;\n}\n"},function(e,t,n){"use strict";n.d(t,"a",function(){return i});n(167);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function i(e,t){const n=document.createElement("div"),i=document.createElement("div");return i.textContent=e,n.className="neuroglancer-icon-button",n.appendChild(i),void 0!==t&&(n.title=t),n}},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"b",function(){return o});var i=n(2),r=n(1);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class s{constructor(){this.map=new Map}get(e,t){let{map:n}=this,i=n.get(e);return void 0===i?((i=t()).registerDisposer(()=>{n.delete(e)}),n.set(e,i)):i.addRef(),i}}class o extends s{get(e,t){return"string"!=typeof e&&(e=Object(r.g)(e)),super.get(e,t)}getUncounted(e,t){return this.get(e,()=>new i.b(t())).value}}},function(e,t,n){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function i(e,t){if(!e.active)return;if(void 0===e.pickedAnnotationId)return;const n=e.pickedRenderLayer;if(null===n)return;const i=e.pickedAnnotationLayer;if(void 0===i)return;const r=t.renderLayerToManagedLayerMap.get(n);return void 0!==r?{layer:r,annotationLayer:i,id:e.pickedAnnotationId,partIndex:e.pickedOffset}:void 0}function r(e,t){e.registerDisposer(t.changed.add(()=>{if(t.active&&t.pickedAnnotationLayer===e){const n=e.hoverState.value;void 0!==n&&n.id===t.pickedAnnotationId&&n.partIndex===t.pickedOffset||(e.hoverState.value={id:t.pickedAnnotationId,partIndex:t.pickedOffset})}else e.hoverState.value=void 0}))}n.d(t,"a",function(){return i}),n.d(t,"b",function(){return r})},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(2),r=n(7);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class s extends i.a{constructor(e,t){super(),this.target=e,this.eventMap=t,this.registerEventListener(e,"wheel",e=>{this.dispatch("wheel",e)}),this.registerEventListener(e,"click",e=>{this.dispatch(`click${e.button}`,e)}),this.registerEventListener(e,"dblclick",e=>{this.dispatch(`dblclick${e.button}`,e)}),this.registerEventListener(e,"mousedown",e=>{this.dispatch(`mousedown${e.button}`,e)}),this.registerEventListener(e,"mouseup",e=>{this.dispatch(`mouseup${e.button}`,e)})}dispatch(e,t){Object(r.c)(e,t,t,this.eventMap)}}},function(e,t,n){var i=n(13),r=n(114),s="Expected a function";e.exports=function(e,t,n){var o=!0,a=!0;if("function"!=typeof e)throw new TypeError(s);return r(n)&&(o="leading"in n?!!n.leading:o,a="trailing"in n?!!n.trailing:a),i(e,t,{leading:o,maxWait:t,trailing:a})}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const i=new(n(74).a)},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return r});n(12);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i{}i.RPC_ID="computed/ComputedVolumeChunkSourceParameters";class r{}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const i=new Float32Array(1);function r(e){i[0]=e,e=i[0];for(let t=1;t<21;++t){let n=e.toPrecision(t);if(i[0]=parseFloat(n),i[0]===e)return n}return e.toString()}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(83);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r(){return Object(i.a)("")}},function(e,t,n){"use strict";n.d(t,"a",function(){return u});n(177),n(178),n(126),n(127);var i=n(50),r=n.n(i),s=n(13),o=n.n(s),a=n(2),l=n(10);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(182)(r.a);const c=500;class u extends a.a{constructor(e){super(),this.state=e,this.changingValue=!1,this.debouncedValueUpdater=o()(()=>{this.changingValue=!0;try{this.state.fragmentMain.value=this.textEditor.getValue()}finally{this.changingValue=!1}},c),this.textEditor=r()(e=>{},{value:this.state.fragmentMain.value,mode:"glsl",gutters:["CodeMirror-lint-markers"]}),this.textEditor.on("change",()=>{this.setValidState(void 0),this.debouncedValueUpdater()}),this.registerDisposer(this.state.fragmentMain.changed.add(()=>{this.changingValue||this.textEditor.setValue(this.state.fragmentMain.value)})),this.element.classList.add("neuroglancer-shader-code-widget"),this.registerDisposer(this.state.shaderError.changed.add(()=>{this.updateErrorState()})),this.updateErrorState()}get element(){return this.textEditor.getWrapperElement()}updateErrorState(){const e=this.state.shaderError.value;void 0===e?this.setValidState(void 0):null!==e?(this.textEditor.setOption("lint",{getAnnotations:()=>{if("ShaderCompilationError"===e.name){let t=e.source.split("\n").indexOf(this.state.fragmentMainStartLine)+2;return e.errorMessages.map(e=>({message:e.message,severity:"error",from:r.a.Pos(void 0===e.line?0:e.line-t)}))}return"ShaderLinkError"===e.name?[{message:e.log,severity:"error",from:r.a.Pos(0)}]:[{message:e.message,severity:"error",from:r.a.Pos(0)}]}}),this.setValidState(!1)):(this.textEditor.setOption("lint",void 0),this.setValidState(!0))}setValidState(e){let{element:t}=this;t.classList.remove("invalid-input"),t.classList.remove("valid-input"),!0===e?t.classList.add("valid-input"):!1===e&&t.classList.add("invalid-input")}disposed(){this.debouncedValueUpdater.flush(),this.debouncedValueUpdater=void 0,Object(l.b)(this.element),this.textEditor=void 0,super.disposed()}}},function(e,t,n){"use strict";var i=n(59),r=(n(173),n(90)),s=n(31);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class o extends s.b{constructor(e){super(),this.transform=e,this.textArea=document.createElement("textarea"),this.modelGeneration=-1;const{element:t}=this;t.classList.add("neuroglancer-coordinate-transform-widget");const{textArea:n}=this,i=document.createElement("label");i.className="neuroglancer-coordinate-transform-widget-homogeneous",i.textContent="34 Homogeneous transformation matrix",i.appendChild(n),t.appendChild(i),this.registerDisposer(e.changed.add(()=>this.updateView())),this.registerDisposer(this.visibility.changed.add(()=>this.updateView())),n.addEventListener("change",()=>this.updateModel()),n.addEventListener("blur",()=>this.updateModel()),n.title="Homogeneous transformation matrix",n.rows=3;const r=document.createElement("button");r.textContent="Reset to identity",r.addEventListener("click",()=>this.transform.reset()),t.appendChild(r),this.updateView()}updateView(){if(!this.visible)return;const e=this.transform.changed.count;if(this.modelGeneration!==e){let t="";const{transform:n}=this.transform;for(let e=0;e<3;++e){0!==e&&(t+="\n");for(let i=0;i<4;++i){const s=n[4*i+e];0!==i&&(t+=" "),t+=Object(r.a)(s)}}this.textArea.value=t,this.modelGeneration=e}}updateModel(){const e=this.textArea.value.split(/[\s,\[\]\(\)\{\}]/).filter(e=>e.length>0);if(12===e.length){const t=[];for(let n=0;n<12;++n){const i=parseFloat(e[n]);if(Number.isNaN(i))return!1;t[n]=i}const{transform:n}=this.transform;n[3]=n[7]=n[10]=0,n[15]=1;for(let e=0;e<4;++e)for(let i=0;i<3;++i)n[4*e+i]=t[e+4*i];return this.transform.changed.dispatch(),!0}return!1}}n.d(t,"a",function(){return l});
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const a="transform";function l(e){return class extends e{constructor(...e){super(...e),this.transform=new i.a,this.transform.changed.add(this.specificationChanged.dispatch),this.tabs.add("transform",{label:"Transform",order:100,getter:()=>new o(this.transform)});const t=e[1];this.transform.restoreState(t[a])}toJSON(){const e=super.toJSON();return e[a]=this.transform.toJSON(),e}}}},function(e,t,n){"use strict";n.d(t,"b",function(){return d}),n.d(t,"a",function(){return p});var i=n(2),r=n(0),s=n(19);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const o=r.u.create(),a=r.u.create(),l=.001,c=.001;function u(e){let t=0;for(var n=0;n<3;++n)e[n]<0&&(t+=1<<n);return t}const d=new Float32Array([0,0,0,1,0,0,0,1,0,1,1,0,0,0,1,1,0,1,0,1,1,1,1,1]);class h extends i.a{constructor(e){super(),this.outputVertexIndices=this.registerDisposer(s.a.fromData(e,new Float32Array([0,1,2,3,4,5]),e.ARRAY_BUFFER,e.STATIC_DRAW));let t=[0,1,2,4,5,3,6,7],n=[0,1,2,5,3,4,6,7],i=[0,1,1,4,4,7,4,7,1,5,0,1,1,4,4,7,0,2,2,5,5,7,5,7,2,6,0,2,2,5,5,7,0,3,3,6,6,7,6,7,3,4,0,3,3,6,6,7],r=[0,1,2,3,4,5,6,7,1,4,5,0,3,7,2,6,2,6,0,5,7,3,1,4,3,0,6,4,1,2,7,5,4,3,7,1,0,6,5,2,5,2,1,7,6,0,4,3,6,7,3,2,5,4,0,1,7,5,4,6,2,1,3,0],o=[];for(var a=0;a<8;++a)for(var l=0;l<i.length;++l){const e=8*n[a]+i[l];o.push(t[r[e]])}this.vertexIndices=new Int32Array(o)}static get(e){return e.memoize.get("SliceViewShaderBuffers",()=>new h(e))}}class p extends i.a{static get(e){return e.memoize.get("BoundingBoxCrossSectionRenderHelper",()=>new p(e))}constructor(e){super(),this.data=this.registerDisposer(h.get(e))}defineShader(e){e.addUniform("highp vec3","uPlaneNormal"),e.addUniform("highp float","uPlaneDistance"),e.addUniform("highp ivec2","uVertexIndex",24),e.addUniform("highp vec3","uVertexBasePosition",8),e.addInitializer(e=>{e.gl.uniform3fv(e.uniform("uVertexBasePosition"),d)}),e.addVertexCode(`\nvec3 getBoundingBoxPlaneIntersectionVertexPosition(vec3 chunkSize, vec3 boxLower, vec3 lowerClipBound, vec3 upperClipBound, int vertexIndex) {\n  for (int e = 0; e < 4; ++e) {\n    highp ivec2 vidx = uVertexIndex[vertexIndex*4 + e];\n    highp vec3 v1 = max(lowerClipBound, min(upperClipBound, chunkSize * uVertexBasePosition[vidx.x] + boxLower));\n    highp vec3 v2 = max(lowerClipBound, min(upperClipBound, chunkSize * uVertexBasePosition[vidx.y] + boxLower));\n    highp vec3 vDir = v2 - v1;\n    highp float denom = dot(vDir, uPlaneNormal);\n    if (abs(denom) > ${c}) {\n      highp float lambda = (uPlaneDistance - dot(v1, uPlaneNormal)) / denom;\n      if ((lambda >= -${l}) && (lambda <= (1.0 + ${l}))) {\n        lambda = clamp(lambda, 0.0, 1.0);\n        highp vec3 position = v1 + lambda * vDir;\n        return position;\n      }\n    }\n  }\n  return vec3(0, 0, 0);\n}\n`)}computeVertexPositionDebug(e,t,n,i,s,o,a){let h=u(s),p=this.data.vertexIndices.subarray(48*h,48*(h+1)),f=[0,0],g=[r.u.create(),r.u.create()],m=r.u.create(),v=r.u.create(),b=e=>d.subarray(3*e,3*e+3);for(let u=0;u<4;++u){for(let i=0;i<2;++i)f[i]=p[2*(4*a+u)+i],r.u.multiply(g[i],e,b(f[i])),r.u.add(g[i],g[i],o),r.u.min(g[i],g[i],n),r.u.max(g[i],g[i],t);r.u.subtract(m,g[1],g[0]);let d=r.u.dot(m,s);if(Math.abs(d)>c){let e=(i-r.u.dot(g[0],s))/d;if(e>=-l&&e<=1+l)return e=Math.max(0,Math.min(1,e)),r.u.scaleAndAdd(v,g[0],m,e),v;console.log(`vertex ${a}, e = ${u}, skipped, deom = ${d}, `+`vDir = ${Object(r.v)(m)}, `+`uPlaneNormal = ${Object(r.v)(s)}, `+`lambda=${e}`)}else console.log(`vertex ${a}, e = ${u}, skipped, deom = ${d}, `+`vDir = ${Object(r.v)(m)}, uPlaneNormal = ${Object(r.v)(s)}`)}}setPlane(e,t,n){const{gl:i}=e;i.uniform3fv(e.uniform("uPlaneNormal"),t),i.uniform1f(e.uniform("uPlaneDistance"),n);const r=u(t);i.uniform2iv(e.uniform("uVertexIndex"),this.data.vertexIndices.subarray(48*r,48*(r+1)))}setViewportPlane(e,t,n,i){const s=Object(r.r)(o,t,i),l=r.u.dot(r.u.transformMat4(a,n,i),s);this.setPlane(e,s,l)}}},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return s});var i,r=n(27);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(e){e[e.LINE=0]="LINE",e[e.POINT=1]="POINT"}(i||(i={}));class s extends r.i{constructor(e){super(e)}static make(e){return new s(Object.assign({},e,{transform:Object(r.k)(e.transform,e.vectorGraphicsSourceOptions)}))}static fromObject(e){return new s(e)}toObject(){return super.toObject()}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return a});var i=n(35),r=n(23);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function s(e){e.addOutputBuffer("vec4","v4f_fragColor",null),e.setFragmentMain("v4f_fragColor = getValue0();")}function o(e,t=s,n=1){return e.memoize.get(`elementWiseTextureShader:${n}:${Object(i.a)(t)}`,()=>{let i=new r.a(e);i.addVarying("vec2","vTexCoord"),i.addUniform("sampler2D","uSampler",n),i.addInitializer(t=>{let i=[];for(let e=0;e<n;++e)i[e]=e;e.uniform1iv(t.uniform("uSampler"),i)});for(let e=0;e<n;++e)i.addFragmentCode(`\nvec4 getValue${e}() {\n  return texture(uSampler[${e}], vTexCoord);\n}\n`);return i.addUniform("mat4","uProjectionMatrix"),i.require(t),i.addAttribute("vec4","aVertexPosition"),i.addAttribute("vec2","aTexCoord"),i.setVertexMain("vTexCoord = aTexCoord; gl_Position = uProjectionMatrix * aVertexPosition;"),i.build()})}function a(e){return e.memoize.get("trivialColorShader",()=>{let t=new r.a(e);return t.addVarying("vec4","vColor"),t.addOutputBuffer("vec4","v4f_fragColor",null),t.setFragmentMain("v4f_fragColor = vColor;"),t.addAttribute("vec4","aVertexPosition"),t.addAttribute("vec4","aColor"),t.addUniform("mat4","uProjectionMatrix"),t.setVertexMain("vColor = aColor; gl_Position = uProjectionMatrix * aVertexPosition;"),t.build()})}},function(e,t,n){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function i(e){return("0"+e.toString(16)).slice(-2)}function r(e){return Array.prototype.map.call(e,i).join("")}function s(e){if(!/^(?:[0-9a-fA-F]{2})*$/.test(e))throw new Error("Invalid hex-encoded string");const t=e.length/2,n=new Uint8Array(t);for(let i=0;i<t;++i)n[i]=parseInt(e.substr(2*i,2),16);return n}n.d(t,"c",function(){return i}),n.d(t,"b",function(){return r}),n.d(t,"a",function(){return s})},function(e,t,n){"use strict";n.d(t,"a",function(){return w});n(175);var i=n(13),r=n.n(i),s=n(87),o=n.n(s),a=n(30),l=n(9),c=n(75),u=n(73),d=n(2),h=n(7),p=n(0),f=n(86),g=n(99),m=n(54),v=n(103);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const b=200,y=h.a.fromObject({mousedown0:{action:"set"},wheel:{action:"adjust-via-wheel"},dblclick0:{action:"reset"}});class w extends d.a{constructor(e,t){super(),this.histogram=e,this.target=t,this.label=document.createElement("div"),this.element=document.createElement("div"),this.canvas=document.createElement("canvas"),this.legend=document.createElement("div"),this.legendRenderScale=document.createElement("div"),this.legendSpatialScale=document.createElement("div"),this.legendChunks=document.createElement("div"),this.ctx=this.canvas.getContext("2d"),this.hoverTarget=new l.f(void 0),this.throttledUpdateView=this.registerCancellable(o()(()=>this.debouncedUpdateView(),b,{leading:!0,trailing:!0})),this.debouncedUpdateView=this.registerCancellable(r()(()=>this.updateView(),0));const{canvas:n,label:i,element:s,legend:c,legendRenderScale:u,legendSpatialScale:d,legendChunks:p}=this;i.className="neuroglancer-render-scale-widget-prompt",s.className="neuroglancer-render-scale-widget",s.title=y.describe(),c.className="neuroglancer-render-scale-widget-legend",s.appendChild(i),s.appendChild(n),s.appendChild(c),u.title="Target resolution of data in screen pixels",p.title="Number of chunks rendered",c.appendChild(u),c.appendChild(p),c.appendChild(d),this.registerDisposer(e.changed.add(this.throttledUpdateView)),this.registerDisposer(e.visibility.changed.add(this.debouncedUpdateView)),this.registerDisposer(t.changed.add(this.debouncedUpdateView)),this.registerDisposer(new f.a(n,y)),this.registerDisposer(t.changed.add(this.debouncedUpdateView)),this.registerDisposer(this.hoverTarget.changed.add(this.debouncedUpdateView));const g=e=>{const t=e.offsetX/n.width*a.d;return Object(a.b)(t)};this.registerEventListener(n,"pointermove",e=>{this.hoverTarget.value=[g(e),e.offsetY]}),this.registerEventListener(n,"pointerleave",()=>{this.hoverTarget.value=void 0}),this.registerDisposer(Object(h.d)(n,"set",e=>{this.target.value=g(e.detail)})),this.registerDisposer(Object(h.d)(n,"adjust-via-wheel",e=>{const t=e.detail,{deltaY:n}=t;0!==n&&(this.hoverTarget.value=void 0,this.target.value*=2**Math.sign(n),t.preventDefault())})),this.registerDisposer(Object(h.d)(n,"reset",e=>{this.hoverTarget.value=void 0,this.target.reset(),e.preventDefault()}));const m=new v.a(()=>this.debouncedUpdateView());m.observe(n),this.registerDisposer(()=>m.disconnect()),this.updateView()}updateView(){const{ctx:e}=this,{canvas:t}=this,n=t.width=t.offsetWidth,i=t.height=t.offsetHeight,r=this.target.value,s=this.hoverTarget.value;{const{legendRenderScale:e}=this,t=function(e){if(e<1||e>1024){const t=0|Math.log2(e),n=e/2**t;return`${Object(g.a)(n,1)}p${t}`}return Math.round(e)+""}(void 0===s?r:s[0]);e.textContent=t+" px"}function o(e){return e*n/a.d}e.clearRect(0,0,n,i);const{histogram:l}=this,{value:d,spatialScales:h}=l;l.visibility.visible||d.fill(0);const f=Array.from(h.keys());f.sort();const v=p.u.create();let b=1;const y=h.size;let w=0,x=0;for(let e=0;e<a.d;++e){let t=0;for(let n=0;n<y;++n){const i=n*a.d*2+e,r=d[i],s=d[i+a.d];w+=r,x+=s,t+=r+s}b=Math.max(t,b)}const S=i/Math.log(1+b);function C(e){return i-Math.log(1+e)*S}let O=void 0;if(void 0!==s){const e=Math.floor(Object(a.c)(s[0]));if(e>=0&&e<a.d){let t=0;const n=s[1];for(let i=y-1;i>=0;--i){const r=f[i],s=2*h.get(r)*a.d+e,o=d[s]+d[s+a.d];if(0===o)continue;const l=Math.round(C(t));if(t+=o,Math.round(C(t))<=n&&n<=l){O=r;break}}}}if(void 0!==O){w=0,x=0;const e=2*h.get(O)*a.d;for(let t=0;t<a.d;++t){const n=e+t;w+=d[n],x+=d[n+a.d]}if(Number.isFinite(O)){const e=Object(m.c)(O);this.legendSpatialScale.textContent=Object(g.a)(O/e.lengthInNanometers,2)+" "+e.unit}else this.legendSpatialScale.textContent="unknown"}else this.legendSpatialScale.textContent="";this.legendChunks.textContent=`${w}/${w+x}`;const L=f.map(e=>{const t=e===O?.5:1;let n;n=Number.isFinite(e)?(.1*Math.log2(e)%1+1)%1:0,Object(u.a)(v,n,t,1);const i=Object(c.b)(v);return Object(u.a)(v,n,t,.5),[i,Object(c.b)(v)]});for(let t=0;t<a.d;++t){let n=0;for(let i=y-1;i>=0;--i){const r=f[i],s=h.get(r)*a.d*2+t,l=d[s],c=d[s+a.d],u=l+c;if(0===u)continue;const p=Math.round(o(t)),g=Math.round(o(t+1)),m=Math.round(C(n));n+=u;const v=Math.round(C(n)),b=(l*v+c*m)/u;e.fillStyle=L[i][1],e.fillRect(p,v,g-p,b-v),e.fillStyle=L[i][0],e.fillRect(p,b,g-p,m-b)}}{const t=r;e.fillStyle="#fff";const n=o(Object(a.c)(t)),s=1;e.fillRect(Math.floor(n),0,s,i)}if(void 0!==s){const t=s[0];e.fillStyle="#888";const n=o(Object(a.c)(t)),r=1;e.fillRect(Math.floor(n),0,r,i)}}}},function(e,t,n){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function i(e,t){let n="";for(let i=0;i<=t&&(n=e.toFixed(i),parseFloat(n)!==e);++i);return n}n.d(t,"a",function(){return i})},function(e,t,n){var i=n(197);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(2),r=n(19),s=n(96);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class o extends i.a{constructor(e){super(),this.gl=e,this.vertexBuffer=this.registerDisposer(r.a.fromData(e,new Float32Array([0,0,0,1,1,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,1,1]),e.ARRAY_BUFFER,e.STATIC_DRAW));this.colorBuffer=this.registerDisposer(r.a.fromData(e,new Float32Array([1,0,0,.5,1,0,0,.5,0,1,0,.5,0,1,0,.5,0,0,1,.5,0,0,1,.5]),e.ARRAY_BUFFER,e.STATIC_DRAW)),this.trivialColorShader=this.registerDisposer(Object(s.c)(e))}static get(e){return e.memoize.get("SliceViewPanel:AxesLineHelper",()=>new o(e))}draw(e,t=!0){let n=this.trivialColorShader,i=this.gl;n.bind(),i.uniformMatrix4fv(n.uniform("uProjectionMatrix"),!1,e);let r=n.attribute("aVertexPosition");this.vertexBuffer.bindToVertexAttrib(r,4);let s=n.attribute("aColor");this.colorBuffer.bindToVertexAttrib(s,4),t&&(i.colorMask(!1,!1,!1,!0),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.colorMask(!0,!0,!0,!0),i.enable(i.BLEND),i.blendFunc(i.ONE_MINUS_DST_ALPHA,i.DST_ALPHA)),i.lineWidth(1),i.drawArrays(i.LINES,0,6),t&&i.disable(i.BLEND),i.disableVertexAttribArray(r),i.disableVertexAttribArray(s)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const i=!1;class r{constructor(){this.renderLayers=[null],this.pickData=[null],this.values=[0,0,0],this.nextPickID=1}clear(){this.renderLayers.length=1,this.pickData.length=1,this.values.length=3,this.nextPickID=1}registerUint64(e,t,n=1){return this.register(e,n,t.low,t.high)}register(e,t=1,n=0,i=0,r=null){let{renderLayers:s,values:o}=this,a=this.nextPickID;this.nextPickID+=t;let l=s.length;s[l]=e;let c=3*l;return o[c]=a,o[c+1]=n,o[c+2]=i,this.pickData[l]=r,a}setMouseState(e,t){const{renderLayers:n,values:r}=this;let s=0,o=n.length-1;for(;s<o;){const e=Math.ceil(s+(o-s)/2);r[3*e]>t?o=e-1:s=e}const a=e.pickedRenderLayer=n[s],l=3*s,c=e.pickedOffset=t-r[l];i&&console.log(`Looking up pick ID ${t}: renderLayer`,a,`offset=${c}`);let{pickedValue:u}=e;u.low=r[l+1],u.high=r[l+2],e.pickedAnnotationId=void 0,e.pickedAnnotationLayer=void 0,null!==a&&a.updateMouseState(e,u,c,this.pickData[s])}}},function(e,t,n){"use strict";(function(e){var n=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var n=-1;return e.some(function(e,i){return e[0]===t&&(n=i,!0)}),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),i=this.__entries__[n];return i&&i[1]},t.prototype.set=function(t,n){var i=e(this.__entries__,t);~i?this.__entries__[i][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,i=e(n,t);~i&&n.splice(i,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,i=this.__entries__;n<i.length;n++){var r=i[n];e.call(t,r[1],r[0])}},t}()}(),i="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,r=void 0!==e&&e.Math===Math?e:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),s="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(r):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)},o=2;var a=20,l=["top","right","bottom","left","width","height","size","weight"],c="undefined"!=typeof MutationObserver,u=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,i=!1,r=0;function a(){n&&(n=!1,e()),i&&c()}function l(){s(a)}function c(){var e=Date.now();if(n){if(e-r<o)return;i=!0}else n=!0,i=!1,setTimeout(l,t);r=e}return c}(this.refresh.bind(this),a)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter(function(e){return e.gatherActive(),e.hasActive()});return e.forEach(function(e){return e.broadcastActive()}),e.length>0},e.prototype.connect_=function(){i&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),c?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){i&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;l.some(function(e){return!!~n.indexOf(e)})&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),d=function(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];Object.defineProperty(e,r,{value:t[r],enumerable:!1,writable:!1,configurable:!0})}return e},h=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||r},p=y(0,0,0,0);function f(e){return parseFloat(e)||0}function g(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce(function(t,n){return t+f(e["border-"+n+"-width"])},0)}function m(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return p;var i=h(e).getComputedStyle(e),r=function(e){for(var t={},n=0,i=["top","right","bottom","left"];n<i.length;n++){var r=i[n],s=e["padding-"+r];t[r]=f(s)}return t}(i),s=r.left+r.right,o=r.top+r.bottom,a=f(i.width),l=f(i.height);if("border-box"===i.boxSizing&&(Math.round(a+s)!==t&&(a-=g(i,"left","right")+s),Math.round(l+o)!==n&&(l-=g(i,"top","bottom")+o)),!function(e){return e===h(e).document.documentElement}(e)){var c=Math.round(a+s)-t,u=Math.round(l+o)-n;1!==Math.abs(c)&&(a-=c),1!==Math.abs(u)&&(l-=u)}return y(r.left,r.top,a,l)}var v="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof h(e).SVGGraphicsElement}:function(e){return e instanceof h(e).SVGElement&&"function"==typeof e.getBBox};function b(e){return i?v(e)?function(e){var t=e.getBBox();return y(0,0,t.width,t.height)}(e):m(e):p}function y(e,t,n,i){return{x:e,y:t,width:n,height:i}}var w=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=y(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=b(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),x=function(){return function(e,t){var n,i,r,s,o,a,l,c=(i=(n=t).x,r=n.y,s=n.width,o=n.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,l=Object.create(a.prototype),d(l,{x:i,y:r,width:s,height:o,top:r,right:i+s,bottom:o+r,left:i}),l);d(this,{target:e,contentRect:c})}}(),S=function(){function e(e,t,i){if(this.activeObservations_=[],this.observations_=new n,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=i}return e.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof h(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new w(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof h(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(t){t.isActive()&&e.activeObservations_.push(t)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map(function(e){return new x(e.target,e.broadcastRect())});this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),C="undefined"!=typeof WeakMap?new WeakMap:new n,O=function(){return function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=u.getInstance(),i=new S(t,n,this);C.set(this,i)}}();["observe","unobserve","disconnect"].forEach(function(e){O.prototype[e]=function(){var t;return(t=C.get(this))[e].apply(t,arguments)}});var L=void 0!==r.ResizeObserver?r.ResizeObserver:O;t.a=L}).call(this,n(123))},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(14),r=n(24);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function s(e,t,n,s,o,a,l=i.e){let c;e:for(;;){c=await e.get(c,l);t:for(;;)try{return await Object(r.b)(t,o(c.credentials,n),s,l)}catch(e){if(e instanceof r.a){if("refresh"===a(e))continue e;continue t}throw e}}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(1),r=n(3);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class s{constructor(e,t,n=t){this.enumType=e,this.value_=t,this.defaultValue=n,this.changed=new r.a}set value(e){this.value_!==e&&(this.value_=e,this.changed.dispatch())}get value(){return this.value_}reset(){this.value=this.defaultValue}restoreState(e){this.value=Object(i.m)(e,this.enumType)}toJSON(){return this.enumType[this.value_].toLowerCase()}}},function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return c});var i=n(45),r=n(70),s=n(19),o=n(46);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class a extends r.a{constructor(e,{sourceOptions:t={}}={}){super(e.chunkManager,e.getSources(t),{}),this.shader=void 0,this.rpcId=null,this.shaderGetter=this.registerDisposer(new o.a(this.gl,e=>this.defineShader(e),()=>this.getShaderKey()))}defineShader(e){e.addFragmentCode("\nvoid emit(vec4 color) {\n  v4f_fragColor = color;\n}\nvoid emitRGBA(vec4 rgba) {\n  emit(vec4(rgba.rgb, rgba.a * uOpacity));\n}\nvoid emitRGB(vec3 rgb) {\n  emit(vec4(rgb, uOpacity));\n}\nvoid emitGrayscale(float value) {\n  emit(vec4(value, value, value, uOpacity));\n}\nvoid emitTransparent() {\n  emit(vec4(0.0, 0.0, 0.0, 0.0));\n}\n")}beginSlice(e){let t=this.shaderGetter.get();if(void 0!==t)return t.bind(),t}}class l extends i.b{constructor(e,t){super(e,t),this.vertexPositions=t.vertexPositions,this.numPoints=Math.floor(this.vertexPositions.length/3)}copyToGPU(e){super.copyToGPU(e),this.vertexBuffer=s.a.fromData(e,this.vertexPositions,e.ARRAY_BUFFER,e.STATIC_DRAW)}freeGPUMemory(e){super.freeGPUMemory(e),this.vertexBuffer.dispose()}}class c extends i.c{getChunk(e){return new l(this,e)}get vectorGraphicsCoordinatesInVoxels(){return!0}}},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var i=n(5),r=n(27),s=n(94),o=n(70),a=n(0),l=n(46),c=n(26);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const u=!1,d=.001,h="\nhighp ivec3 getPositionWithinChunk () {\n  return ivec3(min(vChunkPosition, uChunkDataSize - 1.0));\n}\n",p=a.m.create(),f=a.u.create();class g extends s.a{static get(e){return e.memoize.get("volume.VolumeSliceVertexComputationManager",()=>new g(e))}defineShader(e){super.defineShader(e),e.addAttribute("highp float","aVertexIndexFloat"),e.addUniform("highp vec3","uTranslation"),e.addUniform("highp mat4","uProjectionMatrix"),e.addUniform("highp vec3","uChunkDataSize"),e.addUniform("highp vec3","uVoxelSize"),e.addUniform("highp vec3","uLowerClipBound"),e.addUniform("highp vec3","uUpperClipBound"),e.addVarying("highp vec3","vChunkPosition"),e.setVertexMain(`\nvec3 chunkSize = uChunkDataSize * uVoxelSize;\nvec3 position = getBoundingBoxPlaneIntersectionVertexPosition(chunkSize, uTranslation, uLowerClipBound, uUpperClipBound, int(aVertexIndexFloat));\ngl_Position = uProjectionMatrix * vec4(position, 1.0);\nvChunkPosition = (position - uTranslation) / uVoxelSize +\n    ${d} * abs(uPlaneNormal);\n`),e.addFragmentCode(h)}computeVerticesDebug(e,t,n,i,r,s,o,l){let c=a.u.multiply(a.u.create(),e,t),u=a.u.create(),h=a.u.create(),p=a.u.fromValues(Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]));for(let e=0;e<6;++e){const f=this.computeVertexPositionDebug(c,n,i,r,s,o,e);if(void 0===f)return void console.log("no intersection found");a.u.transformMat4(u,f,l),a.u.sub(h,f,o),a.u.divide(h,h,t),a.u.scaleAndAdd(h,h,p,d),console.log(`vertex ${e}, at ${u}, vChunkPosition = ${h}`)}}beginSlice(e,t){let n=t.attribute("aVertexIndexFloat");this.data.outputVertexIndices.bindToVertexAttrib(n,1)}endSlice(e,t){let n=t.attribute("aVertexIndexFloat");e.disableVertexAttribArray(n)}beginSource(e,t,n,i,r,s){this.setViewportPlane(t,n.viewportAxes[2],n.centerDataPosition,s.invTransform),e.uniformMatrix4fv(t.uniform("uProjectionMatrix"),!1,a.m.multiply(p,i,s.transform)),e.uniform3fv(t.uniform("uVoxelSize"),r.voxelSize),e.uniform3fv(t.uniform("uLowerClipBound"),r.lowerClipBound),e.uniform3fv(t.uniform("uUpperClipBound"),r.upperClipBound),u&&(window.debug_sliceView_uVoxelSize=r.voxelSize,window.debug_sliceView_uLowerClipBound=r.lowerClipBound,window.debug_sliceView_uUpperClipBound=r.upperClipBound,window.debug_sliceView=n,window.debug_sliceView_dataToDevice=i)}setupChunkDataSize(e,t,n){e.uniform3fv(t.uniform("uChunkDataSize"),n),u&&(window.debug_sliceView_chunkDataSize=n)}drawChunk(e,t,n){if(e.uniform3fv(t.uniform("uTranslation"),n),e.drawArrays(e.TRIANGLE_FAN,0,6),u){let e=window.debug_sliceView,t=window.debug_sliceView_chunkDataSize,i=window.debug_sliceView_uVoxelSize,r=window.debug_sliceView_uLowerClipBound,s=window.debug_sliceView_uUpperClipBound;console.log(`Drawing chunk: ${Object(a.v)(n)} of data size ${Object(a.v)(t)}`);let o=window.debug_sliceView_dataToDevice;this.computeVerticesDebug(t,i,r,s,e.viewportPlaneDistanceToOrigin,e.viewportAxes[2],n,o)}}}class m extends o.a{constructor(e,t){const{sourceOptions:n={},shaderError:i}=t;super(e.chunkManager,e.getSources(n),t);const{gl:s}=this;this.shaderGetter=this.registerDisposer(new l.a(s,e=>this.defineShader(e),()=>`${this.getShaderKey()}/${this.chunkFormat.shaderKey}`,i)),this.vertexComputationManager=g.get(s);const o=Object(r.m)(this);{const{source:e,chunkLayout:t}=o[0][0],n=e.spec,i=this.boundingBox=new a.b(a.u.fromValues(1/0,1/0,1/0),a.u.fromValues(-1/0,-1/0,-1/0)),r=a.u.create(),s=f;for(let e=0;e<8;++e){for(let t=0;t<3;++t)s[t]=e&1<<t?n.upperClipBound[t]:n.lowerClipBound[t];t.localSpatialToGlobal(r,s),a.u.min(i.lower,i.lower,r),a.u.max(i.upper,i.upper,r)}}}get dataType(){return this.sources[0][0].spec.dataType}get chunkFormat(){return this.sources[0][0].chunkFormat}getValueAt(e){for(let t of Object(r.m)(this))for(let n of t){let t=n.source.getValueAt(e,n.chunkLayout);if(null!=t)return t}return null}getShaderKey(){return this.chunkFormat.shaderKey}defineShader(e){this.vertexComputationManager.defineShader(e),e.addOutputBuffer("vec4","v4f_fragData0",0),e.addFragmentCode("\nvoid emit(vec4 color) {\n  v4f_fragData0 = color;\n}\n"),this.chunkFormat.defineShader(e),e.addFragmentCode(`\n${Object(c.a)(this.dataType)} getDataValue() { return getDataValue(0); }\n`)}beginSlice(e){let t=this.gl,n=this.shaderGetter.get();if(void 0!==n)return n.bind(),this.vertexComputationManager.beginSlice(t,n),n}endSlice(e){let t=this.gl;this.vertexComputationManager.endSlice(t,e)}draw(e){let t=e.visibleLayers.get(this);if(0===t.length)return;let n=this.gl;const r=this.beginSlice(e);if(void 0===r)return;let s=a.u.create();const{renderScaleHistogram:o,vertexComputationManager:l}=this;let c=this.chunkFormat;c.beginDrawing(n,r),void 0!==o&&o.begin(this.chunkManager.chunkQueueManager.frameNumberCounter.frameNumber);for(let c of t){const t=c.chunkLayout,p=c.source,f=p.chunks;let g,m=t.size,v=e.visibleChunks.get(t);if(!v)continue;l.beginSource(n,r,e,e.dataToDevice,p.spec,t);let b=p.chunkFormat;b.beginSource(n,r);let y=e=>{g=e,l.setupChunkDataSize(n,r,g)},w=0,x=0;for(let e of v){let t=f.get(e);if(t&&t.state===i.g.GPU_MEMORY){let e=t.chunkDataSize;e!==g&&y(e),a.u.multiply(s,m,t.chunkGridPosition),b.bindChunk(n,r,t),l.drawChunk(n,r,s),++w}else++x}if((0!==w||0!==x)&&void 0!==o){const{voxelSize:t}=c,n=(u=t[0],d=t[1],h=t[2],u>d?h>u?u:d>h?d:h:h>d?d:u>h?u:h);o.add(n,n/e.pixelSize,w,x)}}var u,d,h;c.endDrawing(n,r),this.endSlice(r)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(62),r=n(20),s=n(28),o=n(30),a=n(76),l=n(93),c=n(1);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const u="source",d="crossSectionRenderScale";function h(e){return function(e){return class extends e{constructor(){super(...arguments),this.sliceViewRenderScaleHistogram=new o.a,this.sliceViewRenderScaleTarget=(()=>{const e=Object(o.e)(1);return e.changed.add(this.specificationChanged.dispatch),e})()}restoreState(e){super.restoreState(e);const t=this.volumePath=Object(c.v)(e,u,c.y);this.sliceViewRenderScaleTarget.restoreState(e[d]),void 0!==t&&(this.multiscaleSource=Object(s.d)(this.manager.dataSourceProvider,this.manager.chunkManager,t,this.volumeOptions)).then(e=>{if(!this.wasDisposed){const t=e.getStaticAnnotations&&e.getStaticAnnotations();void 0!==t&&(this.annotationLayerState.value=new i.b(Object.assign({transform:this.transform,source:t,role:r.g.DEFAULT_ANNOTATION},Object(a.b)(this))))}})}toJSON(){const e=super.toJSON();return e[u]=this.volumePath,e[d]=this.sliceViewRenderScaleTarget.toJSON(),e}}}(Object(a.a)(Object(l.a)(e)))}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(2),r=n(10),s=n(3),o=n(17);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(79),n(171);class a extends i.a{constructor(){super(),this.element=document.createElement("form"),this.label=document.createElement("label"),this.input=document.createElement("input"),this.valuesEntered=new s.b;let{element:e,label:t,input:n}=this;e.className="uint64-entry neuroglancer-noselect",e.appendChild(t),t.appendChild(n),this.registerEventListener(e,"submit",e=>{e.preventDefault();const t=this.validateInput();void 0!==t&&(this.input.value="",this.input.classList.remove("valid-input","invalid-input"),this.valuesEntered.dispatch(t))}),this.registerEventListener(e,"input",()=>{""!==this.input.value?this.validateInput()?this.input.classList.remove("invalid-input"):this.input.classList.add("invalid-input"):this.input.classList.remove("valid-input","invalid-input")})}validateInput(){let e=this.input.value;const t=(e=(e=e.replace(/[\s,\(\)\[\]\{\};]+/g," ")).trim()).split(" ");if(0===t.length)return;const n=[];for(const e of t){const t=new o.a;if(!t.tryParseString(e))return;n.push(t)}return n}disposed(){Object(r.b)(this.element),super.disposed()}}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(2);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r extends i.a{constructor(e){super(),this.model=e,this.element=document.createElement("select"),this.valueIndexMap=new Map;const{element:t,valueIndexMap:n}=this;let i=0;for(const r of Object.keys(e.enumType))if(isNaN(Number(r))){const s=document.createElement("option");s.textContent=s.value=r.toLowerCase(),t.appendChild(s),n.set(e.enumType[r],i),++i}this.registerDisposer(e.changed.add(()=>this.updateView())),this.registerEventListener(t,"change",()=>this.updateModel()),this.registerEventListener(t,"wheel",e=>{let{deltaY:n}=e;n>0?(t.selectedIndex=(t.options.length+t.selectedIndex-1)%t.options.length,this.updateModel()):n<0&&(t.selectedIndex=(t.options.length+t.selectedIndex+1)%t.options.length,this.updateModel())}),this.updateView()}updateView(){const{element:e}=this;e.selectedIndex=this.valueIndexMap.get(this.model.value)}updateModel(){this.model.restoreState(this.element.value)}}},function(e,t,n){"use strict";n.r(t);n(79),n(187);var i=n(20),r=n(28),s=n(43),o=n(49),a=n(30);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const l=3432918353,c=461845907;function u(e,t){return t>>>=0,e>>>=0,t=((t=Math.imul(t,l)>>>0)<<15|t>>>17)>>>0,e=5*(e=((e=(e^(t=Math.imul(t,c)>>>0))>>>0)<<13|e>>>19)>>>0)+3864292196>>>0}var d=n(51),h=n(17);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const p=3,f=.9,g=!1;let m=0,v=0,b=0,y=0;class w{constructor(e=w.generateHashSeeds(p)){this.hashSeeds=e,this.loadFactor=f,this.size=0,this.emptyLow=4294967295,this.emptyHigh=4294967295,this.maxRehashAttempts=5,this.maxAttempts=5,this.generation=0,this.mungedEmptyKey=-1;let t=8;for(;t<2*e.length;)t*=2;this.allocate(t)}updateHashFunctions(e){this.hashSeeds=w.generateHashSeeds(e),this.mungedEmptyKey=-1}tableWithMungedEmptyKey(e){const t=this.hashSeeds.length,n=new Array(t);for(let e=0;e<t;++e)n[e]=this.getHash(e,this.emptyLow,this.emptyHigh);let{mungedEmptyKey:i}=this;if(-1===i)e:for(;;){i=16777216*Math.random()>>>0;for(let e=0;e<t;++e){let r=this.getHash(e,i,i);for(let e=0;e<t;++e)if(n[e]===r)continue e}this.mungedEmptyKey=i;break}let{table:r,emptyLow:s,emptyHigh:o}=this;for(let e=0;e<t;++e){let t=n[e];r[t]===s&&r[t+1]===o&&(r[t]=i,r[t+1]=i)}try{e(r)}finally{for(let e=0;e<t;++e){let t=n[e];r[t]===i&&r[t+1]===i&&(r[t]=s,r[t+1]=o)}}}static generateHashSeeds(e=p){return Object(d.c)(new Uint32Array(e))}getHash(e,t,n){let i=this.hashSeeds[e];return i=u(i,t),i=u(i,n),this.entryStride*(i&this.tableSize-1)}*keys(e=new h.a){let{emptyLow:t,emptyHigh:n,entryStride:i}=this,{table:r}=this;for(let s=0,o=r.length;s<o;s+=i){let i=r[s],o=r[s+1];i===t&&o===n||(e.low=i,e.high=o,yield e)}}indexOfPair(e,t){let{table:n,emptyLow:i,emptyHigh:r}=this;if(e===i&&t===r)return-1;for(let i=0,r=this.hashSeeds.length;i<r;++i){let r=this.getHash(i,e,t);if(n[r]===e&&n[r+1]===t)return r}return-1}indexOf(e){return this.indexOfPair(e.low,e.high)}chooseAnotherEmptyKey(){let e,t,{emptyLow:n,emptyHigh:i,table:r,entryStride:s}=this;for(;e=4294967296*Math.random()>>>0,t=4294967296*Math.random()>>>0,e===n&&t===i||this.hasPair(e,t););this.emptyLow=e,this.emptyHigh=t;for(let o=0,a=r.length;o<a;o+=s)r[o]===n&&r[o+1]===i&&(r[o]=e,r[o+1]=t)}has(e){return-1!==this.indexOf(e)}hasPair(e,t){return-1!==this.indexOfPair(e,t)}delete(e){let t=this.indexOf(e);if(-1!==t){let{table:e}=this;return e[t]=this.emptyLow,e[t+1]=this.emptyHigh,++this.generation,this.size--,!0}return!1}clearTable(){let{table:e,entryStride:t,emptyLow:n,emptyHigh:i}=this,r=e.length;for(let s=0;s<r;s+=t)e[s]=n,e[s+1]=i}clear(){return 0!==this.size&&(this.size=0,++this.generation,this.clearTable(),!0)}swapPending(e,t){let n=m,i=v;this.storePending(e,t),e[t]=n,e[t+1]=i}storePending(e,t){m=e[t],v=e[t+1]}backupPending(){b=m,y=v}restorePending(){m=b,v=y}tryToInsert(){g&&console.log(`tryToInsert: ${m}, ${v}`);let e=0,{emptyLow:t,emptyHigh:n,maxAttempts:i,table:r}=this,s=this.hashSeeds.length,o=Math.floor(Math.random()*s);for(;;){let a=this.getHash(o,m,v);if(this.swapPending(r,a),m===t&&v===n)return!0;if(++e===i)break;o=(o+Math.floor(Math.random()*(s-1))+1)%s}return!1}allocate(e){this.tableSize=e;let{entryStride:t}=this;this.table=new Uint32Array(e*t),this.maxAttempts=e,this.clearTable(),this.capacity=e*this.loadFactor,this.mungedEmptyKey=-1}rehash(e,t){g&&console.log("rehash begin"),this.allocate(t),this.updateHashFunctions(this.hashSeeds.length);let{emptyLow:n,emptyHigh:i,entryStride:r}=this;for(let t=0,s=e.length;t<s;t+=r){let r=e[t],s=e[t+1];if((r!==n||s!==i)&&(this.storePending(e,t),!this.tryToInsert()))return g&&console.log("rehash failed"),!1}return g&&console.log("rehash end"),!0}grow(e){g&&console.log(`grow: ${e}`);let t=this.table,{tableSize:n}=this;for(;n<e;)n*=2;for(;;){for(let e=0;e<this.maxRehashAttempts;++e)if(this.rehash(t,n))return void(g&&console.log("grow end"));n*=2}}insertInternal(){for(++this.generation,m===this.emptyLow&&v===this.emptyHigh&&this.chooseAnotherEmptyKey(),++this.size>this.capacity&&(this.backupPending(),this.grow(2*this.tableSize),this.restorePending());!this.tryToInsert();)this.backupPending(),this.grow(this.tableSize),this.restorePending()}}class x extends w{add(e){let{low:t,high:n}=e;return!this.hasPair(t,n)&&(g&&console.log(`add: ${t},${n}`),m=t,v=n,this.insertInternal(),!0)}[Symbol.iterator](){return this.keys()}}x.prototype.entryStride=2;let S=0,C=0,O=0,L=0;class T extends w{set(e,t){let{low:n,high:i}=e;return!this.hasPair(n,i)&&(g&&console.log(`add: ${n},${i} -> ${t.low},${t.high}`),m=n,v=i,S=t.low,C=t.high,this.insertInternal(),!0)}get(e,t){let n=this.indexOf(e);if(-1===n)return!1;let{table:i}=this;return t.low=i[n+2],t.high=i[n+3],!0}swapPending(e,t){let n=S,i=C;super.swapPending(e,t),e[t+2]=n,e[t+3]=i}storePending(e,t){super.storePending(e,t),S=e[t+2],C=e[t+3]}backupPending(){super.backupPending(),O=S,L=C}restorePending(){super.restorePending(),S=O,C=L}[Symbol.iterator](){return this.entries()}*entries(e=[new h.a,new h.a]){let{emptyLow:t,emptyHigh:n,entryStride:i}=this,{table:r}=this,[s,o]=e;for(let a=0,l=r.length;a<l;a+=i){let i=r[a],l=r[a+1];i===t&&l===n||(s.low=i,s.high=l,o.low=r[a+2],o.high=r[a+3],yield e)}}}T.prototype.entryStride=4;var k=n(2),E=n(26),A=n(21),M=n(12);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const I=[E.h,"\nhighp uint hashCombine(highp uint state, highp uint value) {\n  value *= 0xcc9e2d51u;\n  value = (value << 15u) | (value >> 17u);\n  value *= 0x1b873593u;\n  state ^= value;\n  state = (state << 13u) | (state >> 19u);\n  state = (state * 5u) + 0xe6546b64u;\n  return state;\n}\nhighp uint hashCombine(highp uint state, uint64_t x) {\n  state = hashCombine(state, x.value[0]);\n  return hashCombine(state, x.value[1]);\n}\n"],N=Object(A.e)(new A.b,M.b.UINT64,1);class D extends k.a{constructor(e,t){super(),this.gl=e,this.hashTable=t,this.generation=-1,this.texture=null,this.texture=e.createTexture()}copyToGPU(){let{hashTable:e}=this,{generation:t}=e;if(this.generation===t)return;const{gl:n,texture:i}=this;Object(A.d)(this,n,N.texelsPerElement,e.tableSize*e.entryStride/2),this.generation=t,n.activeTexture(WebGL2RenderingContext.TEXTURE0+n.tempTextureUnit),n.bindTexture(WebGL2RenderingContext.TEXTURE_2D,i),e.tableWithMungedEmptyKey(e=>{Object(A.g)(this.gl,this,N,e)}),n.bindTexture(WebGL2RenderingContext.TEXTURE_2D,null)}disposed(){let{gl:e}=this;e.deleteTexture(this.texture),this.texture=null,this.gl=void 0,this.hashTable=void 0,super.disposed()}static get(e,t){return e.memoize.get(t,()=>new this(e,t))}}class R{constructor(e,t=p){this.prefix=e,this.numAlternatives=t,this.textureUnitSymbol=Symbol.for(`gpuhashtable:${this.prefix}`),this.accessHelper=new A.a(`gpuhashtable_${this.prefix}`),this.samplerName=this.prefix+"_sampler",this.hashSeedsName=this.prefix+"_seeds",this.hashKeyMask=this.prefix+"_keyMask",this.readTable=this.prefix+"_readTable"}defineShader(e){let{hashSeedsName:t,samplerName:n,numAlternatives:i,hashKeyMask:r}=this;e.addUniform("highp uint",t,i),e.addUniform("highp uint",r),e.addTextureSampler("usampler2D",n,this.textureUnitSymbol),e.addFragmentCode(I),e.addFragmentCode(E.h),e.addFragmentCode(E.b),this.accessHelper.defineShader(e),e.addFragmentCode(this.accessHelper.getAccessor(this.readTable,this.samplerName,M.b.UINT64,1));let s="";s+=`\nbool ${this.hasFunctionName}(uint64_t x) {\n`;for(let e=0;e<i;++e)s+=`\n  {\n    uint h = hashCombine(${t}[${e}], x) & ${r};\n    uint64_t key = ${this.readTable}(h);\n    if (equals(key, x)) {\n      return true;\n    }\n  }\n`;s+="\n  return false;\n}\n",e.addFragmentCode(s)}get hasFunctionName(){return`${this.prefix}_has`}enable(e,t,n){n.copyToGPU();const i=t.textureUnit(this.textureUnitSymbol);e.activeTexture(WebGL2RenderingContext.TEXTURE0+i),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,n.texture),this.accessHelper.setupTextureLayout(e,t,n),e.uniform1ui(t.uniform(this.hashKeyMask),n.hashTable.tableSize-1),e.uniform1uiv(t.uniform(this.hashSeedsName),n.hashTable.hashSeeds)}disable(e,t){const n=t.textureUnit(this.textureUnitSymbol);e.activeTexture(WebGL2RenderingContext.TEXTURE0+n),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,null)}}class P extends R{defineShader(e){super.defineShader(e);let{numAlternatives:t,hashSeedsName:n,hashKeyMask:i}=this,r=`\nbool ${this.getFunctionName}(uint64_t x, out uint64_t value) {\n`;for(let e=0;e<t;++e)r+=`\n  {\n    uint h = hashCombine(${n}[${e}], x) & ${i};\n    uint64_t key = ${this.readTable}(h * 2u);\n    if (equals(key, x)) {\n      value = ${this.readTable}(h * 2u + 1u);\n      return true;\n    }\n  }\n`;r+="\n  return false;\n}\n",e.addFragmentCode(r)}get getFunctionName(){return`${this.prefix}_get`}}var j=n(73),V=n(3);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const _=2;class U{constructor(e){this.prefix=e,this.seedName=this.prefix+"_seed"}defineShader(e){const{seedName:t}=this;e.addUniform("highp uint",t),e.addFragmentCode(E.h),e.addFragmentCode(I),e.addFragmentCode(E.e);let n=`\nvec3 ${this.prefix}(uint64_t x) {\n  uint h = hashCombine(${t}, x);\n  vec${_} v;\n`;for(let e=0;e<_;++e)n+=`\n  v[${e}] = float(h & 0xFFu) / 255.0;\n  h >>= 8u;\n`;n+="\n  vec3 hsv = vec3(v.x, 0.5 + v.y * 0.5, 1.0);\n  return hsvToRgb(hsv);\n}\n",e.addFragmentCode(n)}enable(e,t,n){e.uniform1ui(t.uniform(this.seedName),n.hashSeed)}}let F=new Float32Array(3);class z{constructor(e=Object(d.b)()){this.hashSeed=e,this.changed=new V.a}static getDefault(){return new z(0)}compute(e,t){let n=u(this.hashSeed,t.low);const i=(255&(n=u(n,t.high)))/255,r=(n>>8&255)/255;return Object(j.a)(e,i,.5+.5*r,1),e}computeCssColor(e){return this.compute(F,e),`rgb(${100*F[0]}%,${100*F[1]}%,${100*F[2]}%)`}randomize(){this.hashSeed=Object(d.b)(),this.changed.dispatch()}toString(){return`new SegmentColorHash(${this.hashSeed})`}toJSON(){return 0===this.hashSeed?void 0:this.hashSeed}reset(){this.restoreState(0)}restoreState(e){const t=e>>>0;t!==this.hashSeed&&(this.hashSeed=t,this.changed.dispatch())}}var B=n(44);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G=Symbol("disjoint_sets:rank"),W=Symbol("disjoint_sets:parent"),$=Symbol("disjoint_sets:next"),H=Symbol("disjoint_sets:prev");function q(e){let t=e,n=e[W];for(;n!==e;)n=(e=n)[W];for(e=t[W];n!==e;)t[W]=n,e=(t=e)[W];return n}function*Y(e){let t=e;do{yield t,t=t[$]}while(t!==e)}const J=Symbol("disjoint_sets:min");class X{constructor(){this.map=new Map,this.generation=0}get(e){let t=e.toString(),n=this.map.get(t);return void 0===n?e:q(n)[J]}isMinElement(e){let t=this.get(e);return t===e||h.a.equal(t,e)}makeSet(e){let t=e.toString(),{map:n}=this,i=n.get(t);return void 0===i?(i=e.clone(),(r=i)[W]=r,r[G]=0,r[$]=r[H]=r,i[J]=i,n.set(t,i),i):q(i);var r}link(e,t){if((e=this.makeSet(e))===(t=this.makeSet(t)))return!1;this.generation++;let n=function(e,t){let n=e[G],i=t[G];return n>i?(t[W]=e,e):(e[W]=t,n===i&&(t[G]=i+1),t)}(e,t);!function(e,t){let n=e[H],i=t[H];t[H]=n,n[$]=t,e[H]=i,i[$]=e}(e,t);let i=e[J],r=t[J];return n[J]=h.a.less(i,r)?i:r,!0}*setElements(e){let t=e.toString(),n=this.map.get(t);void 0===n?yield e:yield*Y(n)}clear(){let{map:e}=this;return 0!==e.size&&(++this.generation,e.clear(),!0)}get size(){return this.map.size}*mappings(e=new Array(2)){for(let t of this.map.values())e[0]=t,e[1]=q(t)[J],yield e}[Symbol.iterator](){return this.mappings()}toJSON(){let e=new Array;for(let n of this.map.values())if((t=n)[W]===t){let t=new Array;for(let e of Y(n))t.push(e);t.sort(h.a.compare),e.push(t)}var t;return e.sort((e,t)=>h.a.compare(e[0],t[0])),e.map(e=>e.map(e=>e.toString()))}}var K=n(1),Q=n(8);let Z=class extends Q.c{constructor(){super(...arguments),this.disjointSets=new X,this.changed=new V.a}static makeWithCounterpart(e){let t=new this;return t.initializeCounterpart(e),t}disposed(){this.disjointSets=void 0,this.changed=void 0,super.disposed()}link(e,t){if(this.disjointSets.link(e,t)){let{rpc:n}=this;n&&n.invoke("DisjointUint64Sets.add",{id:this.rpcId,al:e.low,ah:e.high,bl:t.low,bh:t.high}),this.changed.dispatch()}}get(e){return this.disjointSets.get(e)}clear(){if(this.disjointSets.clear()){let{rpc:e}=this;e&&e.invoke("DisjointUint64Sets.clear",{id:this.rpcId}),this.changed.dispatch()}}setElements(e){return this.disjointSets.setElements(e)}get size(){return this.disjointSets.size}toJSON(){return this.disjointSets.toJSON()}restoreState(e){if(this.clear(),void 0!==e){let t=[new h.a,new h.a];Object(K.a)(e,e=>{Object(K.a)(e,(e,n)=>{t[n%2].parseString(String(e),10),0!==n&&this.link(t[0],t[1])})})}}};Z=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([Object(Q.f)("DisjointUint64Sets")],Z);const ee=new h.a,te=new h.a;Object(Q.e)("DisjointUint64Sets.add",function(e){let t=this.get(e.id);ee.low=e.al,ee.high=e.ah,te.low=e.bl,te.high=e.bh,t.disjointSets.link(ee,te)&&t.changed.dispatch()}),Object(Q.e)("DisjointUint64Sets.clear",function(e){let t=this.get(e.id);t.disjointSets.clear()&&t.changed.dispatch()});var ne=n(56),ie=n(4),re=n(107);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class se{constructor(e){this.disjointSets=e,this.generation=Number.NaN,this.hashMap=new T}update(){let{disjointSets:e}=this;const{generation:t}=e;if(this.generation!==t){this.generation=t;let{hashMap:n}=this;n.clear();for(let[t,i]of e.mappings())n.set(t,i)}}}class oe extends re.a{constructor(e,t){super(e,{sourceOptions:t.volumeSourceOptions,transform:t.transform,renderScaleHistogram:t.renderScaleHistogram,renderScaleTarget:t.renderScaleTarget}),this.displayState=t,this.segmentColorShaderManager=new U("segmentColorHash"),this.hashTableManager=new R("visibleSegments"),this.gpuHashTable=D.get(this.gl,this.displayState.visibleSegments.hashTable),this.hashTableManagerHighlighted=new R("highlightedSegments"),this.gpuHashTableHighlighted=D.get(this.gl,this.displayState.highlightedSegments.hashTable),this.equivalencesShaderManager=new P("equivalences"),this.equivalencesHashMap=new se(this.displayState.segmentEquivalences.disjointSets),this.gpuEquivalencesHashTable=D.get(this.gl,this.equivalencesHashMap.hashMap),Object(B.f)(t,this),this.registerDisposer(t.selectedAlpha.changed.add(()=>{this.redrawNeeded.dispatch()})),this.registerDisposer(t.hideSegmentZero.changed.add(()=>{this.redrawNeeded.dispatch(),this.shaderGetter.invalidateShader()})),this.hasEquivalences=0!==this.displayState.segmentEquivalences.size,t.segmentEquivalences.changed.add(()=>{let{segmentEquivalences:e}=this.displayState,t=0!==e.size;t!==this.hasEquivalences&&(this.hasEquivalences=t,this.shaderGetter.invalidateShader())}),this.registerDisposer(t.notSelectedAlpha.changed.add(()=>{this.redrawNeeded.dispatch()}))}getShaderKey(){return`sliceview.SegmentationRenderLayer/${this.hasEquivalences}/`+this.displayState.hideSegmentZero.value}defineShader(e){super.defineShader(e),this.hashTableManager.defineShader(e),this.hashTableManagerHighlighted.defineShader(e),e.addFragmentCode("\nuint64_t getUint64DataValue() {\n  return toUint64(getDataValue());\n}\n"),this.hasEquivalences?(this.equivalencesShaderManager.defineShader(e),e.addFragmentCode(`\nuint64_t getMappedObjectId() {\n  uint64_t value = getUint64DataValue();\n  uint64_t mappedValue;\n  if (${this.equivalencesShaderManager.getFunctionName}(value, mappedValue)) {\n    return mappedValue;\n  }\n  return value;\n}\n`)):e.addFragmentCode("\nuint64_t getMappedObjectId() {\n  return getUint64DataValue();\n}\n"),this.segmentColorShaderManager.defineShader(e),e.addUniform("highp uvec2","uSelectedSegment"),e.addUniform("highp uint","uShowAllSegments"),e.addUniform("highp float","uSelectedAlpha"),e.addUniform("highp float","uNotSelectedAlpha"),e.addUniform("highp float","uSaturation");let t="\n  uint64_t value = getMappedObjectId();\n\n  float alpha = uSelectedAlpha;\n  float saturation = uSaturation;\n";this.displayState.hideSegmentZero.value&&(t+="\n  if (value.value[0] == 0u && value.value[1] == 0u) {\n    emit(vec4(vec4(0, 0, 0, 0)));\n    return;\n  }\n"),t+=`\n  bool has = uShowAllSegments != 0u ? true : ${this.hashTableManager.hasFunctionName}(value);\n  if (uSelectedSegment == value.value) {\n    saturation = has ? 0.5 : 0.75;\n  } else if (!has) {\n    alpha = uNotSelectedAlpha;\n  }\n  vec3 rgb = segmentColorHash(value);\n  `,t+=`\n  if(${this.hashTableManagerHighlighted.hasFunctionName}(value)) {\n    rgb = vec3(0.2,0.2,2.0);\n    saturation = 1.0;\n  };\n`,t+="\n  emit(vec4(mix(vec3(1.0,1.0,1.0), rgb, saturation), alpha));\n",e.setFragmentMain(t)}beginSlice(e){let t=super.beginSlice(e);if(void 0===t)return;let n=this.gl,{displayState:i}=this,{segmentSelectionState:r,visibleSegments:s}=this.displayState,o=0,a=0;if(r.hasSelectedSegment){let e=r.selectedSegment;o=e.low,a=e.high}return n.uniform1f(t.uniform("uSelectedAlpha"),this.displayState.selectedAlpha.value),n.uniform1f(t.uniform("uSaturation"),this.displayState.saturation.value),n.uniform1f(t.uniform("uNotSelectedAlpha"),this.displayState.notSelectedAlpha.value),n.uniform2ui(t.uniform("uSelectedSegment"),o,a),n.uniform1ui(t.uniform("uShowAllSegments"),s.hashTable.size?0:1),this.hashTableManager.enable(n,t,this.gpuHashTable),this.hashTableManagerHighlighted.enable(n,t,this.gpuHashTableHighlighted),this.hasEquivalences&&(this.equivalencesHashMap.update(),this.equivalencesShaderManager.enable(n,t,this.gpuEquivalencesHashTable)),this.segmentColorShaderManager.enable(n,t,i.segmentColorHash),t}endSlice(e){let{gl:t}=this;this.hashTableManager.disable(t,e),this.hashTableManagerHighlighted.disable(t,e),super.endSlice(e)}}var ae,le=n(47),ce=n(18),ue=n(9);let de=ae=class extends Q.c{constructor(){super(...arguments),this.hashTable=new x,this.changed=new V.b}static makeWithCounterpart(e){let t=new ae;return t.initializeCounterpart(e),t}disposed(){super.disposed(),this.hashTable=void 0,this.changed=void 0}add_(e){return this.hashTable.add(e)}add(e){if(this.add_(e)){let{rpc:t}=this;t&&t.invoke("Uint64Set.add",{id:this.rpcId,value:e}),this.changed.dispatch(e,!0)}}has(e){return this.hashTable.has(e)}[Symbol.iterator](){return this.hashTable.keys()}delete_(e){return this.hashTable.delete(e)}delete(e){if(this.delete_(e)){let{rpc:t}=this;t&&t.invoke("Uint64Set.delete",{id:this.rpcId,value:e}),this.changed.dispatch(e,!1)}}get size(){return this.hashTable.size}clear(){if(this.hashTable.clear()){let{rpc:e}=this;e&&e.invoke("Uint64Set.clear",{id:this.rpcId}),this.changed.dispatch(null,!1)}}toJSON(){let e=new Array;for(let t of this)e.push(t.toString());return e.sort(),e}};de=ae=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([Object(Q.f)("Uint64Set")],de),Object(Q.e)("Uint64Set.add",function(e){let t=this.get(e.id);t.add_(e.value)&&t.changed.dispatch()}),Object(Q.e)("Uint64Set.delete",function(e){let t=this.get(e.id);t.delete_(e.value)&&t.changed.dispatch()}),Object(Q.e)("Uint64Set.clear",function(e){let t=this.get(e.id);t.hashTable.clear()&&t.changed.dispatch()});var he=n(108),pe=n(46),fe=n(110),ge=n(55),me=n(98);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(79),n(189);let ve=new h.a;class be extends k.a{constructor(e){super(),this.displayState=e,this.element=document.createElement("div"),this.clearButton=document.createElement("button"),this.itemContainer=document.createElement("span"),this.items=new Map;let{element:t,clearButton:n,itemContainer:i}=this;t.className="segment-set-widget neuroglancer-noselect",n.className="clear-button",n.title="Remove all segment IDs",this.registerEventListener(n,"click",()=>{this.visibleSegments.clear()}),i.className="item-container",t.appendChild(i),i.appendChild(n),this.registerDisposer(e.visibleSegments.changed.add((e,t)=>{this.handleSetChanged(e,t)})),this.registerDisposer(e.segmentColorHash.changed.add(()=>{this.handleColorChanged()}));for(let t of e.visibleSegments)this.addElement(t.toString());this.updateClearButtonVisibility()}get visibleSegments(){return this.displayState.visibleSegments}get segmentColorHash(){return this.displayState.segmentColorHash}get segmentSelectionState(){return this.displayState.segmentSelectionState}updateClearButtonVisibility(){let{clearButton:e}=this;e.style.display=this.displayState.visibleSegments.size>0?"":"none"}handleSetChanged(e,t){this.updateClearButtonVisibility();let{items:n}=this;if(null===e){let{itemContainer:e,clearButton:t}=this;for(;;){let n=e.lastElementChild;if(n===t)break;e.removeChild(n)}n.clear()}else if(t)this.addElement(e.toString());else{let t=e.toString(),i=n.get(t);i.parentElement.removeChild(i),n.delete(t)}}addElement(e){let t=document.createElement("button");t.className="segment-button",t.textContent=e,t.title=`Remove segment ID ${e}`;let n=this;t.addEventListener("click",function(){ve.tryParseString(this.textContent),n.visibleSegments.delete(ve)}),t.addEventListener("mouseenter",function(){ve.tryParseString(this.textContent),n.segmentSelectionState.set(ve)}),t.addEventListener("mouseleave",function(){ve.tryParseString(this.textContent),n.segmentSelectionState.set(null)}),this.setItemColor(t),this.itemContainer.appendChild(t),this.items.set(e,t)}setItemColor(e){ve.tryParseString(e.textContent),e.style.backgroundColor=this.segmentColorHash.computeCssColor(ve)}handleColorChanged(){this.items.forEach(e=>{this.setItemColor(e)})}disposed(){let{element:e}=this,{parentElement:t}=e;t&&t.removeChild(e),super.disposed()}}var ye=n(92),we=n(31),xe=n(109);n.d(t,"SegmentationUserLayer",function(){return Ve});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Se="selectedAlpha",Ce="notSelectedAlpha",Oe="objectAlpha",Le="saturation",Te="hideSegmentZero",ke="mesh",Ee="skeletons",Ae="segments",Me="highlights",Ie="equivalences",Ne="colorSeed",De="meshRenderScale",Re="skeletonRendering",Pe="skeletonShader",je=Object(he.a)(i.i);class Ve extends je{constructor(e,t){super(e,t),this.manager=e,this.displayState={segmentColorHash:z.getDefault(),segmentSelectionState:new B.a,selectedAlpha:Object(le.a)(.5),saturation:Object(le.a)(1),notSelectedAlpha:Object(le.a)(0),objectAlpha:Object(le.a)(1),hideSegmentZero:new ce.b(!0,!0),visibleSegments:de.makeWithCounterpart(this.manager.worker),highlightedSegments:de.makeWithCounterpart(this.manager.worker),segmentEquivalences:Z.makeWithCounterpart(this.manager.worker),objectToDataTransform:this.transform,skeletonRenderingOptions:new ne.d,shaderError:Object(pe.c)(),renderScaleHistogram:new a.a,renderScaleTarget:Object(a.e)(1)},this.objectLayerStateChanged=new V.a,this.displayState.visibleSegments.changed.add(this.specificationChanged.dispatch),this.displayState.segmentEquivalences.changed.add(this.specificationChanged.dispatch),this.displayState.segmentSelectionState.bindTo(e.layerSelectedValues,this),this.displayState.selectedAlpha.changed.add(this.specificationChanged.dispatch),this.displayState.saturation.changed.add(this.specificationChanged.dispatch),this.displayState.notSelectedAlpha.changed.add(this.specificationChanged.dispatch),this.displayState.objectAlpha.changed.add(this.specificationChanged.dispatch),this.displayState.hideSegmentZero.changed.add(this.specificationChanged.dispatch),this.displayState.skeletonRenderingOptions.changed.add(this.specificationChanged.dispatch),this.displayState.segmentColorHash.changed.add(this.specificationChanged.dispatch),this.displayState.renderScaleTarget.changed.add(this.specificationChanged.dispatch),this.tabs.add("rendering",{label:"Rendering",order:-100,getter:()=>new Ue(this)}),this.tabs.default="rendering"}get volumeOptions(){return{volumeType:ie.c.SEGMENTATION}}restoreState(e){super.restoreState(e),this.displayState.selectedAlpha.restoreState(e[Se]),this.displayState.saturation.restoreState(e[Le]),this.displayState.notSelectedAlpha.restoreState(e[Ce]),this.displayState.objectAlpha.restoreState(e[Oe]),this.displayState.hideSegmentZero.restoreState(e[Te]);const{skeletonRenderingOptions:t}=this.displayState;t.restoreState(e[Re]);const n=e[Pe];void 0!==n&&t.shader.restoreState(n),this.displayState.segmentColorHash.restoreState(e[Ne]),this.displayState.renderScaleTarget.restoreState(e[De]),Object(K.v)(e,Ie,e=>{this.displayState.segmentEquivalences.restoreState(e)});const i=(t,n)=>{Object(K.v)(e,t,e=>{if(void 0!==e){let{segmentEquivalences:t}=this.displayState;Object(K.a)(e,e=>{let i=h.a.parseString(String(e),10);n.add(t.get(i))})}})};i(Ae,this.displayState.visibleSegments),i(Me,this.displayState.highlightedSegments),this.displayState.highlightedSegments.changed.add(()=>{this.specificationChanged.dispatch()});const{multiscaleSource:r}=this;let o=this.meshPath=null===e[ke]?null:Object(K.y)(e[ke]),a=this.skeletonsPath=Object(K.v)(e,Ee,K.y),l=0;null!=o&&(++l,this.manager.dataSourceProvider.getMeshSource(this.manager.chunkManager,o).then(e=>{this.wasDisposed||(this.addMesh(e),0==--l&&(this.isReady=!0))})),void 0!==a&&(++l,this.manager.dataSourceProvider.getSkeletonSource(this.manager.chunkManager,a).then(e=>{this.wasDisposed||(this.addSkeletonSource(e),0==--l&&(this.isReady=!0))})),void 0!==r&&(++l,r.then(e=>{if(!this.wasDisposed){const{displayState:t}=this;this.addRenderLayer(new oe(e,Object.assign({},t,{transform:t.objectToDataTransform,renderScaleHistogram:this.sliceViewRenderScaleHistogram,renderScaleTarget:this.sliceViewRenderScaleTarget}))),void 0===o&&void 0===a&&(++l,Promise.resolve(e.getMeshSource()).then(e=>{this.wasDisposed?null!==e&&e.dispose():(0==--l&&(this.isReady=!0),e instanceof s.b||e instanceof s.d?this.addMesh(e):e instanceof ne.e&&this.addSkeletonSource(e))})),0==--l&&(this.isReady=!0)}}))}addMesh(e){e instanceof s.b?this.meshLayer=new s.a(this.manager.chunkManager,e,this.displayState):this.meshLayer=new s.c(this.manager.chunkManager,e,this.displayState),this.addRenderLayer(this.meshLayer),this.objectLayerStateChanged.dispatch()}addSkeletonSource(e){let t=new ne.c(this.manager.chunkManager,e,this.manager.voxelSize,this.displayState);this.skeletonLayer=t,this.addRenderLayer(new ne.b(t.addRef())),this.addRenderLayer(new ne.f(t)),this.objectLayerStateChanged.dispatch()}toJSON(){const e=super.toJSON();e.type="segmentation",e[ke]=this.meshPath,e[Ee]=this.skeletonsPath,e[Se]=this.displayState.selectedAlpha.toJSON(),e[Ce]=this.displayState.notSelectedAlpha.toJSON(),e[Le]=this.displayState.saturation.toJSON(),e[Oe]=this.displayState.objectAlpha.toJSON(),e[Te]=this.displayState.hideSegmentZero.toJSON(),e[Ne]=this.displayState.segmentColorHash.toJSON();let{visibleSegments:t}=this.displayState;t.size>0&&(e[Ae]=t.toJSON());let{highlightedSegments:n}=this.displayState;n.size>0&&(e[Me]=n.toJSON());let{segmentEquivalences:i}=this.displayState;return i.size>0&&(e[Ie]=i.toJSON()),e[Re]=this.displayState.skeletonRenderingOptions.toJSON(),e[De]=this.displayState.renderScaleTarget.toJSON(),e}transformPickedValue(e){if(null==e)return e;let{segmentEquivalences:t}=this.displayState;if(0===t.size)return e;"number"==typeof e&&(e=new h.a(e,0));let n=t.get(e);return h.a.equal(n,e)?e:new B.c(e,n)}handleAction(e){switch(e){case"recolor":this.displayState.segmentColorHash.randomize();break;case"clear-segments":this.displayState.visibleSegments.clear();break;case"select":{let{segmentSelectionState:e}=this.displayState;if(e.hasSelectedSegment){let t=e.selectedSegment,{visibleSegments:n}=this.displayState;n.has(t)?n.delete(t):n.add(t)}break}case"highlight":{let{segmentSelectionState:e}=this.displayState;if(e.hasSelectedSegment){let t=e.selectedSegment,{highlightedSegments:n}=this.displayState;n.has(t)?n.delete(t):n.add(t)}break}}}}function _e(e){return new ye.a({fragmentMain:e.displayState.skeletonRenderingOptions.shader,shaderError:e.displayState.shaderError,fragmentMainStartLine:ne.a})}class Ue extends we.b{constructor(e){super(),this.layer=e,this.visibleSegmentWidget=this.registerDisposer(new be(this.layer.displayState)),this.addSegmentWidget=this.registerDisposer(new xe.a),this.selectedAlphaWidget=this.registerDisposer(new ge.a(this.layer.displayState.selectedAlpha)),this.notSelectedAlphaWidget=this.registerDisposer(new ge.a(this.layer.displayState.notSelectedAlpha)),this.saturationWidget=this.registerDisposer(new ge.a(this.layer.displayState.saturation)),this.objectAlphaWidget=this.registerDisposer(new ge.a(this.layer.displayState.objectAlpha));const{element:t}=this;t.classList.add("segmentation-dropdown");let{selectedAlphaWidget:n,notSelectedAlphaWidget:i,saturationWidget:r,objectAlphaWidget:s}=this;if(n.promptElement.textContent="Opacity (on)",i.promptElement.textContent="Opacity (off)",r.promptElement.textContent="Saturation",s.promptElement.textContent="Opacity (3d)",void 0!==this.layer.volumePath){t.appendChild(this.selectedAlphaWidget.element),t.appendChild(this.notSelectedAlphaWidget.element),t.appendChild(this.saturationWidget.element);{const e=this.registerDisposer(new me.a(this.layer.sliceViewRenderScaleHistogram,this.layer.sliceViewRenderScaleTarget));e.label.textContent="Resolution (slice)",t.appendChild(e.element)}}const o=this.registerDisposer(new ue.a(()=>!!(this.layer.meshPath||this.layer.meshLayer||this.layer.skeletonsPath||this.layer.skeletonLayer),this.layer.objectLayerStateChanged));this.registerDisposer(new ce.a(o,this.objectAlphaWidget.element));{const e=this.registerDisposer(new me.a(this.layer.displayState.renderScaleHistogram,this.layer.displayState.renderScaleTarget));e.label.textContent="Resolution (mesh)",t.appendChild(e.element),this.registerDisposer(new ce.a(o,e.element))}t.appendChild(this.objectAlphaWidget.element);{const n=this.registerDisposer(new ce.c(e.displayState.hideSegmentZero));n.element.className="neuroglancer-segmentation-dropdown-hide-segment-zero neuroglancer-noselect";const i=document.createElement("label");i.className="neuroglancer-segmentation-dropdown-hide-segment-zero neuroglancer-noselect",i.appendChild(document.createTextNode("Hide segment ID 0")),i.appendChild(n.element),t.appendChild(i)}this.addSegmentWidget.element.classList.add("add-segment"),this.addSegmentWidget.element.title="Add one or more segment IDs",t.appendChild(this.registerDisposer(this.addSegmentWidget).element),this.registerDisposer(this.addSegmentWidget.valuesEntered.add(e=>{for(const t of e)this.layer.displayState.visibleSegments.add(t)})),t.appendChild(this.registerDisposer(this.visibleSegmentWidget).element);const a=()=>{if(void 0!==this.codeWidget)return;if(null===this.layer.skeletonsPath||void 0===this.layer.skeletonLayer)return;const n=(e,n)=>{{const i=this.registerDisposer(new fe.a(e.mode)),r=document.createElement("label");r.className="neuroglancer-segmentation-dropdown-skeleton-render-mode neuroglancer-noselect",r.appendChild(document.createTextNode(`Skeleton mode (${n})`)),r.appendChild(i.element),t.appendChild(r)}{const i=this.registerDisposer(new ge.a(e.lineWidth,{min:1,max:40,step:1}));i.promptElement.textContent=`Skeleton line width (${n})`,t.appendChild(i.element)}};n(e.displayState.skeletonRenderingOptions.params2d,"2d"),n(e.displayState.skeletonRenderingOptions.params3d,"3d");let i=document.createElement("div");i.className="neuroglancer-segmentation-dropdown-skeleton-shader-header";let r=document.createElement("div");r.style.flex="1",r.textContent="Skeleton shader:";let s=document.createElement("a"),o=document.createElement("button");o.type="button",o.textContent="?",o.className="help-link",s.appendChild(o),s.title="Documentation on skeleton rendering",s.target="_blank",s.href="https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/image_layer_rendering.md";let a=document.createElement("button");a.innerHTML="&square;",a.className="maximize-button",a.title="Show larger editor view",this.registerEventListener(a,"click",()=>{new Fe(this.layer)}),i.appendChild(r),i.appendChild(a),i.appendChild(s),t.appendChild(i);const l=this.codeWidget=this.registerDisposer(_e(this.layer));t.appendChild(l.element),l.textEditor.refresh()};this.registerDisposer(this.layer.objectLayerStateChanged.add(a)),a(),this.visibility.changed.add(()=>{this.visible&&void 0!==this.codeWidget&&this.codeWidget.textEditor.refresh()})}}class Fe extends o.a{constructor(e){super(),this.layer=e,this.codeWidget=this.registerDisposer(_e(this.layer)),this.content.classList.add("neuroglancer-segmentation-layer-skeleton-shader-overlay"),this.content.appendChild(this.codeWidget.element),this.codeWidget.textEditor.refresh()}}Object(r.e)("segmentation",Ve),Object(r.f)(ie.c.SEGMENTATION,Ve)},function(e,t,n){"use strict";n.r(t);var i,r=n(6),s=n(52),o=n(62),a=n(11),l=n(69),c=n(40),u=n(63);!function(e){e[e.RAW=0]="RAW",e[e.JPEG=1]="JPEG",e[e.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION"}(i||(i={}));class d{}d.RPC_ID="brainmaps/VolumeChunkSource";class h{}h.RPC_ID="brainmaps/MultiscaleMeshSource";class p{}p.RPC_ID="brainmaps/MeshSource";class f{}f.RPC_ID="brainmaps/SkeletonSource";class g{}g.RPC_ID="brainmaps/Annotation";var m=n(53),v=n(43),b=n(56),y=n(27),w=n(4),x=n(34),S=n(22),C=n(37),O=n(0),L=n(1),T=n(35);n.d(t,"BrainmapsSkeletonSource",function(){return M}),n.d(t,"VolumeInfo",function(){return D}),n.d(t,"MultiscaleVolumeInfo",function(){return j}),n.d(t,"MultiscaleVolumeChunkSource",function(){return V}),n.d(t,"parseVolumeKey",function(){return _}),n.d(t,"VolumeList",function(){return G}),n.d(t,"parseChangeStackList",function(){return W}),n.d(t,"BrainmapsAnnotationSource",function(){return q}),n.d(t,"BrainmapsDataSource",function(){return Y}),n.d(t,"productionInstance",function(){return J});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class k extends(Object(a.f)(Object(l.a)()(x.b),d)){}class E extends(Object(a.f)(Object(l.a)()(v.d),h)){}class A extends(Object(a.f)(Object(l.a)()(v.b),p)){}class M extends(Object(a.f)(Object(l.a)()(b.e),f)){get skeletonVertexCoordinatesInVoxels(){return!1}}const I=new Map;function N(e){Object(L.t)(e);try{return{corner:Object(L.v)(e,"corner",e=>Object(L.f)(O.u.create(),e,L.n)),size:Object(L.v)(e,"size",e=>Object(L.f)(O.u.create(),e,L.o)),metadata:Object(L.v)(e,"metadata",L.y)}}catch(e){throw new Error(`Failed to parse bounding box: ${e.message}`)}}I.set("UINT8",w.a.UINT8),I.set("FLOAT",w.a.FLOAT32),I.set("UINT64",w.a.UINT64);class D{constructor(e){try{Object(L.t)(e),this.numChannels=Object(L.v)(e,"channelCount",L.z),this.dataType=Object(L.v)(e,"channelType",e=>Object(L.s)(e,I)),this.voxelSize=Object(L.v)(e,"pixelSize",e=>Object(L.f)(O.u.create(),e,L.o)),this.upperVoxelBound=Object(L.v)(e,"volumeSize",e=>Object(L.f)(O.u.create(),e,L.z)),this.boundingBoxes=Object(L.v)(e,"boundingBox",e=>void 0===e?[]:Object(L.a)(e,N))}catch(e){throw new Error(`Failed to parse BrainMaps volume geometry: ${e.message}`)}}}function R(e){return Object(L.t)(e),{name:Object(L.v)(e,"name",L.A),type:Object(L.v)(e,"type",L.A)}}const P=new RegExp("^(.*)_([0-9]+)x([0-9]+)x([0-9]+)_lod([0-9]+)_([0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?)$");class j{constructor(e){try{Object(L.t)(e);let t=this.scales=Object(L.v)(e,"geometry",e=>Object(L.a)(e,e=>new D(e)));if(0===t.length)throw new Error("Expected at least one scale.");let n=t[0],i=this.numChannels=n.numChannels,r=this.dataType=n.dataType;for(let e=1,n=t.length;e<n;++e){let n=t[e];if(n.dataType!==r)throw new Error(`Scale ${e} has data type ${w.a[n.dataType]} `+`but scale 0 has data type ${w.a[r]}.`);if(n.numChannels!==i)throw new Error(`Scale ${e} has ${n.numChannels} channel(s) `+`but scale 0 has ${i} channels.`)}}catch(e){throw new Error(`Failed to parse BrainMaps multiscale volume specification: ${e.message}`)}}}class V{constructor(e,t,n,i,r,s,o,a){let l;if(this.chunkManager=e,this.instance=t,this.credentialsProvider=n,this.volumeId=i,this.changeSpec=r,this.multiscaleVolumeInfo=s,this.encoding=a.encoding,this.chunkLayoutPreference=a.chunkLayoutPreference,1===this.numChannels)switch(this.dataType){case w.a.UINT64:l=w.c.SEGMENTATION}void 0===l&&(l=void 0!==a.volumeType?a.volumeType:w.c.IMAGE),this.volumeType=l,this.meshes=function(e){try{return Object(L.t)(e),Object(L.v)(e,"meshes",e=>void 0===e?[]:Object(L.a)(e,R))}catch(e){throw new Error(`Failed to parse BrainMaps meshes specification: ${e.message}`)}}(o)}get scales(){return this.multiscaleVolumeInfo.scales}get dataType(){return this.multiscaleVolumeInfo.dataType}get numChannels(){return this.multiscaleVolumeInfo.numChannels}getSources(e){let t=i.RAW;this.dataType===w.a.UINT64?t=i.COMPRESSED_SEGMENTATION:this.volumeType===w.c.IMAGE&&this.dataType===w.a.UINT8&&1===this.numChannels&&this.encoding!==i.RAW&&(t=i.JPEG);const n=this.scales[0],r=O.u.multiply(O.u.create(),n.upperVoxelBound,n.voxelSize);return this.scales.map((n,i)=>w.b.getDefaults({voxelSize:n.voxelSize,dataType:n.dataType,numChannels:n.numChannels,upperVoxelBound:n.upperVoxelBound,upperClipBound:r,volumeType:this.volumeType,volumeSourceOptions:e,chunkLayoutPreference:this.chunkLayoutPreference,maxCompressedSegmentationBlockSize:O.u.fromValues(64,64,64)}).map(e=>this.chunkManager.getChunkSource(k,{credentialsProvider:this.credentialsProvider,spec:e,parameters:{volumeId:this.volumeId,changeSpec:this.changeSpec,scaleIndex:i,encoding:t,instance:this.instance}})))}getMeshSource(){const e=function(e,t){const n=new Map,i=e.scales[0],r=new Set;for(const e of t){if("TRIANGLES"!==e.type)continue;const t=e.name.match(P);if(null===t)continue;const s=t[1];let o=n.get(s);void 0===o&&(o={key:s,chunkShape:O.u.create(),lods:[]},n.set(s,o));const a=parseInt(t[5]);if(void 0!==o.lods[a]){r.add(s);continue}const l=O.u.fromValues(parseInt(t[2],10),parseInt(t[3],10),parseInt(t[4],10)),c=new Uint32Array(3);for(let e=0;e<3;++e)c[e]=Math.ceil(i.upperVoxelBound[e]/l[e]);o.lods[a]={info:e,scale:parseFloat(t[6]),relativeBlockShape:l,gridShape:c}}const s=[];e:for(const e of n.values()){if(r.has(e.key))continue e;const t=e.lods[0];if(void 0===t)continue e;const n=t.relativeBlockShape;O.u.multiply(e.chunkShape,n,i.voxelSize);for(let t=1;t<e.lods.length;++t){const i=e.lods[t];if(void 0===i)continue e;const{relativeBlockShape:r}=i;for(let e=0;e<3;++e){const t=r[e],i=n[e];if(t<i||t%i!=0)continue e;r[e]=t/i}}n.fill(1),s.push(e)}return s}(this.multiscaleVolumeInfo,this.meshes);for(const t of e)return this.chunkManager.getChunkSource(E,{credentialsProvider:this.credentialsProvider,format:{fragmentRelativeVertices:!1,transform:O.m.create(),vertexPositionFormat:m.e.float32},parameters:{instance:this.instance,volumeId:this.volumeId,info:t,changeSpec:this.changeSpec}});for(const e of this.meshes){if("TRIANGLES"===e.type)return this.chunkManager.getChunkSource(A,{credentialsProvider:this.credentialsProvider,parameters:{instance:this.instance,volumeId:this.volumeId,meshName:e.name,changeSpec:this.changeSpec}});if("LINE_SEGMENTS"===e.type)return this.chunkManager.getChunkSource(M,{credentialsProvider:this.credentialsProvider,parameters:{instance:this.instance,volumeId:this.volumeId,meshName:e.name,changeSpec:this.changeSpec}})}return null}getStaticAnnotations(){const e=this.scales[0],t=new r.b(O.m.fromScaling(O.m.create(),e.voxelSize));return t.readonly=!0,t.add(Object(r.i)(O.u.create(),e.upperVoxelBound)),e.boundingBoxes.forEach((e,n)=>{t.add({type:r.c.AXIS_ALIGNED_BOUNDING_BOX,description:e.metadata,pointA:e.corner,pointB:O.u.add(O.u.create(),e.corner,e.size),id:`boundingBox${n}`})}),t}}function _(e){const t=e.match(/^([^:?]+:[^:?]+:[^:?]+)(?::([^:?]+))?(?:\?(.*))?$/);if(null===t)throw new Error(`Invalid Brain Maps volume key: ${JSON.stringify(e)}.`);let n;void 0!==t[2]&&(n={changeStackId:t[2]});const i=Object(L.e)(t[3]||"");return{volumeId:t[1],changeSpec:n,parameters:i}}const U=/^([^\/]+)\/(.*)$/;function F(e){try{return Object(L.t)(e),{id:Object(L.v)(e,"id",L.A),label:Object(L.v)(e,"label",L.A),description:Object(L.v)(e,"description",L.y)}}catch(e){throw new Error(`Failed to parse project: ${e.message}`)}}function z(e){try{return Object(L.t)(e),Object(L.v)(e,"project",e=>void 0===e?[]:Object(L.a)(e,F))}catch(e){throw new Error(`Error parsing project list: ${e.message}`)}}function B(e,t){try{return Object(L.t)(e),Object(L.v)(e,t,e=>void 0===e?[]:Object(L.a)(e,L.A))}catch(e){throw new Error(`Error parsing dataset list: ${e.message}`)}}class G{constructor(e,t){this.projects=new Map,this.hierarchicalVolumeIds=new Map;const{projects:n}=this;for(let t of z(e))n.set(t.id,t);try{Object(L.t)(t);let e=this.volumeIds=Object(L.v)(t,"volumeId",e=>void 0===e?[]:Object(L.a)(e,L.A));e.sort();let n=new Map;for(let t of e){let e=0;for(;;){let i=t.indexOf(":",e);-1===i?i=void 0:++i;let r=t.substring(0,e),s=n.get(r);if(void 0===s&&(s=new Set,n.set(r,s)),s.add(t.substring(e,i)),void 0===i)break;e=i}}let{hierarchicalVolumeIds:i}=this;for(let[e,t]of n)i.set(e,Array.from(t))}catch(e){throw new Error(`Failed to parse Brain Maps volume list reply: ${e.message}`)}}}function W(e){return Object(L.v)(e,"changeStackId",e=>void 0===e?void 0:Object(L.a)(e,L.A))}function $(e){const t=e.scales[0];return[[{parameters:void 0,spec:new s.k({voxelSize:t.voxelSize,chunkSize:O.u.multiply(O.u.create(),t.upperVoxelBound,t.voxelSize),upperChunkBound:O.u.fromValues(1,1,1)})}]]}const H=Object(a.f)(Object(l.a)()(o.c),g);class q extends H{constructor(e,t){super(e,Object.assign({sourceSpecifications:$(t.multiscaleVolumeInfo)},t)),O.m.fromScaling(this.objectToLocal,t.multiscaleVolumeInfo.scales[0].voxelSize)}}class Y extends c.a{constructor(e,t){super(),this.instance=e,this.credentialsProvider=t}get description(){return this.instance.description}getMeshSource(e,t){return e.getChunkSource(A,{credentialsProvider:this.credentialsProvider,parameters:this.getMeshSourceParameters(t)})}getMeshSourceParameters(e){let t=e.match(U);if(null===t)throw new Error(`Invalid Brainmaps mesh URL: ${e}`);let{volumeId:n,changeSpec:i}=_(t[1]);return{instance:this.instance,volumeId:n,changeSpec:i,meshName:t[2]}}getSkeletonSource(e,t){return e.getChunkSource(M,{credentialsProvider:this.credentialsProvider,parameters:this.getMeshSourceParameters(t)})}getMultiscaleInfo(e,t){return e.memoize.getUncounted({type:"brainmaps:getMultiscaleInfo",volumeId:t,instance:this.instance,credentialsProvider:Object(T.a)(this.credentialsProvider)},()=>Object(u.b)(this.instance,this.credentialsProvider,{method:"GET",path:`/v1beta2/volumes/${t}`,responseType:"json"}).then(e=>new j(e)))}getVolume(e,t,n){const{volumeId:r,changeSpec:s,parameters:o}=_(t);Object(L.t)(o);const a=Object(L.v)(o,"encoding",e=>void 0===e?void 0:Object(L.m)(e,i)),l=Object(L.v)(o,"chunkLayout",e=>void 0===e?void 0:Object(L.m)(e,y.a)),c=Object.assign({},n,{encoding:a,chunkLayoutPreference:l});return e.memoize.getUncounted({type:"brainmaps:getVolume",instance:this.instance,volumeId:r,changeSpec:s,brainmapsOptions:c},()=>Promise.all([this.getMultiscaleInfo(e,r),Object(u.b)(this.instance,this.credentialsProvider,{method:"GET",path:`/v1beta2/objects/${r}/meshes`,responseType:"json"})]).then(([t,n])=>new V(e,this.instance,this.credentialsProvider,r,s,t,n,c)))}getAnnotationSource(e,t){const{volumeId:n,changeSpec:i}=_(t);if(void 0===i)throw new Error("A changestack must be specified.");const r={volumeId:n,changestack:i.changeStackId,instance:this.instance};return e.memoize.getUncounted({type:"brainmaps:getAnnotationSource",instance:this.instance,credentialsProvider:Object(T.a)(this.credentialsProvider),parameters:r},()=>this.getMultiscaleInfo(e,n).then(t=>e.getChunkSource(q,{parameters:r,credentialsProvider:this.credentialsProvider,multiscaleVolumeInfo:t})))}getProjectList(e){return e.memoize.getUncounted({instance:this.instance,type:"brainmaps:getProjectList"},()=>{let e=Object(u.b)(this.instance,this.credentialsProvider,{method:"GET",path:"/v1beta2/projects",responseType:"json"}).then(e=>z(e));const t=`${this.instance.description} project list`;return S.a.forPromise(e,{delay:!0,initialMessage:`Retrieving ${t}.`,errorPrefix:`Error retrieving ${t}: `}),e})}getDatasetList(e,t){return e.memoize.getUncounted({instance:this.instance,type:`brainmaps:${t}:getDatasetList`},()=>{let e=Object(u.b)(this.instance,this.credentialsProvider,{method:"GET",path:`/v1beta2/datasets?project_id=${t}`,responseType:"json"}).then(e=>B(e,"datasetIds"));const n=`${this.instance.description} dataset list`;return S.a.forPromise(e,{delay:!0,initialMessage:`Retrieving ${n}`,errorPrefix:`Error retrieving ${n}`}),e})}getVolumeList(e,t,n){return e.memoize.getUncounted({instance:this.instance,type:`brainmaps:${t}:${n}:getVolumeList`},()=>{let e=Object(u.b)(this.instance,this.credentialsProvider,{method:"GET",path:`/v1beta2/volumes?project_id=${t}&dataset_id=${n}`,responseType:"json"}).then(e=>{const i=B(e,"volumeId"),r=t.length+n.length+2,s=[];for(const e of i)s.push(e.substring(r));return s});const i=`${this.instance.description} volume list`;return S.a.forPromise(e,{delay:!0,initialMessage:`Retrieving ${i}`,errorPrefix:`Error retrieving ${i}`}),e})}getChangeStackList(e,t){return e.memoize.getUncounted({instance:this.instance,type:"brainmaps:getChangeStackList",volumeId:t},()=>{let e=Object(u.b)(this.instance,this.credentialsProvider,{method:"GET",path:`/v1beta2/changes/${t}/change_stacks`,responseType:"json"}).then(e=>W(e));const n=`change stacks for ${t}`;return S.a.forPromise(e,{delay:!0,initialMessage:`Retrieving ${n}.`,errorPrefix:`Error retrieving ${n}: `}),e})}volumeCompleter(e,t){let n=0;const i=[];for(let t=e.indexOf(":");t>=0;t=e.indexOf(":",t+1))i.push(t),++n;switch(n){case 0:return this.getProjectList(t).then(t=>{let n=[],i=new Map;for(const e of t){const t=e.id+":";n.push(t),i.set(t,e.label)}return{offset:0,completions:Object(C.c)(e,n,e=>e,e=>i.get(e))}});case 1:{const n=i[0],r=e.substring(0,n);return this.getDatasetList(t,r).then(t=>{const i=n+1,r=e.substring(i),s=[];for(const e of t)s.push(e+":");return s.sort(),{offset:i,completions:Object(C.b)(r,s)}})}case 2:{const n=e.substring(0,i[0]),r=e.substring(i[0]+1,i[1]),s=i[1]+1;return this.getVolumeList(t,n,r).then(t=>{const n=e.substring(s);return{offset:s,completions:Object(C.b)(n,t)}})}default:{const n=e.substring(0,i[2]),r=i[2]+1,s=e.substring(r);return this.getChangeStackList(t,n).then(e=>{if(void 0===e)throw null;return{offset:r,completions:Object(C.b)(s,e)}})}}}}const J={description:"Google Brain Maps",serverUrl:"https://brainmaps.googleapis.com"}},function(e,t,n){"use strict";var i=n(2),r=n(3),s=n(84);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const o=!1;var a=n(103);n.d(t,"b",function(){return l}),n.d(t,"a",function(){return c});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class l extends i.a{constructor(e,t,n){super(),this.context=e,this.element=t,this.visibility=n,this.gl=e.gl,e.addPanel(this)}scheduleRedraw(){this.visible&&this.context.scheduleRedraw()}setGLViewport(){let e=this.element;const t=e.getBoundingClientRect(),n=this.context.canvasRect,i=n.width/this.context.canvas.width,r=n.height/this.context.canvas.height;let s=(e.clientLeft+t.left-n.left)*i,o=e.clientWidth,a=(t.top-n.top+e.clientTop)*r,l=e.clientHeight,c=a+l,u=this.gl;u.enable(u.SCISSOR_TEST);let d=this.context.canvas.height-c;u.viewport(s,d,o,l),u.scissor(s,d,o,l)}disposed(){this.context.removePanel(this),super.disposed()}get visible(){return this.visibility.visible}}class c extends i.a{constructor(e){super(),this.container=e,this.canvas=document.createElement("canvas"),this.updateStarted=new r.a,this.updateFinished=new r.a,this.changed=this.updateFinished,this.panels=new Set,this.updatePending=null,this.frameNumber=0,this.resizeObserver=new a.a(()=>this.scheduleRedraw());const{canvas:t,resizeObserver:n}=this;e.style.position="relative",t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.width="100%",t.style.height="100%",t.style.zIndex="0",n.observe(t),e.appendChild(t),this.gl=function(e){let t={antialias:!1,stencil:!0};o&&(console.log("DEBUGGING via preserveDrawingBuffer"),t.preserveDrawingBuffer=!0);let n=e.getContext("webgl2",t);if(null==n)throw new Error("WebGL not supported.");n.memoize=new s.a,n.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),n.maxTextureImageUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),n.tempTextureUnit=n.maxTextureImageUnits-1;for(const e of["EXT_color_buffer_float"])if(!n.getExtension(e))throw new Error(`${e} extension not available`);for(const e of["EXT_float_blend"])n.getExtension(e);return n}(t)}isReady(){for(const e of this.panels)if(e.visible&&!e.isReady())return!1;return!0}makeCanvasOverlayElement(){const e=document.createElement("div");return e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.width="100%",e.style.height="100%",e.style.zIndex="2",this.container.appendChild(e),e}disposed(){this.resizeObserver.disconnect(),null!=this.updatePending&&(cancelAnimationFrame(this.updatePending),this.updatePending=null)}addPanel(e){this.panels.add(e),this.resizeObserver.observe(e.element),this.scheduleRedraw()}removePanel(e){this.resizeObserver.unobserve(e.element),this.panels.delete(e),e.dispose(),this.scheduleRedraw()}scheduleRedraw(){null===this.updatePending&&(this.updatePending=requestAnimationFrame(this.update.bind(this)))}draw(){++this.frameNumber,this.updateStarted.dispatch();let e=this.gl,t=this.canvas;t.width=t.offsetWidth,t.height=t.offsetHeight,this.canvasRect=t.getBoundingClientRect(),this.gl.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);for(let e of this.panels){let{element:t}=e;e.visible&&0!==t.clientWidth&&0!==t.clientHeight&&0!==t.offsetWidth&&0!==t.offsetHeight&&(e.setGLViewport(),e.draw())}e.disable(e.SCISSOR_TEST),this.gl.clearColor(1,1,1,1),this.gl.colorMask(!1,!1,!1,!0),e.clear(e.COLOR_BUFFER_BIT),this.gl.colorMask(!0,!0,!0,!0),this.updateFinished.dispatch()}update(){this.updatePending=null,this.draw()}}},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,n){"use strict";n.r(t);var i=n(11),r=n(69),s=n(40),o=n(65);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class a{}class l extends a{static stringify(e){return`boss:volume:${e.baseUrl}/${e.collection}/${e.experiment}/${e.channel}/${e.resolution}/${e.encoding}`}}l.RPC_ID="boss/VolumeChunkSource";class c{static stringify(e){return`boss:mesh:${e.baseUrl}`}}c.RPC_ID="boss/MeshChunkSource";var u=n(43),d=n(4),h=n(34),p=n(37),f=n(0),g=n(24),m=n(1);n.d(t,"MultiscaleVolumeChunkSource",function(){return T}),n.d(t,"getExperimentInfo",function(){return E}),n.d(t,"getChannelInfo",function(){return A}),n.d(t,"getDownsampleInfoForChannel",function(){return M}),n.d(t,"parseDownsampleScales",function(){return I}),n.d(t,"parseDownsampleInfoForChannel",function(){return N}),n.d(t,"getVolume",function(){return D}),n.d(t,"getCollections",function(){return P}),n.d(t,"getExperiments",function(){return j}),n.d(t,"getCoordinateFrame",function(){return V}),n.d(t,"collectionExperimentChannelCompleter",function(){return _}),n.d(t,"BossDataSource",function(){return U});
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class v extends(Object(i.f)(Object(r.a)()(h.b),l)){}class b extends(Object(i.f)(Object(r.a)()(u.b),c)){}let y=new Map;y.set("image",d.c.IMAGE),y.set("annotation",d.c.SEGMENTATION);const w=new Set(["npz","jpeg"]),x=f.u.fromValues(512,512,16);var S;function C(e){switch(e){case S.MICROMETERS:return 1e3;case S.MILLIMETERS:return 1e6;case S.CENTIMETERS:return 1e7;default:return 1}}function O(e){let t=y.get(e);return void 0===t&&(t=d.c.UNKNOWN),t}function L(e){Object(m.t)(e);let t=Object(m.v)(e,"type",m.A),n=!1;return"DOWNSAMPLED"===Object(m.v)(e,"downsample_status",m.A)&&(n=!0),{channelType:t,description:Object(m.v)(e,"description",m.A),volumeType:O(t),dataType:Object(m.v)(e,"datatype",e=>Object(m.m)(e,d.a)),downsampled:n,scales:[],key:Object(m.v)(e,"name",m.A)}}!function(e){e[e.NANOMETERS=0]="NANOMETERS",e[e.MICROMETERS=1]="MICROMETERS",e[e.MILLIMETERS=2]="MILLIMETERS",e[e.CENTIMETERS=3]="CENTIMETERS"}(S||(S={}));class T{constructor(e,t,n,i,r,s){if(this.chunkManager=e,this.baseUrl=t,this.credentialsProvider=n,this.experimentInfo=i,this.parameters=s,this.meshPath=void 0,this.meshUrl=void 0,void 0===r){const e=Array.from(i.channels.keys());if(1!==e.length)throw new Error(`Experiment contains multiple channels: ${JSON.stringify(e)}`);r=e[0]}const o=i.channels.get(r);if(void 0===o)throw new Error(`Specified channel ${JSON.stringify(r)} is not one of the supported channels ${JSON.stringify(Array.from(i.channels.keys()))}`);if(this.channel=r,this.channelInfo=o,this.scales=o.scales,void 0===i.coordFrame)throw new Error(`Specified experiment ${JSON.stringify(i.key)} does not have a valid coordinate frame`);this.coordinateFrame=i.coordFrame,!1===this.channelInfo.downsampled&&(this.scales=[o.scales[0]]),this.experiment=i.key;let a=Object(m.y)(s.window);if(void 0!==a){let e=f.t.create(),t=a.split(/,/);if(2===t.length)e[0]=Object(m.n)(t[0]),e[1]=Object(m.n)(t[1]);else{if(1!==t.length)throw new Error(`Invalid window. Must be either one value or two comma separated values: ${JSON.stringify(a)}`);e[0]=0,e[1]=Object(m.n)(t[1])}if(this.window=e,this.window[0]===this.window[1])throw new Error(`Invalid window. First element must be different from second: ${JSON.stringify(a)}.`)}let l=Object(m.y)(s.meshurl);void 0!==l&&(this.meshUrl=l);let c=Object(m.y)(s.encoding);if(void 0===c)c=this.volumeType===d.c.IMAGE?"jpeg":"npz";else if(!w.has(c))throw new Error(`Invalid encoding: ${JSON.stringify(c)}.`);this.encoding=c}get dataType(){return this.channelInfo.dataType===d.a.UINT16?d.a.UINT8:this.channelInfo.dataType}get numChannels(){return 1}get volumeType(){return this.channelInfo.volumeType}getSources(e){return this.scales.map(t=>{let{voxelSizeNanometers:n,imageSize:i}=t,r=this.coordinateFrame.voxelOffsetBase,s=f.u.create();for(let e=0;e<3;++e)s[e]=Math.ceil(r[e]);return d.b.getDefaults({numChannels:this.numChannels,volumeType:this.volumeType,dataType:this.dataType,voxelSize:n,chunkDataSizes:[x],transform:f.m.fromTranslation(f.m.create(),f.u.multiply(f.u.create(),r,n)),baseVoxelOffset:s,upperVoxelBound:i,volumeSourceOptions:e}).map(e=>this.chunkManager.getChunkSource(v,{credentialsProvider:this.credentialsProvider,spec:e,parameters:{baseUrl:this.baseUrl,collection:this.experimentInfo.collection,experiment:this.experimentInfo.key,channel:this.channel,resolution:t.key,encoding:this.encoding,window:this.window}}))})}getMeshSource(){return void 0!==this.meshUrl?this.chunkManager.getChunkSource(b,{credentialsProvider:this.credentialsProvider,parameters:{baseUrl:this.meshUrl}}):null}}const k=/^([^\/?]+)\/([^\/?]+)(?:\/([^\/?]+))?(?:\?(.*))?$/;function E(e,t,n,i,r){return e.memoize.getUncounted({hostname:t,collection:r,experiment:i,type:"boss:getExperimentInfo"},()=>Object(o.b)(n,`${t}/latest/collection/${r}/experiment/${i}/`,{},g.f).then(s=>(function(e,t,n,i,r,s){Object(m.t)(e);let o=Object(m.v)(e,"channels",e=>Object(m.a)(e,e=>A(t,n,i,s,r,e)));return Promise.all(o).then(r=>{let s=new Map;r.forEach(e=>{s.set(e.key,e)});let o={channels:s,scalingLevels:Object(m.v)(e,"num_hierarchy_levels",m.r),coordFrameKey:Object(m.v)(e,"coord_frame",m.A),coordFrame:void 0,key:Object(m.v)(e,"name",m.A),collection:Object(m.v)(e,"collection",m.A)};return V(t,n,i,o)})})(s,e,t,n,r,i)))}function A(e,t,n,i,r,s){return e.memoize.getUncounted({hostname:t,collection:r,experiment:i,channel:s,type:"boss:getChannelInfo"},()=>Object(o.b)(n,`${t}/latest/collection/${r}/experiment/${i}/channel/${s}/`,{},g.f).then(L))}function M(e,t,n,i,r,s){return e.memoize.getUncounted({hostname:t,collection:i,experiment:r.key,channel:s,downsample:!0,type:"boss:getDownsampleInfoForChannel"},()=>Object(o.b)(n,`${t}/latest/downsample/${i}/${r.key}/${s}/`,{},g.f)).then(e=>N(e,r,s))}function I(e,t){Object(m.t)(e);let n=Object(m.v)(e,"voxel_size",e=>Object(m.u)(e,m.j)),i=Object(m.v)(e,"extent",e=>Object(m.u)(e,m.i)),r=Object(m.v)(e,"num_hierarchy_levels",m.r),s=new Array;for(let e=0;e<r;e++){let r=String(e);const o=n.get(r),a=i.get(r);if(void 0===o||void 0===a)throw new Error(`Missing voxel_size/extent for resolution ${r}.`);let l=f.u.scale(f.u.create(),o,C(t));s[e]={voxelSizeNanometers:l,imageSize:a,key:r}}return s}function N(e,t,n){let i=t.coordFrame;if(void 0===i)throw new Error(`Missing coordinate frame information for experiment ${t.key}. A valid coordinate frame is required to retrieve downsampling information.`);let r=t.channels.get(n);if(void 0===r)throw new Error(`Specified channel ${JSON.stringify(n)} is not one of the supported channels ${JSON.stringify(Array.from(t.channels.keys()))}`);return r.scales=I(e,i.voxelUnit),t.channels.set(n,r),t}function D(e,t,n,i){const r=i.match(k);if(null===r)throw new Error(`Invalid volume path ${JSON.stringify(i)}`);const s=r[1],o=r[2],a=r[3],l=Object(m.e)(r[4]||"");return e.memoize.getUncounted({hostname:t,path:i,type:"boss:getVolume"},()=>E(e,t,n,o,s).then(i=>M(e,t,n,s,i,a).then(i=>new T(e,t,n,i,a,l))))}const R=/^((?:http|https):\/\/[^\/?]+)\/(.*)$/;function P(e,t,n){return e.memoize.getUncounted({hostname:t,type:"boss:getCollections"},()=>Object(o.b)(n,`${t}/latest/collection/`,{},g.f).then(e=>Object(m.v)(e,"collections",e=>Object(m.a)(e,m.A))))}function j(e,t,n,i){return e.memoize.getUncounted({hostname:t,collection:i,type:"boss:getExperiments"},()=>Object(o.b)(n,`${t}/latest/collection/${i}/experiment/`,{},g.f).then(e=>Object(m.v)(e,"experiments",e=>Object(m.a)(e,m.A))))}function V(e,t,n,i){let r=i.coordFrameKey;return e.memoize.getUncounted({hostname:t,coordinateframe:r,experimentInfo:i,type:"boss:getCoordinateFrame"},()=>Object(o.b)(n,`${t}/latest/coord/${r}/`,{},g.f).then(e=>(function(e,t){Object(m.t)(e);let n=f.u.create(),i=f.u.create(),r=f.u.create();n[0]=Object(m.v)(e,"x_voxel_size",m.r),n[1]=Object(m.v)(e,"y_voxel_size",m.r),n[2]=Object(m.v)(e,"z_voxel_size",m.r),i[0]=Object(m.v)(e,"x_start",m.r),i[1]=Object(m.v)(e,"y_start",m.r),i[2]=Object(m.v)(e,"z_start",m.r),r[0]=Object(m.v)(e,"x_stop",m.r),r[1]=Object(m.v)(e,"y_stop",m.r),r[2]=Object(m.v)(e,"z_stop",m.r);let s=Object(m.v)(e,"voxel_unit",e=>Object(m.m)(e,S)),o=f.u.scale(f.u.create(),n,C(s));return t.coordFrame={voxelSizeBaseNanometers:o,voxelOffsetBase:i,imageSizeBase:r,voxelUnit:s},t})(e,i)))}function _(e,t,n,i){let r=i.match(/^(?:([^\/]+)(?:\/?([^\/]*)(?:\/?([^\/]*)(?:\/?([^\/]*)?))?)?)?$/);if(null===r)return Promise.reject(null);if(void 0===r[1])return Promise.reject(null);if(void 0===r[2]){let i=r[1]||"";return P(e,t,n).then(e=>({offset:0,completions:Object(p.c)(i,e,e=>e+"/",()=>void 0)}))}if(void 0===r[3]){let i=r[2]||"";return j(e,t,n,r[1]).then(e=>({offset:r[1].length+1,completions:Object(p.c)(i,e,e=>e+"/",()=>void 0)}))}return E(e,t,n,r[2],r[1]).then(e=>{let t=Object(p.c)(r[3],e.channels,e=>e[0],e=>`${e[1].channelType} (${d.a[e[1].dataType]})`);return{offset:r[1].length+r[2].length+2,completions:t}})}class U extends s.a{constructor(e){super(),this.credentialsManager=e}get description(){return"The Boss"}getCredentialsProvider(e){let t=function(e){let t=e.match(/^(?:https:\/\/[^.]+([^\/]+))/);if(null===t)throw new Error(`Unable to construct auth server hostname from base hostname ${e}.`);return`https://auth${t[1]}/auth`}(e);return this.credentialsManager.getCredentialsProvider(o.a,t)}getVolume(e,t){let n=t.match(R);if(null===n)throw new Error(`Invalid boss volume path: ${JSON.stringify(t)}`);let i=this.getCredentialsProvider(t);return D(e,n[1],i,n[2])}volumeCompleter(e,t){let n=e.match(R);return null===n?Promise.reject(null):_(t,n[1],this.getCredentialsProvider(n[1]),n[2]).then(e=>Object(p.a)(n[1].length+1,e))}}},function(e,t,n){"use strict";n.r(t);var i,r=n(11),s=n(40);!function(e){e[e.JPEG=0]="JPEG",e[e.RAW=1]="RAW",e[e.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION",e[e.COMPRESSED_SEGMENTATIONARRAY=3]="COMPRESSED_SEGMENTATIONARRAY"}(i||(i={}));class o{}class a extends o{}a.RPC_ID="dvid/VolumeChunkSource";class l extends o{}l.RPC_ID="dvid/SkeletonSource";class c extends o{}c.RPC_ID="dvid/MeshSource";var u=n(43),d=n(56),h=n(4),p=n(34),f=n(22),g=n(37),m=n(0),v=n(24),b=n(1);n.d(t,"DataInstanceBaseInfo",function(){return w}),n.d(t,"DataInstanceInfo",function(){return x}),n.d(t,"VolumeDataInstanceInfo",function(){return L}),n.d(t,"parseDataInstance",function(){return T}),n.d(t,"RepositoryInfo",function(){return k}),n.d(t,"parseRepositoriesInfo",function(){return E}),n.d(t,"ServerInfo",function(){return A}),n.d(t,"getServerInfo",function(){return M}),n.d(t,"getDataInstanceDetails",function(){return I}),n.d(t,"MultiscaleVolumeChunkSource",function(){return N}),n.d(t,"getVolume",function(){return R}),n.d(t,"completeInstanceName",function(){return P}),n.d(t,"completeNodeAndInstance",function(){return j}),n.d(t,"volumeCompleter",function(){return V}),n.d(t,"DVIDDataSource",function(){return _});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let y=new Map;y.set("uint8",h.a.UINT8),y.set("uint32",h.a.UINT32),y.set("uint64",h.a.UINT64);class w{constructor(e){this.obj=e,Object(b.t)(e),Object(b.v)(e,"TypeName",b.A)}get typeName(){return this.obj.TypeName}get compressionName(){return this.obj.Compression}}class x{constructor(e,t,n){this.obj=e,this.name=t,this.base=n}}class S extends(Object(r.f)(p.b,a)){}class C extends(Object(r.f)(d.e,l)){}class O extends(Object(r.f)(u.b,c)){}class L extends x{constructor(e,t,n,r,s){super(e,t,n),this.encoding=r;let o=Object(b.v)(e,"Extended",b.t),a=Object(b.v)(o,"Values",e=>Object(b.a)(e,b.t));if(a.length<1)throw new Error("Expected Extended.Values property to have length >= 1, but received: ${JSON.stringify(extendedValues)}.");this.numLevels=1;let l=new Set(s);if(r===i.COMPRESSED_SEGMENTATIONARRAY){let e=Object(b.v)(o,"MaxDownresLevel",b.z);this.numLevels=e+1}else for(;l.has(t+"_"+this.numLevels.toString());)this.numLevels+=1;this.meshSrc="",l.has(t+"_meshes")&&(this.meshSrc=t+"_meshes"),this.skeletonSrc="",""!==this.meshSrc&&l.has(t+"_skeletons")&&(this.skeletonSrc=t+"_skeletons"),this.dataType=Object(b.v)(a[0],"DataType",e=>Object(b.s)(e,y)),this.voxelSize=Object(b.v)(o,"VoxelSize",e=>Object(b.c)(m.u.create(),e,b.o)),this.numChannels=1}get volumeType(){return this.encoding===i.COMPRESSED_SEGMENTATION||this.encoding===i.COMPRESSED_SEGMENTATIONARRAY?h.c.SEGMENTATION:h.c.IMAGE}getSources(e,t,n){let{encoding:r}=this,s=[];for(let o=0;o<this.numLevels;++o){let a=m.u.scale(m.u.create(),this.voxelSize,Math.pow(2,o)),l=m.u.create(),c=m.u.create();for(let e=0;e<3;++e){let t=Math.floor(this.lowerVoxelBound[e]*(this.voxelSize[e]/a[e]));l[e]=t-t%64;let n=Math.ceil((this.upperVoxelBound[e]+1)*(this.voxelSize[e]/a[e]));c[e]=n,n%64!=0&&(c[e]+=64-n%64)}let u=t.dataInstanceKey;r!==i.COMPRESSED_SEGMENTATIONARRAY&&o>0&&(u+="_"+o.toString());let d={baseUrl:t.baseUrl,nodeKey:t.nodeKey,dataInstanceKey:u,dataScale:o.toString(),encoding:r},p=h.b.getDefaults({voxelSize:a,dataType:this.dataType,numChannels:this.numChannels,transform:m.m.fromTranslation(m.m.create(),m.u.multiply(m.u.create(),l,a)),baseVoxelOffset:l,upperVoxelBound:m.u.subtract(m.u.create(),c,l),volumeType:this.volumeType,volumeSourceOptions:n,compressedSegmentationBlockSize:r===i.COMPRESSED_SEGMENTATION||r===i.COMPRESSED_SEGMENTATIONARRAY?m.u.fromValues(8,8,8):void 0}).map(t=>e.getChunkSource(S,{spec:t,parameters:d}));s.push(p)}return s}getMeshSource(e,t){return""!==this.meshSrc?e.getChunkSource(O,{parameters:{baseUrl:t.baseUrl,nodeKey:t.nodeKey,dataInstanceKey:this.meshSrc}}):null}getSkeletonSource(e,t){return""!==this.skeletonSrc?e.getChunkSource(C,{parameters:{baseUrl:t.baseUrl,nodeKey:t.nodeKey,dataInstanceKey:this.skeletonSrc}}):null}}function T(e,t,n){Object(b.t)(e);let r=Object(b.v)(e,"Base",e=>new w(e));switch(r.typeName){case"uint8blk":case"grayscale8":let s=-1!==r.compressionName.indexOf("jpeg");return new L(e,t,r,s?i.JPEG:i.RAW,n);case"labels64":case"labelblk":return new L(e,t,r,i.COMPRESSED_SEGMENTATION,n);case"labelarray":case"labelmap":return new L(e,t,r,i.COMPRESSED_SEGMENTATIONARRAY,n);default:throw new Error(`DVID data type ${JSON.stringify(r.typeName)} is not supported.`)}}class k{constructor(e){if(this.errors=[],this.dataInstances=new Map,this.vnodes=new Set,e instanceof k)return this.alias=e.alias,this.description=e.description,this.errors=e.errors,void(this.dataInstances=e.dataInstances);Object(b.t)(e),this.alias=Object(b.v)(e,"Alias",b.A),this.description=Object(b.v)(e,"Description",b.A);let t=Object(b.v)(e,"DataInstances",b.t),n=Object.keys(t);for(let e of n)try{this.dataInstances.set(e,T(t[e],e,n))}catch(t){let n=`Failed to parse data instance ${JSON.stringify(e)}: ${t.message}`;console.log(n),this.errors.push(n)}let i=Object(b.v)(e,"DAG",b.t),r=Object(b.v)(i,"Nodes",b.t);for(let e of Object.keys(r))this.vnodes.add(e)}}function E(e){try{let t=Object(b.u)(e,e=>new k(e)),n=new Map;for(let[e,i]of t){n.set(e,i);for(let t of i.vnodes)if(t!==e){let e=new k(i);n.set(t,e)}}for(let[e,t]of n)t.uuid=e;return n}catch(e){throw new Error(`Failed to parse DVID repositories info: ${e.message}`)}}class A{constructor(e){this.repositories=E(e)}getNode(e){let t=[];for(let n of this.repositories.keys())n.startsWith(e)&&t.push(n);if(1!==t.length)throw new Error(`Node key ${JSON.stringify(e)} matches ${JSON.stringify(t)} nodes.`);return this.repositories.get(t[0])}}function M(e,t){return e.memoize.getUncounted({type:"dvid:getServerInfo",baseUrl:t},()=>{const e=Object(v.c)(`${t}/api/repos/info`).then(e=>e.json()).then(e=>new A(e)),n=`repository info for DVID server ${t}`;return f.a.forPromise(e,{initialMessage:`Retrieving ${n}.`,delay:!0,errorPrefix:`Error retrieving ${n}: `}),e})}function I(e,t,n,i){return e.memoize.getUncounted({type:"dvid:getInstanceDetails",baseUrl:t,nodeKey:n,name:i.name},()=>{let e=Object(v.c)(`${t}/api/node/${n}/${i.name}/info`).then(e=>e.json());const r=`datainstance info for node ${n} and instance ${i.name} `+`on DVID server ${t}`;return f.a.forPromise(e,{initialMessage:`Retrieving ${r}.`,delay:!0,errorPrefix:`Error retrieving ${r}: `}),e.then(e=>{let t=Object(b.v)(e,"Extended",b.t);return i.lowerVoxelBound=Object(b.v)(t,"MinPoint",e=>Object(b.d)(m.u.create(),e)),i.upperVoxelBound=Object(b.v)(t,"MaxPoint",e=>Object(b.d)(m.u.create(),e)),i})})}class N{constructor(e,t,n,i,r){this.chunkManager=e,this.baseUrl=t,this.nodeKey=n,this.dataInstanceKey=i,this.info=r}get dataType(){return this.info.dataType}get numChannels(){return this.info.numChannels}get volumeType(){return this.info.volumeType}getSources(e){return this.info.getSources(this.chunkManager,{baseUrl:this.baseUrl,nodeKey:this.nodeKey,dataInstanceKey:this.dataInstanceKey},e)}getMeshSource(){let e=this.info.getMeshSource(this.chunkManager,{baseUrl:this.baseUrl,nodeKey:this.nodeKey,dataInstanceKey:this.dataInstanceKey});return null===e?this.info.getSkeletonSource(this.chunkManager,{baseUrl:this.baseUrl,nodeKey:this.nodeKey,dataInstanceKey:this.dataInstanceKey}):e}}const D=/^((?:http|https):\/\/[^\/]+)\/([^\/]+)\/([^\/]+)$/;function R(e,t){let n=t.match(D);if(null===n)throw new Error(`Invalid DVID URL: ${JSON.stringify(t)}.`);const i=n[1],r=n[2],s=n[3];return M(e,i).then(t=>{let n=t.getNode(r);if(void 0===n)throw new Error(`Invalid node: ${JSON.stringify(r)}.`);const o=n.dataInstances.get(s);if(!(o instanceof L))throw new Error(`Invalid data instance ${s}.`);return I(e,i,r,o)}).then(t=>e.memoize.getUncounted({type:"dvid:MultiscaleVolumeChunkSource",baseUrl:i,nodeKey:r,dataInstanceKey:s},()=>new N(e,i,r,s,t)))}function P(e,t){return{offset:0,completions:Object(g.c)(t,e.dataInstances.values(),e=>e.name,e=>`${e.base.typeName}`)}}function j(e,t){let n=t.match(/^(?:([^\/]+)(?:\/([^\/]*))?)?$/);if(null===n)throw new Error("Invalid DVID URL syntax.");if(void 0===n[2])return{offset:0,completions:Object(g.c)(t,e.repositories.values(),e=>e.uuid+"/",e=>`${e.alias}: ${e.description}`)};let i=n[1],r=e.getNode(i);return Object(g.a)(i.length+1,P(r,n[2]))}function V(e,t){let n=e.match(/^((?:http|https):\/\/[^\/]+)\/(.*)$/);if(null===n)return Promise.reject(null);let i=n[1],r=n[2];return M(t,i).then(e=>Object(g.a)(i.length+1,j(e,r)))}class _ extends s.a{get description(){return"DVID"}getVolume(e,t){return R(e,t)}volumeCompleter(e,t){return V(e,t)}}},function(e,t,n){"use strict";n.r(t);var i=n(11),r=n(40);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class s{}class o extends s{}class a extends o{}a.RPC_ID="render/TileChunkSource";class l extends o{}l.RPC_ID="render/PointMatchSource";var c=n(95),u=n(106),d=n(4),h=n(34),p=n(37),f=n(0),g=n(24),m=n(1);n.d(t,"MultiscaleVolumeChunkSource",function(){return M}),n.d(t,"computeStackHierarchy",function(){return I}),n.d(t,"getOwnerInfo",function(){return N}),n.d(t,"getVolume",function(){return P}),n.d(t,"stackAndProjectCompleter",function(){return j}),n.d(t,"volumeCompleter",function(){return V}),n.d(t,"MultiscaleVectorGraphicsChunkSource",function(){return _}),n.d(t,"getPointMatches",function(){return U}),n.d(t,"RenderDataSource",function(){return F});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const v=new Set(["jpg"]),b=Object(i.f)(h.b,a);class y extends b{}const w=Object(i.f)(u.b,l);class x extends w{}const S=new Set(["COMPLETE","READ_ONLY"]),C=new Set(["LOADING"]);function O(e){let t=Object(m.a)(e,m.t);if(t.length<1)throw new Error("No stacks found for owner object.");let n=new Map,i=Object(m.v)(t[0],"stackId",T);for(let e of t){let t=Object(m.v)(e,"stackId",L),i=k(e);if(void 0!==i){let e=i.project,r=n.get(e);if(void 0===r){let t=new Map;n.set(e,{stacks:t}),r=n.get(e)}r.stacks.set(t,i)}}return{owner:i,projects:n}}function L(e){return Object(m.t)(e),Object(m.v)(e,"stack",m.A)}function T(e){return Object(m.t)(e),Object(m.v)(e,"owner",m.A)}function k(e){Object(m.t)(e);let t=Object(m.v)(e,"state",m.A),n=[],i=f.u.create(),r=f.u.create();if(S.has(t)){let t=Object(m.v)(e,"stats",m.t);i=function(e){Object(m.t)(e);let t=Object(m.v)(e,"stackBounds",m.t),n=f.u.create();return n[0]=Object(m.v)(t,"minX",m.p),n[1]=Object(m.v)(t,"minY",m.p),n[2]=Object(m.v)(t,"minZ",m.p),n}(t),r=function(e){Object(m.t)(e);let t=Object(m.v)(e,"stackBounds",m.t),n=f.u.create();return n[0]=Object(m.v)(t,"maxX",m.p)+1,n[1]=Object(m.v)(t,"maxY",m.p)+1,n[2]=Object(m.v)(t,"maxZ",m.p)+1,n}(t),t.hasOwnProperty("channelNames")&&(n=function(e){return Object(m.t)(e),Object(m.v)(e,"channelNames",e=>Object(m.a)(e,m.A))}(t))}else if(!C.has(t))return;return{lowerVoxelBound:i,upperVoxelBound:r,voxelResolution:Object(m.v)(e,"currentVersion",E),project:Object(m.v)(e,"stackId",A),channels:n}}function E(e){Object(m.t)(e);let t=f.u.create();try{t[0]=Object(m.v)(e,"stackResolutionX",m.p),t[1]=Object(m.v)(e,"stackResolutionY",m.p),t[2]=Object(m.v)(e,"stackResolutionZ",m.p)}catch(e){t[0]=1,t[1]=1,t[2]=1}return t}function A(e){return Object(m.t)(e),Object(m.v)(e,"project",m.A)}class M{constructor(e,t,n,i,r,s,o){this.chunkManager=e,this.baseUrl=t,this.ownerInfo=n,this.project=r,this.parameters=o;let a=n.projects.get(r);if(void 0===a)throw new Error(`Specified project ${JSON.stringify(r)} does not exist for `+`specified owner ${JSON.stringify(n.owner)}`);if(void 0===i){const e=Array.from(a.stacks.keys());if(1!==e.length)throw new Error(`Dataset contains multiple stacks: ${JSON.stringify(e)}`);i=e[0]}const l=a.stacks.get(i);if(void 0===l)throw new Error(`Specified stack ${JSON.stringify(i)} is not one of the supported stacks: `+JSON.stringify(Array.from(a.stacks.keys())));this.stack=i,this.stackInfo=l,void 0!==s&&s.length>0&&(this.channel=s),this.minIntensity=Object(m.x)(o.minIntensity),this.maxIntensity=Object(m.x)(o.maxIntensity),this.maxTileSpecsToRender=Object(m.x)(o.maxTileSpecsToRender),this.filter=Object(m.w)(o.filter),this.minX=Object(m.x)(o.minX),this.minY=Object(m.x)(o.minY),this.minZ=Object(m.x)(o.minZ),this.maxX=Object(m.x)(o.maxX),this.maxY=Object(m.x)(o.maxY),this.maxZ=Object(m.x)(o.maxZ),void 0!==this.minX&&(l.lowerVoxelBound[0]=this.minX),void 0!==this.minY&&(l.lowerVoxelBound[1]=this.minY),void 0!==this.minZ&&(l.lowerVoxelBound[2]=this.minZ),void 0!==this.maxX&&(l.upperVoxelBound[0]=this.maxX),void 0!==this.maxY&&(l.upperVoxelBound[1]=this.maxY),void 0!==this.maxZ&&(l.upperVoxelBound[2]=this.maxZ);let c=Object(m.y)(o.encoding);if(void 0===c)c="jpg";else if(!v.has(c))throw new Error(`Invalid encoding: ${JSON.stringify(c)}.`);this.encoding=c,this.numLevels=Object(m.x)(o.numlevels),this.dims=f.u.create();let u=Object(m.x)(o.tilesize);void 0===u&&(u=1024),this.dims[0]=u,this.dims[1]=u,this.dims[2]=1}get dataType(){return d.a.UINT8}get numChannels(){return 3}get volumeType(){return d.c.IMAGE}getSources(e){let t=[],n=this.numLevels;void 0===n&&(n=I(this.stackInfo,this.dims[0]));let i=f.u.create(),r=f.u.create();for(let e=0;e<3;e++)i[e]=this.stackInfo.lowerVoxelBound[e]*this.stackInfo.voxelResolution[e],r[e]=this.stackInfo.upperVoxelBound[e]*this.stackInfo.voxelResolution[e];for(let s=0;s<n;s++){let n=f.u.clone(this.stackInfo.voxelResolution),o=f.u.fromValues(1,1,1);for(let e=0;e<2;++e)n[e]=n[e]*Math.pow(2,s),o[e]=this.dims[e];let a=f.u.create(),l=f.u.create();for(let e=0;e<3;e++)a[e]=Math.floor(this.stackInfo.lowerVoxelBound[e]*(this.stackInfo.voxelResolution[e]/n[e])),l[e]=Math.ceil(this.stackInfo.upperVoxelBound[e]*(this.stackInfo.voxelResolution[e]/n[e]));let c=d.b.make({voxelSize:n,chunkDataSize:o,numChannels:this.numChannels,dataType:this.dataType,lowerClipBound:i,upperClipBound:r,lowerVoxelBound:a,upperVoxelBound:l,volumeSourceOptions:e}),u=this.chunkManager.getChunkSource(y,{spec:c,parameters:{baseUrl:this.baseUrl,owner:this.ownerInfo.owner,project:this.stackInfo.project,stack:this.stack,channel:this.channel,minIntensity:this.minIntensity,maxIntensity:this.maxIntensity,maxTileSpecsToRender:this.maxTileSpecsToRender,filter:this.filter,dims:`${this.dims[0]}_${this.dims[1]}`,level:s,encoding:this.encoding}});t.push([u])}return t}getMeshSource(){return null}}function I(e,t){let n=0;for(let t=0;t<2;t++)n=n<e.upperVoxelBound[t]?e.upperVoxelBound[t]:n;if(t>=n)return 1;let i=0;for(;n>t;)n/=2,i++;return i}function N(e,t,n){return e.memoize.getUncounted({type:"render:getOwnerInfo",hostname:t,owner:n},()=>Object(g.c)(`${t}/render-ws/v1/owner/${n}/stacks`).then(e=>e.json()).then(O))}const D=/^([^\/?]+)(?:\/([^\/?]+))?(?:\/([^\/?]+))(?:\/([^\/?]*))?(?:\?(.*))?$/,R=/^((?:(?:(?:http|https):\/\/[^,\/]+)[^\/?]))\/(.*)$/;function P(e,t){let n,i;{let e=t.match(R);if(null===e)throw new Error(`Invalid render volume path: ${JSON.stringify(t)}`);n=e[1],i=e[2]}const r=i.match(D);if(null===r)throw new Error(`Invalid volume path ${JSON.stringify(i)}`);const s=r[1],o=r[2],a=r[3],l=r[4],c=Object(m.e)(r[5]||"");return e.memoize.getUncounted({type:"render:MultiscaleVolumeChunkSource",hostname:n,path:i},()=>N(e,n,s).then(t=>new M(e,n,t,a,o,l,c)))}function j(e,t,n){const i=n.match(/^(?:([^\/]+)(?:\/([^\/]*))?(?:\/([^\/]*))?(\/.*?)?)?$/);if(null===i)return Promise.reject(null);if(void 0===i[2])return Promise.reject(null);if(void 0===i[3]){let n=i[2]||"";return N(e,t,i[1]).then(e=>{let t=Object(p.c)(n,e.projects,e=>e[0]+"/",()=>void 0);return{offset:i[1].length+1,completions:t}})}if(void 0===i[4]){let n=i[3]||"";return N(e,t,i[1]).then(e=>{let t=e.projects.get(i[2]);if(void 0===t)return Promise.reject(null);let r=Object(p.c)(n,t.stacks,e=>e[0]+"/",e=>`(${e[1].project})`);return{offset:i[1].length+i[2].length+2,completions:r}})}let r=i[4].substr(1)||"";return N(e,t,i[1]).then(e=>{let t=e.projects.get(i[2]);if(void 0===t)return Promise.reject(null);let n=t.stacks.get(i[3]);if(void 0===n)return Promise.reject(null);let s=n.channels;if(0===s.length)return Promise.reject(null);{let e=Object(p.c)(r,s,e=>e,()=>void 0);return{offset:i[1].length+i[2].length+i[3].length+3,completions:e}}})}function V(e,t){let n=e.match(R);return null===n?Promise.reject(null):j(t,n[1],n[2]).then(e=>Object(p.a)(n[1].length+1,e))}class _{constructor(e,t,n,i,r,s){this.chunkManager=e,this.baseUrl=t,this.ownerInfo=n,this.project=r,this.parameters=s;let o=n.projects.get(r);if(void 0===o)throw new Error(`Specified project ${JSON.stringify(r)} does not exist for `+`specified owner ${JSON.stringify(n.owner)}`);if(void 0===i){const e=Array.from(o.stacks.keys());if(1!==e.length)throw new Error(`Dataset contains multiple stacks: ${JSON.stringify(e)}`);i=e[0]}const a=o.stacks.get(i);if(void 0===a)throw new Error(`Specified stack ${JSON.stringify(i)} is not one of the supported stacks: `+JSON.stringify(Array.from(o.stacks.keys())));this.stack=i,this.stackInfo=a;let l=Object(m.y)(s.matchCollection);void 0===l&&(l=i),this.matchCollection=l;let c=Object(m.x)(s.zoffset);void 0===c&&(c=1),this.zoffset=c,this.dims=f.u.create();let u=Object(m.x)(s.tilesize);void 0===u&&(u=1024),this.dims[0]=u,this.dims[1]=u,this.dims[2]=1}getSources(e){const t=this.stackInfo.voxelResolution,n=f.u.subtract(f.u.create(),this.stackInfo.upperVoxelBound,this.stackInfo.lowerVoxelBound);f.u.multiply(n,n,t),n[2]=t[2];const i=c.a.make({voxelSize:t,chunkSize:n,lowerChunkBound:f.u.fromValues(0,0,this.stackInfo.lowerVoxelBound[2]),upperChunkBound:f.u.fromValues(1,1,this.stackInfo.upperVoxelBound[2]),vectorGraphicsSourceOptions:e});return[[this.chunkManager.getChunkSource(x,{spec:i,parameters:{baseUrl:this.baseUrl,owner:this.ownerInfo.owner,project:this.stackInfo.project,stack:this.stack,encoding:"points",matchCollection:this.matchCollection,zoffset:this.zoffset}})]]}}function U(e,t){let n,i;{let e=t.match(R);if(null===e)throw new Error(`Invalid render point path: ${JSON.stringify(t)}`);n=e[1],i=e[2]}const r=i.match(D);if(null===r)throw new Error(`Invalid point path ${JSON.stringify(i)}`);const s=r[1],o=r[2],a=r[3],l=Object(m.e)(r[4]||"");return e.memoize.getUncounted({type:"render:MultiscaleVectorGraphicsChunkSource",hostname:n,path:i},()=>N(e,n,s).then(t=>new _(e,n,t,a,o,l)))}class F extends r.a{get description(){return"Render"}getVolume(e,t){return P(e,t)}volumeCompleter(e,t){return V(e,t)}getVectorGraphicsSource(e,t){return U(e,t)}}},function(e,t,n){"use strict";n.r(t);var i,r,s,o=n(6),a=n(11),l=n(40);!function(e){e[e.RAW=0]="RAW",e[e.JPEG=1]="JPEG",e[e.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION"}(i||(i={}));class c{}c.RPC_ID="precomputed/VolumeChunkSource";class u{}u.RPC_ID="precomputed/MeshSource",function(e){e[e.RAW=0]="RAW",e[e.GZIP=1]="GZIP"}(r||(r={})),function(e){e[e.IDENTITY=0]="IDENTITY",e[e.MURMURHASH3_X86_128=1]="MURMURHASH3_X86_128"}(s||(s={}));class d{}d.RPC_ID="precomputed/MultiscaleMeshSource";class h{}h.RPC_ID="precomputed/SkeletonSource";var p=n(53),f=n(43),g=n(56),m=n(4),v=n(34),b=n(0),y=n(24),w=n(1);n.d(t,"PrecomputedSkeletonSource",function(){return O}),n.d(t,"MultiscaleVolumeChunkSource",function(){return k}),n.d(t,"getShardedMeshSource",function(){return E}),n.d(t,"getSkeletonSource",function(){return P}),n.d(t,"getVolume",function(){return j}),n.d(t,"PrecomputedDataSource",function(){return V});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class x extends(Object(a.f)(v.b,c)){}class S extends(Object(a.f)(f.b,u)){}class C extends(Object(a.f)(f.d,d)){}class O extends(Object(a.f)(g.e,h)){get skeletonVertexCoordinatesInVoxels(){return!1}get vertexAttributes(){return this.parameters.metadata.vertexAttributes}}function L(e,t){const n=e.split("/");for(const e of t.split("/"))".."!==e||0===n.length?n.push(e):n.length=n.length-1;return n.join("/")}class T{constructor(e){if(Object(w.t)(e),this.resolution=Object(w.v)(e,"resolution",e=>Object(w.c)(b.u.create(),e,w.o)),this.voxelOffset=Object(w.v)(e,"voxel_offset",e=>void 0===e?b.u.create():Object(w.d)(b.u.create(),e)),this.size=Object(w.v)(e,"size",e=>Object(w.c)(b.u.create(),e,w.z)),this.chunkSizes=Object(w.v)(e,"chunk_sizes",e=>Object(w.a)(e,e=>Object(w.c)(b.u.create(),e,w.z))),0===this.chunkSizes.length)throw new Error("No chunk sizes specified.");if(this.sharding=Object(w.v)(e,"sharding",N),void 0!==this.sharding&&1!==this.chunkSizes.length)throw new Error("Sharding requires a single chunk size per scale");(this.encoding=Object(w.v)(e,"encoding",e=>Object(w.m)(e,i)))===i.COMPRESSED_SEGMENTATION&&(this.compressedSegmentationBlockSize=Object(w.v)(e,"compressed_segmentation_block_size",e=>Object(w.c)(b.u.create(),e,w.z))),this.key=Object(w.v)(e,"key",w.A)}}class k{constructor(e,t,n){this.chunkManager=e,this.url=t,Object(w.t)(n);const i=Object(w.v)(n,"@type",w.y);if(void 0!==i&&"neuroglancer_multiscale_volume"!==i)throw new Error(`Invalid type: ${JSON.stringify(i)}`);this.dataType=Object(w.v)(n,"data_type",e=>Object(w.m)(e,m.a)),this.numChannels=Object(w.v)(n,"num_channels",w.z),this.volumeType=Object(w.v)(n,"type",e=>Object(w.m)(e,m.c)),this.mesh=Object(w.v)(n,"mesh",w.y),this.skeletons=Object(w.v)(n,"skeletons",w.y),this.scales=Object(w.v)(n,"scales",e=>Object(w.a)(e,e=>new T(e)))}getMeshSource(){const{mesh:e}=this;if(void 0!==e)return R(this.chunkManager,L(this.url,e));const{skeletons:t}=this;return void 0!==t?P(this.chunkManager,L(this.url,t)):null}getSources(e){return this.scales.map(t=>m.b.getDefaults({voxelSize:t.resolution,dataType:this.dataType,numChannels:this.numChannels,transform:b.m.fromTranslation(b.m.create(),b.u.multiply(b.u.create(),t.resolution,t.voxelOffset)),upperVoxelBound:t.size,volumeType:this.volumeType,chunkDataSizes:t.chunkSizes,baseVoxelOffset:t.voxelOffset,compressedSegmentationBlockSize:t.compressedSegmentationBlockSize,volumeSourceOptions:e}).map(e=>this.chunkManager.getChunkSource(x,{spec:e,parameters:{url:L(this.url,t.key),encoding:t.encoding,sharding:t.sharding}})))}getStaticAnnotations(){const e=this.scales[0],t=new o.b(b.m.fromScaling(b.m.create(),e.resolution));return t.readonly=!0,t.add(Object(o.i)(e.voxelOffset,b.u.add(b.u.create(),e.voxelOffset,e.size))),t}}function E(e,t){return e.getChunkSource(S,{parameters:t})}function A(e){return Object(w.v)(e,"transform",e=>{const t=b.m.create();return void 0!==e&&Object(w.c)(t.subarray(0,12),e,w.n),b.m.transpose(t,t),t})}function M(e,t){return e.memoize.getUncounted({type:"precomputed:MeshSource",url:t},()=>Object(y.c)(`${t}/info`).then(e=>e.json().then(e=>(function(e){Object(w.t)(e);const t=Object(w.v)(e,"@type",w.A);if("neuroglancer_multilod_draco"!==t)throw new Error(`Unsupported mesh type: ${JSON.stringify(t)}`);const n=Object(w.v)(e,"lod_scale_multiplier",w.o),i=Object(w.v)(e,"vertex_quantization_bits",w.z);return{lodScaleMultiplier:n,transform:A(e),sharding:Object(w.v)(e,"sharding",N),vertexQuantizationBits:i}})(e)),()=>void 0))}function I(e){return void 0===e?r.RAW:Object(w.m)(e,r)}function N(e){if(void 0===e)return;Object(w.t)(e);const t=Object(w.v)(e,"@type",w.A);if("neuroglancer_uint64_sharded_v1"!==t)throw new Error(`Unsupported sharding format: ${JSON.stringify(t)}`);return{hash:Object(w.v)(e,"hash",e=>Object(w.m)(e,s)),preshiftBits:Object(w.v)(e,"preshift_bits",w.r),shardBits:Object(w.v)(e,"shard_bits",w.r),minishardBits:Object(w.v)(e,"minishard_bits",w.r),minishardIndexEncoding:Object(w.v)(e,"minishard_index_encoding",I),dataEncoding:Object(w.v)(e,"data_encoding",I)}}function D(e,t){return e.memoize.getUncounted({type:"precomputed:SkeletonSource",url:t},async()=>{const e=await Object(y.c)(`${t}/info`);return function(e){Object(w.t)(e);const t=Object(w.v)(e,"@type",w.A);if("neuroglancer_skeletons"!==t)throw new Error(`Unsupported skeleton type: ${JSON.stringify(t)}`);const n=A(e),i=new Map;Object(w.v)(e,"vertex_attributes",e=>{void 0!==e&&Object(w.a)(e,e=>{Object(w.t)(e);const t=Object(w.v)(e,"id",w.A);if(""===t)throw new Error("vertex attribute id must not be empty");if(i.has(t))throw new Error(`duplicate vertex attribute id ${JSON.stringify(t)}`);const n=Object(w.v)(e,"data_type",e=>Object(w.m)(e,m.a)),r=Object(w.v)(e,"num_components",w.z);i.set(t,{dataType:n,numComponents:r})})});const r=Object(w.v)(e,"sharding",N);return{transform:n,vertexAttributes:i,sharding:r}}(await e.json())})}async function R(e,t){const n=await M(e,t);if(void 0===n)return E(e,{url:t,lod:0});let i;const{vertexQuantizationBits:r}=n;if(10===r)i=p.e.uint10;else{if(16!==r)throw new Error(`Invalid vertex quantization bits: ${r}`);i=p.e.uint16}return e.getChunkSource(C,{parameters:{url:t,metadata:n},format:{fragmentRelativeVertices:!0,vertexPositionFormat:i,transform:n.transform}})}async function P(e,t){const n=await D(e,t);return e.getChunkSource(O,{parameters:{url:t,metadata:n},transform:n.transform})}function j(e,t){return t=Object(y.d)(t),e.memoize.getUncounted({type:"precomputed:MultiscaleVolumeChunkSource",url:t},()=>Object(y.c)(`${t}/info`).then(e=>e.json()).then(n=>new k(e,t,n)))}class V extends l.a{get description(){return"Precomputed file-backed data source"}getVolume(e,t){return j(e,t)}getMeshSource(e,t){return R(e,Object(y.d)(t))}getSkeletonSource(e,t){return P(e,Object(y.d)(t))}}},function(e,t,n){"use strict";n.r(t);var i=n(11),r=n(40);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const s="nifti/getNiftiVolumeInfo";var o;!function(e){e[e.NONE=0]="NONE",e[e.BINARY=1]="BINARY",e[e.UINT8=2]="UINT8",e[e.INT16=4]="INT16",e[e.INT32=8]="INT32",e[e.FLOAT32=16]="FLOAT32",e[e.COMPLEX64=32]="COMPLEX64",e[e.FLOAT64=64]="FLOAT64",e[e.RGB24=128]="RGB24",e[e.INT8=256]="INT8",e[e.UINT16=512]="UINT16",e[e.UINT32=768]="UINT32",e[e.INT64=1024]="INT64",e[e.UINT64=1280]="UINT64",e[e.FLOAT128=1536]="FLOAT128",e[e.COMPLEX128=1792]="COMPLEX128",e[e.COMPLEX256=2048]="COMPLEX256"}(o||(o={}));class a{}a.RPC_ID="nifti/VolumeChunkSource";var l=n(4),c=n(34),u=n(14),d=n(0);n.d(t,"MultiscaleVolumeChunkSource",function(){return p}),n.d(t,"getVolume",function(){return f}),n.d(t,"NiftiDataSource",function(){return g});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class h extends(Object(i.f)(c.b,a)){}class p{constructor(e,t,n){this.chunkManager=e,this.url=t,this.info=n}get numChannels(){return this.info.numChannels}get dataType(){return this.info.dataType}get volumeType(){return this.info.volumeType}getSources(e){let{info:t}=this;const n=l.b.withDefaultCompression({volumeType:t.volumeType,chunkDataSize:t.volumeSize,dataType:t.dataType,voxelSize:t.voxelSize,numChannels:t.numChannels,upperVoxelBound:t.volumeSize,transform:Object(d.s)(d.m.create(),t.qoffset,t.quatern,d.i,t.qfac),volumeSourceOptions:e});return[[this.chunkManager.getChunkSource(h,{spec:n,parameters:{url:this.url}})]]}getMeshSource(){return null}}function f(e,t){return e.memoize.getUncounted({type:"nifti/getVolume",url:t},()=>(function(e,t,n){return e.rpc.promiseInvoke(s,{chunkManager:e.addCounterpartRef(),url:t},n)})(e,t,u.e).then(n=>new p(e,t,n)))}class g extends r.a{get description(){return"Single NIfTI file"}getVolume(e,t){return f(e,t)}}},function(e,t,n){"use strict";n.r(t);var i,r=n(6),s=n(11),o=n(40);!function(e){e[e.RAW=0]="RAW",e[e.GZIP=1]="GZIP"}(i||(i={}));class a{}a.RPC_ID="n5/VolumeChunkSource";var l=n(4),c=n(34),u=n(0),d=n(24),h=n(1);n.d(t,"MultiscaleVolumeChunkSource",function(){return f}),n.d(t,"N5DataSource",function(){return y});
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class p extends(Object(s.f)(c.b,a)){}class f{constructor(e,t,n,i){let r,s;if(this.chunkManager=e,this.url=t,this.topLevelMetadata=n,this.scales=i,i.forEach((e,t)=>{if(void 0!==e){if(void 0===s&&(s=t),void 0!==r&&e.dataType!==r)throw new Error(`Scale s${t} has data type ${l.a[e.dataType]} but expected ${l.a[r]}.`);r=e.dataType}}),void 0===r)throw new Error("At least one scale must be specified.");this.dataType=r,this.volumeType=l.c.IMAGE,this.baseScaleIndex=s}get numChannels(){return 1}getMeshSource(){return null}getSources(e){const{topLevelMetadata:t}=this,n=[];return this.scales.forEach((i,r)=>{void 0!==i&&n.push(l.b.getDefaults({voxelSize:u.u.multiply(u.u.create(),t.pixelResolution,t.scales[r]),dataType:i.dataType,numChannels:1,upperVoxelBound:i.size,volumeType:this.volumeType,chunkDataSizes:[i.chunkSize],volumeSourceOptions:e}).map(e=>this.chunkManager.getChunkSource(p,{spec:e,parameters:{url:`${this.url}/s${r}`,encoding:i.encoding}})))}),n}getStaticAnnotations(){const{topLevelMetadata:e,baseScaleIndex:t}=this,n=new r.b(u.m.fromScaling(u.m.create(),u.u.multiply(u.u.create(),e.pixelResolution,e.scales[t])));return n.readonly=!0,n.add(Object(r.i)(u.u.create(),this.scales[t].size)),n}}const g=new Map([["mm",1e6],["m",1e9],["um",1e3],["nm",1]]);class m{constructor(e){Object(h.t)(e),Object(h.v)(e,"pixelResolution",e=>{Object(h.t)(e);const t=Object(h.v)(e,"unit",e=>{const t=g.get(e);if(void 0===t)throw new Error(`Unsupported unit: ${JSON.stringify(e)}.`);return t}),n=Object(h.v)(e,"dimensions",e=>Object(h.c)(u.u.create(),e,h.o));this.pixelResolution=u.u.scale(n,n,t)}),this.scales=Object(h.v)(e,"scales",e=>Object(h.a)(e,e=>Object(h.c)(u.u.create(),e,h.o)))}}class v{constructor(e){let t;Object(h.t)(e),this.dataType=Object(h.v)(e,"dataType",e=>Object(h.m)(e,l.a)),this.size=Object(h.v)(e,"dimensions",e=>Object(h.c)(u.u.create(),e,h.z)),this.chunkSize=Object(h.v)(e,"blockSize",e=>Object(h.c)(u.u.create(),e,h.z)),Object(h.v)(e,"compression",e=>{t=Object(h.v)(e,"type",e=>Object(h.m)(e,i))}),void 0===t&&(t=Object(h.v)(e,"compressionType",e=>Object(h.m)(e,i))),this.encoding=t}}function b(e,t,n){return Promise.all(n.scales.map((n,i)=>(function(e,t){return e.memoize.getUncounted({type:"n5:scaleMetadata",url:t},()=>Object(d.c)(t).then(e=>e.json()).then(e=>new v(e)))})(e,`${t}/s${i}/attributes.json`).catch(e=>{if(!(e instanceof d.a&&404===e.status))throw e})))}class y extends o.a{get description(){return"N5 data source"}getVolume(e,t){const n=(t=Object(d.d)(t)).match(/^(.*)\/(c[0-9]+)$/);let i;return i=null!==n?`${n[1]}/attributes.json`:`${t}/attributes.json`,e.memoize.getUncounted({type:"n5:MultiscaleVolumeChunkSource",url:t},()=>(function(e,t){return e.memoize.getUncounted({type:"n5:topLevelMetadata",url:t},()=>Object(d.c)(t).then(e=>e.json()).then(e=>new m(e)))})(e,i).then(n=>b(e,t,n).then(i=>new f(e,t,n,i))))}}},function(e,t,n){"use strict";n.r(t);n(89);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var i=n(58),r=n(1),s=n(8);n.d(t,"ExampleComputation",function(){return o}),n.d(t,"ExampleComputationProvider",function(){return a});
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let o=class extends i.VolumeComputationFrontend{};o=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([Object(s.g)("Computation.ExampleComputation")],o);class a{getComputation(e,{},t){const n=t.computationParameters;if(void 0!==e.inputSize){const t=Object(r.k)(e.inputSize);n.inputSpec.size.set(t)}if(void 0!==e.outputSize){const t=Object(r.k)(e.outputSize);n.outputSpec.size.set(t)}return Promise.resolve(new o(n))}}},function(e,t,n){"use strict";n.r(t);var i=n(58);n(89);var r=n(4),s=n(14),o=n(1),a=n(8);n.d(t,"loadTFjs",function(){return c}),n.d(t,"TensorflowComputation",function(){return u}),n.d(t,"TensorflowComputationProvider",function(){return d});let l=null;function c(){return l?Promise.resolve():n.e(1).then(n.bind(null,406)).then(e=>{l=e})}let u=class extends i.VolumeComputationFrontend{constructor(e,t){super(e),this.model_=t,this.inferenceQueue_=[],this.running_=!1}predict(e,t,n){return new Promise((i,r)=>{let s;const o=this.inferenceQueue_;for(s=0;s<o.length&&o[s].priority<t;++s);o.splice(s,0,{array:e,cancellationToken:n,priority:t,resolve:i,reject:r}),this.startInference()}).then(e=>({value:e,transfers:[e.outputBuffer.buffer]}))}startInference(){this.running_||(this.running_=!0,setTimeout(()=>this.runInference_(),0))}runInference_(){if(0===this.inferenceQueue_.length)return void(this.running_=!1);const e=this.inferenceQueue_.pop();if(e.cancellationToken.isCanceled)return e.reject(s.a),void this.runInference_();this.modelInference_(e).then(()=>this.runInference_())}modelInference_(e){const t=e.array.length,n=this.params.inputTensorNumElements;if(t!==n)return e.reject(new Error(`Input array has ${t} elements. Expected ${n}`)),Promise.resolve();const i=l.tidy(()=>{const t=l.tensor(e.array).reshape(this.params.inputTensorShape);return this.model_.predict(t,{})});return i.data().then(t=>{i.dispose();const n={outputBuffer:t};e.resolve(n)}).then(()=>new Promise(e=>{setTimeout(()=>e(),10)}))}};u=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([Object(a.g)("Computation.Tensorflow")],u);class d{getComputation(e,{},t){let n,i=Object(o.A)(e.modelPath);i.endsWith("/")||(i+="/");let s=1,a=0,d=r.c.SEGMENTATION;if(void 0!==e.stdDev&&(s=Object(o.p)(e.stdDev)),void 0!==e.mean&&(a=Object(o.p)(e.mean)),void 0!==e.atype){const t=Object(o.A)(e.atype);switch(t){case"classifier":break;case"regressor":d=r.c.IMAGE;break;default:throw new Error(`Unknown algorithm type ${t}. Must be "classifier" or "regressor"`)}}return c().then(()=>l.loadFrozenModel(i+"tensorflowjs_model.pb",i+"weights_manifest.json")).then(e=>{if(1!==(n=e).inputs.length)throw new Error("Only models with exactly one input are supported");if(1!==n.outputs.length)throw new Error("Only models with exactly one output are supported");const t=l.tidy(()=>{const e=l.ones(n.inputs[0].shape);return n.predict(e,{})});return t.data().then(()=>t)}).then(e=>{const i=[1,1,1],o=[1,1,1],l=n.inputs[0],c=l.dtype;let h=0;for(let e of l.shape)if(e>1&&(i[h]=e,++h),h>=3)throw new Error(`Cannot support tensorflow model with input ndim > 3: ${l.shape}`);h=0;for(let t of e.shape)if(t>1&&(o[h]=t,++h),h>=3)throw new Error(`Cannot support tensorflow model with output ndim > 3: ${e.shape}`);e.dispose();let p=1;for(const e of l.shape)p*=e;const f=t.computationParameters;return f.inputSpec.size.set(i),f.outputSpec.size.set(o),f.outputSpec.dataType=r.a.UINT32,f.outputSpec.volumeType=d,f.inputDType=c,f.mean=a,f.stdDev=s,f.inputTensorShape=l.shape,f.inputTensorNumElements=p,new u(f,n)})}}Object(a.d)("Computation.Tensorflow.Inference",function(e,t){const n=e.inferenceRequest;return this.get(n.computationRef).predict(n.inputBuffer,n.priority,t)})},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var i=n(136),r="object"==typeof self&&self&&self.Object===Object&&self,s=i||r||Function("return this")();e.exports=s},function(e,t,n){var i=n(124).Symbol;e.exports=i},function(e,t,n){var i=n(180);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){var i=n(181);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){var i=n(183);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){var i=n(184);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){!function(e){"use strict";function t(t,n,r,s){if(r&&r.call){var o=r;r=null}else var o=i(t,r,"rangeFinder");"number"==typeof n&&(n=e.Pos(n,0));var a=i(t,r,"minFoldSize");function l(e){var i=o(t,n);if(!i||i.to.line-i.from.line<a)return null;for(var r=t.findMarksAt(i.from),l=0;l<r.length;++l)if(r[l].__isFold&&"fold"!==s){if(!e)return null;i.cleared=!0,r[l].clear()}return i}var c=l(!0);if(i(t,r,"scanUp"))for(;!c&&n.line>t.firstLine();)n=e.Pos(n.line-1,0),c=l(!1);if(c&&!c.cleared&&"unfold"!==s){var u=function(e,t){var n=i(e,t,"widget");if("string"==typeof n){var r=document.createTextNode(n);(n=document.createElement("span")).appendChild(r),n.className="CodeMirror-foldmarker"}else n&&(n=n.cloneNode(!0));return n}(t,r);e.on(u,"mousedown",function(t){d.clear(),e.e_preventDefault(t)});var d=t.markText(c.from,c.to,{replacedWith:u,clearOnEnter:i(t,r,"clearOnEnter"),__isFold:!0});d.on("clear",function(n,i){e.signal(t,"unfold",t,n,i)}),e.signal(t,"fold",t,c.from,c.to)}}e.newFoldFunction=function(e,n){return function(i,r){t(i,r,{rangeFinder:e,widget:n})}},e.defineExtension("foldCode",function(e,n,i){t(this,e,n,i)}),e.defineExtension("isFolded",function(e){for(var t=this.findMarksAt(e),n=0;n<t.length;++n)if(t[n].__isFold)return!0}),e.commands.toggleFold=function(e){e.foldCode(e.getCursor())},e.commands.fold=function(e){e.foldCode(e.getCursor(),null,"fold")},e.commands.unfold=function(e){e.foldCode(e.getCursor(),null,"unfold")},e.commands.foldAll=function(t){t.operation(function(){for(var n=t.firstLine(),i=t.lastLine();n<=i;n++)t.foldCode(e.Pos(n,0),null,"fold")})},e.commands.unfoldAll=function(t){t.operation(function(){for(var n=t.firstLine(),i=t.lastLine();n<=i;n++)t.foldCode(e.Pos(n,0),null,"unfold")})},e.registerHelper("fold","combine",function(){var e=Array.prototype.slice.call(arguments,0);return function(t,n){for(var i=0;i<e.length;++i){var r=e[i](t,n);if(r)return r}}}),e.registerHelper("fold","auto",function(e,t){for(var n=e.getHelpers(t,"fold"),i=0;i<n.length;i++){var r=n[i](e,t);if(r)return r}});var n={rangeFinder:e.fold.auto,widget:"",minFoldSize:0,scanUp:!1,clearOnEnter:!0};function i(e,t,i){if(t&&void 0!==t[i])return t[i];var r=e.options.foldOptions;return r&&void 0!==r[i]?r[i]:n[i]}e.defineOption("foldOptions",null),e.defineExtension("foldOption",function(e,t){return i(this,e,t)})}(n(50))},,,,function(e,t,n){n(112),n(242),n(151),n(115),n(244),n(152),n(116),n(153),n(117),n(154),n(118),n(155),n(119),n(156),n(120),n(157),n(58),n(158),n(121),n(159),n(122),n(160),n(161),n(162),n(243),n(240),n(111),n(241),n(245),e.exports=n(239)},function(e,t,n){var i=n(124);e.exports=function(){return i.Date.now()}},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(123))},function(e,t,n){var i=n(114),r=n(138),s=NaN,o=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(r(e))return s;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(o,"");var n=l.test(e);return n||c.test(e)?u(e.slice(2),n?2:8):a.test(e)?s:+e}},function(e,t,n){var i=n(139),r=n(142),s="[object Symbol]";e.exports=function(e){return"symbol"==typeof e||r(e)&&i(e)==s}},function(e,t,n){var i=n(125),r=n(140),s=n(141),o="[object Null]",a="[object Undefined]",l=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?a:o:l&&l in Object(e)?r(e):s(e)}},function(e,t,n){var i=n(125),r=Object.prototype,s=r.hasOwnProperty,o=r.toString,a=i?i.toStringTag:void 0;e.exports=function(e){var t=s.call(e,a),n=e[a];try{e[a]=void 0;var i=!0}catch(e){}var r=o.call(e);return i&&(t?e[a]=n:delete e[a]),r}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){var i=n(144);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2018 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-tab-view {\n  display: flex;\n  flex-direction: column;\n}\n\n.neuroglancer-tab-view-bar {\n  display: block;\n  background-color: #333;\n  border-bottom: 1px solid white;\n}\n\n.neuroglancer-tab-label {\n  display: inline-block;\n  border-top: 1px solid transparent;\n  border-left: 1px solid transparent;\n  border-right: 1px solid transparent;\n  border-bottom: none;\n  margin-right: 4px;\n  padding-top: 1px;\n  padding-left: 2px;\n  padding-right: 2px;\n  font: 10pt sans-serif;\n  font-weight: bold;\n  cursor: pointer;\n}\n.neuroglancer-tab-label:hover {\n  color: #daa520;\n}\n\n.neuroglancer-tab-label.neuroglancer-selected-tab-label {\n  background-color: black;\n  border-top: 1px solid white;\n  border-left: 1px solid white;\n  border-right: 1px solid white;\n  border-bottom: 1px solid black;\n  padding-bottom: 1px;\n  margin-bottom: -1px;\n}\n\n.neuroglancer-stack-view {\n  display: flex;\n  flex-direction: column;\n}\n\n.neuroglancer-tab-view > .neuroglancer-stack-view {\n  flex: 1;\n  /*\n  border-left: 1px solid white;\n  border-right: 1px solid white;\n  border-bottom: 1px solid white;\n  */\n  padding: 2px;\n}\n\n.neuroglancer-tab-content {\n  flex: 1;\n}\n',""])},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,i=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var r,s=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(s)?e:(r=0===s.indexOf("//")?s:0===s.indexOf("/")?n+s:i+s.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")})}},function(e,t,n){var i=n(147);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n#statusContainer {\n  position: fixed;\n  bottom: 0px;\n  z-index: 100;\n  background-color: grey;\n  color: white;\n  margin: 0px;\n  padding: 0px;\n}\n\n#statusContainer li {\n  width: 100vw;\n  max-height: 25vh;\n  overflow-y: auto;\n}\n',""])},function(e,t,n){var i=n(149);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-rendered-data-panel {\n  cursor: crosshair;\n  position: relative;\n  outline: 0;\n  touch-action: none;\n}\n',""])},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-noselect {\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.neuroglancer-select-text {\n  -webkit-touch-callout: default;\n  -webkit-user-select: text;\n  -khtml-user-select: text;\n  -moz-user-select: text;\n  -ms-user-select: text;\n  user-select: text;\n}\n',""])},function(e,t,n){"use strict";n.r(t);var i=n(112),r=n(63),s=n(41);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object(s.b)("brainmaps",e=>new i.BrainmapsDataSource(i.productionInstance,e.credentialsManager.getCredentialsProvider(r.a)))},function(e,t,n){"use strict";n.r(t);var i=n(115),r=n(41);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object(r.b)("boss",e=>new i.BossDataSource(e.credentialsManager))},function(e,t,n){"use strict";n.r(t);var i=n(116),r=n(41);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object(r.b)("dvid",()=>new i.DVIDDataSource)},function(e,t,n){"use strict";n.r(t);var i=n(41),r=n(117);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object(i.b)("render",()=>new r.RenderDataSource)},function(e,t,n){"use strict";n.r(t);var i=n(118),r=n(41);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object(r.b)("precomputed",()=>new i.PrecomputedDataSource)},function(e,t,n){"use strict";n.r(t);var i=n(119),r=n(41);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object(r.b)("nifti",()=>new i.NiftiDataSource)},function(e,t,n){"use strict";n.r(t);var i=n(41),r=n(120);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object(i.b)("n5",()=>new r.N5DataSource)},function(e,t,n){"use strict";n.r(t);var i=n(58),r=n(41);Object(r.b)("computed",()=>new i.ComputedDataSource)},function(e,t,n){"use strict";n.r(t);var i=n(121);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(58).ComputedDataSource.registerComputation("example",new i.ExampleComputationProvider)},function(e,t,n){"use strict";n.r(t);var i=n(58),r=n(122);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
i.ComputedDataSource.registerComputation("tensorflow",new r.TensorflowComputationProvider)},function(e,t){},function(e,t){},function(e,t,n){var i=n(164);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.overlay {\n  height: 100%;\n  width: 100%;\n  position: fixed;\n  z-index: 99;\n  top: 0;\n  left: 0;\n  background-color: rgba(0, 0, 0, 0.8);\n}\n\n.overlay-content {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background-color: white;\n  z-index: 100;\n  color: black;\n  padding: 1em;\n}\n',""])},function(e,t,n){var i=n(166);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2018 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-annotations-tab {\n  display: flex;\n  align-items: flex-start;\n  flex: 1;\n  flex-direction: column;\n}\n\n.neuroglancer-annotation-list { \n  list-style-type: none;\n  margin: 0px;\n  padding: 5px;\n  overflow-y: auto;\n  height: 0px;\n  flex: 1;\n  flex-basis: 0px;\n  min-height: 0px;\n}\n\n.neuroglancer-annotation-layer-view {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n}\n\n.neuroglancer-annotations-stack {\n  flex: 1;\n  align-self: stretch;\n}\n\n.neuroglancer-annotation-icon {\n  position: absolute;\n  left: 0px;\n}\n\n.neuroglancer-annotation-description {\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.neuroglancer-annotation-hover {\n  background-color: #333;\n}\n\n.neuroglancer-annotation-selected {\n  outline: 1px solid #ccc;\n}\n\n.neuroglancer-annotation-list > li {\n  cursor: pointer;\n  position: relative;\n  padding-left: 1.5em;\n}\n\n.neuroglancer-tab-content.neuroglancer-annotation-details {\n  flex: 0 0 auto;\n  align-self: stretch;\n  display: flex;\n  flex-direction: column;\n\n  -webkit-touch-callout: default;\n  -webkit-user-select: text;\n  -khtml-user-select: text;\n  -moz-user-select: text;\n  -ms-user-select: text;\n  user-select: text;\n}\n\n.neuroglancer-annotation-details-title {\n  display: flex;\n  flex-direction: row;\n  background-color: #03c;\n  align-self: stretch;\n  padding: 2px;\n}\n\n.neuroglancer-voxel-coordinates-link {\n  cursor: pointer;\n}\n\n.neuroglancer-voxel-coordinates-link:hover {\n  background-color: #db4437;\n}\n\n.neuroglancer-annotation-details-icon {\n  display: inline-block;\n  margin-right: 5px;\n}\n\n.neuroglancer-annotation-details-title-text {\n  display: inline-block;\n  flex: 1;\n}\n\n.neuroglancer-annotation-details-description {\n  align-self: stretch;\n  background-color: #222;\n  color: white;\n  font: 10pt sans-serif;\n  border: 0px;\n  outline: 0px;\n  resize: none;\n  overflow-y: scroll;\n}\n\n.neuroglancer-annotation-details-position {\n}\n\n.neuroglancer-annotation-toolbox {\n  display: flex;\n  align-items: stretch;\n}\n\n.neuroglancer-annotation-segment-list {\n}\n\n\n.neuroglancer-annotation-segment-item {\n  color: black;\n}\n',""])},function(e,t,n){var i=n(168);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2018 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-icon-button {\n  display: flex;\n  flex-direction: row;\n  align-self: center;\n  border-radius: 50%;\n  width: 18px;\n  height: 18px;\n  align-items: center;\n  justify-content: center;\n  color: white;\n  font: 12px sans-serif;\n  cursor: pointer;\n  font-weight: 900;\n}\n\n.neuroglancer-icon-button:hover {\n  background-color: #db4437;\n}\n\n.neuroglancer-icon-button div {\n  display: inline-block;\n  margin: -2px;\n}\n',""])},function(e,t,n){var i=n(170);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.range-slider {\n  display: flex;\n  flex-direction: row;\n  white-space: nowrap;\n  justify-content: space-between;\n}\n\n.range-slider input[type=\'range\'] {\n}\n\n',""])},function(e,t,n){var i=n(172);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.uint64-entry input {\n  width: 19ch;\n}\n\n.uint64-entry input.invalid-input {\n  color: red;\n}\n',""])},function(e,t,n){var i=n(174);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2018 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-coordinate-transform-widget {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n}\n\n.neuroglancer-coordinate-transform-widget-homogeneous {\n  align-self: stretch;\n  display: block;\n}\n\n.neuroglancer-coordinate-transform-widget textarea {\n  display: block;\n  font-family: monospace;\n  font-size: medium;\n  margin-left: 1em;\n  background-color: transparent;\n  color: white;\n  border: 0px;\n  outline: 0px;\n  resize: none;\n}\n',""])},function(e,t,n){var i=n(176);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2019 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-render-scale-widget {\n  margin-top: 2px;\n  margin-bottom: 2px;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n\n.neuroglancer-render-scale-widget-prompt {\n  white-space: nowrap;\n}\n\n.neuroglancer-render-scale-widget > canvas {\n  height: 36px;\n  flex: 1;\n  flex-basis: 0px;\n  width: 0px;\n}\n\n\n.neuroglancer-render-scale-widget-legend {\n  width: 10ch;\n  font-size: 11px;\n  text-align: right;\n}\n\n.neuroglancer-render-scale-widget-legend > div {\n  height: 12px;\n}\n',""])},function(e,t,n){!function(e){"use strict";var t="CodeMirror-lint-markers";function n(e){e.parentNode&&e.parentNode.removeChild(e)}function i(t,i,r){var s=function(t,n){var i=document.createElement("div");function r(t){if(!i.parentNode)return e.off(document,"mousemove",r);i.style.top=Math.max(0,t.clientY-i.offsetHeight-5)+"px",i.style.left=t.clientX+5+"px"}return i.className="CodeMirror-lint-tooltip",i.appendChild(n.cloneNode(!0)),document.body.appendChild(i),e.on(document,"mousemove",r),r(t),null!=i.style.opacity&&(i.style.opacity=1),i}(t,i);function o(){var t;e.off(r,"mouseout",o),s&&((t=s).parentNode&&(null==t.style.opacity&&n(t),t.style.opacity=0,setTimeout(function(){n(t)},600)),s=null)}var a=setInterval(function(){if(s)for(var e=r;;e=e.parentNode){if(e&&11==e.nodeType&&(e=e.host),e==document.body)return;if(!e){o();break}}if(!s)return clearInterval(a)},400);e.on(r,"mouseout",o)}function r(e,t,n){this.marked=[],this.options=t,this.timeout=null,this.hasGutter=n,this.onMouseOver=function(t){!function(e,t){var n=t.target||t.srcElement;if(/\bCodeMirror-lint-mark-/.test(n.className)){for(var r=n.getBoundingClientRect(),s=(r.left+r.right)/2,o=(r.top+r.bottom)/2,l=e.findMarksAt(e.coordsChar({left:s,top:o},"client")),c=[],u=0;u<l.length;++u){var d=l[u].__annotation;d&&c.push(d)}c.length&&function(e,t){for(var n=t.target||t.srcElement,r=document.createDocumentFragment(),s=0;s<e.length;s++){var o=e[s];r.appendChild(a(o))}i(t,r,n)}(c,t)}}(e,t)},this.waitingFor=0}function s(e){var n=e.state.lint;n.hasGutter&&e.clearGutter(t);for(var i=0;i<n.marked.length;++i)n.marked[i].clear();n.marked.length=0}function o(t,n,r,s){var o=document.createElement("div"),a=o;return o.className="CodeMirror-lint-marker-"+n,r&&((a=o.appendChild(document.createElement("div"))).className="CodeMirror-lint-marker-multiple"),0!=s&&e.on(a,"mouseover",function(e){i(e,t,a)}),o}function a(e){var t=e.severity;t||(t="error");var n=document.createElement("div");return n.className="CodeMirror-lint-message-"+t,void 0!==e.messageHTML?n.innerHTML=e.messageHTML:n.appendChild(document.createTextNode(e.message)),n}function l(t){var n=t.state.lint,i=n.options,r=i.options||i,s=i.getAnnotations||t.getHelper(e.Pos(0,0),"lint");if(s)if(i.async||s.async)!function(t,n,i){var r=t.state.lint,s=++r.waitingFor;function o(){s=-1,t.off("change",o)}t.on("change",o),n(t.getValue(),function(n,i){t.off("change",o),r.waitingFor==s&&(i&&n instanceof e&&(n=i),t.operation(function(){c(t,n)}))},i,t)}(t,s,r);else{var o=s(t.getValue(),r,t);if(!o)return;o.then?o.then(function(e){t.operation(function(){c(t,e)})}):t.operation(function(){c(t,o)})}}function c(e,n){s(e);for(var i=e.state.lint,r=i.options,l=function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n],r=i.from.line;(t[r]||(t[r]=[])).push(i)}return t}(n),c=0;c<l.length;++c){var u=l[c];if(u){for(var d=null,h=i.hasGutter&&document.createDocumentFragment(),p=0;p<u.length;++p){var f=u[p],g=f.severity;g||(g="error"),v=g,d="error"==(m=d)?m:v,r.formatAnnotation&&(f=r.formatAnnotation(f)),i.hasGutter&&h.appendChild(a(f)),f.to&&i.marked.push(e.markText(f.from,f.to,{className:"CodeMirror-lint-mark-"+g,__annotation:f}))}i.hasGutter&&e.setGutterMarker(c,t,o(h,d,u.length>1,i.options.tooltips))}}var m,v;r.onUpdateLinting&&r.onUpdateLinting(n,l,e)}function u(e){var t=e.state.lint;t&&(clearTimeout(t.timeout),t.timeout=setTimeout(function(){l(e)},t.options.delay||500))}e.defineOption("lint",!1,function(n,i,o){if(o&&o!=e.Init&&(s(n),!1!==n.state.lint.options.lintOnChange&&n.off("change",u),e.off(n.getWrapperElement(),"mouseover",n.state.lint.onMouseOver),clearTimeout(n.state.lint.timeout),delete n.state.lint),i){for(var a=n.getOption("gutters"),c=!1,d=0;d<a.length;++d)a[d]==t&&(c=!0);var h=n.state.lint=new r(n,(p=i)instanceof Function?{getAnnotations:p}:(p&&!0!==p||(p={}),p),c);!1!==h.options.lintOnChange&&n.on("change",u),0!=h.options.tooltips&&"gutter"!=h.options.tooltips&&e.on(n.getWrapperElement(),"mouseover",h.onMouseOver),l(n)}var p}),e.defineExtension("performLint",function(){this.state.lint&&l(this)})}(n(50))},function(e,t,n){var i=n(179);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-shader-code-widget.invalid-input {\n  border: 1px solid red;\n}\n\n.neuroglancer-shader-code-widget.valid-input {\n  border: 1px solid green;\n}\n',""])},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,"/* BASICS */\n\n.CodeMirror {\n  /* Set height, width, borders, and global font properties here */\n  font-family: monospace;\n  height: 300px;\n  color: black;\n  direction: ltr;\n}\n\n/* PADDING */\n\n.CodeMirror-lines {\n  padding: 4px 0; /* Vertical padding around content */\n}\n.CodeMirror pre {\n  padding: 0 4px; /* Horizontal padding of content */\n}\n\n.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {\n  background-color: white; /* The little square between H and V scrollbars */\n}\n\n/* GUTTER */\n\n.CodeMirror-gutters {\n  border-right: 1px solid #ddd;\n  background-color: #f7f7f7;\n  white-space: nowrap;\n}\n.CodeMirror-linenumbers {}\n.CodeMirror-linenumber {\n  padding: 0 3px 0 5px;\n  min-width: 20px;\n  text-align: right;\n  color: #999;\n  white-space: nowrap;\n}\n\n.CodeMirror-guttermarker { color: black; }\n.CodeMirror-guttermarker-subtle { color: #999; }\n\n/* CURSOR */\n\n.CodeMirror-cursor {\n  border-left: 1px solid black;\n  border-right: none;\n  width: 0;\n}\n/* Shown when moving in bi-directional text */\n.CodeMirror div.CodeMirror-secondarycursor {\n  border-left: 1px solid silver;\n}\n.cm-fat-cursor .CodeMirror-cursor {\n  width: auto;\n  border: 0 !important;\n  background: #7e7;\n}\n.cm-fat-cursor div.CodeMirror-cursors {\n  z-index: 1;\n}\n.cm-fat-cursor-mark {\n  background-color: rgba(20, 255, 20, 0.5);\n  -webkit-animation: blink 1.06s steps(1) infinite;\n  -moz-animation: blink 1.06s steps(1) infinite;\n  animation: blink 1.06s steps(1) infinite;\n}\n.cm-animate-fat-cursor {\n  width: auto;\n  border: 0;\n  -webkit-animation: blink 1.06s steps(1) infinite;\n  -moz-animation: blink 1.06s steps(1) infinite;\n  animation: blink 1.06s steps(1) infinite;\n  background-color: #7e7;\n}\n@-moz-keyframes blink {\n  0% {}\n  50% { background-color: transparent; }\n  100% {}\n}\n@-webkit-keyframes blink {\n  0% {}\n  50% { background-color: transparent; }\n  100% {}\n}\n@keyframes blink {\n  0% {}\n  50% { background-color: transparent; }\n  100% {}\n}\n\n/* Can style cursor different in overwrite (non-insert) mode */\n.CodeMirror-overwrite .CodeMirror-cursor {}\n\n.cm-tab { display: inline-block; text-decoration: inherit; }\n\n.CodeMirror-rulers {\n  position: absolute;\n  left: 0; right: 0; top: -50px; bottom: -20px;\n  overflow: hidden;\n}\n.CodeMirror-ruler {\n  border-left: 1px solid #ccc;\n  top: 0; bottom: 0;\n  position: absolute;\n}\n\n/* DEFAULT THEME */\n\n.cm-s-default .cm-header {color: blue;}\n.cm-s-default .cm-quote {color: #090;}\n.cm-negative {color: #d44;}\n.cm-positive {color: #292;}\n.cm-header, .cm-strong {font-weight: bold;}\n.cm-em {font-style: italic;}\n.cm-link {text-decoration: underline;}\n.cm-strikethrough {text-decoration: line-through;}\n\n.cm-s-default .cm-keyword {color: #708;}\n.cm-s-default .cm-atom {color: #219;}\n.cm-s-default .cm-number {color: #164;}\n.cm-s-default .cm-def {color: #00f;}\n.cm-s-default .cm-variable,\n.cm-s-default .cm-punctuation,\n.cm-s-default .cm-property,\n.cm-s-default .cm-operator {}\n.cm-s-default .cm-variable-2 {color: #05a;}\n.cm-s-default .cm-variable-3, .cm-s-default .cm-type {color: #085;}\n.cm-s-default .cm-comment {color: #a50;}\n.cm-s-default .cm-string {color: #a11;}\n.cm-s-default .cm-string-2 {color: #f50;}\n.cm-s-default .cm-meta {color: #555;}\n.cm-s-default .cm-qualifier {color: #555;}\n.cm-s-default .cm-builtin {color: #30a;}\n.cm-s-default .cm-bracket {color: #997;}\n.cm-s-default .cm-tag {color: #170;}\n.cm-s-default .cm-attribute {color: #00c;}\n.cm-s-default .cm-hr {color: #999;}\n.cm-s-default .cm-link {color: #00c;}\n\n.cm-s-default .cm-error {color: #f00;}\n.cm-invalidchar {color: #f00;}\n\n.CodeMirror-composing { border-bottom: 2px solid; }\n\n/* Default styles for common addons */\n\ndiv.CodeMirror span.CodeMirror-matchingbracket {color: #0b0;}\ndiv.CodeMirror span.CodeMirror-nonmatchingbracket {color: #a22;}\n.CodeMirror-matchingtag { background: rgba(255, 150, 0, .3); }\n.CodeMirror-activeline-background {background: #e8f2ff;}\n\n/* STOP */\n\n/* The rest of this file contains styles related to the mechanics of\n   the editor. You probably shouldn't touch them. */\n\n.CodeMirror {\n  position: relative;\n  overflow: hidden;\n  background: white;\n}\n\n.CodeMirror-scroll {\n  overflow: scroll !important; /* Things will break if this is overridden */\n  /* 30px is the magic margin used to hide the element's real scrollbars */\n  /* See overflow: hidden in .CodeMirror */\n  margin-bottom: -30px; margin-right: -30px;\n  padding-bottom: 30px;\n  height: 100%;\n  outline: none; /* Prevent dragging from highlighting the element */\n  position: relative;\n}\n.CodeMirror-sizer {\n  position: relative;\n  border-right: 30px solid transparent;\n}\n\n/* The fake, visible scrollbars. Used to force redraw during scrolling\n   before actual scrolling happens, thus preventing shaking and\n   flickering artifacts. */\n.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {\n  position: absolute;\n  z-index: 6;\n  display: none;\n}\n.CodeMirror-vscrollbar {\n  right: 0; top: 0;\n  overflow-x: hidden;\n  overflow-y: scroll;\n}\n.CodeMirror-hscrollbar {\n  bottom: 0; left: 0;\n  overflow-y: hidden;\n  overflow-x: scroll;\n}\n.CodeMirror-scrollbar-filler {\n  right: 0; bottom: 0;\n}\n.CodeMirror-gutter-filler {\n  left: 0; bottom: 0;\n}\n\n.CodeMirror-gutters {\n  position: absolute; left: 0; top: 0;\n  min-height: 100%;\n  z-index: 3;\n}\n.CodeMirror-gutter {\n  white-space: normal;\n  height: 100%;\n  display: inline-block;\n  vertical-align: top;\n  margin-bottom: -30px;\n}\n.CodeMirror-gutter-wrapper {\n  position: absolute;\n  z-index: 4;\n  background: none !important;\n  border: none !important;\n}\n.CodeMirror-gutter-background {\n  position: absolute;\n  top: 0; bottom: 0;\n  z-index: 4;\n}\n.CodeMirror-gutter-elt {\n  position: absolute;\n  cursor: default;\n  z-index: 4;\n}\n.CodeMirror-gutter-wrapper ::selection { background-color: transparent }\n.CodeMirror-gutter-wrapper ::-moz-selection { background-color: transparent }\n\n.CodeMirror-lines {\n  cursor: text;\n  min-height: 1px; /* prevents collapsing before first draw */\n}\n.CodeMirror pre {\n  /* Reset some styles that the rest of the page might have set */\n  -moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0;\n  border-width: 0;\n  background: transparent;\n  font-family: inherit;\n  font-size: inherit;\n  margin: 0;\n  white-space: pre;\n  word-wrap: normal;\n  line-height: inherit;\n  color: inherit;\n  z-index: 2;\n  position: relative;\n  overflow: visible;\n  -webkit-tap-highlight-color: transparent;\n  -webkit-font-variant-ligatures: contextual;\n  font-variant-ligatures: contextual;\n}\n.CodeMirror-wrap pre {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  word-break: normal;\n}\n\n.CodeMirror-linebackground {\n  position: absolute;\n  left: 0; right: 0; top: 0; bottom: 0;\n  z-index: 0;\n}\n\n.CodeMirror-linewidget {\n  position: relative;\n  z-index: 2;\n  padding: 0.1px; /* Force widget margins to stay inside of the container */\n}\n\n.CodeMirror-widget {}\n\n.CodeMirror-rtl pre { direction: rtl; }\n\n.CodeMirror-code {\n  outline: none;\n}\n\n/* Force content-box sizing for the elements where we expect it */\n.CodeMirror-scroll,\n.CodeMirror-sizer,\n.CodeMirror-gutter,\n.CodeMirror-gutters,\n.CodeMirror-linenumber {\n  -moz-box-sizing: content-box;\n  box-sizing: content-box;\n}\n\n.CodeMirror-measure {\n  position: absolute;\n  width: 100%;\n  height: 0;\n  overflow: hidden;\n  visibility: hidden;\n}\n\n.CodeMirror-cursor {\n  position: absolute;\n  pointer-events: none;\n}\n.CodeMirror-measure pre { position: static; }\n\ndiv.CodeMirror-cursors {\n  visibility: hidden;\n  position: relative;\n  z-index: 3;\n}\ndiv.CodeMirror-dragcursors {\n  visibility: visible;\n}\n\n.CodeMirror-focused div.CodeMirror-cursors {\n  visibility: visible;\n}\n\n.CodeMirror-selected { background: #d9d9d9; }\n.CodeMirror-focused .CodeMirror-selected { background: #d7d4f0; }\n.CodeMirror-crosshair { cursor: crosshair; }\n.CodeMirror-line::selection, .CodeMirror-line > span::selection, .CodeMirror-line > span > span::selection { background: #d7d4f0; }\n.CodeMirror-line::-moz-selection, .CodeMirror-line > span::-moz-selection, .CodeMirror-line > span > span::-moz-selection { background: #d7d4f0; }\n\n.cm-searching {\n  background-color: #ffa;\n  background-color: rgba(255, 255, 0, .4);\n}\n\n/* Used to force a border model for a node */\n.cm-force-border { padding-right: .1px; }\n\n@media print {\n  /* Hide the cursor when printing */\n  .CodeMirror div.CodeMirror-cursors {\n    visibility: hidden;\n  }\n}\n\n/* See issue #2901 */\n.cm-tab-wrap-hack:after { content: ''; }\n\n/* Help users use markselection to safely style text background */\nspan.CodeMirror-selectedtext { background: none; }\n",""])},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/* The lint marker gutter */\n.CodeMirror-lint-markers {\n  width: 16px;\n}\n\n.CodeMirror-lint-tooltip {\n  background-color: #ffd;\n  border: 1px solid black;\n  border-radius: 4px 4px 4px 4px;\n  color: black;\n  font-family: monospace;\n  font-size: 10pt;\n  overflow: hidden;\n  padding: 2px 5px;\n  position: fixed;\n  white-space: pre;\n  white-space: pre-wrap;\n  z-index: 100;\n  max-width: 600px;\n  opacity: 0;\n  transition: opacity .4s;\n  -moz-transition: opacity .4s;\n  -webkit-transition: opacity .4s;\n  -o-transition: opacity .4s;\n  -ms-transition: opacity .4s;\n}\n\n.CodeMirror-lint-mark-error, .CodeMirror-lint-mark-warning {\n  background-position: left bottom;\n  background-repeat: repeat-x;\n}\n\n.CodeMirror-lint-mark-error {\n  background-image:\n  url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAYAAAC09K7GAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sJDw4cOCW1/KIAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAHElEQVQI12NggIL/DAz/GdA5/xkY/qPKMDAwAADLZwf5rvm+LQAAAABJRU5ErkJggg==")\n  ;\n}\n\n.CodeMirror-lint-mark-warning {\n  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAYAAAC09K7GAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sJFhQXEbhTg7YAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAMklEQVQI12NkgIIvJ3QXMjAwdDN+OaEbysDA4MPAwNDNwMCwiOHLCd1zX07o6kBVGQEAKBANtobskNMAAAAASUVORK5CYII=");\n}\n\n.CodeMirror-lint-marker-error, .CodeMirror-lint-marker-warning {\n  background-position: center center;\n  background-repeat: no-repeat;\n  cursor: pointer;\n  display: inline-block;\n  height: 16px;\n  width: 16px;\n  vertical-align: middle;\n  position: relative;\n}\n\n.CodeMirror-lint-message-error, .CodeMirror-lint-message-warning {\n  padding-left: 18px;\n  background-position: top left;\n  background-repeat: no-repeat;\n}\n\n.CodeMirror-lint-marker-error, .CodeMirror-lint-message-error {\n  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAHlBMVEW7AAC7AACxAAC7AAC7AAAAAAC4AAC5AAD///+7AAAUdclpAAAABnRSTlMXnORSiwCK0ZKSAAAATUlEQVR42mWPOQ7AQAgDuQLx/z8csYRmPRIFIwRGnosRrpamvkKi0FTIiMASR3hhKW+hAN6/tIWhu9PDWiTGNEkTtIOucA5Oyr9ckPgAWm0GPBog6v4AAAAASUVORK5CYII=");\n}\n\n.CodeMirror-lint-marker-warning, .CodeMirror-lint-message-warning {\n  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAANlBMVEX/uwDvrwD/uwD/uwD/uwD/uwD/uwD/uwD/uwD6twD/uwAAAADurwD2tQD7uAD+ugAAAAD/uwDhmeTRAAAADHRSTlMJ8mN1EYcbmiixgACm7WbuAAAAVklEQVR42n3PUQqAIBBFUU1LLc3u/jdbOJoW1P08DA9Gba8+YWJ6gNJoNYIBzAA2chBth5kLmG9YUoG0NHAUwFXwO9LuBQL1giCQb8gC9Oro2vp5rncCIY8L8uEx5ZkAAAAASUVORK5CYII=");\n}\n\n.CodeMirror-lint-marker-multiple {\n  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAMAAADzjKfhAAAACVBMVEUAAAAAAAC/v7914kyHAAAAAXRSTlMAQObYZgAAACNJREFUeNo1ioEJAAAIwmz/H90iFFSGJgFMe3gaLZ0od+9/AQZ0ADosbYraAAAAAElFTkSuQmCC");\n  background-repeat: no-repeat;\n  background-position: right bottom;\n  width: 100%; height: 100%;\n}\n',""])},function(e,t){e.exports=function(e){function t(e){for(var t={},n=e.split(" "),i=0;i<n.length;++i)t[n[i]]=!0;return t}e.defineMode("glsl",function(e,r){var s,o=e.indentUnit,a=r.keywords||t(n),l=r.builtins||t(i),c=r.blockKeywords||t("case do else for if switch while struct"),u=r.atoms||t("null"),d=r.hooks||{},h=r.multiLineStrings,p=/[+\-*&%=<>!?|\/]/;function f(e,t){var n,i=e.next();if(d[i]){var r=d[i](e,t);if(!1!==r)return r}if('"'==i||"'"==i)return t.tokenize=(n=i,function(e,t){for(var i,r=!1,s=!1;null!=(i=e.next());){if(i==n&&!r){s=!0;break}r=!r&&"\\"==i}return(s||!r&&!h)&&(t.tokenize=f),"string"}),t.tokenize(e,t);if(/[\[\]{}\(\),;\:\.]/.test(i))return s=i,"bracket";if(/\d/.test(i))return e.eatWhile(/[\w\.]/),"number";if("/"==i){if(e.eat("*"))return t.tokenize=g,g(e,t);if(e.eat("/"))return e.skipToEnd(),"comment"}if("#"==i)return e.eatWhile(/[\S]+/),e.eatWhile(/[\s]+/),e.eatWhile(/[\S]+/),e.eatWhile(/[\s]+/),"comment";if(p.test(i))return e.eatWhile(p),"operator";e.eatWhile(/[\w\$_]/);var o=e.current();return a.propertyIsEnumerable(o)?(c.propertyIsEnumerable(o)&&(s="newstatement"),"keyword"):l.propertyIsEnumerable(o)?"builtin":u.propertyIsEnumerable(o)?"atom":"word"}function g(e,t){for(var n,i=!1;n=e.next();){if("/"==n&&i){t.tokenize=f;break}i="*"==n}return"comment"}function m(e,t,n,i,r){this.indented=e,this.column=t,this.type=n,this.align=i,this.prev=r}function v(e,t,n){return e.context=new m(e.indented,t,n,null,e.context)}function b(e){var t=e.context.type;return")"!=t&&"]"!=t&&"}"!=t||(e.indented=e.context.indented),e.context=e.context.prev}return{startState:function(e){return{tokenize:null,context:new m((e||0)-o,0,"top",!1),indented:0,startOfLine:!0}},token:function(e,t){var n=t.context;if(e.sol()&&(null==n.align&&(n.align=!1),t.indented=e.indentation(),t.startOfLine=!0),e.eatSpace())return null;s=null;var i=(t.tokenize||f)(e,t);if("comment"==i||"meta"==i)return i;if(null==n.align&&(n.align=!0),";"!=s&&":"!=s||"statement"!=n.type)if("{"==s)v(t,e.column(),"}");else if("["==s)v(t,e.column(),"]");else if("("==s)v(t,e.column(),")");else if("}"==s){for(;"statement"==n.type;)n=b(t);for("}"==n.type&&(n=b(t));"statement"==n.type;)n=b(t)}else s==n.type?b(t):("}"==n.type||"top"==n.type||"statement"==n.type&&"newstatement"==s)&&v(t,e.column(),"statement");else b(t);return t.startOfLine=!1,i},indent:function(e,t){if(e.tokenize!=f&&null!=e.tokenize)return 0;var n=t&&t.charAt(0),i=e.context,r=n==i.type;return"statement"==i.type?i.indented+("{"==n?0:o):i.align?i.column+(r?0:1):i.indented+(r?0:o)},electricChars:"{}"}});var n="attribute const uniform varying break continue do for while if else in out inout float int void bool true false lowp mediump highp precision invariant discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler2D samplerCube struct gl_FragCoord gl_FragColor",i="radians degrees sin cos tan asin acos atan pow exp log exp2 log2 sqrt inversesqrt abs sign floor ceil fract mod min max clamp mix step smoothstep length distance dot cross normalize faceforward reflect refract matrixCompMult lessThan lessThanEqual greaterThan greaterThanEqual equal notEqual any all not dFdx dFdy fwidth texture2D texture2DProj texture2DLod texture2DProjLod textureCube textureCubeLod require export";function r(e,t){return!!t.startOfLine&&(e.skipToEnd(),"meta")}!function(){e.defineMIME("text/x-glsl",{name:"glsl",keywords:t(n),builtins:t(i),blockKeywords:t("case do else for if switch while struct"),atoms:t("null"),hooks:{"#":r}})}()}},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.image-dropdown .neuroglancer-shader-code-widget {\n  height: 6em;\n  /* width: 60ch; */\n  border: 1px solid transparent;\n}\n\n.image-dropdown-top-row {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n\n/* .image-dropdown-top-row .range-slider {\n  flex: 1;\n} */\n\n.image-layer-shader-overlay .neuroglancer-shader-code-widget {\n  width: 80vw;\n  height: 80vh;\n}\n\n.neuroglancer-segmentation-dropdown-skeleton-shader-header {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n',""])},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.maximize-button {\n  font-weight: bold;\n  margin-right: 2px;\n  margin-left: 2px;\n}\n',""])},function(e,t,n){var i=n(186);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2017 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.vec3-input-row {\n  display: flex;\n  flex-direction: row;\n  white-space: nowrap;\n  justify-content: space-between;\n}\n\n.vec3-input-label {\n    padding-right: 50px;\n}\n',""])},function(e,t,n){var i=n(188);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.segmentation-dropdown .add-segment label::before {\n  content: "+ ";\n  font-weight: bold;\n}\n\n.segmentation-dropdown {\n  display: flex;\n  flex-direction: column;\n}\n\n.segmentation-dropdown .add-segment {\n  margin-bottom: 5px;\n}\n\n.segmentation-dropdown .neuroglancer-shader-code-widget {\n  height: 6em;\n  width: 60ch;\n  border: 1px solid transparent;\n}\n\n.neuroglancer-segmentation-layer-skeleton-shader-overlay .neuroglancer-shader-code-widget {\n  width: 80vw;\n  height: 80vh;\n}\n',""])},function(e,t,n){var i=n(190);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.segment-set-widget button {\n  margin: 3px;\n}\n\n.segment-set-widget {\n  flex: 1;\n  overflow-y: auto;\n  height: 0px;\n  min-height: 0px;\n  flex-basis: 0px;\n}\n\n.segment-set-widget .item-container {\n  flex: 1;\n  display: flex;\n  flex-wrap: wrap;\n}\n',""])},function(e,t,n){var i=n(192);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-single-mesh-dropdown .neuroglancer-single-mesh-attribute-widget {\n  max-height: 6em;\n}\n\n.neuroglancer-single-mesh-dropdown .neuroglancer-shader-code-widget {\n  height: 6em;\n  width: 60ch;\n  border: 1px solid transparent;\n}\n\n.neuroglancer-single-mesh-dropdown-top-row {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n\n.neuroglancer-single-mesh-shader-overlay .neuroglancer-shader-code-widget {\n  width: 80vw;\n  height: 80vh;\n}\n\n.neuroglancer-single-mesh-attribute-widget {\n  word-wrap: break-word;\n  overflow-y: auto;\n  width: 60ch;\n}\n\n.neuroglancer-single-mesh-layer-shader-overlay .neuroglancer-single-mesh-attribute-widget {\n  max-height: 20vh;\n}\n\n.neuroglancer-single-mesh-attribute {\n  font-family: monospace;\n  display: flex;\n  flex-direction: row;\n}\n\n.neuroglancer-single-mesh-attribute-range {\n  white-space: nowrap;\n}\n\n.neuroglancer-single-mesh-attribute input {\n  font-family: monospace;\n  margin-left: 1ch;\n  flex: 1;\n}\n',""])},function(e,t,n){var i=n(194);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-annotation-point-list-dropdown {\n  display: flex;\n}\n',""])},function(e,t,n){var i=n(196);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nhtml, body {\n  margin: 0px;\n  padding: 0px;\n  overflow: hidden;\n  width: 100vw;\n  height: 100vh;\n  background-color: black;\n  color: white;\n}\n\nbody {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n}\n\n#neuroglancer-container {\n  width: 100vw;\n  flex: 1;\n}\n',""])},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2017 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* This pseudo-element is needed to make the content of the main button element centered.  See\n * https://stackoverflow.com/a/24685032.\n */\n.neuroglancer-button:before {\n  content: \'\';\n  display: inline-block;\n  vertical-align: middle;\n  height: 100%;\n}\n\n.neuroglancer-button {\n  display: inline-block;\n  color: black;\n  background-color: #ddd;\n  border-style: outset;\n  border-width: 1px;\n  font-family: sans-serif;\n  font-size: 10pt;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: middle;\n  cursor: default;\n}\n.neuroglancer-button:active {\n  border-style: inset;\n}\n',""])},function(e,t,n){var i=n(199);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2019 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-data-panel-layout-controls {\n  position: absolute;\n  top: 2px;\n  right: 2px;\n  display: flex;\n}\n\n.neuroglancer-data-panel-layout-controls > button {\n  display: flex;\n  margin: 2px;\n  border: 0px;\n  background-color: rgba(0, 0, 0, 0.5);\n  flex-direction: row;\n  align-self: center;\n  align-items: center;\n  justify-content: center;\n  border: 1px solid white;\n  font-size: 15px;\n  width: 18px;\n  height: 18px;\n  color: white;\n}\n\n.neuroglancer-data-panel-layout-controls > button > div {\n  display: inline-block;\n  text-align: center;\n  line-height: 12px;\n  width: 15px;\n  height: 15px;\n}\n\n.neuroglancer-data-panel-layout-controls > button:hover {\n  color: #6ff;\n}\n',""])},function(e,t,n){var i=n(201);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nlabel.perspective-panel-show-slice-views {\n  pointer-events: none;\n}\n\ninput.perspective-panel-show-slice-views {\n  pointer-events: all;\n}\n',""])},function(e,t,n){var i=n(203);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.describe-key-bindings {\n  overflow-x: hidden;\n}\n\n.describe-key-bindings-container {\n  overflow-y: scroll;\n  max-height: 80vh;\n  overflow-x: hidden;\n}\n\n.describe-key-bindings .definition-outer-container {\n  display: block;\n}\n\n.describe-key-bindings .definition-container {\n  display: inline-block;\n  white-space: nowrap;\n}\n\n.describe-key-bindings .dt {\n  font-family: monospace;\n  font-weight: bold;\n  display: inline-block;\n  width: 20ch;\n}\n\n.describe-key-bindings .dd {\n  display: inline-block;\n}\n',""])},function(e,t,n){var i=n(205);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.autocomplete-hint, .autocomplete-input {\n  outline: 0;\n  width: 100%;\n  border: 0;\n  margin: 0;\n  padding: 0;\n}\n\n.autocomplete-prompt, .autocomplete-hint, .autocomplete-input, .autocomplete-completion {\n  font-family: monospace;\n  font-size: medium;\n}\n\n.autocomplete {\n  display: flex;\n  flex-direction: row;\n}\n\n.autocomplete-prompt {\n  display: inline-block;\n}\n\n.autocomplete-prompt:not(:empty) {\n  margin-right: 1em;\n}\n\n.autocomplete-hint {\n  position: absolute;\n  top: 0;\n  left: 0;\n  border-color: transparent;\n  background-color: transparent;\n  box-shadow: none;\n  color: #aaa;\n}\n\n.autocomplete-dropdown-wrapper {\n  display: inline-block;\n  position: relative;\n  border: 0;\n  margin: 0;\n  padding: 0;\n  flex: 1;\n}\n\n.autocomplete-input {\n  position: relative;\n  top: 0;\n  left: 0;\n  /* vertical-align: top; */\n  color: #333;\n  background-color: transparent;\n}\n\n.autocomplete-input-wrapper {\n  display: flex;\n  position: relative;\n  outline: 0px;\n  border: 0;\n  margin: 0px;\n  padding: 0px;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  top: 0;\n}\n\n.autocomplete-dropdown {\n  position: absolute;\n  display: none;\n  outline: 0;\n  margin: 0;\n  padding: 0;\n  text-align: left;\n  cursor: default;\n  border-style: solid;\n  border-width: 1px;\n  border-color: #aaa;\n  overflow-y: scroll;\n  overflow-x: hidden;\n  white-space: pre;\n  background-color: white;\n}\n\n\n.autocomplete-completion {\n  \n}\n\n.autocomplete-completion:hover {\n  outline: 1px solid #ddd;\n}\n\n.autocomplete-completion-active {\n  background-color: #ccc;\n}\n\n.autocomplete-completion-with-description {\n  display: flex;\n  flex-direction: row;\n}\n\n.autocomplete-completion-description {\n  text-align: right;\n  display: inline;\n  flex: 1;\n  font-style: italic;\n  padding-left: 2em;\n}\n',""])},function(e,t,n){var i=n(207);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.add-layer-overlay {\n  width: 80vw;\n}\n\n.add-layer-name {\n  display: flex;\n  flex-direction: row;\n  font-family: monospace;\n}\n\n.add-layer-overlay .dialog-status {\n  width: 100%;\n  height: 4em;\n  overflow: auto;\n}\n\n.add-layer-overlay form {\n  display: flex;\n  flex-direction: row;\n  width: 100%;\n}\n\n.add-layer-overlay form {\n  margin-bottom: 5px;\n}\n\n.add-layer-overlay form button {\n  margin-left: 1em;\n}\n\n.add-layer-overlay form > label {\n  margin-right: 1em;\n  min-width: 4em;\n}\n\n.add-layer-name, .add-layer-source {\n  border: 1px solid black;\n  padding: 2px;\n  flex: 1;\n}\n\n.add-layer-name.invalid-input {\n  border: 1px solid red;\n}\n\n.add-layer-overlay .add-layer-name {\n  font-family: monospace;\n  flex: 1;\n  outline: 0;\n  margin: 0;\n}\n\n.add-layer-overlay .dialog-status.dialog-status-error {\n  color: red;\n}\n',""])},function(e,t,n){var i=n(209);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2017 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-position-widget {\n  display: inline-flex;\n  align-items: center;\n}\n\n.neuroglancer-position-widget-input-container {\n  position: relative;\n  display: inline-block;\n  outline: 0;\n  border: 0;\n  margin: 0;\n  padding: 0;\n}\n\n.neuroglancer-position-widget input {\n  font-family: monospace;\n  font-size: medium;\n  border: 0;\n  margin: 0;\n  top: 0;\n  left: 0;\n}\n\ninput.neuroglancer-position-widget-input {\n  color: white;\n  background-color: transparent;\n  position: relative;\n  vertical-align: top;\n}\n.neuroglancer-position-widget-input:focus {\n  outline: 0px;\n  }\n\n.neuroglancer-position-widget-hint {\n  position: absolute;\n  background-color: transparent;\n  border-color: transparent;\n  box-shadow: none;\n  color: #aaa;\n  pointer-events: none;\n}\n\n.neuroglancer-copy-button {\n  padding: 0px;\n  margin-right: 2px;\n  display: inline-block;\n  user-select: none;\n  color: black;\n  background-color: #ccc;\n}\n\n.neuroglancer-copy-button:focus {\n  outline: 0px;\n}\n\n.neuroglancer-voxel-size-widget {\n  vertical-align: center;\n  margin-right: 2px;\n}\n\n.neuroglancer-voxel-size-units {\n  font-family: monospace;\n  font-size: medium;\n  color: white;\n  margin-left: 3px;\n  outline: 0px;\n}\n.neuroglancer-voxel-size-units::after {\n  content: "";\n  \n}\n\n.neuroglancer-voxel-size-dimension {\n  font-family: monospace;\n  font-size: medium;\n  color: white;\n}\n\n.neuroglancer-voxel-size-dimension + .neuroglancer-voxel-size-dimension::before {\n  content: "";\n  color: #aaa;\n}\n\n.neuroglancer-mouse-position-widget {\n  vertical-align: center;\n  font-family: monospace;\n  font-size: medium;\n  color: orange;\n}\n',""])},function(e,t,n){var i=n(211);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-layer-panel {\n  width: 100%;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  background-color: black;\n  align-items: stretch;\n  margin-left: -5px;\n  margin-top: -1px;\n}\n\n.neuroglancer-layer-item {\n  position: relative;\n  display: flex;\n  align-items: center;\n  color: white;\n  cursor: pointer;\n  border-width: 1px;\n  border-style: solid;\n  border-color: #ccc;\n  font-family: sans-serif;\n  font-size: 10pt;\n  background-color: black;\n  padding: 1px;\n}\n\n.neuroglancer-layer-item, .neuroglancer-layer-add-button {\n  margin: 1px;\n  margin-left: 5px;\n}\n\n.neuroglancer-layer-item[layer-selected=true] {\n  border-color: #8c8;\n}\n\n.neuroglancer-layer-item[layer-selected=true]:hover {\n  border-color: #3c3;\n}\n\n\n.neuroglancer-layer-item:hover {\n  border-color: #daa520;\n}\n\n.clear-button::after {\n  content: "x";\n}\n\n.neuroglancer-layer-dropdown {\n  flex-direction: column;\n  background-color: black;\n  padding: 5px;\n  border: 1px solid white;\n  box-sizing: border-box;\n}\n\n.neuroglancer-layer-item-label {\n  display: inline-block;\n  background-color: #222;\n  padding-right: 3px;\n}\n\n.neuroglancer-layer-item-number {\n  display: inline-block;\n  background-color: /*#daa520*/ #9a7518;\n  font-weight: bold;\n  padding: 1px;\n}\n\n.neuroglancer-layer-item-value {\n  display: inline-block;\n  min-width: 10ch;\n  max-width: 50ch;\n  margin-left: 1ch;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipses;\n  text-align: center;\n}\n\n.neuroglancer-layer-item[layer-visible=false] .neuroglancer-layer-item-label {\n  text-decoration: line-through;\n}\n\n.neuroglancer-layer-item[layer-visible=false] .neuroglancer-layer-item-value {\n  display: none;\n}\n\n\n.neuroglancer-layer-add-button.neuroglancer-button {\n  font-weight: bold;\n}\n\n.neuroglancer-layer-item[layer-visible=false] {\n  color: #bbb;\n}\n\n.neuroglancer-layer-panel-drop-zone {\n  display: inline-block;\n  flex: 1;\n}\n',""])},function(e,t,n){var i=n(213);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2017 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-context-menu {\n  position: absolute;\n  z-index: 100;\n  border: 1px solid white;\n  background-color: black;\n  box-shadow: 5px 5px 2px 1px rgba(0, 0, 0, 0.5);\n  font-family: sans-serif;\n  font-size: 11pt;\n  padding: 5px;\n  color: white;\n  outline: 0px;\n}\n',""])},function(e,t,n){var i=n(215);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-panel {\n  flex: 1;\n}\n\n.neuroglancer-show-panel-borders .neuroglancer-panel {\n  border-style: solid;\n  border-color: black;\n  border-width: 2px;\n}\n\n.neuroglancer-panel:focus {\n  border-color: white;\n}\n\n.neuroglancer-layer-group-viewer {\n  outline: 0px;\n}\n\n.neuroglancer-layer-group-viewer-context-menu {\n  flex-direction: column;\n  align-items: stretch;\n}\n\n.neuroglancer-layer-group-viewer-context-menu label {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n}\n\n.neuroglancer-layer-group-viewer-context-menu select::before {\n  flex: 1;\n  content: " ";\n}\n\n.neuroglancer-layer-group-viewer-context-menu select {\n  margin-left: 5px;\n}\n',""])},function(e,t,n){var i=n(217);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2017 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n.neuroglancer-layout-split-drop-zone {\n  position: absolute;\n  z-index: 1000;\n}\n\n.neuroglancer-drag-over {\n  background-color: rgba(0, 0, 255, 0.5);\n}\n\n.neuroglancer-stack-layout-row > .neuroglancer-stack-layout-drop-placeholder {\n  padding-left: 4px;\n  padding-right: 4px;\n  width: 1px;\n}\n\n.neuroglancer-stack-layout-column > .neuroglancer-stack-layout-drop-placeholder {\n  padding-top: 4px;\n  padding-bottom: 4px;\n  height: 1px;\n}\n\n.neuroglancer-stack-layout-drop-placeholder {\n  background-clip: content-box;\n  background-color: #666;\n  z-index: 1;\n}\n\n.neuroglancer-stack-layout-drop-placeholder.neuroglancer-drag-over {\n  background-clip: border-box;\n  background-color: rgba(128, 128, 255, 0.5);\n}\n\n.neuroglancer-stack-layout-drop-placeholder:first-child, .neuroglancer-stack-layout-drop-placeholder:last-child {\n  display: none;\n}\n',""])},function(e,t,n){var i=n(219);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'\n/**\n * @license\n * Copyright 2019 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-resize-gutter-vertical {\n  height: 1px;\n  background-color: #333;\n  background-clip: content-box;\n  padding-top: 2px;\n  padding-bottom: 2px;\n  cursor: row-resize;\n}\n\n.neuroglancer-resize-gutter-horizontal {\n  width: 1px;\n  background-color: #333;\n  background-clip: content-box;\n  padding-right: 2px;\n  padding-left: 2px;\n  cursor: col-resize;\n}\n',""])},function(e,t,n){var i=n(221);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2018 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-layer-side-panel {\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n}\n\n.neuroglancer-managed-user-layer-info-panel {\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  flex: 1;\n}\n\n.neuroglancer-layer-info-panel-container {\n  flex: 1;\n}\n\n\n.neuroglancer-layer-side-panel-title {\n  display: flex;\n  flex-direction: row;\n  font-family: sans-serif;\n  font-size: 10pt;\n  background-color: #3c3;\n  padding: 2px;\n}\n\n.neuroglancer-layer-side-panel-title > input {\n  flex: 1;\n  background-color: transparent;\n  border: 0px;\n  color: white;\n  outline: 0px;\n}\n\n.neuroglancer-layer-side-panel-info-panel {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  font: 10pt sans-serif;\n}\n\n.neuroglancer-layer-side-panel-content-container {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n}\n',""])},function(e,t,n){var i=n(223);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2018 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-mouse-selection-tooltip {\n  color: black;\n  background-color: white;\n  padding: 2px;\n  border: 1px solid black;\n  font-family: sans-serif;\n  font-size: 10pt;\n}\n\n.neuroglancer-mouse-selection-tooltip-title {\n  font-weight: bold;\n}\n\n.neuroglancer-mouse-selection-tooltip-description {\n}\n\n',""])},function(e,t,n){var i=n(225);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2017 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-tooltip {\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n  max-width: 40%;\n}\n',""])},function(e,t,n){!function(e){"use strict";e.defineMode("javascript",function(t,n){var i,r,s=t.indentUnit,o=n.statementIndent,a=n.jsonld,l=n.json||a,c=n.typescript,u=n.wordCharacters||/[\w$\xa1-\uffff]/,d=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),n=e("keyword b"),i=e("keyword c"),r=e("keyword d"),s=e("operator"),o={type:"atom",style:"atom"};return{if:e("if"),while:t,with:t,else:n,do:n,try:n,finally:n,return:r,break:r,continue:r,new:e("new"),delete:i,void:i,throw:i,debugger:e("debugger"),var:e("var"),const:e("var"),let:e("var"),function:e("function"),catch:e("catch"),for:e("for"),switch:e("switch"),case:e("case"),default:e("default"),in:s,typeof:s,instanceof:s,true:o,false:o,null:o,undefined:o,NaN:o,Infinity:o,this:e("this"),class:e("class"),super:e("atom"),yield:i,export:e("export"),import:e("import"),extends:i,await:i}}(),h=/[+\-*&%=<>!?|~^@]/,p=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function f(e,t,n){return i=e,r=n,t}function g(e,t){var n,i=e.next();if('"'==i||"'"==i)return t.tokenize=(n=i,function(e,t){var i,r=!1;if(a&&"@"==e.peek()&&e.match(p))return t.tokenize=g,f("jsonld-keyword","meta");for(;null!=(i=e.next())&&(i!=n||r);)r=!r&&"\\"==i;return r||(t.tokenize=g),f("string","string")}),t.tokenize(e,t);if("."==i&&e.match(/^\d+(?:[eE][+\-]?\d+)?/))return f("number","number");if("."==i&&e.match(".."))return f("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(i))return f(i);if("="==i&&e.eat(">"))return f("=>","operator");if("0"==i&&e.match(/^(?:x[\da-f]+|o[0-7]+|b[01]+)n?/i))return f("number","number");if(/\d/.test(i))return e.match(/^\d*(?:n|(?:\.\d*)?(?:[eE][+\-]?\d+)?)?/),f("number","number");if("/"==i)return e.eat("*")?(t.tokenize=m,m(e,t)):e.eat("/")?(e.skipToEnd(),f("comment","comment")):qe(e,t,1)?(function(e){for(var t,n=!1,i=!1;null!=(t=e.next());){if(!n){if("/"==t&&!i)return;"["==t?i=!0:i&&"]"==t&&(i=!1)}n=!n&&"\\"==t}}(e),e.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),f("regexp","string-2")):(e.eat("="),f("operator","operator",e.current()));if("`"==i)return t.tokenize=v,v(e,t);if("#"==i)return e.skipToEnd(),f("error","error");if(h.test(i))return">"==i&&t.lexical&&">"==t.lexical.type||(e.eat("=")?"!"!=i&&"="!=i||e.eat("="):/[<>*+\-]/.test(i)&&(e.eat(i),">"==i&&e.eat(i))),f("operator","operator",e.current());if(u.test(i)){e.eatWhile(u);var r=e.current();if("."!=t.lastType){if(d.propertyIsEnumerable(r)){var s=d[r];return f(s.type,s.style,r)}if("async"==r&&e.match(/^(\s|\/\*.*?\*\/)*[\[\(\w]/,!1))return f("async","keyword",r)}return f("variable","variable",r)}}function m(e,t){for(var n,i=!1;n=e.next();){if("/"==n&&i){t.tokenize=g;break}i="*"==n}return f("comment","comment")}function v(e,t){for(var n,i=!1;null!=(n=e.next());){if(!i&&("`"==n||"$"==n&&e.eat("{"))){t.tokenize=g;break}i=!i&&"\\"==n}return f("quasi","string-2",e.current())}var b="([{}])";function y(e,t){t.fatArrowAt&&(t.fatArrowAt=null);var n=e.string.indexOf("=>",e.start);if(!(n<0)){if(c){var i=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(e.string.slice(e.start,n));i&&(n=i.index)}for(var r=0,s=!1,o=n-1;o>=0;--o){var a=e.string.charAt(o),l=b.indexOf(a);if(l>=0&&l<3){if(!r){++o;break}if(0==--r){"("==a&&(s=!0);break}}else if(l>=3&&l<6)++r;else if(u.test(a))s=!0;else{if(/["'\/]/.test(a))return;if(s&&!r){++o;break}}}s&&!r&&(t.fatArrowAt=o)}}var w={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,"jsonld-keyword":!0};function x(e,t,n,i,r,s){this.indented=e,this.column=t,this.type=n,this.prev=r,this.info=s,null!=i&&(this.align=i)}function S(e,t){for(var n=e.localVars;n;n=n.next)if(n.name==t)return!0;for(var i=e.context;i;i=i.prev)for(var n=i.vars;n;n=n.next)if(n.name==t)return!0}var C={state:null,column:null,marked:null,cc:null};function O(){for(var e=arguments.length-1;e>=0;e--)C.cc.push(arguments[e])}function L(){return O.apply(null,arguments),!0}function T(e,t){for(var n=t;n;n=n.next)if(n.name==e)return!0;return!1}function k(e){var t=C.state;if(C.marked="def",t.context)if("var"==t.lexical.info&&t.context&&t.context.block){var i=function e(t,n){if(n){if(n.block){var i=e(t,n.prev);return i?i==n.prev?n:new A(i,n.vars,!0):null}return T(t,n.vars)?n:new A(n.prev,new M(t,n.vars),!1)}return null}(e,t.context);if(null!=i)return void(t.context=i)}else if(!T(e,t.localVars))return void(t.localVars=new M(e,t.localVars));n.globalVars&&!T(e,t.globalVars)&&(t.globalVars=new M(e,t.globalVars))}function E(e){return"public"==e||"private"==e||"protected"==e||"abstract"==e||"readonly"==e}function A(e,t,n){this.prev=e,this.vars=t,this.block=n}function M(e,t){this.name=e,this.next=t}var I=new M("this",new M("arguments",null));function N(){C.state.context=new A(C.state.context,C.state.localVars,!1),C.state.localVars=I}function D(){C.state.context=new A(C.state.context,C.state.localVars,!0),C.state.localVars=null}function R(){C.state.localVars=C.state.context.vars,C.state.context=C.state.context.prev}function P(e,t){var n=function(){var n=C.state,i=n.indented;if("stat"==n.lexical.type)i=n.lexical.indented;else for(var r=n.lexical;r&&")"==r.type&&r.align;r=r.prev)i=r.indented;n.lexical=new x(i,C.stream.column(),e,null,n.lexical,t)};return n.lex=!0,n}function j(){var e=C.state;e.lexical.prev&&(")"==e.lexical.type&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function V(e){return function t(n){return n==e?L():";"==e||"}"==n||")"==n||"]"==n?O():L(t)}}function _(e,t){return"var"==e?L(P("vardef",t),be,V(";"),j):"keyword a"==e?L(P("form"),B,_,j):"keyword b"==e?L(P("form"),_,j):"keyword d"==e?C.stream.match(/^\s*$/,!1)?L():L(P("stat"),W,V(";"),j):"debugger"==e?L(V(";")):"{"==e?L(P("}"),D,oe,j,R):";"==e?L():"if"==e?("else"==C.state.lexical.info&&C.state.cc[C.state.cc.length-1]==j&&C.state.cc.pop()(),L(P("form"),B,_,j,Oe)):"function"==e?L(Ee):"for"==e?L(P("form"),Le,_,j):"class"==e||c&&"interface"==t?(C.marked="keyword",L(P("form","class"==e?e:t),De,j)):"variable"==e?c&&"declare"==t?(C.marked="keyword",L(_)):c&&("module"==t||"enum"==t||"type"==t)&&C.stream.match(/^\s*\w/,!1)?(C.marked="keyword","enum"==t?L($e):"type"==t?L(Me,V("operator"),ue,V(";")):L(P("form"),ye,V("{"),P("}"),oe,j,j)):c&&"namespace"==t?(C.marked="keyword",L(P("form"),F,_,j)):c&&"abstract"==t?(C.marked="keyword",L(_)):L(P("stat"),Z):"switch"==e?L(P("form"),B,V("{"),P("}","switch"),D,oe,j,j,R):"case"==e?L(F,V(":")):"default"==e?L(V(":")):"catch"==e?L(P("form"),N,U,_,j,R):"export"==e?L(P("stat"),Ve,j):"import"==e?L(P("stat"),Ue,j):"async"==e?L(_):"@"==t?L(F,_):O(P("stat"),F,V(";"),j)}function U(e){if("("==e)return L(Ie,V(")"))}function F(e,t){return G(e,t,!1)}function z(e,t){return G(e,t,!0)}function B(e){return"("!=e?O():L(P(")"),F,V(")"),j)}function G(e,t,n){if(C.state.fatArrowAt==C.stream.start){var i=n?X:J;if("("==e)return L(N,P(")"),re(Ie,")"),j,V("=>"),i,R);if("variable"==e)return O(N,ye,V("=>"),i,R)}var r=n?H:$;return w.hasOwnProperty(e)?L(r):"function"==e?L(Ee,r):"class"==e||c&&"interface"==t?(C.marked="keyword",L(P("form"),Ne,j)):"keyword c"==e||"async"==e?L(n?z:F):"("==e?L(P(")"),W,V(")"),j,r):"operator"==e||"spread"==e?L(n?z:F):"["==e?L(P("]"),We,j,r):"{"==e?se(te,"}",null,r):"quasi"==e?O(q,r):"new"==e?L(function(e){return function(t){return"."==t?L(e?Q:K):"variable"==t&&c?L(ge,e?H:$):O(e?z:F)}}(n)):"import"==e?L(F):L()}function W(e){return e.match(/[;\}\)\],]/)?O():O(F)}function $(e,t){return","==e?L(F):H(e,t,!1)}function H(e,t,n){var i=0==n?$:H,r=0==n?F:z;return"=>"==e?L(N,n?X:J,R):"operator"==e?/\+\+|--/.test(t)||c&&"!"==t?L(i):c&&"<"==t&&C.stream.match(/^([^>]|<.*?>)*>\s*\(/,!1)?L(P(">"),re(ue,">"),j,i):"?"==t?L(F,V(":"),r):L(r):"quasi"==e?O(q,i):";"!=e?"("==e?se(z,")","call",i):"."==e?L(ee,i):"["==e?L(P("]"),W,V("]"),j,i):c&&"as"==t?(C.marked="keyword",L(ue,i)):"regexp"==e?(C.state.lastType=C.marked="operator",C.stream.backUp(C.stream.pos-C.stream.start-1),L(r)):void 0:void 0}function q(e,t){return"quasi"!=e?O():"${"!=t.slice(t.length-2)?L(q):L(F,Y)}function Y(e){if("}"==e)return C.marked="string-2",C.state.tokenize=v,L(q)}function J(e){return y(C.stream,C.state),O("{"==e?_:F)}function X(e){return y(C.stream,C.state),O("{"==e?_:z)}function K(e,t){if("target"==t)return C.marked="keyword",L($)}function Q(e,t){if("target"==t)return C.marked="keyword",L(H)}function Z(e){return":"==e?L(j,_):O($,V(";"),j)}function ee(e){if("variable"==e)return C.marked="property",L()}function te(e,t){return"async"==e?(C.marked="property",L(te)):"variable"==e||"keyword"==C.style?(C.marked="property","get"==t||"set"==t?L(ne):(c&&C.state.fatArrowAt==C.stream.start&&(n=C.stream.match(/^\s*:\s*/,!1))&&(C.state.fatArrowAt=C.stream.pos+n[0].length),L(ie))):"number"==e||"string"==e?(C.marked=a?"property":C.style+" property",L(ie)):"jsonld-keyword"==e?L(ie):c&&E(t)?(C.marked="keyword",L(te)):"["==e?L(F,ae,V("]"),ie):"spread"==e?L(z,ie):"*"==t?(C.marked="keyword",L(te)):":"==e?O(ie):void 0;var n}function ne(e){return"variable"!=e?O(ie):(C.marked="property",L(Ee))}function ie(e){return":"==e?L(z):"("==e?O(Ee):void 0}function re(e,t,n){function i(r,s){if(n?n.indexOf(r)>-1:","==r){var o=C.state.lexical;return"call"==o.info&&(o.pos=(o.pos||0)+1),L(function(n,i){return n==t||i==t?O():O(e)},i)}return r==t||s==t?L():n&&n.indexOf(";")>-1?O(e):L(V(t))}return function(n,r){return n==t||r==t?L():O(e,i)}}function se(e,t,n){for(var i=3;i<arguments.length;i++)C.cc.push(arguments[i]);return L(P(t,n),re(e,t),j)}function oe(e){return"}"==e?L():O(_,oe)}function ae(e,t){if(c){if(":"==e||"in"==t)return L(ue);if("?"==t)return L(ae)}}function le(e){if(c&&":"==e)return C.stream.match(/^\s*\w+\s+is\b/,!1)?L(F,ce,ue):L(ue)}function ce(e,t){if("is"==t)return C.marked="keyword",L()}function ue(e,t){return"keyof"==t||"typeof"==t||"infer"==t?(C.marked="keyword",L("typeof"==t?z:ue)):"variable"==e||"void"==t?(C.marked="type",L(fe)):"|"==t||"&"==t?L(ue):"string"==e||"number"==e||"atom"==e?L(fe):"["==e?L(P("]"),re(ue,"]",","),j,fe):"{"==e?L(P("}"),re(he,"}",",;"),j,fe):"("==e?L(re(pe,")"),de,fe):"<"==e?L(re(ue,">"),ue):void 0}function de(e){if("=>"==e)return L(ue)}function he(e,t){return"variable"==e||"keyword"==C.style?(C.marked="property",L(he)):"?"==t||"number"==e||"string"==e?L(he):":"==e?L(ue):"["==e?L(V("variable"),ae,V("]"),he):"("==e?O(Ae,he):void 0}function pe(e,t){return"variable"==e&&C.stream.match(/^\s*[?:]/,!1)||"?"==t?L(pe):":"==e?L(ue):"spread"==e?L(pe):O(ue)}function fe(e,t){return"<"==t?L(P(">"),re(ue,">"),j,fe):"|"==t||"."==e||"&"==t?L(ue):"["==e?L(ue,V("]"),fe):"extends"==t||"implements"==t?(C.marked="keyword",L(ue)):"?"==t?L(ue,V(":"),ue):void 0}function ge(e,t){if("<"==t)return L(P(">"),re(ue,">"),j,fe)}function me(){return O(ue,ve)}function ve(e,t){if("="==t)return L(ue)}function be(e,t){return"enum"==t?(C.marked="keyword",L($e)):O(ye,ae,Se,Ce)}function ye(e,t){return c&&E(t)?(C.marked="keyword",L(ye)):"variable"==e?(k(t),L()):"spread"==e?L(ye):"["==e?se(xe,"]"):"{"==e?se(we,"}"):void 0}function we(e,t){return"variable"!=e||C.stream.match(/^\s*:/,!1)?("variable"==e&&(C.marked="property"),"spread"==e?L(ye):"}"==e?O():"["==e?L(F,V("]"),V(":"),we):L(V(":"),ye,Se)):(k(t),L(Se))}function xe(){return O(ye,Se)}function Se(e,t){if("="==t)return L(z)}function Ce(e){if(","==e)return L(be)}function Oe(e,t){if("keyword b"==e&&"else"==t)return L(P("form","else"),_,j)}function Le(e,t){return"await"==t?L(Le):"("==e?L(P(")"),Te,j):void 0}function Te(e){return"var"==e?L(be,ke):"variable"==e?L(ke):O(ke)}function ke(e,t){return")"==e?L():";"==e?L(ke):"in"==t||"of"==t?(C.marked="keyword",L(F,ke)):O(F,ke)}function Ee(e,t){return"*"==t?(C.marked="keyword",L(Ee)):"variable"==e?(k(t),L(Ee)):"("==e?L(N,P(")"),re(Ie,")"),j,le,_,R):c&&"<"==t?L(P(">"),re(me,">"),j,Ee):void 0}function Ae(e,t){return"*"==t?(C.marked="keyword",L(Ae)):"variable"==e?(k(t),L(Ae)):"("==e?L(N,P(")"),re(Ie,")"),j,le,R):c&&"<"==t?L(P(">"),re(me,">"),j,Ae):void 0}function Me(e,t){return"keyword"==e||"variable"==e?(C.marked="type",L(Me)):"<"==t?L(P(">"),re(me,">"),j):void 0}function Ie(e,t){return"@"==t&&L(F,Ie),"spread"==e?L(Ie):c&&E(t)?(C.marked="keyword",L(Ie)):c&&"this"==e?L(ae,Se):O(ye,ae,Se)}function Ne(e,t){return"variable"==e?De(e,t):Re(e,t)}function De(e,t){if("variable"==e)return k(t),L(Re)}function Re(e,t){return"<"==t?L(P(">"),re(me,">"),j,Re):"extends"==t||"implements"==t||c&&","==e?("implements"==t&&(C.marked="keyword"),L(c?ue:F,Re)):"{"==e?L(P("}"),Pe,j):void 0}function Pe(e,t){return"async"==e||"variable"==e&&("static"==t||"get"==t||"set"==t||c&&E(t))&&C.stream.match(/^\s+[\w$\xa1-\uffff]/,!1)?(C.marked="keyword",L(Pe)):"variable"==e||"keyword"==C.style?(C.marked="property",L(c?je:Ee,Pe)):"number"==e||"string"==e?L(c?je:Ee,Pe):"["==e?L(F,ae,V("]"),c?je:Ee,Pe):"*"==t?(C.marked="keyword",L(Pe)):c&&"("==e?O(Ae,Pe):";"==e||","==e?L(Pe):"}"==e?L():"@"==t?L(F,Pe):void 0}function je(e,t){if("?"==t)return L(je);if(":"==e)return L(ue,Se);if("="==t)return L(z);var n=C.state.lexical.prev,i=n&&"interface"==n.info;return O(i?Ae:Ee)}function Ve(e,t){return"*"==t?(C.marked="keyword",L(Ge,V(";"))):"default"==t?(C.marked="keyword",L(F,V(";"))):"{"==e?L(re(_e,"}"),Ge,V(";")):O(_)}function _e(e,t){return"as"==t?(C.marked="keyword",L(V("variable"))):"variable"==e?O(z,_e):void 0}function Ue(e){return"string"==e?L():"("==e?O(F):O(Fe,ze,Ge)}function Fe(e,t){return"{"==e?se(Fe,"}"):("variable"==e&&k(t),"*"==t&&(C.marked="keyword"),L(Be))}function ze(e){if(","==e)return L(Fe,ze)}function Be(e,t){if("as"==t)return C.marked="keyword",L(Fe)}function Ge(e,t){if("from"==t)return C.marked="keyword",L(F)}function We(e){return"]"==e?L():O(re(z,"]"))}function $e(){return O(P("form"),ye,V("{"),P("}"),re(He,"}"),j,j)}function He(){return O(ye,Se)}function qe(e,t,n){return t.tokenize==g&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(t.lastType)||"quasi"==t.lastType&&/\{\s*$/.test(e.string.slice(0,e.pos-(n||0)))}return R.lex=!0,j.lex=!0,{startState:function(e){var t={tokenize:g,lastType:"sof",cc:[],lexical:new x((e||0)-s,0,"block",!1),localVars:n.localVars,context:n.localVars&&new A(null,null,!1),indented:e||0};return n.globalVars&&"object"==typeof n.globalVars&&(t.globalVars=n.globalVars),t},token:function(e,t){if(e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation(),y(e,t)),t.tokenize!=m&&e.eatSpace())return null;var n=t.tokenize(e,t);return"comment"==i?n:(t.lastType="operator"!=i||"++"!=r&&"--"!=r?i:"incdec",function(e,t,n,i,r){var s=e.cc;for(C.state=e,C.stream=r,C.marked=null,C.cc=s,C.style=t,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);;){var o=s.length?s.pop():l?F:_;if(o(n,i)){for(;s.length&&s[s.length-1].lex;)s.pop()();return C.marked?C.marked:"variable"==n&&S(e,i)?"variable-2":t}}}(t,n,i,r,e))},indent:function(t,i){if(t.tokenize==m)return e.Pass;if(t.tokenize!=g)return 0;var r,a=i&&i.charAt(0),l=t.lexical;if(!/^\s*else\b/.test(i))for(var c=t.cc.length-1;c>=0;--c){var u=t.cc[c];if(u==j)l=l.prev;else if(u!=Oe)break}for(;("stat"==l.type||"form"==l.type)&&("}"==a||(r=t.cc[t.cc.length-1])&&(r==$||r==H)&&!/^[,\.=+\-*:?[\(]/.test(i));)l=l.prev;o&&")"==l.type&&"stat"==l.prev.type&&(l=l.prev);var d=l.type,p=a==d;return"vardef"==d?l.indented+("operator"==t.lastType||","==t.lastType?l.info.length+1:0):"form"==d&&"{"==a?l.indented:"form"==d?l.indented+s:"stat"==d?l.indented+(function(e,t){return"operator"==e.lastType||","==e.lastType||h.test(t.charAt(0))||/[,.]/.test(t.charAt(0))}(t,i)?o||s:0):"switch"!=l.info||p||0==n.doubleIndentSwitch?l.align?l.column+(p?0:1):l.indented+(p?0:s):l.indented+(/^(?:case|default)\b/.test(i)?s:2*s)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:l?null:"/*",blockCommentEnd:l?null:"*/",blockCommentContinue:l?null:" * ",lineComment:l?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:l?"json":"javascript",jsonldMode:a,jsonMode:l,expressionAllowed:qe,skipExpression:function(e){var t=e.cc[e.cc.length-1];t!=F&&t!=z||e.cc.pop()}}}),e.registerHelper("wordChars","javascript",/[\w$]/),e.defineMIME("text/javascript","javascript"),e.defineMIME("text/ecmascript","javascript"),e.defineMIME("application/javascript","javascript"),e.defineMIME("application/x-javascript","javascript"),e.defineMIME("application/ecmascript","javascript"),e.defineMIME("application/json",{name:"javascript",json:!0}),e.defineMIME("application/x-json",{name:"javascript",json:!0}),e.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),e.defineMIME("text/typescript",{name:"javascript",typescript:!0}),e.defineMIME("application/typescript",{name:"javascript",typescript:!0})}(n(50))},function(e,t,n){!function(e){"use strict";e.defineOption("foldGutter",!1,function(t,i,r){var s;r&&r!=e.Init&&(t.clearGutter(t.state.foldGutter.options.gutter),t.state.foldGutter=null,t.off("gutterClick",a),t.off("change",l),t.off("viewportChange",c),t.off("fold",u),t.off("unfold",u),t.off("swapDoc",l)),i&&(t.state.foldGutter=new n((!0===(s=i)&&(s={}),null==s.gutter&&(s.gutter="CodeMirror-foldgutter"),null==s.indicatorOpen&&(s.indicatorOpen="CodeMirror-foldgutter-open"),null==s.indicatorFolded&&(s.indicatorFolded="CodeMirror-foldgutter-folded"),s)),o(t),t.on("gutterClick",a),t.on("change",l),t.on("viewportChange",c),t.on("fold",u),t.on("unfold",u),t.on("swapDoc",l))});var t=e.Pos;function n(e){this.options=e,this.from=this.to=0}function i(e,n){for(var i=e.findMarks(t(n,0),t(n+1,0)),r=0;r<i.length;++r)if(i[r].__isFold&&i[r].find().from.line==n)return i[r]}function r(e){if("string"==typeof e){var t=document.createElement("div");return t.className=e+" CodeMirror-guttermarker-subtle",t}return e.cloneNode(!0)}function s(e,n,s){var o=e.state.foldGutter.options,a=n,l=e.foldOption(o,"minFoldSize"),c=e.foldOption(o,"rangeFinder");e.eachLine(n,s,function(n){var s=null;if(i(e,a))s=r(o.indicatorFolded);else{var u=t(a,0),d=c&&c(e,u);d&&d.to.line-d.from.line>=l&&(s=r(o.indicatorOpen))}e.setGutterMarker(n,o.gutter,s),++a})}function o(e){var t=e.getViewport(),n=e.state.foldGutter;n&&(e.operation(function(){s(e,t.from,t.to)}),n.from=t.from,n.to=t.to)}function a(e,n,r){var s=e.state.foldGutter;if(s){var o=s.options;if(r==o.gutter){var a=i(e,n);a?a.clear():e.foldCode(t(n,0),o.rangeFinder)}}}function l(e){var t=e.state.foldGutter;if(t){var n=t.options;t.from=t.to=0,clearTimeout(t.changeUpdate),t.changeUpdate=setTimeout(function(){o(e)},n.foldOnChangeTimeSpan||600)}}function c(e){var t=e.state.foldGutter;if(t){var n=t.options;clearTimeout(t.changeUpdate),t.changeUpdate=setTimeout(function(){var n=e.getViewport();t.from==t.to||n.from-t.to>20||t.from-n.to>20?o(e):e.operation(function(){n.from<t.from&&(s(e,n.from,t.from),t.from=n.from),n.to>t.to&&(s(e,t.to,n.to),t.to=n.to)})},n.updateViewportTimeSpan||400)}}function u(e,t){var n=e.state.foldGutter;if(n){var i=t.line;i>=n.from&&i<n.to&&s(e,i,i+1)}}}(n(50),n(130))},function(e,t,n){!function(e){"use strict";e.registerHelper("fold","brace",function(t,n){var i,r=n.line,s=t.getLine(r);function o(o){for(var a=n.ch,l=0;;){var c=a<=0?-1:s.lastIndexOf(o,a-1);if(-1!=c){if(1==l&&c<n.ch)break;if(i=t.getTokenTypeAt(e.Pos(r,c+1)),!/^(comment|string)/.test(i))return c+1;a=c-1}else{if(1==l)break;l=1,a=s.length}}}var a="{",l="}",c=o("{");if(null==c&&(a="[",l="]",c=o("[")),null!=c){var u,d,h=1,p=t.lastLine();e:for(var f=r;f<=p;++f)for(var g=t.getLine(f),m=f==r?c:0;;){var v=g.indexOf(a,m),b=g.indexOf(l,m);if(v<0&&(v=g.length),b<0&&(b=g.length),(m=Math.min(v,b))==g.length)break;if(t.getTokenTypeAt(e.Pos(f,m+1))==i)if(m==v)++h;else if(!--h){u=f,d=m;break e}++m}if(null!=u&&r!=u)return{from:e.Pos(r,c),to:e.Pos(u,d)}}}),e.registerHelper("fold","import",function(t,n){function i(n){if(n<t.firstLine()||n>t.lastLine())return null;var i=t.getTokenAt(e.Pos(n,1));if(/\S/.test(i.string)||(i=t.getTokenAt(e.Pos(n,i.end+1))),"keyword"!=i.type||"import"!=i.string)return null;for(var r=n,s=Math.min(t.lastLine(),n+10);r<=s;++r){var o=t.getLine(r),a=o.indexOf(";");if(-1!=a)return{startCh:i.end,end:e.Pos(r,a)}}}var r,s=n.line,o=i(s);if(!o||i(s-1)||(r=i(s-2))&&r.end.line==s-1)return null;for(var a=o.end;;){var l=i(a.line+1);if(null==l)break;a=l.end}return{from:t.clipPos(e.Pos(s,o.startCh+1)),to:a}}),e.registerHelper("fold","include",function(t,n){function i(n){if(n<t.firstLine()||n>t.lastLine())return null;var i=t.getTokenAt(e.Pos(n,1));return/\S/.test(i.string)||(i=t.getTokenAt(e.Pos(n,i.end+1))),"meta"==i.type&&"#include"==i.string.slice(0,8)?i.start+8:void 0}var r=n.line,s=i(r);if(null==s||null!=i(r-1))return null;for(var o=r;;){var a=i(o+1);if(null==a)break;++o}return{from:e.Pos(r,s+1),to:t.clipPos(e.Pos(o))}})}(n(50))},function(e,t,n){var i=n(230);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'.CodeMirror-foldmarker {\n  color: blue;\n  text-shadow: #b9f 1px 1px 2px, #b9f -1px -1px 2px, #b9f 1px -1px 2px, #b9f -1px 1px 2px;\n  font-family: arial;\n  line-height: .3;\n  cursor: pointer;\n}\n.CodeMirror-foldgutter {\n  width: .7em;\n}\n.CodeMirror-foldgutter-open,\n.CodeMirror-foldgutter-folded {\n  cursor: pointer;\n}\n.CodeMirror-foldgutter-open:after {\n  content: "\\25BE";\n}\n.CodeMirror-foldgutter-folded:after {\n  content: "\\25B8";\n}\n',""])},function(e,t,n){var i=n(232);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2018 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n.neuroglancer-state-editor {\n  width: 80%;\n}\n',""])},function(e,t,n){var i=n(234);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2019 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-statistics-panel {\n  overflow-x: auto;\n  overflow-y: auto;\n}\n\n.neuroglancer-statistics-panel > table > thead td {\n  position: sticky;\n  top: 0px;\n  zIndex: 2;\n  background-color: black;\n}\n\n.neuroglancer-statistics-panel > table > tbody tr:hover {\n  background-color: #333;\n}\n',""])},function(e,t,n){var i=n(236);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2018 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-annotation-tool-status-widget {\n  color: #3c3;\n  font: 10pt sans-serif;\n}\n',""])},function(e,t,n){var i=n(238);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(16)(i,r);i.locals&&(e.exports=i.locals)},function(e,t,n){(e.exports=n(15)(!1)).push([e.i,'/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.neuroglancer-viewer {\n  outline: 0px;\n}\n\n.neuroglancer-viewer-context-menu > label {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n}\n\n.neuroglancer-viewer-context-menu > label > input::before {\n  flex: 1;\n  content: " ";\n}\n\n.neuroglancer-viewer-context-menu > label > input {\n  margin-left: 5px;\n  width: 11ch;\n}\n\n.neuroglancer-viewer-context-menu-limit-widget > input {\n  width: 11ch;\n}\n\n.neuroglancer-viewer-top-row {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  background-color: #222;\n  margin-bottom: 3px;\n  padding-right: 2px;\n}\n',""])},function(e,t,n){"use strict";n.r(t);var i=n(22),r=n(2);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function s(e){const t=window.getSelection();if(null!==t&&!t.isCollapsed)return!0;const{tagName:n}=e.target;return"TEXTAREA"===n||"INPUT"===n}var o=n(0),a=n(48);function l(e){e.registerEventListener(document,"paste",t=>{if(s(t))return;const{clipboardData:n}=t;if(null!==n){const t=function(e){const t=e.match(/^[\[\]{}()\s,]*(\d+(?:\.\d+)?)[,\s]+(\d+(?:\.\d+)?)[,\s]+(\d+(?:\.\d+)?)[\[\]{}()\s,]*$/);if(null!==t)return o.u.fromValues(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]))}(n.getData("text/plain"));void 0!==t&&e.navigationState.position.setVoxelCoordinates(t)}t.preventDefault()})}var c=n(7);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let u,d,h,p;function f(){return void 0===d&&(d=c.a.fromObject({arrowleft:"x-",arrowright:"x+",arrowup:"y-",arrowdown:"y+",comma:"z-",period:"z+",keyz:"snap","control+equal":"zoom-in","control+shift+equal":"zoom-in","control+minus":"zoom-out",keyr:"rotate-relative-z-",keye:"rotate-relative-z+","shift+arrowdown":"rotate-relative-x-","shift+arrowup":"rotate-relative-x+","shift+arrowleft":"rotate-relative-y-","shift+arrowright":"rotate-relative-y+","at:control+wheel":{action:"zoom-via-wheel",preventDefault:!0},"at:wheel":{action:"z+1-via-wheel",preventDefault:!0},"at:shift+wheel":{action:"z+10-via-wheel",preventDefault:!0},"at:dblclick0":"select","at:control+mousedown0":"annotate","at:mousedown2":"move-to-mouse-position","at:control+mousedown2":"select-annotation","at:alt+mousedown0":"move-annotation","at:control+alt+mousedown2":"delete-annotation","at:touchpinch":"zoom-via-touchpinch","at:touchrotate":"rotate-in-plane-via-touchrotate","at:touchtranslate2":"translate-in-plane-via-touchtranslate","at:touchhold1":"move-to-mouse-position","at:touchtap1x2":"select","at:touchtap2x3":"snap"},{label:"All Data Panels"})),d}function g(e){e.global.addParent(function(){if(void 0===u){const e=new c.a;e.set("keyl","recolor"),e.set("keyx","clear-segments"),e.set("keys","toggle-show-slices"),e.set("keyb","toggle-scale-bar"),e.set("shift+keyb","toggle-default-annotations"),e.set("keya","toggle-axis-lines"),e.set("keyo","toggle-orthographic-projection");for(let t=1;t<=9;++t)e.set("digit"+t,"toggle-layer-"+t),e.set("control+digit"+t,"select-layer-"+t);e.set("keyn","add-layer"),e.set("keyh","help"),e.set("space","toggle-layout"),e.set("shift+space","toggle-layout-alternative"),e.set("backslash","toggle-show-statistics"),u=e}return u}(),Number.NEGATIVE_INFINITY),e.sliceView.addParent((void 0===p&&(p=c.a.fromObject({"at:mousedown0":{action:"translate-via-mouse-drag",stopPropagation:!0},"at:shift+mousedown0":{action:"rotate-via-mouse-drag",stopPropagation:!0},"at:touchtranslate1":"translate-z-via-touchtranslate"},{parents:[[f(),Number.NEGATIVE_INFINITY]]})),p),Number.NEGATIVE_INFINITY),e.perspectiveView.addParent((void 0===h&&(h=c.a.fromObject({"at:mousedown0":{action:"rotate-via-mouse-drag",stopPropagation:!0},"at:shift+mousedown0":{action:"translate-via-mouse-drag",stopPropagation:!0},"at:touchtranslate1":"rotate-out-of-plane-via-touchtranslate"},{parents:[[f(),Number.NEGATIVE_INFINITY]]})),h),Number.NEGATIVE_INFINITY)}var m=n(34),v=n(23);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const b=Symbol("SingleTextureVolumeChunk.textureUnit"),y=Symbol("SingleTextureVolumeChunk.textureLayout");class w extends r.a{constructor(e){super(),this.shaderKey=e}defineShader(e){e.addTextureSampler(this.shaderSamplerType,"uVolumeChunkSampler",b)}beginDrawing(e,t){let n=t.textureUnit(b);e.activeTexture(WebGL2RenderingContext.TEXTURE0+n),t[y]=null}endDrawing(e,t){e.bindTexture(v.c[this.shaderSamplerType],null),t[y]=null}bindChunk(e,t,n){let i=n.textureLayout;t[y]!==i&&(t[y]=i,this.setupTextureLayout(e,t,i)),e.bindTexture(v.c[this.shaderSamplerType],n.texture)}beginSource(e,t){}}class x extends m.a{constructor(e,t){super(e,t),this.texture=null,this.data=t.data}copyToGPU(e){super.copyToGPU(e);let t=this.texture=e.createTexture();const n=v.c[this.chunkFormat.shaderSamplerType];e.bindTexture(n,t),this.setTextureData(e),e.bindTexture(n,null)}freeGPUMemory(e){super.freeGPUMemory(e),e.deleteTexture(this.texture),this.texture=null,this.textureLayout.dispose(),this.textureLayout=null}}var S=n(4),C=n(17),O=n(26),L=n(21);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class T extends r.a{constructor(e,t){super(),this.chunkDataSize=e,this.numChannels=t}static get(e,t,n){return e.memoize.get(`sliceview.UncompressedTextureLayout:${Object(o.v)(t)},${n}`,()=>new T(t,n))}}class k extends w{constructor(e,t,n,i){super(i),this.dataType=t,this.numChannels=n,Object(L.e)(this,t),this.textureAccessHelper=new L.c("chunkData")}get shaderSamplerType(){return`${this.samplerPrefix}sampler3D`}static get(e,t,n){let i=`sliceview.UncompressedChunkFormat:${t}:${n}`;return e.memoize.get(i,()=>new k(e,t,n,i))}defineShader(e){super.defineShader(e);let{textureAccessHelper:t}=this;e.addFragmentCode(t.getAccessor("readVolumeData","uVolumeChunkSampler",this.dataType));let{numChannels:n}=this;n>1?(e.addUniform("highp int","uChannelStride"),e.addFragmentCode("\nhighp int getChannelOffset(highp int channelIndex) {\n  return channelIndex * uChannelStride;\n}\n")):e.addFragmentCode("highp int getChannelOffset(highp int channelIndex) { return 0; }");const i=Object(O.a)(this.dataType);e.addFragmentCode(`\n${i} getDataValue (highp int channelIndex) {\n  highp ivec3 p = getPositionWithinChunk();\n  return readVolumeData(ivec3(p.x, p.y, p.z + getChannelOffset(channelIndex)));\n}\n`)}setupTextureLayout(e,t,n){this.numChannels>1&&e.uniform1i(t.uniform("uChannelStride"),n.chunkDataSize[2])}getTextureLayout(e,t){return T.get(e,t,this.numChannels)}setTextureData(e,t,n){const{chunkDataSize:i}=t;Object(L.h)(e,this,n,i[0],i[1],i[2]*this.numChannels)}}class E extends x{setTextureData(e){let t,{source:n}=this,{chunkFormatHandler:i}=n,{chunkFormat:r}=i;this.chunkDataSize===n.spec.chunkDataSize?this.textureLayout=t=i.textureLayout.addRef():this.textureLayout=t=r.getTextureLayout(e,this.chunkDataSize),this.chunkFormat.setTextureData(e,t,this.data)}getChannelValueAt(e,t){let{chunkFormat:n}=this,i=this.chunkDataSize,r=e[0]+i[0]*(e[1]+i[1]*(e[2]+i[2]*t)),s=n.dataType,o=this.data;switch(s){case S.a.UINT8:case S.a.FLOAT32:case S.a.UINT16:case S.a.UINT32:return o[r];case S.a.UINT64:{let e=2*r;return new C.a(o[e],o[e+1])}}throw new Error("Invalid data type: "+s)}}class A extends r.a{constructor(e,t){super(),this.chunkFormat=this.registerDisposer(k.get(e,t.dataType,t.numChannels)),this.textureLayout=this.registerDisposer(this.chunkFormat.getTextureLayout(e,t.chunkDataSize))}getChunk(e,t){return new E(e,t)}}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function M(e,t,n,i,r,s){let o=0,a=0,l=1,c=1;for(let e=0;e<3;++e){let t=r[e],s=i[e],u=t%s;o+=Math.floor(t/s)*l,l*=Math.ceil(n[e]/s),a+=u*c,c*=s}let u=t+2*o,d=e[u],h=e[u+1],p=16777215&d,f=d>>24&255;if(f>0){p+=s*(e[(t+h&16777215)+Math.floor(a*f/32)]>>a*f%32&(1<<f)-1)}return p}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I(e,t,n,i,r){return e[M(e,t,n,i,r,1)+t]}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function N(e,t,n,i,r,s){let o=M(t,n,i,r,s,2)+n;return e.low=t[o],e.high=t[o+1],e}Object(m.c)((e,t)=>null==t.compressedSegmentationBlockSize?new A(e,t):null);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class D extends r.a{constructor(e,t,n,i){super(),this.chunkDataSize=t,this.subchunkSize=n,Object(L.d)(this,e,1,i);let r=this.subchunkGridSize=o.u.create();for(let e=0;e<3;++e)r[e]=Math.ceil(t[e]/n[e])}static get(e,t,n,i){return e.memoize.get(`sliceview.CompressedSegmentationTextureLayout:${Object(o.v)(t)},`+`${Object(o.v)(n)},${i}`,()=>new D(e,t,n,i))}}const R=Object(L.e)(new L.b,S.a.UINT32);class P extends w{constructor(e,t,n,i){super(i),this.dataType=e,this.subchunkSize=t,this.numChannels=n,this.textureAccessHelper=new L.a("chunkData")}static get(e,t,n,i){let r=`sliceview.CompressedSegmentationChunkFormat:${t}:${i}`,s=`${r}:${Object(o.v)(n)}`;return e.memoize.get(s,()=>new P(t,n,i,r))}get shaderSamplerType(){return"usampler2D"}defineShader(e){super.defineShader(e);let{textureAccessHelper:t}=this;t.defineShader(e);let n=e=>"compressedSegmentationChunkFormat_"+e;e.addUniform("highp ivec3","uSubchunkGridSize"),e.addUniform("highp ivec3","uSubchunkSize"),e.addFragmentCode(O.d);const{dataType:i}=this,r=Object(O.a)(i);i===S.a.UINT64?e.addFragmentCode(O.h):e.addFragmentCode(O.g),e.addFragmentCode(t.getAccessor(n("readTextureValue"),"uVolumeChunkSampler",S.a.UINT32,1));let s=`\nuint ${n("getChannelOffset")}(int channelIndex) {\n  if (channelIndex == 0) {\n    return ${this.numChannels}u;\n  }\n  return ${n("readTextureValue")}(uint(channelIndex)).value;\n}\n${r} getDataValue (int channelIndex) {\n  ivec3 chunkPosition = getPositionWithinChunk();\n\n  // TODO: maybe premultiply this and store as uniform.\n  ivec3 subchunkGridPosition = chunkPosition / uSubchunkSize;\n  int subchunkGridOffset = getFortranOrderIndex(subchunkGridPosition, uSubchunkGridSize);\n\n  int channelOffset = int(${n("getChannelOffset")}(channelIndex));\n\n  // TODO: Maybe just combine this offset into subchunkGridStrides.\n  int subchunkHeaderOffset = subchunkGridOffset * 2 + channelOffset;\n\n  highp uint subchunkHeader0 = ${n("readTextureValue")}(uint(subchunkHeaderOffset)).value;\n  highp uint subchunkHeader1 = ${n("readTextureValue")}(uint(subchunkHeaderOffset + 1)).value;\n  highp uint outputValueOffset = (subchunkHeader0 & 0xFFFFFFu) + uint(channelOffset);\n  highp uint encodingBits = subchunkHeader0 >> 24u;\n  if (encodingBits > 0u) {\n    ivec3 subchunkPosition = chunkPosition - subchunkGridPosition * uSubchunkSize;\n    int subchunkOffset = getFortranOrderIndex(subchunkPosition, uSubchunkSize);\n    uint encodedValueBaseOffset = subchunkHeader1 + uint(channelOffset);\n    uint encodedValueOffset = encodedValueBaseOffset + uint(subchunkOffset) * encodingBits / 32u;\n    uint encodedValue = ${n("readTextureValue")}(encodedValueOffset).value;\n    uint wordOffset = uint(subchunkOffset) * encodingBits % 32u;\n    uint encodedValueShifted = encodedValue >> wordOffset;\n    uint decodedValue = encodedValueShifted - (encodedValueShifted >> encodingBits << encodingBits);\n    outputValueOffset += decodedValue * ${this.dataType===S.a.UINT64?"2u":"1u"};\n  }\n  ${r} result;\n`;i===S.a.UINT64?s+=`\n  result.value[0] = ${n("readTextureValue")}(outputValueOffset).value;\n  result.value[1] = ${n("readTextureValue")}(outputValueOffset+1u).value;\n`:s+=`\n  result.value = ${n("readTextureValue")}(outputValueOffset).value;\n`,s+="\n  return result;\n}\n",e.addFragmentCode(s)}setupTextureLayout(e,t,n){const{subchunkGridSize:i}=n;e.uniform3i(t.uniform("uSubchunkGridSize"),i[0],i[1],i[2]),this.textureAccessHelper.setupTextureLayout(e,t,n)}setTextureData(e,t,n){Object(L.g)(e,t,R,n)}getTextureLayout(e,t,n){return D.get(e,t,this.subchunkSize,n)}beginSource(e,t){super.beginSource(e,t);const{subchunkSize:n}=this;e.uniform3i(t.uniform("uSubchunkSize"),n[0],n[1],n[2])}}class j extends x{setTextureData(e){let{data:t}=this,{chunkFormat:n}=this,i=this.textureLayout=n.getTextureLayout(e,this.chunkDataSize,t.length);n.setTextureData(e,i,t)}getChannelValueAt(e,t){let{chunkDataSize:n,chunkFormat:i}=this,{data:r}=this,s=r[t];if(i.dataType===S.a.UINT64){let t=new C.a;return N(t,r,s,n,i.subchunkSize,e),t}return I(r,s,n,i.subchunkSize,e)}}class V extends r.a{constructor(e,t){super();let{dataType:n}=t;if(n!==S.a.UINT64&&n!==S.a.UINT32)throw new Error(`Unsupported compressed segmentation data type: ${S.a[n]}`);this.chunkFormat=this.registerDisposer(P.get(e,t.dataType,t.compressedSegmentationBlockSize,t.numChannels))}getChunk(e,t){return new j(e,t)}}Object(m.c)((e,t)=>null!=t.compressedSegmentationBlockSize?new V(e,t):null);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var _=n(113),U=n(13),F=n.n(U),z=n(11),B=n(88);n(100),n(198);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function G(e,t){return n=>{n.style.flex=e,t(n)}}function W(e,t){return n=>{n.style.display="flex",n.style.flexDirection=e;for(let e of t){let t=n.ownerDocument.createElement("div");n.appendChild(t),e(t)}}}var $=n(29),H=n(87),q=n.n(H),Y=n(101),J=n(20);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const X="perspective_view/PerspectiveView",K="perspective_view/addLayer",Q="perspective_view/removeLayer",Z="perspective_view/updateViewport";var ee=n(61),te=n(33),ne=n(45),ie=n(18),re=n(67),se=n(3);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class oe extends r.a{constructor(e,t,n){super(),this.register=e,this.unregister=t,this.changed=new se.a,void 0===n?this.map=new Map:(this.map=new Map(n),this.map.forEach(this.register))}set(e,t){const{map:n}=this,i=n.get(e);return void 0!==i&&this.unregister(i,e),n.set(e,t),this.register(t,e),this.changed.dispatch(),this}delete(e){const{map:t}=this,n=t.get(e);return void 0!==n&&(this.unregister(n,e),this.changed.dispatch(),!0)}has(e){return this.map.has(e)}get size(){return this.map.size}[Symbol.iterator](){return this.map[Symbol.iterator]()}clear(){const{map:e}=this;e.size>0&&(e.forEach(this.unregister),e.clear(),this.changed.dispatch())}values(){return this.map.values()}keys(){return this.map.keys()}disposed(){const{map:e}=this;e.forEach(this.unregister),this.map.clear(),super.disposed()}}var ae,le=n(25),ce=n(38),ue=n(54),de=n(8);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(79),n(200),function(e){e[e.COLOR=0]="COLOR",e[e.Z=1]="Z",e[e.PICK=2]="PICK",e[e.NUM_TEXTURES=3]="NUM_TEXTURES"}(ae||(ae={}));const he="\nvoid emit(vec4 color, highp uint pickId) {\n  out_color = color;\n  out_z = 1.0 - gl_FragCoord.z;\n  out_pickId = float(pickId);\n}\n",pe=["\nfloat computeOITWeight(float alpha) {\n  float a = min(1.0, alpha) * 8.0 + 0.01;\n  float b = -gl_FragCoord.z * 0.95 + 1.0;\n  return a * a * a * b * b * b;\n}\n","\nvoid emit(vec4 color, highp uint pickId) {\n  float weight = computeOITWeight(color.a);\n  vec4 accum = color * weight;\n  v4f_fragData0 = vec4(accum.rgb, color.a);\n  v4f_fragData1 = vec4(accum.a, 0.0, 0.0, 0.0);\n}\n"];function fe(e){e.addOutputBuffer("vec4","out_color",ae.COLOR),e.addOutputBuffer("highp float","out_z",ae.Z),e.addOutputBuffer("highp float","out_pickId",ae.PICK),e.addFragmentCode(he)}function ge(e){e.addOutputBuffer("vec4","v4f_fragData0",0),e.addOutputBuffer("vec4","v4f_fragData1",1),e.addFragmentCode(pe)}const me=o.u.create(),ve=o.u.create(),be=o.w.create(),ye=o.m.create();function we(e){e.addOutputBuffer("vec4","v4f_fragColor",null),e.setFragmentMain("\nvec4 v0 = getValue0();\nvec4 v1 = getValue1();\nvec4 accum = vec4(v0.rgb, v1.r);\nfloat revealage = v0.a;\n\nv4f_fragColor = vec4(accum.rgb / accum.a, revealage);\n")}const xe=Object(le.c)(de.b);class Se extends xe{}class Ce extends te.a{constructor(e,t,n){super(e,t,n),this.sliceViews=(()=>{const e=new Map;return this.registerDisposer(new oe((t,n)=>{const i=n.visibility.add(this.visibility);e.set(n,i),this.scheduleRedraw()},(t,n)=>{const i=e.get(n);e.delete(n),i(),n.dispose(),this.scheduleRedraw()}))})(),this.projectionMat=o.m.create(),this.viewMat=o.m.create(),this.viewMatInverse=o.m.create(),this.viewProjectionMat=o.m.create(),this.viewProjectionMatInverse=o.m.create(),this.width=0,this.height=0,this.axesLineHelper=this.registerDisposer(Y.a.get(this.gl)),this.sliceViewRenderHelper=this.registerDisposer(ne.d.get(this.gl,fe)),this.offscreenFramebuffer=this.registerDisposer(new ce.b(this.gl,{colorBuffers:[new ce.e(this.gl,WebGL2RenderingContext.RGBA8,WebGL2RenderingContext.RGBA,WebGL2RenderingContext.UNSIGNED_BYTE),new ce.e(this.gl,WebGL2RenderingContext.R32F,WebGL2RenderingContext.RED,WebGL2RenderingContext.FLOAT),new ce.e(this.gl,WebGL2RenderingContext.R32F,WebGL2RenderingContext.RED,WebGL2RenderingContext.FLOAT)],depthBuffer:new ce.a(this.gl)})),this.offscreenCopyHelper=this.registerDisposer(ce.c.get(this.gl)),this.transparencyCopyHelper=this.registerDisposer(ce.c.get(this.gl,we,2)),this.scaleBarCopyHelper=this.registerDisposer(ce.c.get(this.gl)),this.scaleBarTexture=this.registerDisposer(new ue.a(this.gl)),this.nanometersPerPixel=1,this.throttledSendViewportUpdate=this.registerCancellable(q()(()=>{const{sharedObject:e}=this,{valid:t}=this.navigationState;t&&this.updateProjectionMatrix(),e.rpc.invoke(Z,{view:e.rpcId,viewport:{width:t?this.width:0,height:t?this.height:0,viewMat:this.viewMat,projectionMat:this.projectionMat,viewProjectionMat:this.viewProjectionMat}})},10)),this.registerDisposer(this.navigationState.changed.add(()=>{this.throttledSendViewportUpdate(),this.context.scheduleRedraw()}));const i=this.sharedObject=this.registerDisposer(new Se);if(i.RPC_TYPE_ID=X,i.initializeCounterpart(n.rpc,{}),i.visibility.add(this.visibility),this.visibleLayerTracker=Object(J.l)(this.viewer.layerManager,ee.a,this.viewer.visibleLayerRoles,this,e=>{const{backend:t}=e;if(t)return t.rpc.invoke(K,{layer:t.rpcId,view:this.sharedObject.rpcId}),()=>{t.rpc.invoke(Q,{layer:t.rpcId,view:this.sharedObject.rpcId})}}),Object(c.d)(t,"rotate-via-mouse-drag",e=>{Object(re.a)(e.detail,(e,t,n)=>{this.navigationState.pose.rotateRelative(o.g[1],t/4*Math.PI/180),this.navigationState.pose.rotateRelative(o.g[0],-n/4*Math.PI/180)})}),Object(c.d)(t,"rotate-in-plane-via-touchrotate",e=>{const{detail:t}=e;this.navigationState.pose.rotateRelative(o.g[2],t.angle-t.prevAngle)}),Object(c.d)(t,"rotate-out-of-plane-via-touchtranslate",e=>{const{detail:t}=e;this.navigationState.pose.rotateRelative(o.g[1],t.deltaX/4*Math.PI/180),this.navigationState.pose.rotateRelative(o.g[0],-t.deltaY/4*Math.PI/180)}),n.showSliceViewsCheckbox){let e=this.registerDisposer(new ie.c(n.showSliceViews));e.element.className="perspective-panel-show-slice-views neuroglancer-noselect";let t=document.createElement("label");t.className="perspective-panel-show-slice-views neuroglancer-noselect",t.appendChild(document.createTextNode("Slices")),t.appendChild(e.element),this.element.appendChild(t)}this.registerDisposer(n.orthographicProjection.changed.add(()=>this.scheduleRedraw())),this.registerDisposer(n.showScaleBar.changed.add(()=>this.scheduleRedraw())),this.registerDisposer(n.scaleBarOptions.changed.add(()=>this.scheduleRedraw())),this.registerDisposer(n.showSliceViews.changed.add(()=>this.scheduleRedraw())),this.registerDisposer(n.showAxisLines.changed.add(()=>this.scheduleRedraw())),this.registerDisposer(n.crossSectionBackgroundColor.changed.add(()=>this.scheduleRedraw())),this.registerDisposer(n.perspectiveViewBackgroundColor.changed.add(()=>this.scheduleRedraw()))}translateByViewportPixels(e,t){const n=me,{viewProjectionMat:i}=this,{width:r,height:s}=this,{position:a}=this.viewer.navigationState,l=a.spatialCoordinates;o.u.transformMat4(n,l,i),n[0]=-2*e/r,n[1]=2*t/s,o.u.transformMat4(l,n,this.viewProjectionMatInverse),a.changed.dispatch()}get navigationState(){return this.viewer.navigationState}isReady(){if(!this.visible)return!0;for(const[e,t]of this.sliceViews)if((t||this.viewer.showSliceViews.value)&&!e.isReady())return!1;this.checkForResize();const{width:e,height:t}=this;if(0===e||0===t)return!0;const{viewProjectionMat:n}=this;this.updateProjectionMatrix();const i={viewportWidth:e,viewportHeight:t,dataToDevice:n};let r=this.visibleLayerTracker.getVisibleLayers();for(let e of r)if(!e.isReady(i))return!1;return!0}updateProjectionMatrix(){const{projectionMat:e,viewProjectionMat:t}=this,n=this.width/this.height,i=Math.PI/4;if(this.viewer.orthographicProjection.value){const t=100/(1/Math.tan(i/2));o.m.ortho(e,-n*t,n*t,-t,t,10,5e3),this.nanometersPerPixel=1/(2*e[0])*this.navigationState.zoomFactor.value,this.nanometersPerPixel=2*n*t/this.width*this.navigationState.zoomFactor.value}else o.m.perspective(e,i,n,10,5e3);const{viewMatInverse:r,viewMat:s}=this;this.navigationState.toMat4(r),o.u.set(me,1,-1,-1),o.m.scale(r,r,me);let a=o.u.set(me,0,0,100);o.m.translate(r,r,a),o.m.invert(s,r),o.m.multiply(t,e,s),o.m.invert(this.viewProjectionMatInverse,t)}panelSizeChanged(){this.throttledSendViewportUpdate()}disposed(){for(let e of this.sliceViews.keys())e.dispose();this.sliceViews.clear(),super.disposed()}issuePickRequest(e,t){const{offscreenFramebuffer:n}=this;n.readPixelFloat32IntoBuffer(ae.Z,e-te.e,t-te.e,0,te.c,te.c),n.readPixelFloat32IntoBuffer(ae.PICK,e-te.e,t-te.e,16*te.c*te.c,te.c,te.c)}completePickRequest(e,t,n,i){const{mouseState:r}=this.viewer;r.pickedRenderLayer=null,Object(te.b)(n,0,4,e,t,i.viewportWidth,i.viewportHeight);const s=te.d.length;for(let a=0;a<s;++a){const s=te.d[a];let l=n[4*s];if(0===l)continue;const c=s%te.c,u=(s-c)/te.c;let d=1-l;const h=r.position;h[0]=2*(e+c-te.e)/i.viewportWidth-1,h[1]=2*(t+u-te.e)/i.viewportHeight-1,h[2]=2*d-1,o.u.transformMat4(h,h,i.invTransform);const p=n[4*te.c*te.c+4*s];return i.pickIDs.setMouseState(r,p),void r.setActive(!0)}r.setActive(!1)}translateDataPointByViewportPixels(e,t,n,i){const r=me,{viewProjectionMat:s}=this,{width:a,height:l}=this;return o.u.transformMat4(r,t,s),r[0]+=2*n/a,r[1]+=-2*i/l,o.u.transformMat4(e,r,this.viewProjectionMatInverse)}get transparentConfiguration(){let e=this.transparentConfiguration_;return void 0===e&&(e=this.transparentConfiguration_=this.registerDisposer(new ce.b(this.gl,{colorBuffers:Object(ce.f)(this.gl,2,this.gl.RGBA32F,this.gl.RGBA,this.gl.FLOAT),depthBuffer:this.offscreenFramebuffer.depthBuffer.addRef()}))),e}drawWithPicking(e){if(!this.navigationState.valid)return!1;const{width:t,height:n}=this,i=this.viewer.showSliceViews.value;for(const[e,t]of this.sliceViews)(t||i)&&e.updateRendering();let r=this.gl;this.offscreenFramebuffer.bind(t,n),r.disable(r.SCISSOR_TEST);const s=this.viewer.perspectiveViewBackgroundColor.value;this.gl.clearColor(s[0],s[1],s[2],0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.enable(r.DEPTH_TEST);let{viewProjectionMat:a}=this;this.updateProjectionMatrix();let l=o.u.create();Object(o.r)(l,o.g[2],this.viewMatInverse),o.u.normalize(l,l);const c={dataToDevice:a,lightDirection:l,ambientLighting:.2,directionalLighting:.8,pickIDs:e.pickIDs,emitter:fe,emitColor:!0,emitPickID:!0,alreadyEmittedPickID:!1,viewportWidth:t,viewportHeight:n};o.m.copy(e.invTransform,this.viewProjectionMatInverse);let u=this.visibleLayerTracker.getVisibleLayers(),d=!1,h=!1;for(let e of u)e.isTransparent?d=!0:e.isAnnotation?h=!0:e.draw(c);if(this.drawSliceViews(c),h){r.enable(WebGL2RenderingContext.BLEND),r.depthFunc(WebGL2RenderingContext.LEQUAL),r.blendFunc(WebGL2RenderingContext.SRC_ALPHA,WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA),r.drawBuffers([r.COLOR_ATTACHMENT0,r.NONE,r.NONE]),c.emitPickID=!1;for(let e of u)e.isAnnotation&&e.draw(c);r.depthFunc(WebGL2RenderingContext.LESS),r.disable(WebGL2RenderingContext.BLEND),r.drawBuffers([r.COLOR_ATTACHMENT0,r.COLOR_ATTACHMENT1,r.COLOR_ATTACHMENT2]),c.emitPickID=!0}if(this.viewer.showAxisLines.value&&this.drawAxisLines(),d){r.depthMask(!1),r.enable(WebGL2RenderingContext.BLEND);const{transparentConfiguration:e}=this;e.bind(t,n),this.gl.clearColor(0,0,0,1),r.clear(WebGL2RenderingContext.COLOR_BUFFER_BIT),c.emitter=ge,r.blendFuncSeparate(WebGL2RenderingContext.ONE,WebGL2RenderingContext.ONE,WebGL2RenderingContext.ZERO,WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA),c.emitPickID=!1;for(let e of u)e.isTransparent&&e.draw(c);r.disable(WebGL2RenderingContext.DEPTH_TEST),this.offscreenFramebuffer.bindSingle(ae.COLOR),r.blendFunc(WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA,WebGL2RenderingContext.SRC_ALPHA),this.transparencyCopyHelper.draw(e.colorBuffers[0].texture,e.colorBuffers[1].texture),r.depthMask(!0),r.disable(WebGL2RenderingContext.BLEND),r.enable(WebGL2RenderingContext.DEPTH_TEST),this.offscreenFramebuffer.bind(t,n)}r.drawBuffers([r.NONE,r.COLOR_ATTACHMENT1,r.COLOR_ATTACHMENT2]),c.emitter=fe,c.emitPickID=!0,c.emitColor=!1,r.enable(WebGL2RenderingContext.POLYGON_OFFSET_FILL),r.polygonOffset(-1,-1);for(let e of u)c.alreadyEmittedPickID=!e.isTransparent&&!e.isAnnotation,e.draw(c);if(r.disable(WebGL2RenderingContext.POLYGON_OFFSET_FILL),this.viewer.showScaleBar.value&&this.viewer.orthographicProjection.value){r.drawBuffers([r.COLOR_ATTACHMENT0]),r.disable(WebGL2RenderingContext.DEPTH_TEST),r.enable(WebGL2RenderingContext.BLEND),r.blendFunc(WebGL2RenderingContext.SRC_ALPHA,WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA);const{scaleBarTexture:e}=this,n=this.viewer.scaleBarOptions.value,{dimensions:i}=e;i.targetLengthInPixels=Math.min(n.maxWidthFraction*t,n.maxWidthInPixels*n.scaleFactor),i.nanometersPerPixel=this.nanometersPerPixel,e.update(n),r.viewport(n.leftPixelOffset*n.scaleFactor,n.bottomPixelOffset*n.scaleFactor,e.width,e.height),this.scaleBarCopyHelper.draw(e.texture),r.disable(WebGL2RenderingContext.BLEND)}return this.offscreenFramebuffer.unbind(),this.setGLViewport(),this.offscreenCopyHelper.draw(this.offscreenFramebuffer.colorBuffers[ae.COLOR].texture),!0}drawSliceViews(e){let{sliceViewRenderHelper:t}=this,{lightDirection:n,ambientLighting:i,directionalLighting:r,dataToDevice:s}=e;const a=this.viewer.showSliceViews.value;for(const[e,l]of this.sliceViews){if(!l&&!a)continue;if(0===e.width||0===e.height||!e.hasValidViewport)continue;let c=i+Math.abs(o.u.dot(n,e.viewportAxes[2]))*r,u=ye;o.m.identity(u),u[0]=e.width/2,u[5]=-e.height/2,o.m.multiply(u,e.viewportToData,u),o.m.multiply(u,s,u);const d=be,h=this.viewer.crossSectionBackgroundColor.value;d[0]=h[0],d[1]=h[1],d[2]=h[2],d[3]=1,t.draw(e.offscreenFramebuffer.colorBuffers[0].texture,u,o.w.fromValues(c,c,c,1),be,0,0,1,1)}}drawAxisLines(){const e=me,t=ve,{viewProjectionMat:n}=this,{position:i}=this.viewer.navigationState,r=i.spatialCoordinates;o.u.transformMat4(e,r,n),e[0]=.5,o.u.transformMat4(t,e,this.viewProjectionMatInverse);const s=o.u.distance(t,r);e[0]=0,e[1]=.5,o.u.transformMat4(t,e,this.viewProjectionMatInverse);const a=o.u.distance(t,r);let{gl:l}=this,c=ye;o.m.identity(c);let u=Math.min(s,a);c[0]=u,c[5]=u,c[10]=u;let d=this.navigationState.position.spatialCoordinates;c[12]=d[0],c[13]=d[1],c[14]=d[2],c[15]=1,o.m.multiply(c,this.viewProjectionMat,c),l.drawBuffers([l.COLOR_ATTACHMENT0]),this.axesLineHelper.draw(c,!1)}zoomByMouse(e){this.navigationState.zoomBy(e)}}var Oe=n(72),Le=n(9),Te=n(10),ke=n(1);const Ee=new Map([["xy",void 0],["xz",o.p.rotateX(o.p.create(),o.p.create(),Math.PI/2)],["yz",o.p.rotateY(o.p.create(),o.p.create(),Math.PI/2)]]),Ae=new Map([["4panel",""],["3d",""]]);function Me(e,t){return function(e,t){let n;return n=void 0===t?e.navigationState:new $.e(new $.g(e.navigationState.pose.position,$.f.makeRelative(e.navigationState.pose.orientation,t)),e.navigationState.zoomFactor),new ne.a(e.chunkManager,e.layerManager,n)}(e,Ee.get(t))}function Ie(e){return{crossSectionBackgroundColor:e.crossSectionBackgroundColor,perspectiveViewBackgroundColor:e.perspectiveViewBackgroundColor,mouseState:e.mouseState,layerManager:e.layerManager,showAxisLines:e.showAxisLines,visibleLayerRoles:e.visibleLayerRoles,selectedLayer:e.selectedLayer,visibility:e.visibility,scaleBarOptions:e.scaleBarOptions}}function Ne(e){const{viewer:t}=e;return Object.assign({},Ie(t),{navigationState:t.perspectiveNavigationState,inputEventMap:t.inputEventBindings.perspectiveView,orthographicProjection:e.specification.orthographicProjection,showScaleBar:t.showScaleBar,rpc:t.chunkManager.rpc})}function De(e){return Object.assign({},Ie(e),{navigationState:e.navigationState,inputEventMap:e.inputEventBindings.sliceView})}function Re(e,t,n){const i=document.createElement("div");i.className="neuroglancer-data-panel-layout-controls",e.registerDisposer(()=>Object(Te.b)(i));for(let i=0;i<2;++i){const r=n[Math.min(n.length-1,i)];e.registerDisposer(Object(c.d)(t.element,0===i?"toggle-layout":"toggle-layout-alternative",t=>{e.container.name=r,t.stopPropagation()}))}for(const t of n){const n=document.createElement("button"),r=document.createElement("div");n.appendChild(r),r.textContent=Ae.get(t),n.title=`Switch to ${t} layout.`,n.addEventListener("click",()=>{e.container.name=t}),i.appendChild(n)}t.element.appendChild(i)}function Pe(e,t){const n=new ne.a(e.chunkManager,e.layerManager,t.navigationState.addRef()),i=()=>{n.setViewportSizeDebounced(t.width.value,t.height.value)};return n.registerDisposer(t.width.changed.add(i)),n.registerDisposer(t.height.changed.add(i)),i(),n}function je(e,t,n){const i=new Map;(()=>{const r=new Set;for(const s of n.values()){if(r.add(s),i.has(s))continue;const n=Pe(e,s);t.sliceViews.set(n,!0),i.set(s,n)}for(const[e,n]of i)r.has(e)||t.sliceViews.delete(n)})()}class Ve extends r.a{constructor(e,t,n,i){super(),this.container=e,this.rootElement=t,this.viewer=n;let r=(s=n,new Map([["xy",Me(s,"xy")],["xz",Me(s,"xz")],["yz",Me(s,"yz")]]));var s;let{display:o}=n;const a=Object.assign({},Ne(e),{showSliceViews:n.showPerspectiveSliceViews,showSliceViewsCheckbox:!0}),l=Object.assign({},De(n),{showScaleBar:n.showScaleBar}),c=Object.assign({},De(n),{showScaleBar:new ie.b(!1,!1)}),u=(e,t,n)=>{const i=this.registerDisposer(new Oe.a(o,t,r.get(e),n));return Re(this,i,[e,`${e}-3d`]),i};let d=[G(1,W("column",[G(1,W("row",[G(1,e=>{u("xy",e,l)}),G(1,e=>{u("xz",e,c)})])),G(1,W("row",[G(1,e=>{let t=this.registerDisposer(new Ce(o,e,a));for(let e of r.values())t.sliceViews.set(e.addRef(),!1);je(n,t,i),Re(this,t,["3d"])}),G(1,e=>{u("yz",e,c)})]))]))];W("row",d)(t)}disposed(){Object(Te.a)(this.rootElement),super.disposed()}}class _e extends r.a{constructor(e,t,n,i,r,s){super(),this.container=e,this.rootElement=t,this.viewer=n,this.direction=i;let o=Me(n,r),{display:a}=n;const l=Object.assign({},Ne(e),{showSliceViews:n.showPerspectiveSliceViews,showSliceViewsCheckbox:!0}),c=Object.assign({},De(n),{showScaleBar:n.showScaleBar});G(1,W(i,[G(1,e=>{Re(this,this.registerDisposer(new Oe.a(a,e,o,c)),[r,"4panel"])}),G(1,e=>{let t=this.registerDisposer(new Ce(a,e,l));t.sliceViews.set(o.addRef(),!1),je(n,t,s),Re(this,t,["3d","4panel"])})]))(t)}disposed(){Object(Te.a)(this.rootElement),super.disposed()}}class Ue extends r.a{constructor(e,t,n,i){super(),this.container=e,this.rootElement=t,this.viewer=n;let r=Me(n,i);const s=Object.assign({},De(n),{showScaleBar:n.showScaleBar});W("row",[G(1,e=>{Re(this,this.registerDisposer(new Oe.a(n.display,e,r,s)),["4panel",`${i}-3d`])})])(t)}disposed(){Object(Te.a)(this.rootElement),super.disposed()}}class Fe extends r.a{constructor(e,t,n,i){super(),this.container=e,this.rootElement=t,this.viewer=n;let r=Object.assign({},Ne(e),{showSliceViews:new ie.b(!1,!1)});W("row",[G(1,e=>{const t=this.registerDisposer(new Ce(n.display,e,r));je(n,t,i),Re(this,t,["4panel"])})])(t)}disposed(){Object(Te.a)(this.rootElement),super.disposed()}}const ze=new Map([["4panel",{factory:(e,t,n,i)=>new Ve(e,t,n,i)}],["3d",{factory:(e,t,n,i)=>new Fe(e,t,n,i)}]]);for(const e of Ee.keys()){ze.set(e,{factory:(t,n,i)=>new Ue(t,n,i,e)});const t=`${e}-3d`;Ae.set(e,""),Ae.set(t,""),ze.set(t,{factory:(t,n,i,r)=>new _e(t,n,i,"row",e,r)})}function Be(e){let t=ze.get(e);if(void 0===t)throw new Error(`Invalid layout name: ${JSON.stringify(e)}.`);return t}function Ge(e){return Be(e),e}class We extends r.a{constructor(e){super(),this.width=new Le.c(1e3,ke.z),this.height=new Le.c(1e3,ke.z),this.changed=new se.a,this.position=new $.b(e.position.addRef()),this.position.changed.add(this.changed.dispatch),this.orientation=new $.a(e.pose.orientation.addRef()),this.orientation.changed.add(this.changed.dispatch),this.width.changed.add(this.changed.dispatch),this.height.changed.add(this.changed.dispatch),this.zoom=new $.c(e.zoomFactor.addRef()),this.zoom.changed.add(this.changed.dispatch),this.navigationState=this.registerDisposer(new $.e(new $.g(this.position.value,this.orientation.value),this.zoom.value))}restoreState(e){Object(ke.t)(e),Object(ke.v)(e,"width",e=>void 0!==e&&this.width.restoreState(e)),Object(ke.v)(e,"height",e=>void 0!==e&&this.height.restoreState(e)),Object(ke.v)(e,"position",e=>void 0!==e&&this.position.restoreState(e)),Object(ke.v)(e,"orientation",e=>void 0!==e&&this.orientation.restoreState(e)),Object(ke.v)(e,"zoom",e=>void 0!==e&&this.zoom.restoreState(e))}reset(){this.width.reset(),this.height.reset(),this.position.reset(),this.orientation.reset(),this.zoom.reset()}toJSON(){return{width:this.width.toJSON(),height:this.height.toJSON(),position:this.position.toJSON(),orientation:this.orientation.toJSON(),zoom:this.zoom.toJSON()}}}class $e extends oe{constructor(e){super(e=>this.registerDisposer(this.registerDisposer(e).changed.add(this.changed.dispatch)),e=>{e.changed.remove(this.changed.dispatch),e.dispose()}),this.parentNavigationState=e,this.registerDisposer(e)}restoreState(e){Object(ke.t)(e);for(const t of Object.keys(e)){const n=new We(this.parentNavigationState);try{this.set(t,n.addRef()),n.restoreState(e[t])}finally{n.dispose()}}}reset(){this.clear()}toJSON(){if(0===this.size)return;const e={};for(const[t,n]of this)e[t]=n.toJSON();return e}}class He extends r.a{constructor(e,t){super(),this.changed=new se.a,this.orthographicProjection=new ie.b(!1),this.type=new Le.c(t,Ge),this.type.changed.add(this.changed.dispatch),this.crossSections=this.registerDisposer(new $e(e)),this.crossSections.changed.add(this.changed.dispatch),this.orthographicProjection.changed.add(this.changed.dispatch),this.registerDisposer(e)}reset(){this.crossSections.clear(),this.orthographicProjection.reset(),this.type.reset()}restoreState(e){this.crossSections.clear(),this.orthographicProjection.reset(),"string"==typeof e?this.type.restoreState(e):(Object(ke.t)(e),Object(ke.v)(e,"type",e=>this.type.restoreState(e)),Object(ke.v)(e,"orthographicProjection",e=>this.orthographicProjection.restoreState(e)),Object(ke.v)(e,"crossSections",e=>void 0!==e&&this.crossSections.restoreState(e)))}toJSON(){const{type:e,crossSections:t,orthographicProjection:n}=this,i=n.toJSON();return 0===t.size&&void 0===i?e.value:{type:e.value,crossSections:t.toJSON(),orthographicProjection:i}}}class qe extends r.a{constructor(e,t){super(),this.viewer=e,this.element=document.createElement("div"),this.specification=this.registerDisposer(new He(this.viewer.navigationState.addRef(),t)),this.element.style.flex="1";const n=this.registerCancellable(F()(()=>this.updateLayout(),0));this.specification.type.changed.add(n),Object(c.d)(this.element,"toggle-orthographic-projection",()=>this.specification.orthographicProjection.toggle()),this.registerDisposer(this.viewer.display.updateStarted.add(()=>n.flush())),n()}get name(){return this.specification.type.value}set name(e){this.specification.type.value=e}get changed(){return this.specification.changed}toJSON(){return this.specification.toJSON()}restoreState(e){this.specification.restoreState(e)}reset(){this.specification.reset()}disposeLayout(){let{layout:e}=this;void 0!==e&&(e.dispose(),this.layout=void 0)}updateLayout(){this.disposeLayout(),this.layout=Be(this.name).factory(this,this.element,this.viewer,this.specification.crossSections)}disposed(){this.disposeLayout(),super.disposed()}}var Ye=n(41),Je=n(49);function Xe(e){return e.startsWith("key")?e.substring(3):e.startsWith("digit")?e.substring(5):e.startsWith("arrow")?e.substring(5):e}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(202);class Ke extends Je.a{constructor(e){super();let{content:t}=this;t.classList.add("describe-key-bindings");let n=document.createElement("div");n.classList.add("describe-key-bindings-container");const i=new Map;function r(e,t){if(i.has(t))return;const n={label:e,entries:new Map};!function e(t,n){for(const i of t.parents)void 0!==i.label?r(i.label,i):e(i,n);for(const[e,i]of t.bindings.entries()){const t=e.indexOf(":"),r=e.substring(t+1);n.set(r,i.action)}}(t,n.entries),i.set(t,n)}for(const[t,n]of e)r(t,n);for(const e of i.values()){let t=document.createElement("h2");t.textContent=e.label,n.appendChild(t);let i=document.createElement("div");i.className="dl";for(const[t,n]of e.entries){let e=document.createElement("div"),r=document.createElement("div");r.className="definition-outer-container",e.className="definition-container";let s=document.createElement("div");s.className="dt",s.textContent=t.split("+").map(Xe).join("+");let o=document.createElement("div");o.className="dd",o.textContent=n,e.appendChild(s),e.appendChild(o),i.appendChild(r),r.appendChild(e)}n.appendChild(i)}t.appendChild(n)}}var Qe=n(28),Ze=n(14);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let et=0;function tt(e,t){""===t.id&&(t.id=`unique-id-for-association-${et++}`),e.setAttribute("for",t.id)}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nt=n(36);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function it(e){const t=e.parentElement,n=e.offsetLeft-t.clientLeft,i=e.offsetTop-t.clientTop,r=n+e.offsetWidth,s=i+e.offsetHeight,o=t.clientWidth,a=t.clientHeight,l=t.scrollLeft,c=l+o,u=t.scrollTop,d=u+a,h=Math.max(0,r-c)||Math.min(0,n-l),p=Math.max(0,s-d)||Math.min(0,i-u);t.scrollLeft+=h,t.scrollTop+=p}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */n(204);const rt="autocomplete-completion-active",st=Symbol("autocompleteIndex");function ot(e){let t=document.createElement("div");return t.textContent=e.value,t}function at(e){let t=document.createElement("div");t.className="autocomplete-completion-with-description",t.textContent=e.value;let n=document.createElement("div");return n.className="autocomplete-completion-description",n.textContent=e.description||"",t.appendChild(n),t}const lt=nt.a.fromObject({arrowdown:{action:"cycle-next-active-completion"},arrowup:{action:"cycle-prev-active-completion"},tab:{action:"choose-active-completion-or-prefix",preventDefault:!1},enter:{action:"choose-active-completion",preventDefault:!1},escape:{action:"cancel",preventDefault:!1,stopPropagation:!1}}),ct=200;class ut extends r.a{constructor(e){super(),this.inputChanged=new se.b,this.prevInputValue="",this.completionsVisible=!1,this.activeCompletionPromise=null,this.activeCompletionCancellationToken=void 0,this.hasFocus=!1,this.completionResult=null,this.dropdownContentsStale=!0,this.updateHintScrollPositionTimer=null,this.completionElements=null,this.hasResultForDropdown=!1,this.commonPrefix="",this.activeIndex=-1,this.dropdownStyleStale=!0,this.completer=e.completer;let{delay:t=ct}=e,n=this.scheduleUpdateCompletions=F()(()=>{const e=this.activeCompletionCancellationToken=new Ze.b;let t=this.activeCompletionPromise=this.completer(this.value,e);null!==t&&t.then(e=>{this.activeCompletionPromise===t&&(this.setCompletions(e),this.activeCompletionPromise=null)})},t);this.registerDisposer(()=>{n.cancel()});let i=this.element=document.createElement("div");i.className="autocomplete";let r=document.createElement("div");r.className="autocomplete-dropdown-wrapper";let s=this.dropdownElement=document.createElement("div");s.className="autocomplete-dropdown";let o=this.promptElement=document.createElement("label");o.className="autocomplete-prompt";let a=this.inputWrapperElement=document.createElement("div");a.className="autocomplete-input-wrapper",i.appendChild(o);let l=this.inputElement=document.createElement("input");l.type="text",l.autocomplete="off",l.spellcheck=!1,l.className="autocomplete-input",tt(o,l);let c=this.hintElement=document.createElement("input");c.type="text",c.spellcheck=!1,c.className="autocomplete-hint",c.disabled=!0,a.appendChild(c),a.appendChild(l),r.appendChild(a),r.appendChild(s),i.appendChild(r),this.registerInputHandler(),this.handleInputChanged(""),this.registerEventListener(this.inputElement,"focus",()=>{this.hasFocus||(this.hasFocus=!0,this.dropdownStyleStale=!0,this.updateDropdown())}),this.registerEventListener(this.inputElement,"blur",()=>{this.hasFocus&&(this.hasFocus=!1,this.updateDropdown())}),this.registerEventListener(i.ownerDocument.defaultView,"resize",()=>{this.dropdownStyleStale=!0}),this.registerEventListener(i.ownerDocument.defaultView,"scroll",()=>{this.dropdownStyleStale=!0}),this.registerEventListener(this.dropdownElement,"mousedown",this.handleDropdownMousedown.bind(this)),this.registerEventListener(this.inputElement,"keydown",()=>{this.hintScrollPositionMayBeStale()}),this.registerEventListener(this.inputElement,"mousemove",e=>{0!==e.buttons&&this.hintScrollPositionMayBeStale()}),this.registerDisposer(new nt.b(l,lt)).allShortcutsAreGlobal=!0,Object(nt.c)(l,"cycle-next-active-completion",()=>{this.cycleActiveCompletion(1)}),Object(nt.c)(l,"cycle-prev-active-completion",()=>{this.cycleActiveCompletion(-1)}),Object(nt.c)(l,"choose-active-completion-or-prefix",e=>{this.selectActiveCompletion(!0)&&e.preventDefault()}),Object(nt.c)(l,"choose-active-completion",e=>{this.selectActiveCompletion(!1)&&e.preventDefault()}),Object(nt.c)(l,"cancel",e=>{e.stopPropagation(),this.cancel()&&(e.detail.preventDefault(),e.detail.stopPropagation())})}hintScrollPositionMayBeStale(){""!==this.hintElement.value&&this.scheduleUpdateHintScrollPosition()}get disabled(){return this.inputElement.disabled}set disabled(e){this.inputElement.disabled=e}handleDropdownMousedown(e){this.inputElement.focus();let{dropdownElement:t}=this;for(let n=e.target;n instanceof HTMLElement;n=n.parentElement){let e=n[st];if(void 0!==e){this.selectCompletion(e);break}if(n===t)break}e.preventDefault()}cycleActiveCompletion(e){if(null===this.completionResult)return;let{activeIndex:t}=this,n=this.completionResult.completions.length;t=-1===t?e>0?0:n-1:(t+e+n)%n,this.setActiveIndex(t)}registerInputHandler(){const e=e=>{let t=this.inputElement.value;t!==this.prevInputValue&&(this.prevInputValue=t,this.handleInputChanged(t))};for(let t of["input"])this.registerEventListener(this.inputElement,t,e,!1)}shouldShowDropdown(){let{completionResult:e}=this;return!(null===e||!this.hasFocus)&&this.hasResultForDropdown}updateDropdownStyle(){let{dropdownElement:e,inputElement:t}=this;!function(e,t,{horizontal:n=!1,vertical:i=!0,topMargin:r=6,bottomMargin:s=6,leftMargin:o=6,rightMargin:a=6,maxHeight:l=!0,maxWidth:c=!0}={}){let u=t.getBoundingClientRect();if(n){let t=e.ownerDocument.documentElement.clientHeight,n=u.right,i=t-u.left;n>i?(e.style.left="",e.style.right="0",c&&(e.style.maxWidth=n-o+"px")):(e.style.right="",e.style.left="0",c&&(e.style.maxWidth=i-a+"px"))}if(i){let t=e.ownerDocument.documentElement.clientHeight,n=u.top-r,i=t-u.bottom-s;n>3*i?(e.style.top="",e.style.bottom="100%",l&&(e.style.maxHeight=n+"px")):(e.style.top="100%",e.style.bottom="",l&&(e.style.maxHeight=i+"px"))}}(e,t,{horizontal:!1}),this.dropdownStyleStale=!1}updateDropdown(){if(this.shouldShowDropdown()){let{dropdownElement:e}=this,{activeIndex:t}=this;if(this.dropdownContentsStale){let n=this.completionResult,{makeElement:i=ot}=n;this.completionElements=n.completions.map((r,s)=>{let o=i.call(n,r);return o[st]=s,o.classList.add("autocomplete-completion"),t===s&&o.classList.add(rt),e.appendChild(o),o}),this.dropdownContentsStale=!1}if(this.dropdownStyleStale&&this.updateDropdownStyle(),this.completionsVisible||(e.style.display="block",this.completionsVisible=!0),-1!==t){it(this.completionElements[t])}}else this.completionsVisible&&(this.dropdownElement.style.display="none",this.completionsVisible=!1)}setCompletions(e){this.clearCompletions();let{completions:t}=e;if(0!==t.length){if(this.completionResult=e,1===t.length){let n=t[0];if(e.showSingleResult)this.hasResultForDropdown=!0;else{let e=this.prevInputValue;n.value.startsWith(e)?this.hasResultForDropdown=!1:this.hasResultForDropdown=!0}e.selectSingleResult?this.setActiveIndex(0):this.setHintValue(this.getCompletedValueByIndex(0))}else{this.hasResultForDropdown=!0;let t=function(e){let t=e[Symbol.iterator](),{value:n,done:i}=t.next();if(i)return"";let r=n.length;for(;r>0;){let{value:e,done:i}=t.next();if(i)break;let s=0;for(;s<r&&n.charCodeAt(s)===e.charCodeAt(s);++s);r=s}return n.substring(0,r)}(function*(){for(let t of e.completions)yield t.value}()),n=this.getCompletedValue(t),i=this.prevInputValue;n.startsWith(i)&&(this.commonPrefix=n,this.setHintValue(n))}this.updateDropdown()}}scheduleUpdateHintScrollPosition(){null===this.updateHintScrollPositionTimer&&(this.updateHintScrollPositionTimer=setTimeout(()=>{this.updateHintScrollPosition()},0))}setHintValue(e){let t=this.prevInputValue;e!==t&&e.startsWith(t)||(e=""),this.hintElement.value=e,this.scheduleUpdateHintScrollPosition()}setActiveIndex(e){if(!this.dropdownContentsStale){let{activeIndex:t}=this;if(-1!==t&&this.completionElements[t].classList.remove(rt),-1!==e){let t=this.completionElements[e];t.classList.add(rt),it(t)}}-1!==e&&this.setHintValue(this.getCompletedValueByIndex(e)),this.activeIndex=e}getCompletedValueByIndex(e){return this.getCompletedValue(this.completionResult.completions[e].value)}getCompletedValue(e){let t=this.completionResult;return this.prevInputValue.substring(0,t.offset)+e}selectActiveCompletion(e){let{activeIndex:t}=this;if(-1===t){if(!e)return!1;let{completionResult:n}=this;if(null===n||1!==n.completions.length){let{commonPrefix:e}=this;return e.length>this.value.length&&(this.value=e,!0)}t=0}let n=this.getCompletedValueByIndex(t);return this.value!==n&&(this.value=n,!0)}selectCompletion(e){this.value=this.getCompletedValueByIndex(e)}cancel(){return!1}updateHintScrollPosition(){this.updateHintScrollPositionTimer=null,this.hintElement.scrollLeft=this.inputElement.scrollLeft}cancelActiveCompletion(){const e=this.activeCompletionCancellationToken;void 0!==e&&e.cancel(),this.activeCompletionCancellationToken=void 0,this.activeCompletionPromise=null}handleInputChanged(e){this.cancelActiveCompletion(),this.hintElement.value="",this.clearCompletions(),this.inputChanged.dispatch(e),this.scheduleUpdateCompletions()}clearCompletions(){null!==this.completionResult&&(this.activeIndex=-1,this.completionResult=null,this.completionElements=null,this.dropdownContentsStale=!0,this.dropdownStyleStale=!0,this.commonPrefix="",Object(Te.a)(this.dropdownElement),this.updateDropdown())}get value(){return this.prevInputValue}set value(e){e!==this.prevInputValue&&(this.inputElement.value=e,this.prevInputValue=e,this.handleInputChanged(e))}disposed(){Object(Te.b)(this.element),this.cancelActiveCompletion(),null!==this.updateHintScrollPositionTimer&&(clearTimeout(this.updateHintScrollPositionTimer),this.updateHintScrollPositionTimer=null),super.disposed()}}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(206);class dt extends Je.a{constructor(e,t){super(),this.manager=e,this.existingLayer=t,this.statusElement=document.createElement("div"),this.submitElement=document.createElement("button"),this.namePromptElement=document.createElement("label"),this.nameInputElement=document.createElement("input"),this.volumeCancellationSource=void 0,this.sourceValid=!1,this.nameValid=!0;let n=this.content;n.classList.add("add-layer-overlay");let i=document.createElement("form");i.className="source-form",this.registerEventListener(i,"submit",e=>{e.preventDefault(),this.validateSource(!0)});let r=document.createElement("label");r.textContent="Source:";let s=this.sourceInput=this.registerDisposer(new ut({completer:(e,t)=>this.manager.dataSourceProvider.volumeCompleter(e,this.manager.chunkManager,t).then(e=>({completions:e.completions,makeElement:at,offset:e.offset,showSingleResult:!0})),delay:0}));s.element.classList.add("add-layer-source"),s.inputElement.addEventListener("blur",()=>{this.validateSource(!1)}),this.submitElement.disabled=!0,s.inputChanged.add(()=>{const{volumeCancellationSource:e}=this;void 0!==e&&(e.cancel(),this.volumeCancellationSource=void 0),this.sourceValid=!1,this.submitElement.disabled=!0,this.statusElement.textContent=""}),i.appendChild(r),i.appendChild(s.element),tt(r,s.inputElement);let o=function(){let e=document.createElement("button");return e.type="submit",e.className="hidden-submit-button",e.style.margin="0",e.style.border="0",e.style.padding="0",e.style.width="0",e.style.height="0",e.style.overflow="hidden",e.tabIndex=-1,e}();i.appendChild(o),n.appendChild(i);let{statusElement:a,namePromptElement:l,nameInputElement:c,submitElement:u}=this;a.className="dialog-status";let d=document.createElement("form");if(d.className="name-form",l.textContent="Name:",c.className="add-layer-name",c.autocomplete="off",c.spellcheck=!1,c.type="text",this.registerEventListener(c,"input",()=>{this.validateName()}),u.type="submit",tt(l,c),d.appendChild(l),d.appendChild(c),d.appendChild(u),n.appendChild(d),n.appendChild(a),void 0!==t)void 0!==t.sourceUrl?(s.value=t.sourceUrl,this.validateSource()):this.sourceValid=!0,s.disabled=!0,c.value=t.name,this.validateName(),u.textContent="Save",c.focus();else{let{managedLayers:e}=this.manager.layerManager;for(let t=e.length-1;t>=0;--t){const n=e[t];if(!(n instanceof Qe.b))continue;const{sourceUrl:i}=n;if(void 0!==i)try{let e=this.manager.dataSourceProvider.findSourceGroup(i);s.value=i.substring(0,e),s.inputElement.setSelectionRange(0,e);break}catch(e){}}s.inputElement.focus(),u.textContent="Add Layer"}this.registerEventListener(d,"submit",e=>{e.preventDefault(),this.submit()})}isNameValid(){let e=this.nameInputElement.value;if(""===e)return!1;let t=this.manager.layerManager.getLayerByName(e);return void 0===t||t===this.existingLayer}submit(){this.sourceValid&&this.isNameValid()&&(this.existingLayer?(this.existingLayer.name=this.nameInputElement.value,this.manager.layerManager.layersChanged.dispatch()):this.manager.add(this.manager.getLayer(this.nameInputElement.value,this.sourceInput.value)),this.dispose())}validateName(){let{nameInputElement:e}=this;(this.nameValid=this.isNameValid())?(e.classList.add("valid-input"),e.classList.remove("invalid-input")):(e.classList.remove("valid-input"),e.classList.add("invalid-input")),this.validityChanged()}validityChanged(){this.submitElement.disabled=!(this.nameValid&&this.sourceValid)}validateSource(e=!1){let t=this.sourceInput.value;if(""===t)return;try{let n=this.manager.dataSourceProvider.suggestLayerName(t),{nameInputElement:i}=this;if(""===this.nameInputElement.value){let e=this.manager.layerManager.getUniqueLayerName(n);i.value=e,i.setSelectionRange(0,e.length),this.validateName()}e&&i.focus()}catch(e){return void this.setError(e.message)}this.setInfo("Validating volume source...");const n=this.volumeCancellationSource=new Ze.b;this.manager.dataSourceProvider.getVolume(this.manager.chunkManager,t,void 0,n).then(e=>{n.isCanceled||(this.volumeCancellationSource=void 0,this.sourceValid=!0,this.setInfo(`${S.c[e.volumeType].toLowerCase()}: `+`${e.numChannels}-channel ${S.a[e.dataType].toLowerCase()}`),this.validityChanged())}).catch(e=>{n.isCanceled||(this.volumeCancellationSource=void 0,this.setError(e.message))})}setInfo(e){this.statusElement.className="dialog-status dialog-status-info",this.statusElement.textContent=e}setError(e){this.statusElement.className="dialog-status dialog-status-error",this.statusElement.textContent=e}}var ht=n(97);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pt(e){return Object(ht.b)((new TextEncoder).encode(e))}function ft(e,t){var n;if(e.startsWith(t))try{const i=(n=e.substring(t.length),(new TextDecoder).decode(Object(ht.a)(n)));return JSON.parse(i)}catch(e){return}}let gt;function mt(e,t){return e.dataTransfer.dropEffect=t,gt=t,t}function vt(){return gt}
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const bt="neuroglancer-layer\0";let yt;function wt(e,t){var n,i;let r;e.dataTransfer.setData((n=bt,i=t.layers.map(e=>({name:e.name,visible:e.visible})),n+pt(JSON.stringify(i))),JSON.stringify({layers:t.layers.map(e=>e.toJSON()),layout:t.layoutSpec})),void 0!==yt&&yt.disposer();let s=()=>{t.manager.unregisterDisposer(s);for(const e of t.layers)e.dispose();t.manager.dispose(),yt===r&&(yt=void 0)};yt=r={manager:t.manager.addRef(),layers:t.layers.map(e=>e.addRef()),layoutSpec:t.layoutSpec,disposer:s}}function xt(e){if(void 0!==yt){if(e&&"move"===e.dataTransfer.dropEffect){const e=new Set(yt.layers);yt.manager.layerManager.filter(t=>!e.has(t))}yt.disposer()}}function St(e){return function(e,t){for(const n of e){const e=ft(n,t);if(void 0!==e)return{parameters:e,dragType:n}}}(e.dataTransfer.types,bt)}function Ct(e){if(void 0!==yt&&yt.manager.rootLayers===e.rootLayers)return yt}class Ot{finalize(e){const{dragType:t}=this;if(void 0!==t)try{const{layers:n,layout:i}=JSON.parse(e.dataTransfer.getData(t));if(!Array.isArray(n)||this.numSourceLayers!==n.length)throw new Error("Invalid layer drop data");this.layoutSpec=i;for(const[e,t]of this.layers)this.manager.initializeLayerFromSpec(e,n[t]);return!0}catch(e){return!1}return!0}get method(){return void 0!==this.sourceManager?this.manager===this.sourceManager?"move":"link":"copy"}compatibleWithMethod(e){return this.method===e||!this.moveSupported&&"move"===e}}function Lt(e,t,n=!1){return e.shiftKey?"copy":e.ctrlKey?"move":function(e,t=!1){const n=Ct(e);return void 0===n?"copy":t||n.manager!==e?"link":"move"}(t,n)}function Tt(e,t,n,i,r){const s=Ct(t),o=!r&&void 0!==s&&s.manager===t;if(!n&&void 0!==s){const e=new Ot;if(e.manager=t,e.numSourceLayers=s.layers.length,e.sourceManager=s.manager,e.moveSupported=o,e.layers=new Map,e.layoutSpec=s.layoutSpec,!r&&s.manager===t){if(!i)return;s.layers.forEach((t,n)=>{e.layers.set(t,n)})}return s.layers.forEach((n,i)=>{!r&&t.layerManager.has(n)||e.layers.set(n.addRef(),i)}),e}const a=St(e);if(void 0!==a)try{const e=Object(ke.a)(a.parameters,(e,n)=>{const i=Object(ke.v)(e,"name",ke.A),r=Object(ke.v)(e,"visible",ke.l),s=new Qe.b(i,null,t);return s.visible=r,[s,n]}),n=new Ot;return n.numSourceLayers=e.length,n.moveSupported=o,n.manager=t,n.dragType=a.dragType,n.layers=new Map(e),n}catch(e){}}
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kt(e){let t=-1;return Object.assign(()=>{-1===t&&(t=requestAnimationFrame(()=>{t=-1,e()}))},{flush:()=>{-1!==t&&(t=-1,e())},cancel:()=>{-1!==t&&(cancelAnimationFrame(t),t=-1)}})}var Et=n(90),At=n(91),Mt=n(86),It=n(99);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(208),n(100);const Nt="neuroglancer-position",Dt=c.a.fromObject({tab:{action:"tab-forward",preventDefault:!1},arrowup:{action:"adjust-up"},arrowdown:{action:"adjust-down"},wheel:{action:"adjust-via-wheel"},"shift+tab":{action:"tab-backward",preventDefault:!1},backspace:{action:"delete-backward",preventDefault:!1},escape:{action:"cancel"},mouseup0:{action:"select-all-if-was-not-focused",preventDefault:!1}}),Rt="  ",Pt=",   ";class jt extends r.a{constructor(e,t=6){super(),this.position=e,this.maxNumberWidth=t,this.element=document.createElement("div"),this.inputContainer=document.createElement("div"),this.inputElement=document.createElement("input"),this.hintElement=document.createElement("input"),this.tempPosition=o.u.create(),this.updateHintScrollPosition=this.registerCancellable(kt(()=>{this.hintElement.scrollLeft=this.inputElement.scrollLeft}));const{element:n,inputElement:s,hintElement:a,inputContainer:l}=this;l.className="neuroglancer-position-widget-input-container",s.className="neuroglancer-position-widget-input",a.className="neuroglancer-position-widget-hint",this.inputFieldWidth=3*t+Rt.length+2*Pt.length+1;for(const e of[s,a])e.spellcheck=!1,e.autocomplete="off",e.type="text",e.style.width=this.inputFieldWidth+"ch";a.disabled=!0;const u=document.createElement("div");u.textContent="",u.className="neuroglancer-copy-button neuroglancer-button",u.title="Copy position to clipboard",u.addEventListener("click",()=>{const e=function(e,t="text/plain"){let n=!1;const i=Object(r.d)(document,"copy",i=>{const{clipboardData:r}=i;null!==r&&(r.setData(t,e),n=!0),i.stopPropagation(),i.preventDefault()},!0);try{document.execCommand("copy")}finally{i()}return n}(this.getPositionText());i.a.showTemporaryMessage(e?"Position copied to clipboard":"Failed to copy position to clipboard")}),u.addEventListener("dragstart",t=>{t.dataTransfer.setData(Nt,JSON.stringify(e.toJSON())),t.dataTransfer.setData("text",this.getPositionText()),t.stopPropagation()}),u.draggable=!0,n.appendChild(u),n.appendChild(l),l.appendChild(s),l.appendChild(a),n.className="neuroglancer-position-widget",this.registerDisposer(e.changed.add(this.registerCancellable(kt(()=>this.updateView())))),this.registerDisposer(new nt.b(s,Dt)).allShortcutsAreGlobal=!0,this.registerDisposer(new Mt.a(s,Dt)),this.registerEventListener(s,"change",()=>this.updatePosition()),this.registerEventListener(s,"blur",()=>this.updatePosition()),this.registerEventListener(s,"input",()=>this.cleanInput()),this.registerEventListener(s,"keydown",this.updateHintScrollPosition),this.registerEventListener(s,"copy",e=>{const{selectionStart:t,selectionEnd:n}=s;let i=s.value.substring(t||0,n||0);i=i.trim().replace(/\s+/g," ");const{clipboardData:r}=e;null!==r&&r.setData("text/plain",i),e.stopPropagation(),e.preventDefault()});let d=!1;this.registerEventListener(s,"mousedown",()=>{d=document.activeElement===s}),this.registerDisposer(Object(c.d)(s,"select-all-if-was-not-focused",e=>{d||(s.selectionStart=0,s.selectionEnd=s.value.length,s.selectionDirection="forward",e.preventDefault())})),this.registerDisposer(Object(c.d)(s,"tab-forward",e=>{const t=Math.min(s.selectionStart||0,s.selectionEnd||0),n=s.value.substring(t).match(/^([^,\s]*)((?:\s+)|(?:\s*,\s*))?([^,\s]*)/);if(null!==n&&void 0!==n[2])return s.selectionStart=t+n[1].length+n[2].length,s.selectionEnd=s.selectionStart+n[3].length,s.selectionDirection="forward",void e.preventDefault()})),this.registerDisposer(Object(c.d)(s,"tab-backward",e=>{const t=Math.max(s.selectionStart||0,s.selectionEnd||0),n=s.value.substring(0,t).match(/([^,\s]*)((?:\s+)|(?:\s*,\s*))?([^,\s]*)$/);if(null!==n&&void 0!==n[2])return s.selectionStart=n.index,s.selectionEnd=s.selectionStart+n[1].length,s.selectionDirection="forward",void e.preventDefault()})),this.registerDisposer(Object(c.d)(s,"delete-backward",e=>{if(s.selectionStart===s.selectionEnd&&s.selectionStart===s.value.length){const t=s.value.match(/^(.*)(?![\s])(?:(?:\s+)|(?:\s*,\s*))$/);if(null!==t)return s.value=t[1],this.cleanInput(),void e.preventDefault()}})),this.registerDisposer(Object(c.d)(s,"cancel",()=>{this.updateView(),this.inputElement.blur()})),this.registerDisposer(Object(c.d)(s,"adjust-via-wheel",e=>{const t=e.detail,{deltaY:n}=t;if(0===n)return;const i=Math.ceil((s.scrollLeft+t.offsetX-s.clientLeft)/(s.scrollWidth/this.inputFieldWidth));this.adjustFromCursor(i,-Math.sign(n))})),this.registerDisposer(Object(c.d)(s,"adjust-up",()=>{this.adjustFromCursor(void 0,1)})),this.registerDisposer(Object(c.d)(s,"adjust-down",()=>{this.adjustFromCursor(void 0,-1)})),this.updateView()}adjustFromCursor(e,t){const{inputElement:n}=this;if(void 0===e&&(e=("forward"===n.selectionDirection?n.selectionEnd:n.selectionStart)||0),void 0===this.cleanInput())return;const i=n.value.substring(0,e).split(",").length-1;this.updatePosition();const r=this.tempPosition;this.position.getVoxelCoordinates(r)&&(r[i]+=t,this.position.setVoxelCoordinates(r),this.updateView())}cleanInput(){const e=this.inputElement.value,t=this.inputElement.selectionStart||0,n=/(-?\d+(?:\.(?:\d+)?)?)/.source,i=/((?:\s+(?![\s,]))|(?:\s*,\s*))/.source,r=/([\[\]{}()\s]*)/.source,s=new RegExp(`^${r}(?![\\s])${n}?`+`(?:${i}${n}?(?:${i}${n}?)?)?`+`${r}$`),a=e.match(s);if(null!==a){let e=Rt,n="x ",i=2,r=a[1].length;const s=(s,o,a)=>{if(void 0===s)return;let l=r+s.length;void 0===o&&(a=" ".repeat((o=s).length)),t>=r&&(i=t===l?e.length+o.length:e.length+Math.min(o.length,t-r)),e+=o,n+=a,r=l};return s(a[2]),s(a[3],Pt,"  y "),s(a[4]),s(a[5],Pt,"  z "),s(a[6]),this.hintElement.value=n,this.inputElement.value!==e&&(this.inputElement.value=e,this.inputElement.selectionEnd=i,this.inputElement.selectionStart=i),this.updateHintScrollPosition(),void 0!==a[2]&&void 0!==a[4]&&void 0!==a[6]?{position:o.u.set(this.tempPosition,parseFloat(a[2]),parseFloat(a[4]),parseFloat(a[6]))}:{}}this.hintElement.value=""}updatePosition(){const e=this.cleanInput();void 0!==e&&void 0!==e.position&&this.position.setVoxelCoordinates(e.position)}getPositionText(){const{position:e}=this,t=this.tempPosition;return e.getVoxelCoordinates(t)?`${Math.floor(t[0])}, ${Math.floor(t[1])}, ${Math.floor(t[2])}`:"<unspecified position>"}updateView(){const{position:e}=this,t=this.tempPosition;if(e.getVoxelCoordinates(t)){const{inputElement:e}=this,n=`  ${Math.floor(t[0])},   ${Math.floor(t[1])},   ${Math.floor(t[2])}`,i=n.indexOf(","),r=n.indexOf(",",i+1)-i-4;let s=`x ${" ".repeat(i-2)}  y ${" ".repeat(r)}  z`;const o=e.selectionStart||0,a=e.selectionEnd||0,l=e.selectionDirection||void 0;e.value=n,e.setSelectionRange(o,a,l),this.hintElement.value=s+" ".repeat(n.length-s.length),this.updateHintScrollPosition()}else this.inputElement.value="",this.hintElement.value=""}disposed(){Object(Te.b)(this.element),super.disposed()}}class Vt extends r.a{constructor(e,t){super(),this.element=e,this.voxelSize=t,this.dimensionsContainer=document.createElement("span"),this.unitsElement=document.createElement("span");const{dimensionsContainer:n,unitsElement:i}=this;e.className="neuroglancer-voxel-size-widget",e.title="Voxel size",n.className="neuroglancer-voxel-size-dimensions-container",e.appendChild(n),e.appendChild(i),i.className="neuroglancer-voxel-size-units",this.registerDisposer(t.changed.add(this.registerCancellable(kt(()=>this.updateView())))),this.updateView()}updateView(){const{dimensionsContainer:e,unitsElement:t}=this;Object(Te.a)(e),this.voxelSize.valid?this.element.style.display=null:this.element.style.display="none";const{size:n}=this.voxelSize,i=Math.min(n[0],n[1],n[2]),r=Object(ue.c)(i);t.textContent=r.unit;for(let t=0;t<3;++t){const i=Object(It.a)(n[t]/r.lengthInNanometers,2),s=document.createElement("span");s.className="neuroglancer-voxel-size-dimension",s.textContent=i,e.appendChild(s)}}disposed(){Object(Te.b)(this.element),super.disposed()}}class _t extends r.a{constructor(e,t,n){super(),this.element=e,this.mouseState=t,this.voxelSize=n,this.tempPosition=o.u.create(),e.className="neuroglancer-mouse-position-widget";const i=this.registerCancellable(kt(()=>this.updateView()));this.registerDisposer(t.changed.add(i)),this.registerDisposer(n.changed.add(i))}updateView(){let e="";const{mouseState:t,voxelSize:n}=this;if(t.active&&n.valid){const i=this.tempPosition;n.voxelFromSpatial(i,t.position),e=`x ${Math.floor(i[0])},  y ${Math.floor(i[1])},  z ${Math.floor(i[2])}`}this.element.textContent=e}disposed(){Object(Te.b)(this.element),super.disposed()}}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ut(e,t){return"move"!==e.method&&(e.manager.layerManager.filter(t=>!e.layers.has(t)),void 0!==t&&e.layers.has(t))}function Ft(e,t,n){function i(t,i){let r=e.dropLayers;const s=i?Lt(t,e.manager):vt();let o=!0;if(void 0===r||(i&&mt(t,s),r.compatibleWithMethod(s)||(e.dropLayers=void 0,!Ut(r,n)))){if(void 0===r){if(void 0===(r=e.dropLayers=Tt(t,e.manager,"copy"===s,!0,!1)))return;o="move"===r.method}if(void 0!==n&&r.layers.has(n))return r;if(o){const{layerManager:t}=e.manager,i=new Set;let s=Number.POSITIVE_INFINITY;const o=t.managedLayers=t.managedLayers.filter((e,t)=>!r.layers.has(e)||(s===Number.POSITIVE_INFINITY&&(s=t),i.add(e),!1));let a;void 0!==n?(a=o.indexOf(n),s<=a&&++a):a=o.length;for(const e of r.layers.keys())i.has(e)||r.layers.delete(e);o.splice(a,0,...r.layers.keys()),t.layersChanged.dispatch()}else{let t;void 0!==n&&(t=e.manager.layerManager.managedLayers.indexOf(n));for(const n of r.layers.keys())e.manager.add(n,t)}return r}}const s=Object(r.d)(t,"dragenter",e=>{void 0!==i(e,!0)&&e.preventDefault()}),o=Object(r.d)(t,"drop",t=>{t.preventDefault();const n=i(t,!1);void 0!==n&&(n.finalize(t)?(t.dataTransfer.dropEffect=vt(),xt("move"===n.method?void 0:t)):Ut(n)),e.dropLayers=void 0}),a=Object(r.d)(t,"dragover",e=>{void 0!==i(e,!0)&&(e.preventDefault(),e.stopPropagation())});return()=>{a(),o(),s()}}n(79),n(210),n(100);class zt extends r.a{constructor(e,t){super(),this.layer=e,this.panel=t;let n=this.element=document.createElement("div");n.title="Control+click for layer options, drag to move/copy.",n.className="neuroglancer-layer-item neuroglancer-noselect";let i=this.labelElement=document.createElement("span");i.className="neuroglancer-layer-item-label";let r=this.layerNumberElement=document.createElement("span");r.className="neuroglancer-layer-item-number";let s=this.valueElement=document.createElement("span");s.className="neuroglancer-layer-item-value";const o=Object(At.a)();o.title="Delete layer",this.registerEventListener(o,"click",e=>{this.panel.layerManager.removeManagedLayer(this.layer),e.stopPropagation()}),n.appendChild(r),n.appendChild(i),n.appendChild(s),n.appendChild(o),this.registerEventListener(n,"click",n=>{n.ctrlKey?(t.selectedLayer.layer=e,t.selectedLayer.visible=!0):e.setVisible(!e.visible)}),this.registerEventListener(n,"contextmenu",n=>{t.selectedLayer.layer=e,t.selectedLayer.visible=!0,n.stopPropagation(),n.preventDefault()}),n.draggable=!0,this.registerEventListener(n,"dragstart",e=>{wt(e,{manager:t.manager,layers:[this.layer],layoutSpec:t.getLayoutSpecForDrag()}),e.stopPropagation()}),this.registerEventListener(n,"dragend",e=>{xt(e)}),this.registerDisposer(Ft(this.panel,n,this.layer)),this.registerEventListener(n,"dblclick",t=>{e instanceof Qe.b&&new dt(this.panel.manager,e)})}update(){let{layer:e}=this;this.labelElement.textContent=e.name,this.element.setAttribute("layer-visible",e.visible.toString()),this.element.setAttribute("layer-selected",(e===this.panel.selectedLayer.layer).toString())}disposed(){this.element.parentElement.removeChild(this.element),super.disposed()}}class Bt extends r.a{constructor(e,t,n,i,s){super(),this.display=e,this.manager=t,this.viewerNavigationState=n,this.selectedLayer=i,this.getLayoutSpecForDrag=s,this.layerWidgets=new Map,this.element=document.createElement("div"),this.layerUpdateNeeded=!0,this.valueUpdateNeeded=!1,this.layerWidgetInsertionPoint=document.createElement("div"),this.positionWidget=this.registerDisposer(new jt(this.viewerNavigationState.position.value)),this.scheduleUpdate=this.registerCancellable(kt(()=>this.update())),this.registerDisposer(i);const{element:o}=this;o.className="neuroglancer-layer-panel",this.registerDisposer(t.layerSelectedValues.changed.add(()=>{this.handleLayerValuesChanged()})),this.registerDisposer(t.layerManager.layersChanged.add(()=>{this.handleLayersChanged()})),this.registerDisposer(i.changed.add(()=>{this.handleLayersChanged()})),this.layerWidgetInsertionPoint.style.display="none",this.element.appendChild(this.layerWidgetInsertionPoint);let a=document.createElement("div");a.className="neuroglancer-layer-add-button neuroglancer-button",a.title="Click to add layer, control+click to add local annotation layer.",a.textContent="+";let l=this.dropZone=document.createElement("div");l.className="neuroglancer-layer-panel-drop-zone",this.registerEventListener(a,"click",e=>{if(e.ctrlKey){const e=new Qe.b("annotation",{},this.manager);this.manager.initializeLayerFromSpec(e,{type:"annotation"}),this.manager.add(e)}else this.addLayerMenu()}),o.appendChild(a),o.appendChild(l),this.registerDisposer(function(e){return e.draggable=!0,Object(r.d)(e,"dragstart",e=>{e.stopPropagation(),e.preventDefault()})}(a)),o.appendChild(this.positionWidget.element);const c=()=>{const e=this.viewerNavigationState.position.link.value;this.positionWidget.element.style.display=e===$.d.LINKED?"none":null};this.registerDisposer(this.viewerNavigationState.position.link.changed.add(c)),c(),this.update(),this.registerEventListener(o,"dragleave",e=>{if(e.relatedTarget&&o.contains(e.relatedTarget))return;const{dropLayers:t}=this;void 0!==t&&(Ut(t),this.dropLayers=void 0)}),this.registerDisposer(Ft(this,a,void 0)),this.registerDisposer(Ft(this,l,void 0)),this.registerDisposer(e.updateStarted.add(()=>this.updateLayers()))}get layerManager(){return this.manager.layerManager}disposed(){this.layerWidgets.forEach(e=>e.dispose()),this.layerWidgets=void 0,Object(Te.b)(this.element),super.disposed()}handleLayersChanged(){this.layerUpdateNeeded=!0,this.handleLayerValuesChanged()}handleLayerValuesChanged(){this.valueUpdateNeeded||(this.valueUpdateNeeded=!0,this.scheduleUpdate())}update(){this.valueUpdateNeeded=!1,this.updateLayers();let e=this.manager.layerSelectedValues;for(let[t,n]of this.layerWidgets){let i=t.layer,r="";if(null!==i){let t=e.get(i);void 0!==t&&(r+=(t=(t=Array().concat(t)).map(e=>null===e?"null":Math.fround(e)===e?Object(Et.a)(e):e)).join(", "))}n.valueElement.textContent=r}}updateLayers(){if(!this.layerUpdateNeeded)return;this.layerUpdateNeeded=!1;let e=this.element,t=new Set,n=this.layerWidgetInsertionPoint.nextElementSibling;this.manager.layerManager.managedLayers.forEach(i=>{t.add(i);let r=this.layerWidgets.get(i);const s=this.manager.rootLayers.managedLayers.indexOf(i);void 0===r&&(r=new zt(i,this),this.layerWidgets.set(i,r)),r.layerNumberElement.textContent=""+(1+s),r.update();let{element:o}=r;o!==n&&e.insertBefore(r.element,n),n=o.nextElementSibling});for(let[e,n]of this.layerWidgets)t.has(e)||(this.layerWidgets.delete(e),n.dispose())}addLayerMenu(){new dt(this.manager)}}
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */n(212);class Gt extends r.a{constructor(e){super(),this.element=document.createElement("div"),this.parentDisposers=new Map,this.disabledValue=!1,this.opened=new se.a,this.closed=new se.a;const{element:t}=this;t.className="neuroglancer-context-menu",t.style.visibility="hidden",t.tabIndex=-1,document.body.appendChild(t),void 0!==e&&this.registerParent(e)}get disabled(){return this.disabledValue}set disabled(e){this.disabledValue!==e&&(this.disabledValue=e,e&&this.hide())}get open(){return void 0!==this.menuDisposer}registerParent(e){const{parentDisposers:t}=this;t.has(e)||t.set(e,Object(r.d)(e,"contextmenu",e=>{this.show(e),e.stopPropagation(),e.preventDefault()}))}show(e){if(this.disabledValue)return;this.hide();const{element:t}=this,n=Object(r.d)(document,"mousedown",e=>{e.target instanceof Node&&!t.contains(e.target)&&this.hide()},!0),i=Object(r.d)(document,"keydown",e=>{"Escape"===e.code&&this.hide()},!0);t.style.display=null,t.style.visibility="hidden",this.opened.dispatch(),function(e,t){const{offsetWidth:n,offsetHeight:i}=e,r=document.documentElement.clientWidth,s=document.documentElement.clientHeight,o=document.documentElement.scrollLeft+Math.min(r-n,t.clientX),a=document.documentElement.scrollTop+Math.min(s-i,t.clientY);e.style.left=o+"px",e.style.top=a+"px",e.style.visibility=null}(t,e),this.menuDisposer=(()=>{i(),n(),t.style.display="none"})}unregisterParent(e){const{parentDisposers:t}=this,n=t.get(e);void 0!==n&&(n(),t.delete(e))}disposed(){const{parentDisposers:e}=this;for(const t of e.values())t();e.clear(),Object(Te.b)(this.element)}hide(){void 0!==this.menuDisposer&&(this.menuDisposer(),this.menuDisposer=void 0,this.closed.dispatch())}}
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wt(e,t){const n=Object(r.d)(e,"drop",e=>{if(e.preventDefault(),-1!==e.dataTransfer.types.indexOf(Nt)){const n=JSON.parse(e.dataTransfer.getData(Nt));t.restoreState(n),e.stopPropagation()}}),i=Object(r.d)(e,"dragover",e=>{-1!==e.dataTransfer.types.indexOf(Nt)&&(e.dataTransfer.dropEffect="link",e.preventDefault(),e.stopPropagation())});return()=>{i(),n()}}var $t=n(71),Ht=n(110);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(214);const qt="neuroglancer-layer-group-viewer";function Yt(e){return-1!==e.dataTransfer.types.indexOf(qt)}let Jt;function Xt(e){return void 0!==function(e){return Jt&&Jt.viewer.layerSpecification.rootLayers===e.rootLayers?Jt.viewer:void 0}(e)?"move":"copy"}class Kt extends r.a{constructor(e){super(),this.position=new $.b(e.navigationState.position.addRef()),this.crossSectionOrientation=new $.a(e.navigationState.pose.orientation.addRef()),this.crossSectionZoom=new $.c(e.navigationState.zoomFactor.addRef()),this.navigationState=this.registerDisposer(new $.e(new $.g(this.position.value,this.crossSectionOrientation.value),this.crossSectionZoom.value)),this.perspectiveOrientation=new $.a(e.perspectiveNavigationState.pose.orientation.addRef()),this.perspectiveZoom=new $.c(e.perspectiveNavigationState.zoomFactor.addRef()),this.perspectiveNavigationState=this.registerDisposer(new $.e(new $.g(this.position.value.addRef(),this.perspectiveOrientation.value),this.perspectiveZoom.value))}copyToParent(){for(const e of[this.position,this.crossSectionOrientation,this.crossSectionZoom,this.perspectiveOrientation,this.perspectiveZoom])e.copyToPeer()}register(e){e.add("position",this.position),e.add("crossSectionOrientation",this.crossSectionOrientation),e.add("crossSectionZoom",this.crossSectionZoom),e.add("perspectiveOrientation",this.perspectiveOrientation),e.add("perspectiveZoom",this.perspectiveZoom)}}class Qt extends r.a{constructor(e,t,n={}){super(),this.element=e,this.viewerState=t,this.state=new a.a,this.options=Object.assign({showLayerPanel:new ie.b(!0),showViewerMenu:!1},n),this.layerSpecification=this.registerDisposer(t.layerSpecification),this.viewerNavigationState=this.registerDisposer(new Kt(t)),this.viewerNavigationState.register(this.state),this.layerSpecification instanceof Qe.a?this.state.add("layers",this.layerSpecification):this.state.add("layers",{changed:this.layerSpecification.changed,toJSON:()=>this.layerSpecification.layerManager.managedLayers.map(e=>e.name),reset:()=>{throw new Error("not implemented")},restoreState:()=>{throw new Error("not implemented")}}),e.classList.add("neuroglancer-layer-group-viewer"),this.registerDisposer(new $t.a(e)),this.layout=this.registerDisposer(new qe(this,"xy")),this.state.add("layout",this.layout),this.registerActionBindings(),this.registerDisposer(this.layerManager.useDirectly()),this.registerDisposer(Wt(e,this.navigationState.position)),this.registerDisposer(this.options.showLayerPanel.changed.add(this.registerCancellable(F()(()=>this.updateUI(),0)))),this.makeUI()}get perspectiveNavigationState(){return this.viewerNavigationState.perspectiveNavigationState}get navigationState(){return this.viewerNavigationState.navigationState}get display(){return this.viewerState.display}get selectedLayer(){return this.viewerState.selectedLayer}get layerManager(){return this.layerSpecification.layerManager}get chunkManager(){return this.layerSpecification.chunkManager}get mouseState(){return this.viewerState.mouseState}get showAxisLines(){return this.viewerState.showAxisLines}get showScaleBar(){return this.viewerState.showScaleBar}get showPerspectiveSliceViews(){return this.viewerState.showPerspectiveSliceViews}get inputEventBindings(){return this.viewerState.inputEventBindings}get visibility(){return this.viewerState.visibility}get visibleLayerRoles(){return this.viewerState.visibleLayerRoles}get crossSectionBackgroundColor(){return this.viewerState.crossSectionBackgroundColor}get perspectiveViewBackgroundColor(){return this.viewerState.perspectiveViewBackgroundColor}get scaleBarOptions(){return this.viewerState.scaleBarOptions}get changed(){return this.state.changed}bindAction(e,t){this.registerDisposer(Object(c.d)(this.element,e,t))}registerActionBindings(){this.bindAction("add-layer",()=>{this.layerPanel&&this.layerPanel.addLayerMenu()})}toJSON(){return Object.assign({type:"viewer"},this.state.toJSON())}reset(){this.state.reset()}restoreState(e){this.state.restoreState(e)}makeUI(){this.element.style.flex="1",this.element.style.display="flex",this.element.style.flexDirection="column",this.element.appendChild(this.layout.element),this.updateUI()}updateUI(){const{options:e}=this,t=e.showLayerPanel.value;if(void 0!==this.layerPanel&&!t)return this.layerPanel.dispose(),void(this.layerPanel=void 0);if(t&&void 0===this.layerPanel){const t=this.layerPanel=new Bt(this.display,this.layerSpecification,this.viewerNavigationState,this.viewerState.selectedLayer,()=>this.layout.toJSON());e.showViewerMenu?(t.registerDisposer(function(e,t){const n=new Gt(e),i=n.element;i.classList.add("neuroglancer-layer-group-viewer-context-menu");const r=document.createElement("button");r.textContent="Remove layer group",i.appendChild(r),n.registerEventListener(r,"click",()=>{t.layerSpecification.layerManager.clear()});const{viewerNavigationState:s}=t;for(const[e,t]of[["Position",s.position.link],["Cross-section orientation",s.crossSectionOrientation.link],["Cross-section zoom",s.crossSectionZoom.link],["Perspective orientation",s.perspectiveOrientation.link],["Perspective zoom",s.perspectiveZoom.link]]){const r=n.registerDisposer(new Ht.a(t)),s=document.createElement("label");s.style.display="flex",s.style.flexDirection="row",s.style.whiteSpace="nowrap",s.textContent=e,s.appendChild(r.element),i.appendChild(s)}return n}(t.element,this)),t.element.title="Right click for options, drag to move/copy layer group."):t.element.title="Drag to move/copy layer group.",t.element.draggable=!0,this.registerEventListener(t.element,"dragstart",e=>{wt(e,{manager:this.layerSpecification,layers:this.layerManager.managedLayers,layoutSpec:this.layout.toJSON()});const t=()=>{Jt&&Jt.viewer===this&&(Jt=void 0),this.unregisterDisposer(t)};Jt={viewer:this,disposer:t},this.registerDisposer(t);const n=this.toJSON();delete n.layers,e.dataTransfer.setData(qt,JSON.stringify(n))}),this.registerEventListener(t.element,"dragend",e=>{xt(e),void 0!==Jt&&Jt.viewer===this&&Jt.disposer()}),this.element.insertBefore(t.element,this.element.firstChild)}}disposed(){Object(Te.a)(this.element);const{layerPanel:e}=this;void 0!==e&&(e.dispose(),this.layerPanel=void 0),super.disposed()}}
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */n(216);const Zt=Symbol("layoutComponentContainer");class en extends r.a{constructor(e,t,n){super(),this.viewer=e,this.parent=n,this.changed=new se.a,this.element=document.createElement("div");const{element:i}=this;i.style.display="flex",i.style.flex="1",i.style.position="relative",i.style.alignItems="stretch",i.foo="hello",i[Zt]=this,this.setSpecification(t);const r=[],s=e=>{const t=document.createElement("div");let n;switch(t.className="neuroglancer-layout-split-drop-zone",t.style[e]="0",e){case"left":case"right":n="row",t.style.width="10px",t.style.height="100%";break;case"top":case"bottom":n="column",t.style.height="10px",t.style.width="100%"}t.style.display="none",r.push({element:t,direction:n,orientation:e}),i.appendChild(t),this.registerDisposer(rn(t,this.viewer.layerSpecification,()=>this.split(e).newContainer.component))};s("left"),s("right"),s("top"),s("bottom");let o=!1;this.registerEventListener(i,"dragenter",e=>{if(!o&&void 0!==St(e)){o=!0;for(const{element:e,direction:t,orientation:i}of r){if(void 0!==n&&t===n.direction&&(("left"===i||"top"===i)&&n.get(0)!==this||("bottom"===i||"right"===i)&&n.get(n.length-1)!==this))continue;const{component:r}=this;r instanceof sn&&r.direction===t||(e.style.display="block")}}},!0),this.registerEventListener(i,"drop",e=>{if(o){o=!1;for(const{element:e}of r)e.style.display="none"}}),this.registerEventListener(i,"dragleave",e=>{const{relatedTarget:t}=e;if(o&&!(t instanceof HTMLElement&&this.element.contains(t))){o=!1;for(const{element:e}of r)e.style.display="none"}},!0)}unsetComponent(){const e=this.componentValue;void 0!==e&&(e.changed.remove(this.changed.dispatch),this.element.removeChild(e.element),e.dispose())}get component(){return this.componentValue}setComponent(e){if(this.unsetComponent(),this.componentValue=e,e.changed.add(this.changed.dispatch),this.element.appendChild(e.element),e instanceof Qt){const{layerManager:t}=e,n=e.registerCancellable(F()(()=>{0===t.managedLayers.length&&this.dispose()},0));e.registerDisposer(t.layersChanged.add(()=>{0===t.managedLayers.length&&n()})),n()}else if(e instanceof sn){const t=e.registerCancellable(F()(()=>{const{length:t}=e;if(0===t&&void 0!==this.parent)this.dispose();else if(1===t){const t=e.get(0).component;let n;if(void 0===this.parent&&t instanceof Qt){n=t.layout.specification.toJSON(),t.viewerNavigationState.copyToParent();const e=new Set(t.layerManager.managedLayers),{layerSpecification:i}=t;i.rootLayers.filter(t=>e.has(t)),i.rootLayers.managedLayers=Array.from(t.layerManager.managedLayers),i.rootLayers.layersChanged.dispatch()}else n=t.toJSON();this.setSpecification(n)}},0));e.registerDisposer(e.changed.add(()=>{e.length<2&&t()})),t()}this.changed.dispatch()}toJSON(){return this.component.toJSON()}setSpecification(e){this.setComponent(function(e,t){const n=document.createElement("div");if(n.style.flex="1",n.style.width="0px","string"==typeof t){if(void 0!==e.parent)throw new Error(`Invalid layout component specification: ${JSON.stringify(t)}`);return new nn(n,t,e.viewer)}Object(ke.t)(t);const i=Object(ke.v)(t,"type",ke.A);switch(i){case"row":case"column":return new sn(n,i,Object(ke.v)(t,"children",t=>{const n=Object(ke.a)(t,e=>e);if(void 0===e.parent&&0===n.length)throw new Error("Stack layout requires at least one child.");return n}),e);case"viewer":{const i=e.viewer,r=new Qe.a(i.layerSpecification.addRef()),s=new Qt(n,Object.assign({display:i.display,layerSpecification:r},tn(i)),{showLayerPanel:i.uiControlVisibility.showLayerPanel,showViewerMenu:!0});try{s.restoreState(t)}catch(e){throw s.dispose(),e}return s}default:return new nn(n,t,e.viewer)}}(this,e))}static getFromElement(e){return e[Zt]}disposed(){this.unsetComponent(),this.componentValue=void 0,super.disposed()}split(e){const t={type:"viewer"},{parent:n}=this;if(void 0!==n){if("left"===e&&"row"===n.direction||"top"===e&&"column"===n.direction)return{newContainer:n.insertChild(t,this),existingContainer:this};if("right"===e&&"row"===n.direction||"bottom"===e&&"column"===n.direction)return{newContainer:n.insertChild(t),existingContainer:this}}let i;const r=this.component;let s,o;i=r instanceof nn?r.layerGroupViewer.toJSON():r.toJSON();const a="left"===e||"right"===e?"row":"column";switch(e){case"left":case"top":s={type:a,children:[t,i]},o=0;break;case"right":case"bottom":s={type:a,children:[i,t]},o=1}this.setSpecification(s);const l=this.component;return{newContainer:l.get(o),existingContainer:l.get(1-o)}}}function tn(e){return{mouseState:e.mouseState,showAxisLines:e.showAxisLines,showScaleBar:e.showScaleBar,scaleBarOptions:e.scaleBarOptions,showPerspectiveSliceViews:e.showPerspectiveSliceViews,inputEventBindings:e.inputEventBindings,visibility:e.visibility,selectedLayer:e.selectedLayer,visibleLayerRoles:e.visibleLayerRoles,navigationState:e.navigationState.addRef(),perspectiveNavigationState:e.perspectiveNavigationState.addRef(),crossSectionBackgroundColor:e.crossSectionBackgroundColor,perspectiveViewBackgroundColor:e.perspectiveViewBackgroundColor}}class nn extends r.a{constructor(e,t,n){super(),this.element=e,this.layerGroupViewer=this.registerDisposer(new Qt(e,Object.assign({display:n.display,layerSpecification:n.layerSpecification.addRef()},tn(n)),{showLayerPanel:n.uiControlVisibility.showLayerPanel,showViewerMenu:!1})),this.layerGroupViewer.layout.restoreState(t)}toJSON(){return this.layerGroupViewer.layout.specification.toJSON()}get changed(){return this.layerGroupViewer.layout.changed}}function rn(e,t,n){const i=Object(r.d)(e,"dragenter",t=>{void 0!==St(t)&&e.classList.add("neuroglancer-drag-over")}),s=Object(r.d)(e,"dragleave",()=>{e.classList.remove("neuroglancer-drag-over")}),o=Object(r.d)(e,"dragover",e=>Yt(e)?(mt(e,function(e,t){return e.shiftKey?"copy":e.ctrlKey?"move":Xt(t)}(e,t)),e.stopPropagation(),void e.preventDefault()):void 0!==St(e)?(function(e,t,n=!1){mt(e,Lt(e,t,n))}(e,t,!0),e.stopPropagation(),void e.preventDefault()):void 0),a=Object(r.d)(e,"drop",i=>{if(e.classList.remove("neuroglancer-drag-over"),Yt(i)){let e;i.stopPropagation();try{e=JSON.parse(i.dataTransfer.getData(qt))}catch(e){return}const r=Tt(i,t,!1,!1,!0);if(void 0!==r&&r.finalize(i)){i.preventDefault(),i.dataTransfer.dropEffect=vt(),xt(i);const t=n();for(const e of r.layers.keys())t.layerSpecification.add(e);try{t.restoreState(e)}catch(e){}}}else{const e=Tt(i,t,"copy"===vt(),!1,!0);if(void 0!==e&&e.finalize(i)){i.preventDefault(),i.dataTransfer.dropEffect=vt(),xt(i);const t=n();for(const n of e.layers.keys())t.layerSpecification.add(n);try{t.layout.restoreState(e.layoutSpec)}catch(e){t.layout.reset()}return}}});return()=>{a(),o(),s(),i()}}class sn extends r.a{constructor(e,t,n,i){super(),this.element=e,this.direction=t,this.container=i,this.changed=new se.a,e.classList.add("neuroglancer-stack-layout"),e.classList.add(`neuroglancer-stack-layout-${t}`),e.style.display="flex",e.style.flexDirection=t,e.appendChild(this.makeDropPlaceholder(this));for(const e of n)this.insertChild(e)}get length(){return(this.element.childElementCount-1)/2}makeDropPlaceholder(e){const t=document.createElement("div");return t.className="neuroglancer-stack-layout-drop-placeholder",e.registerDisposer(rn(t,this.viewer.layerSpecification,()=>{const e=t.nextElementSibling;let n;return null!==e&&(n=en.getFromElement(e)),this.insertChild({type:"viewer",layers:[]},n).component})),e.registerDisposer(()=>{Object(Te.b)(t)}),t}get viewer(){return this.container.viewer}get(e){return en.getFromElement(this.element.children[2*e+1])}insertChild(e,t){const n=new en(this.viewer,e,this),i=this.makeDropPlaceholder(n);n.element.classList.add("neuroglancer-stack-layout-child"),n.registerDisposer(n.changed.add(this.changed.dispatch)),n.registerDisposer(()=>{this.element.removeChild(n.element),this.changed.dispatch()});const r=void 0!==t?t.element:null;return this.element.insertBefore(n.element,r),this.element.insertBefore(i,r),this.changed.dispatch(),n}disposed(){this.clear(),super.disposed()}clear(){for(;0!==this.length;)this.get(0).dispose()}*[Symbol.iterator](){const{length:e}=this;for(let t=0;t<e;++t)yield this.get(t)}toJSON(){return{type:this.direction,children:Array.from(this).map(e=>e.toJSON())}}}class on extends r.a{constructor(e,t){super(),this.viewer=e,this.defaultSpecification=t,this.container=this.registerDisposer(new en(this.viewer,this.defaultSpecification,void 0))}get changed(){return this.container.changed}get element(){return this.container.element}reset(){this.container.setSpecification(this.defaultSpecification)}restoreState(e){this.container.setSpecification(e)}disposed(){super.disposed()}toJSON(){return this.container.toJSON()}}n(218);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an extends r.a{constructor(e,t,n,i,r=0){super(),this.element=e,this.visible=t,this.size=n,this.direction=i,this.minSize=r,this.gutter=document.createElement("div"),this.sizeProp="horizontal"===this.direction?"width":"height";const{gutter:s}=this;s.className=`neuroglancer-resize-gutter-${i}`,e.insertAdjacentElement("beforebegin",s),this.registerDisposer(t.changed.add(()=>this.updateView())),this.registerDisposer(n.changed.add(()=>this.updateView()));this.registerEventListener(s,"pointerdown",t=>{if("button"in t&&0!==t.button)return;t.preventDefault();let n=e.getBoundingClientRect()[this.sizeProp];const r=this.minSize/2;Object(re.a)(t,(e,t,s)=>{(n-="horizontal"===i?t:s)<r?this.visible.value=!1:!1===this.visible.value&&n>r&&(this.visible.value=!0),this.size.value=Math.max(this.minSize,n)})}),this.updateView()}updateView(){const{element:e,gutter:t}=this,{visible:n}=this;if(!n.value)return e.style.display="none",void(t.style.display="none");e.style.display="",t.style.display="",e.style[this.sizeProp]=Math.max(this.minSize,this.size.value)+"px"}disposed(){Object(Te.b)(this.gutter),super.disposed()}}n(220);var ln=n(31);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class cn extends ln.b{constructor(e){super(),this.layer=e,this.tabView=new ln.d(this.layer.tabs.addRef(),this.visibility),this.element.appendChild(this.tabView.element),this.element.classList.add("neuroglancer-layer-side-panel-info-panel"),this.tabView.element.style.flex="1"}}class un extends ln.b{get layer(){return null}constructor(){super(),this.element.classList.add("neuroglancer-layer-side-panel-info-panel-empty"),this.element.textContent="Information about this layer will be available once it finishes loading."}}class dn extends ln.b{constructor(e,t,n){super(),this.layer=e,this.layerManager=t,this.collapse=n,this.element=document.createElement("div"),this.title=document.createElement("div"),this.layerName=document.createElement("input"),this.stack=this.registerDisposer(new ln.a(e=>null===e?new un:new cn(e),this.visibility));const{element:i,title:r,layerName:s,stack:o}=this;i.className="neuroglancer-managed-user-layer-info-panel",r.className="neuroglancer-layer-side-panel-title",o.element.classList.add("neuroglancer-layer-side-panel-content-container"),i.appendChild(r),i.appendChild(o.element);const a=Object(At.a)();a.title="Close side panel",a.addEventListener("click",()=>{this.collapse()}),r.appendChild(s),s.spellcheck=!1,s.title="Rename layer",r.appendChild(a),s.addEventListener("change",()=>this.handleLayerNameViewChanged()),s.addEventListener("blur",()=>this.handleLayerNameViewChanged()),this.registerDisposer(e.layerChanged.add(()=>this.handleLayerNameModelChanged())),this.handleUserLayerChanged(),this.handleLayerNameModelChanged()}handleUserLayerChanged(){this.stack.selected!==this.layer.layer&&(this.stack.invalidateAll(),this.stack.selected=this.layer.layer)}handleLayerNameModelChanged(){this.layerName.value=this.layer.name}handleLayerNameViewChanged(){const{layer:e}=this;if(void 0!==e){let t=this.layerName.value;t!==e.name&&(t=this.layerManager.getUniqueLayerName(t),this.layerName.value=t,e.name=t,e.layerChanged.dispatch())}}}class hn extends r.a{constructor(e){super(),this.state=e,this.element=document.createElement("div"),this.stack=this.registerDisposer(new ln.a(e=>new dn(e,this.state.layerManager,this.collapse.bind(this))));const{element:t,stack:n}=this;t.className="neuroglancer-layer-side-panel",n.element.classList.add("neuroglancer-layer-info-panel-container"),t.appendChild(n.element),this.registerDisposer(e.changed.add(()=>this.handleStateChanged())),this.registerDisposer(e.layerManager.layersChanged.add(()=>this.handleLayersChanged())),this.handleStateChanged()}handleLayersChanged(){const{layerManager:e}=this.state,{stack:t}=this;for(const n of t.tabs.keys())e.has(n)||t.invalidate(n)}collapse(){const{state:e}=this;!0===e.visible&&(this.state.visible=!1,this.state.changed.dispatch())}handleStateChanged(){const{state:e}=this,{visible:t}=e;this.element.style.display=t?null:"none",this.stack.visibility.value=t?le.b.VISIBLE:le.b.IGNORED,this.stack.selected=e.layer}disposed(){Object(Te.b)(this.element),super.disposed()}}n(222);var pn=n(6),fn=n(85),gn=n(76),mn=n(78);n(224);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class vn extends r.a{constructor(){super(),this.element=document.createElement("div");const{element:e}=this;e.className="neuroglancer-tooltip",e.style.visibility="hidden",document.body.appendChild(e)}updatePosition(e,t){const{element:n}=this;n.style.left=e+"px",n.style.top=t+"px",n.style.visibility="inherit"}disposed(){Object(Te.b)(this.element),super.disposed()}}
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bn=new Map([[pn.c.AXIS_ALIGNED_BOUNDING_BOX,(e,t,n,i)=>{const r=document.createElement("div");r.className="neuroglancer-annotation-details-volume",r.textContent=Object(mn.a)(e.pointA,e.pointB,n),t.appendChild(r)}]]),yn=500;class wn extends r.a{constructor(e,t,n){super(),this.mouseState=e,this.layerManager=t,this.voxelSize=n,this.tooltip=void 0,this.debouncedShowTooltip=this.registerCancellable(F()(()=>this.doCreateTooltip(),yn)),this.debouncedShowTooltip0=this.registerCancellable(F()(()=>this.doCreateTooltip(),0)),this.doCreateTooltip=(()=>{this.debouncedShowTooltip.cancel(),this.debouncedShowTooltip0.cancel();const{mouseState:e}=this;if(!this.maybeCreateTooltip()){const{tooltip:e}=this;return void 0!==e&&(e.dispose(),this.tooltip=void 0),void this.setReference(void 0)}this.tooltip.updatePosition(e.pageX,e.pageY)}),this.registerDisposer(e.changed.add(()=>this.mouseStateChanged()))}setReference(e){const t=this.reference;void 0!==t&&(t.changed.remove(this.debouncedShowTooltip0),t.dispose(),this.reference=void 0),this.reference=e,void 0!==e&&e.changed.add(this.debouncedShowTooltip0)}maybeCreateTooltip(){const e=Object(fn.a)(this.mouseState,this.layerManager);if(void 0===e)return!1;if(!this.voxelSize.valid)return!1;let{tooltip:t}=this;void 0===t&&(t=this.tooltip=new vn).element.classList.add("neuroglancer-mouse-selection-tooltip");const n=e.annotationLayer.source.getReference(e.id);if(this.setReference(n),null===n.value)return!1;Object(Te.a)(t.element);const i=document.createElement("div");i.className="neuroglancer-mouse-selection-tooltip-title",i.textContent=`${e.layer.name}`;const r=document.createElement("div");r.className="neuroglancer-mouse-selection-tooltip-description";const s=n.value;if(r.textContent=void 0===s?"Loading...":s.description||"",t.element.appendChild(i),t.element.appendChild(r),null!=s){const{segments:n}=s;if(void 0!==n&&n.length>0){const i=document.createElement("div");i.className="neuroglancer-annotation-segment-list";const r=e.annotationLayer.segmentationState.value,s=r?r.segmentColorHash:void 0;n.forEach((e,t)=>{0!==t&&i.appendChild(document.createTextNode(" "));const n=document.createElement("span");n.className="neuroglancer-annotation-segment-item",n.textContent=e.toString(),void 0!==s&&(n.style.backgroundColor=s.computeCssColor(e)),i.appendChild(n)}),t.element.appendChild(i)}const i=e.annotationLayer.objectToGlobal,r=Object(pn.g)(s.type),o=document.createElement("div");o.appendChild(document.createTextNode(r.icon)),Object(gn.c)(o,s,i,this.voxelSize),o.className="neuroglancer-mouse-selection-tooltip-annotation-corners",t.element.appendChild(o);const a=bn.get(s.type);void 0!==a&&a(s,t.element,i,this.voxelSize)}return!0}mouseStateChanged(){const{tooltip:e}=this;void 0!==e&&(e.dispose(),this.tooltip=void 0),this.setReference(void 0),this.debouncedShowTooltip()}disposed(){const{tooltip:e}=this;void 0!==e&&(e.dispose(),this.tooltip=void 0),this.setReference(void 0),super.disposed()}}n(126),n(226),n(130),n(227),n(228),n(229),n(127),n(231);var xn=n(50),Sn=n.n(xn);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Cn=100;class On extends Je.a{constructor(e){super(),this.viewer=e,this.parsedValue=null,this.debouncedValueUpdater=F()(()=>{const e=this.textEditor.getValue();try{const t=JSON.parse(e);this.parsedValue=t,this.applyButton.disabled=!1,this.textEditor.setOption("lint",void 0)}catch(t){this.parsedValue=null,this.applyButton.disabled=!0;let n=0,i=0,r="Unknown parse error";if(t instanceof Error){const s=t.message.match(/^((?:.|\n)*) in JSON at position ([0-9]+)$/);if(null!==s){r=s[1];const t=parseInt(s[2],10),o=e.substring(0,t).split("\n");n=o.length-1,i=o[o.length-1].length}else r=t.message}this.textEditor.setOption("lint",{getAnnotations:()=>[{message:r,severity:"error",from:Sn.a.Pos(n,i)}]})}},Cn),this.content.classList.add("neuroglancer-state-editor");const t=this.applyButton=document.createElement("button");t.textContent="Apply changes",this.content.appendChild(t),t.addEventListener("click",()=>this.applyChanges()),t.disabled=!0,this.textEditor=Sn()(e=>{},{value:"",mode:{name:"javascript",json:!0},foldGutter:!0,gutters:["CodeMirror-lint-markers","CodeMirror-foldgutter"]}),this.updateView(),this.textEditor.on("change",()=>{this.debouncedValueUpdater()}),this.content.appendChild(this.textEditor.getWrapperElement()),this.textEditor.refresh()}applyChanges(){null!==this.parsedValue&&(this.viewer.state.reset(),this.viewer.state.restoreState(this.parsedValue)),this.applyButton.disabled=!0}updateView(){this.textEditor.setValue(this.getJson()),this.textEditor.execCommand("foldAll"),this.textEditor.execCommand("unfold")}getJson(){return JSON.stringify(Object(a.b)(this.viewer.state).value,null,"  ")}}n(233);var Ln=n(5);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Tn{constructor(){this.tracker=new a.a,this.visible=new ie.b(!1),this.size=new Le.c(100,ke.z),this.tracker.add("visible",this.visible),this.tracker.add("size",this.size)}get changed(){return this.tracker.changed}restoreState(e){this.tracker.restoreState(e)}reset(){this.tracker.reset()}toJSON(){const e=this.tracker.toJSON();for(const t of Object.keys(e))if(void 0!==e[t])return e}}function kn(e){const t=new Map;return function e(n,i){if("object"==typeof n)for(const t of Object.keys(n))e(n[t],i+"."+t);else t.set(i,""+n)}(e,""),t}function En(e){const t=e.map(kn),n=function(e){const t=new Set;t.add(".type");const n=new Set;function i(n,i){for(const r of t)if(e[n].get(r)!==e[i].get(r))return!0;return!1}for(let r=0,s=e.length;r<s;++r){for(const t of e[r].keys())n.add(t);let s=[];for(let e=0;e<r;++e)i(r,e)||s.push(e);for(;s.length>0;){let i=s,o=void 0;for(const a of n){if(t.has(a))continue;const n=[];for(const t of s)e[t].get(a)===e[r].get(a)&&n.push(t);if(n.length<i.length&&(i=n,o=a),0===n.length)break}if(void 0===o)break;s=i,t.add(o)}}return Array.from(t)}(t);return t.map(e=>(function(e,t){const n={};for(const i of t){const t=e.get(i);if(void 0!==t){if(""===i)return t;n[i]=t}}return JSON.stringify(n)})(e,n))}const An=1e3;class Mn extends r.a{constructor(e,t){super(),this.chunkQueueManager=e,this.displayState=t,this.element=document.createElement("div"),this.columns=new Map,this.data=void 0,this.requestDataTimerId=-1,this.dataRequested=!1,this.debouncedUpdateView=this.registerCancellable(F()(()=>this.updateView(),0));const{element:n}=this;n.className="neuroglancer-statistics-panel",this.registerDisposer(this.displayState.changed.add(this.debouncedUpdateView)),this.registerDisposer(this.displayState.visible.changed.add(()=>this.requestData())),this.requestData();const{columns:i}=this;i.set("Visible chunks/T",e=>{let t=0;for(let n=0;n<Ln.l;++n)t+=e[Object(Ln.j)(n,Ln.f.VISIBLE)*Ln.k+Ln.e.numChunks];return t}),i.set("Visible chunks/D",e=>e[Object(Ln.j)(Ln.g.DOWNLOADING,Ln.f.VISIBLE)*Ln.k+Ln.e.numChunks]),i.set("Visible chunks/M",e=>e[Object(Ln.j)(Ln.g.SYSTEM_MEMORY,Ln.f.VISIBLE)*Ln.k+Ln.e.numChunks]+e[Object(Ln.j)(Ln.g.SYSTEM_MEMORY_WORKER,Ln.f.VISIBLE)*Ln.k+Ln.e.numChunks]),i.set("Visible chunks/G",e=>e[Object(Ln.j)(Ln.g.GPU_MEMORY,Ln.f.VISIBLE)*Ln.k+Ln.e.numChunks]),i.set("Visible chunks/F",e=>e[Object(Ln.j)(Ln.g.FAILED,Ln.f.VISIBLE)*Ln.k+Ln.e.numChunks]),i.set("Visible memory",e=>e[Object(Ln.j)(Ln.g.GPU_MEMORY,Ln.f.VISIBLE)*Ln.k+Ln.e.gpuMemoryBytes]),i.set("Download latency",e=>e[Object(Ln.i)(Ln.d.totalTime)]/e[Object(Ln.i)(Ln.d.totalChunks)])}disposed(){clearTimeout(this.requestDataTimerId),Object(Te.b)(this.element),super.disposed()}requestData(){if(!this.displayState.visible)return;if(this.dataRequested)return;const{chunkQueueManager:e}=this,t=e.rpc;this.dataRequested=!0,t.promiseInvoke(Ln.h,{queue:e.rpcId}).then(e=>{this.dataRequested=!1,this.data=e,this.debouncedUpdateView(),this.requestDataTimerId=setTimeout(()=>{this.requestDataTimerId=-1,this.requestData()},An)})}updateView(){if(!this.displayState.visible.value)return;const{data:e}=this;if(void 0===e)return;const{columns:t}=this,n=this.chunkQueueManager.rpc,i=document.createElement("table"),r=[];for(const[i,s]of e){const e=n.get(i);if(void 0===e)continue;const o=[e];for(const e of t.values())o.push(e(s));r.push(o)}const s=En(r.map(e=>Object.assign({type:e[0].RPC_TYPE_ID},e[0].key||{}))),o=new Map;s.forEach((e,t)=>{o.set(r[t][0],e)});{const e=document.createElement("thead");let n=document.createElement("tr");e.appendChild(n);const r=e=>{const t=document.createElement("td");t.textContent=e,n.appendChild(t)};r("Name");let s=void 0;for(const e of t.keys()){const t=e.indexOf("/");let i=e;if(-1!==t){if((i=e.substring(0,t))===s){++n.lastElementChild.colSpan;continue}s=i}r(i)}n=document.createElement("tr"),e.appendChild(n);{const e=document.createElement("td");n.appendChild(e)}for(const e of t.keys()){const t=e.indexOf("/");let i="";-1!==t&&(i=e.substring(t+1));const r=document.createElement("td");r.textContent=i,n.appendChild(r)}i.appendChild(e)}const a=document.createElement("tbody");for(const[e,...t]of r){const n=document.createElement("tr"),i=e=>{const t=document.createElement("td");t.textContent=e,n.appendChild(t)};i(o.get(e));for(const e of t)i(""+e);a.appendChild(n)}i.appendChild(a),Object(Te.a)(this.element),this.element.appendChild(i)}}var In=n(75);n(235);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Nn extends r.a{constructor(e){super(),this.selectedLayer=e,this.element=document.createElement("div");const{element:t}=this;t.className="neuroglancer-annotation-tool-status-widget",this.registerDisposer(e.changed.add(()=>this.selectedLayerChanged())),this.selectedLayerChanged()}selectedLayerChanged(){let{unbindPreviousLayer:e}=this;void 0!==e&&e();const t=this.selectedLayer.layer;void 0!==t&&(this.unbindPreviousLayer=t.specificationChanged.add(()=>{this.updateView()})),this.updateView()}disposed(){const{unbindPreviousLayer:e}=this;void 0!==e&&e(),this.unbindPreviousLayer=void 0}getDescriptionText(){const e=this.selectedLayer.layer;if(void 0===e)return;const t=e.layer;if(null===t)return;const n=t.tool.value;return void 0!==n?n.description:void 0}updateView(){this.element.textContent=this.getDescriptionText()||""}}
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dn extends r.a{constructor(e,t={}){super(),this.model=e,this.element=document.createElement("label"),this.inputElement=document.createElement("input");let{validator:n,label:i}=t;const{element:r,inputElement:s}=this;void 0===n&&(n=e instanceof Le.c?e.validator:e=>e),this.validator=n,void 0!==i&&(r.textContent=i),r.appendChild(s),r.className="neuroglancer-number-input",s.type="input",this.registerDisposer(this.model.changed.add(()=>this.updateView())),this.registerEventListener(s,"change",()=>this.updateModel()),this.updateView()}updateView(){this.inputElement.value=""+this.model.value}updateModel(){let e=parseFloat(this.inputElement.value.trim());if(Number.isNaN(e))this.updateView();else try{e=this.validator(e),this.model.value=e}catch(e){this.updateView()}}disposed(){Object(Te.b)(this.element),super.disposed()}}var Rn=n(83);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */n(237),n(79),n(100);class Pn extends r.a{constructor(e,t){super(),this.gl=e,this.frameNumberCounter=t,this.worker=new Worker("static/libs/neuroglancer/chunk_worker.bundle.js"),this.chunkQueueManager=this.registerDisposer(new z.d(new de.a(this.worker),this.gl,this.frameNumberCounter,{gpuMemory:new z.a({defaultItemLimit:1e6,defaultSizeLimit:1e9}),systemMemory:new z.a({defaultItemLimit:1e7,defaultSizeLimit:2e9}),download:new z.a({defaultItemLimit:32,defaultSizeLimit:Number.POSITIVE_INFINITY}),compute:new z.a({defaultItemLimit:128,defaultSizeLimit:5e8})})),this.chunkManager=this.registerDisposer(new z.c(this.chunkQueueManager)),this.chunkQueueManager.registerDisposer(()=>this.worker.terminate())}get rpc(){return this.chunkQueueManager.rpc}}const jn=["showHelpButton","showEditStateButton","showLayerPanel","showLocation","showAnnotationToolStatus"],Vn=["showUIControls","showPanelBorders",...jn];class _n{constructor(){this.showHelpButton=new ie.b(!0),this.showEditStateButton=new ie.b(!0),this.showLayerPanel=new ie.b(!0),this.showLocation=new ie.b(!0),this.showAnnotationToolStatus=new ie.b(!0)}}class Un extends _n{constructor(){super(...arguments),this.showUIControls=new ie.b(!0),this.showPanelBorders=new ie.b(!0)}}const Fn="undefined"!=typeof NEUROGLANCER_OVERRIDE_DEFAULT_VIEWER_OPTIONS?NEUROGLANCER_OVERRIDE_DEFAULT_VIEWER_OPTIONS:{showLayerDialog:!0,resetStateWhenEmpty:!0};class zn extends r.a{constructor(e,t={}){super(),this.display=e,this.navigationState=this.registerDisposer(new $.e),this.perspectiveNavigationState=new $.e(new $.g(this.navigationState.position),1),this.mouseState=new J.e,this.layerManager=this.registerDisposer(new J.a),this.selectedLayer=this.registerDisposer(new J.h(this.layerManager.addRef())),this.showAxisLines=new ie.b(!0,!0),this.showScaleBar=new ie.b(!0,!0),this.showPerspectiveSliceViews=new ie.b(!0,!0),this.visibleLayerRoles=Object(J.k)(),this.showDefaultAnnotations=new ie.b(!0,!0),this.crossSectionBackgroundColor=new In.a(o.u.fromValues(.5,.5,.5)),this.perspectiveViewBackgroundColor=new In.a(o.u.fromValues(0,0,0)),this.scaleBarOptions=new ue.b,this.statisticsDisplayState=new Tn,this.layerSelectedValues=this.registerDisposer(new J.c(this.layerManager,this.mouseState)),this.resetInitiated=new se.a,this.state=new a.a,this.uiControlVisibility={},this.visible=!0;const{dataContext:n=new Pn(e.gl,e),visibility:i=new le.b(le.b.VISIBLE),inputEventBindings:r={global:new nt.a,sliceView:new nt.a,perspectiveView:new nt.a},element:s=e.makeCanvasOverlayElement(),dataSourceProvider:l=Object(Ye.a)({credentialsManager:B.a}),uiConfiguration:c=new Un}=t;this.visibility=i,this.inputEventBindings=r,this.element=s,this.dataSourceProvider=l,this.uiConfiguration=c,this.registerDisposer(()=>Object(Te.b)(this.element)),this.dataContext=this.registerDisposer(n),function(e,t){for(const n of Vn){const i=t[n];void 0!==i&&(e[n].value=i)}}(c,t);const u=Object.assign({},Fn,t),{resetStateWhenEmpty:d,showLayerDialog:h}=u;for(const e of jn)this.uiControlVisibility[e]=this.makeUiControlVisibilityState(e);this.registerDisposer(this.uiConfiguration.showPanelBorders.changed.add(()=>{this.updateShowBorders()})),this.showLayerDialog=h,this.resetStateWhenEmpty=d,this.layerSpecification=new Qe.c(this.dataSourceProvider,this.layerManager,this.chunkManager,this.layerSelectedValues,this.navigationState.voxelSize),this.registerDisposer(e.updateStarted.add(()=>{this.onUpdateDisplay()})),this.showDefaultAnnotations.changed.add(()=>{this.showDefaultAnnotations.value?this.visibleLayerRoles.add(J.g.DEFAULT_ANNOTATION):this.visibleLayerRoles.delete(J.g.DEFAULT_ANNOTATION)});const{state:p}=this;p.add("layers",this.layerSpecification),p.add("navigation",this.navigationState),p.add("showAxisLines",this.showAxisLines),p.add("showScaleBar",this.showScaleBar),p.add("showDefaultAnnotations",this.showDefaultAnnotations),p.add("perspectiveOrientation",this.perspectiveNavigationState.pose.orientation),p.add("perspectiveZoom",this.perspectiveNavigationState.zoomFactor),p.add("showSlices",this.showPerspectiveSliceViews),p.add("gpuMemoryLimit",this.dataContext.chunkQueueManager.capacities.gpuMemory.sizeLimit),p.add("systemMemoryLimit",this.dataContext.chunkQueueManager.capacities.systemMemory.sizeLimit),p.add("concurrentDownloads",this.dataContext.chunkQueueManager.capacities.download.itemLimit),p.add("selectedLayer",this.selectedLayer),p.add("crossSectionBackgroundColor",this.crossSectionBackgroundColor),p.add("perspectiveViewBackgroundColor",this.perspectiveViewBackgroundColor),this.registerDisposer(this.navigationState.changed.add(()=>{this.handleNavigationStateChanged()})),this.layerManager.initializePosition(this.navigationState.position),this.registerDisposer(this.layerSpecification.voxelCoordinatesSet.add(e=>{this.navigationState.position.setVoxelCoordinates(e)})),this.registerDisposer(this.layerSpecification.spatialCoordinatesSet.add(e=>{const{position:t}=this.navigationState;o.u.copy(t.spatialCoordinates,e),t.markSpatialCoordinatesChanged()}));const f=this.registerCancellable(F()(()=>{!this.wasDisposed&&0===this.layerManager.managedLayers.length&&this.resetStateWhenEmpty&&(this.navigationState.reset(),this.perspectiveNavigationState.pose.orientation.reset(),this.perspectiveNavigationState.zoomFactor.reset(),this.resetInitiated.dispatch(),!Je.b&&this.showLayerDialog&&this.visibility.visible&&new dt(this.layerSpecification))}));this.layerManager.layersChanged.add(f),f(),this.registerDisposer(this.dataContext.chunkQueueManager.visibleChunksChanged.add(()=>{this.layerSelectedValues.handleLayerChange()})),this.registerDisposer(this.dataContext.chunkQueueManager.visibleChunksChanged.add(()=>{this.visible&&e.scheduleRedraw()})),this.makeUI(),this.updateShowBorders(),p.add("layout",this.layout),p.add("statistics",this.statisticsDisplayState),this.registerActionListeners(),this.registerEventActionBindings(),this.registerDisposer(Wt(s,this.navigationState.position)),this.registerDisposer(new wn(this.mouseState,this.layerManager,this.navigationState.voxelSize))}get chunkManager(){return this.dataContext.chunkManager}get chunkQueueManager(){return this.dataContext.chunkQueueManager}makeUiControlVisibilityState(e){const t=this.uiConfiguration.showUIControls,n=this.uiConfiguration[e];return this.registerDisposer(Object(Le.g)((e,t)=>e&&t,t,n))}get inputEventMap(){return this.inputEventBindings.global}updateShowBorders(){const{element:e}=this,t="neuroglancer-show-panel-borders";this.uiConfiguration.showPanelBorders.value?e.classList.add(t):e.classList.remove(t)}makeUI(){const e=this.element;e.classList.add("neuroglancer-viewer"),e.classList.add("neuroglancer-noselect"),e.style.display="flex",e.style.flexDirection="column";const t=document.createElement("div");t.title="Right click for settings",t.classList.add("neuroglancer-viewer-top-row"),(this.contextMenu=this.registerDisposer(function(e){const t=new Gt,{element:n}=t;n.classList.add("neuroglancer-viewer-context-menu");const i=(e,i)=>{const r=t.registerDisposer(new Dn(i,{label:e}));r.element.classList.add("neuroglancer-viewer-context-menu-limit-widget"),n.appendChild(r.element)};i("GPU memory limit",e.chunkQueueManager.capacities.gpuMemory.sizeLimit),i("System memory limit",e.chunkQueueManager.capacities.systemMemory.sizeLimit),i("Concurrent chunk requests",e.chunkQueueManager.capacities.download.itemLimit);const r=(e,i)=>{const r=document.createElement("label");r.textContent=e;const s=t.registerDisposer(new ie.c(i));r.appendChild(s.element),n.appendChild(r)};return r("Show axis lines",e.showAxisLines),r("Show scale bar",e.showScaleBar),r("Show cross sections in 3-d",e.showPerspectiveSliceViews),r("Show default annotations",e.showDefaultAnnotations),r("Show chunk statistics",e.statisticsDisplayState.visible),t}(this))).registerParent(t),t.style.display="flex",t.style.flexDirection="row",t.style.alignItems="stretch";const n=this.registerDisposer(new Vt(document.createElement("div"),this.navigationState.voxelSize));this.registerDisposer(new ie.a(this.uiControlVisibility.showLocation,n.element)),t.appendChild(n.element);const i=this.registerDisposer(new jt(this.navigationState.position));this.registerDisposer(new ie.a(this.uiControlVisibility.showLocation,i.element)),t.appendChild(i.element);const r=this.registerDisposer(new _t(document.createElement("div"),this.mouseState,this.navigationState.voxelSize));r.element.style.flex="1",r.element.style.alignSelf="center",this.registerDisposer(new ie.a(this.uiControlVisibility.showLocation,r.element)),t.appendChild(r.element);const s=this.registerDisposer(new Nn(this.selectedLayer));t.appendChild(s.element),this.registerDisposer(new ie.a(this.uiControlVisibility.showAnnotationToolStatus,s.element));{const e=Object(Rn.a)("{}","Edit JSON state");this.registerEventListener(e,"click",()=>{this.editJsonState()}),this.registerDisposer(new ie.a(this.uiControlVisibility.showEditStateButton,e)),t.appendChild(e)}{const e=Object(Rn.a)("?","Help");this.registerEventListener(e,"click",()=>{this.showHelpDialog()}),this.registerDisposer(new ie.a(this.uiControlVisibility.showHelpButton,e)),t.appendChild(e)}this.registerDisposer(new ie.a(Object(Le.g)((...e)=>e.reduce((e,t)=>e||t,!1),this.uiControlVisibility.showHelpButton,this.uiControlVisibility.showEditStateButton,this.uiControlVisibility.showLocation,this.uiControlVisibility.showAnnotationToolStatus),t)),e.appendChild(t);const o=document.createElement("div");o.style.display="flex",o.style.flex="1",o.style.flexDirection="row",this.layout=this.registerDisposer(new on(this,"4panel")),o.appendChild(this.layout.element);const a=this.registerDisposer(new hn(this.selectedLayer.addRef()));o.appendChild(a.element);const l=this;a.registerDisposer(new an(a.element,{changed:l.selectedLayer.changed,get value(){return l.selectedLayer.visible},set value(e){l.selectedLayer.visible=e}},this.selectedLayer.size,"horizontal",290)),e.appendChild(o);const c=this.registerDisposer(new Mn(this.chunkQueueManager,this.statisticsDisplayState));e.appendChild(c.element),c.registerDisposer(new an(c.element,this.statisticsDisplayState.visible,this.statisticsDisplayState.size,"vertical"));const u=()=>{const t=this.visibility.visible;t!==this.visible&&(e.style.visibility=t?"inherit":"hidden",this.visible=t)};u(),this.registerDisposer(this.visibility.changed.add(u))}registerEventActionBindings(){const{element:e}=this;this.registerDisposer(new nt.b(e,this.inputEventMap)),this.registerDisposer(new $t.a(e))}bindAction(e,t){this.registerDisposer(Object(c.d)(this.element,e,t))}registerActionListeners(){for(const e of["recolor","clear-segments"])this.bindAction(e,()=>{this.layerManager.invokeAction(e)});for(const e of["select"])this.bindAction(e,()=>{this.mouseState.updateUnconditionally(),this.layerManager.invokeAction(e)});this.bindAction("help",()=>this.showHelpDialog());for(let e=1;e<=9;++e)this.bindAction(`toggle-layer-${e}`,()=>{const t=e-1,n=this.layerManager.managedLayers;if(t<n.length){let e=n[t];e.setVisible(!e.visible)}}),this.bindAction(`select-layer-${e}`,()=>{const t=e-1,n=this.layerManager.managedLayers;if(t<n.length){const e=n[t];this.selectedLayer.layer=e,this.selectedLayer.visible=!0}});this.bindAction("annotate",()=>{const e=this.selectedLayer.layer;if(void 0===e)return void i.a.showTemporaryMessage("The annotate command requires a layer to be selected.");const t=e.layer;null!==t&&void 0!==t.tool.value?t.tool.value.trigger(this.mouseState):i.a.showTemporaryMessage(`The selected layer (${JSON.stringify(e.name)}) does not have an active annotation tool.`)}),this.bindAction("toggle-axis-lines",()=>this.showAxisLines.toggle()),this.bindAction("toggle-scale-bar",()=>this.showScaleBar.toggle()),this.bindAction("toggle-default-annotations",()=>this.showDefaultAnnotations.toggle()),this.bindAction("toggle-show-slices",()=>this.showPerspectiveSliceViews.toggle()),this.bindAction("toggle-show-statistics",()=>this.showStatistics())}showHelpDialog(){const{inputEventBindings:e}=this;new Ke([["Global",e.global],["Slice View",e.sliceView],["Perspective View",e.perspectiveView]])}editJsonState(){new On(this)}showStatistics(e){void 0===e&&(e=!this.statisticsDisplayState.visible.value),this.statisticsDisplayState.visible.value=e}get gl(){return this.display.gl}onUpdateDisplay(){this.visible&&(this.dataContext.chunkQueueManager.chunkUpdateDeadline=null)}handleNavigationStateChanged(){if(this.visible){let{chunkQueueManager:e}=this.dataContext;null===e.chunkUpdateDeadline&&(e.chunkUpdateDeadline=Date.now()+10)}}}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bn(e){Object(r.d)(document,"contextmenu",e=>{e.preventDefault()}),Object(r.d)(document,"wheel",e=>{e.ctrlKey&&e.preventDefault()});try{let t=new _.a(document.getElementById("neuroglancer-container"));return new zn(t,e)}catch(e){throw i.a.showMessage(`Error: ${e.message}`),e}}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(195);class Gn extends r.a{constructor(e,t=200){super(),this.root=e,this.parseError=new Le.f(void 0),this.registerEventListener(window,"hashchange",()=>this.updateFromUrlHash());const n=F()(()=>this.setUrlHash(),t);this.registerDisposer(e.changed.add(n)),this.registerDisposer(()=>n.cancel())}setUrlHash(){const e=Object(a.b)(this.root),{generation:t}=e;if(t!==this.prevStateGeneration){this.prevStateGeneration=e.generation;let t=(n=JSON.stringify(e.value),encodeURI(n).replace(/[!'()*;,]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}));t!==this.prevStateString&&(this.prevStateString=t,"{}"===decodeURIComponent(t)?history.replaceState(null,"","#"):history.replaceState(null,"","#!"+t))}var n}updateFromUrlHash(){try{let e=location.href.replace(/^[^#]+/,"");if(""!==e&&"#"!==e&&"#!"!==e||(e="#!{}"),e.startsWith("#!+")){e=e.slice(3),e=decodeURIComponent(e);let t=Object(ke.h)(e);Object(ke.t)(t),this.root.restoreState(t),this.prevStateString=void 0}else{if(!e.startsWith("#!"))throw new Error('URL hash is expected to be of the form "#!{...}" or "#!+{...}".');{if(e=e.slice(2),(e=decodeURIComponent(e))===this.prevStateString)return;this.prevStateString=e,this.root.reset();let t=Object(ke.h)(e);Object(ke.t)(t),this.root.restoreState(t)}}this.parseError.value=void 0}catch(e){this.parseError.value=e}}}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wn(){let e=window.viewer=Bn();g(e.inputEventBindings);const t=e.registerDisposer(new Gn(e.state));return e.registerDisposer(t.parseError.changed.add(()=>{const{value:e}=t.parseError;if(void 0!==e){(new i.a).setErrorMessage(`Error parsing state: ${e.message}`),console.log("Error parsing state",e)}t.parseError})),t.updateFromUrlHash(),
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e){e.registerEventListener(document,"copy",t=>{if(s(t))return;const n=Object(a.b)(e.state).value,{clipboardData:i}=t;null!==i&&i.setData("text/plain",JSON.stringify(n,void 0,"  ")),t.preventDefault()})}(e),l(e),e}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */window.addEventListener("DOMContentLoaded",()=>{Wn()})},function(e,t,n){"use strict";n.r(t);var i=n(20),r=n(28),s=n(95),o=n(5),a=n(106),l=n(47),c=n(9),u=n(1);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function d(e=1){return new c.c(e,u.n)}var h=n(0),p=n(3);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function f(e=h.u.create()){return new g(e,e)}class g{constructor(e,t){this.value_=e,this.defaultValue=t,this.changed=new p.a}get value(){return this.value_}set value(e){e!==this.value_&&(this.value_=e,this.changed.dispatch())}toJSON(){let{value_:e}=this;if(e!==this.defaultValue)return this.value_.toString()}restoreState(e){try{this.value=Object(u.k)(e.split(","))}catch(e){this.value=this.defaultValue}}reset(){this.value=this.defaultValue}}var m=n(19);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v=h.m.create();class b extends a.a{constructor(e,{opacity:t=Object(l.a)(.5),lineWidth:n=d(10),color:i=f(h.u.fromValues(255,255,255)),sourceOptions:r={}}={}){super(e,{sourceOptions:r}),this.opacity=t,this.registerDisposer(t.changed.add(()=>{this.redrawNeeded.dispatch()})),this.lineWidth=n,this.registerDisposer(n.changed.add(()=>{this.redrawNeeded.dispatch()})),this.color=i,this.registerDisposer(i.changed.add(()=>{this.redrawNeeded.dispatch()}));let s=this.gl,o=new Float32Array([1,0,0,1,1,0,0,1]);this.vertexIndexBuffer=this.registerDisposer(m.a.fromData(s,o,s.ARRAY_BUFFER,s.STATIC_DRAW));let a=new Float32Array([1,1,-1,-1]);this.normalDirectionBuffer=this.registerDisposer(m.a.fromData(s,a,s.ARRAY_BUFFER,s.STATIC_DRAW))}getShaderKey(){return"vectorgraphics.VectorGraphicsLineRenderLayer"}defineShader(e){super.defineShader(e),e.addUniform("highp float","uOpacity"),e.addUniform("highp float","ulineWidth"),e.addUniform("highp vec3","uColor"),e.addVarying("vec3","vNormal"),e.addAttribute("highp float","aNormalDirection"),e.addAttribute("highp vec2","aVertexIndex"),e.addAttribute("highp vec3","aVertexFirst"),e.addAttribute("highp vec3","aVertexSecond"),e.addUniform("highp mat4","uProjection"),e.setFragmentMain("\nfloat distance = length(vNormal);\n\nfloat antialiasing = 0.5;\n\nif (distance >= 1.0 - antialiasing) {\n  emitRGBA(vec4(uColor, (distance - 1.0) / -antialiasing ));\n}\nelse if (distance < 1.0 - antialiasing) {\n  emitRGB(uColor);\n}\n"),e.setVertexMain("\nvec3 direction = vec3(0., 0., 0.);\ndirection.z = aNormalDirection;\n\nvec3 difference = aVertexSecond - aVertexFirst;\ndifference.z = 0.;\n\nvec3 normal = cross(difference, direction);\nnormal = normalize(normal);\nvNormal = normal;\n\nvec4 delta = vec4(normal * ulineWidth, 0.0);\nvec4 pos = vec4(aVertexFirst * aVertexIndex.x + aVertexSecond * aVertexIndex.y, 1.0);\n\ngl_Position = uProjection * (pos + delta);\n")}beginSlice(e){super.beginSlice(e);let t=this.gl,n=this.shader;return t.uniform1f(n.uniform("uOpacity"),this.opacity.value),t.uniform1f(n.uniform("ulineWidth"),this.lineWidth.value),t.uniform3fv(n.uniform("uColor"),this.color.value),this.vertexIndexBuffer.bindToVertexAttrib(n.attribute("aVertexIndex"),2),this.normalDirectionBuffer.bindToVertexAttrib(n.attribute("aNormalDirection"),1),n}endSlice(e){let t=this.gl;t.disableVertexAttribArray(e.attribute("aVertexIndex")),t.disableVertexAttribArray(e.attribute("aNormalDirection")),t.disableVertexAttribArray(e.attribute("aVertexFirst")),t.disableVertexAttribArray(e.attribute("aVertexSecond"))}draw(e){let t=e.visibleLayers.get(this);if(0===t.length)return;let n=this.gl,i=this.beginSlice(e);if(void 0!==i){for(let r of t){const t=r.chunkLayout,s=r.source;let a=s.spec.voxelSize,l=s.chunks,c=v;h.m.identity(c),s.vectorGraphicsCoordinatesInVoxels&&h.m.scale(c,c,a),h.m.multiply(c,t.transform,c),n.uniformMatrix4fv(i.uniform("uProjection"),!1,h.m.multiply(v,e.dataToDevice,c));let u=e.visibleChunks.get(t);if(u)for(let e of u){let t=l.get(e);if(t&&t.state===o.g.GPU_MEMORY){let e=t.numPoints/2;const r=i.attribute("aVertexFirst");t.vertexBuffer.bindToVertexAttrib(r,3,WebGL2RenderingContext.FLOAT,!1,24,0),n.vertexAttribDivisor(r,1);const s=i.attribute("aVertexSecond");t.vertexBuffer.bindToVertexAttrib(s,3,WebGL2RenderingContext.FLOAT,!1,24,12),n.vertexAttribDivisor(s,1),n.drawArraysInstanced(n.TRIANGLE_STRIP,0,4,e),n.vertexAttribDivisor(r,0),n.vertexAttribDivisor(s,0)}}}this.endSlice(i)}else console.log("error: shader undefined")}}var y=n(22),w=n(55),x=n(31),S=n(2);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(185);class C extends S.a{constructor(e){super(),this.model=e,this.promptElement=document.createElement("span"),this.element=document.createElement("label"),this.inputx=document.createElement("input"),this.inputy=document.createElement("input"),this.inputz=document.createElement("input"),this.valueEntered=new p.b;let{inputx:t,inputy:n,inputz:i,element:r,promptElement:s}=this;r.className="vec3-input-row",s.className="vec3-input-label",r.appendChild(s),r.appendChild(t),r.appendChild(n),r.appendChild(i),t.type=n.type=i.type="number",this.updateInput();const o=()=>{this.model.value=this.getVec3Values()};this.registerEventListener(t,"change",o),this.registerEventListener(n,"change",o),this.registerEventListener(i,"change",o),this.model.changed.add(()=>{this.updateInput()})}getVec3Values(){let e=h.u.create();return e[0]=this.verifyValue(this.inputx.valueAsNumber),e[1]=this.verifyValue(this.inputy.valueAsNumber),e[2]=this.verifyValue(this.inputz.valueAsNumber),e}verifyValue(e){return Object(u.n)(e)}updateInput(){this.inputx.valueAsNumber=this.model.value[0],this.inputy.valueAsNumber=this.model.value[1],this.inputz.valueAsNumber=this.model.value[2]}disposed(){let{inputx:e,inputy:t,inputz:n,element:i}=this;e.parentElement&&e.parentElement.removeChild(e),t.parentElement&&t.parentElement.removeChild(t),n.parentElement&&n.parentElement.removeChild(n),i.parentElement&&i.parentElement.removeChild(i),super.disposed()}}n.d(t,"VectorGraphicsUserLayer",function(){return O}),
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(128),n(129);class O extends i.i{constructor(e,t){super(e,t),this.opacity=Object(l.a)(.5),this.lineWidth=d(10),this.color=f(h.u.fromValues(1,1,1)),this.opacity.restoreState(t.opacity),this.lineWidth.restoreState(t.linewidth),this.color.restoreState(t.color),this.lineWidth.changed.add(()=>{this.specificationChanged.dispatch()}),this.color.changed.add(()=>{this.specificationChanged.dispatch()}),this.vectorGraphicsLayerType=Object(u.m)(t.type,s.b);let n=this.vectorGraphicsPath=Object(u.y)(t.source),i=0;void 0!==n&&(++i,this.vectorGraphicsLayerType===s.b.LINE&&function(e,t,n,i={}){return y.a.forPromise(new Promise(function(r){r(e.getVectorGraphicsSource(t,n,i))}),{initialMessage:`Retrieving metadata for vector graphics source ${n}.`,delay:!0,errorPrefix:`Error retrieving metadata for vector graphics source ${n}: `})}(e.dataSourceProvider,e.chunkManager,n).then(e=>{if(!this.wasDisposed){let t=this.renderLayer=new b(e,{opacity:this.opacity,lineWidth:this.lineWidth,color:this.color,sourceOptions:{}});this.addRenderLayer(t),0==--i&&(this.isReady=!0)}})),this.tabs.add("rendering",{label:"Rendering",order:-100,getter:()=>new L(this)}),this.tabs.default="rendering"}toJSON(){const e=super.toJSON();return e.type=this.getLayerType(),e.source=this.vectorGraphicsPath,e.opacity=this.opacity.toJSON(),e.linewidth=this.lineWidth.toJSON(),e.color=this.color.toJSON(),e}getLayerType(){return s.b[this.vectorGraphicsLayerType].toLowerCase()}}class L extends x.b{constructor(e){super(),this.layer=e,this.opacityWidget=this.registerDisposer(new w.a(this.layer.opacity)),this.lineWidthWidget=this.registerDisposer(new w.a(this.layer.lineWidth,{min:0,max:50,step:1})),this.colorWidget=this.registerDisposer(new T(this.layer.color));const{element:t}=this;t.classList.add("image-dropdown");let{opacityWidget:n,lineWidthWidget:i,colorWidget:r}=this,s=document.createElement("div");s.className="image-dropdown-top-row",n.promptElement.textContent="Opacity",i.promptElement.textContent="Line Width",r.promptElement.textContent="Color";let o=document.createElement("div");o.style.flex="1";let a=document.createElement("a"),l=document.createElement("button");l.type="button",l.textContent="?",l.className="help-link",a.appendChild(l),a.title="Documentation on vector graphics layer rendering",a.target="_blank",a.href="https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/vectorgraphics_layer_rendering.md",s.appendChild(o),s.appendChild(a),t.appendChild(s),t.appendChild(this.opacityWidget.element),t.appendChild(this.lineWidthWidget.element),t.appendChild(this.colorWidget.element)}}class T extends C{constructor(e){super(e)}verifyValue(e){let t=Object(u.n)(e);return(t/=255)<0?0:t>1?1:t}updateInput(){this.inputx.valueAsNumber=Math.round(255*this.model.value[0]),this.inputy.valueAsNumber=Math.round(255*this.model.value[1]),this.inputz.valueAsNumber=Math.round(255*this.model.value[2])}}Object(r.e)("line",O)},function(e,t,n){"use strict";n.r(t);var i=n(13),r=n.n(i),s=n(20),o=n(28),a=n(49),l=n(5),c=n(11),u=n(59),d=n(61);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const h="single_mesh/SingleMeshLayer",p="single_mesh/getSingleMeshInfo",f="";class g{}class m extends g{}m.RPC_ID="single_mesh/SingleMeshSource";var v=n(9),b=n(12),y=n(0),w=n(1),x=n(35),S=n(25),C=n(82),O=n(46),L=n(2),T=n(19),k=n(26);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class E extends L.a{constructor(e){super(),this.gl=e,this.buffer=this.registerDisposer(new T.a(e))}resize(e){let t;if(e<256){let n=t=new Uint8Array(e);for(let t=0;t<e;++t)n[t]=t;this.webglType=WebGL2RenderingContext.UNSIGNED_BYTE}else if(e<65536){const n=t=new Uint16Array(e);for(let t=0;t<e;++t)n[t]=t;this.webglType=WebGL2RenderingContext.UNSIGNED_SHORT}else{const n=t=new Uint32Array(e);for(let t=0;t<e;++t)n[t]=t;this.webglType=WebGL2RenderingContext.UNSIGNED_INT}this.buffer.setData(t),this.length=e}ensure(e){return(void 0===this.length||this.length<e)&&this.resize(e),this}bindToVertexAttrib(e){this.buffer.bindToVertexAttribI(e,1,this.webglType)}bind(e,t=0){const n=e.attribute("aIndexRaw");n>=0&&(this.bindToVertexAttrib(n),0!==t&&this.gl.vertexAttribDivisor(n,t))}}function A(e){e.addAttribute("highp uint","aIndexRaw"),e.addVertexCode(k.g),e.addVertexCode("\nuint getPrimitiveIndex() {\n  return aIndexRaw;\n}\n")}class M{constructor(e){this.name=e}defineShader(e){e.addAttribute("highp uint",this.name)}bind(e,t){const n=t.attribute(this.name);e.bindToVertexAttribI(n,1,WebGL2RenderingContext.UNSIGNED_INT)}disable(e){e.gl.disableVertexAttribArray(e.attribute(this.name))}}var I=n(23),N=n(21),D=n(8);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const R="//NEUROGLANCER_SINGLE_MESH_LAYER_FRAGMENT_MAIN_START",P="void main() {\n  emitGray();\n}\n";class j{constructor(){this.shaderError=Object(O.c)(),this.fragmentMain=function(e=P){return new v.c(e,w.A)}(),this.attributeNames=new v.c([],e=>Object(w.a)(e,w.y)),this.objectToDataTransform=new u.a}}function V(e){return Object(k.a)(e.dataType,e.numComponents)}const _=[],U=Object(N.e)(new N.b,b.b.FLOAT32,3),F=U;class z{constructor(e,t,n){this.attributeNames=e,this.attributeInfo=t,this.fragmentMain=n,this.tempLightVec=new Float32Array(4),this.textureAccessHelper=new N.a("vertexData"),this.indexBufferHelper=new M("vertexIndex")}defineAttributeAccess(e,t){let{textureAccessHelper:n}=this;n.defineShader(e);let i=2;const{attributeNames:r}=this;for(const e of r)void 0!==e&&++i;for(let e=_.length;e<i;++e)_[e]=Symbol(`SingleMeshShaderManager.vertexAttributeTextureUnit${e}`);i=0,e.addTextureSampler("sampler2D","uVertexAttributeSampler0",_[i++]),e.addTextureSampler("sampler2D","uVertexAttributeSampler1",_[i++]),e.addVertexCode(n.getAccessor("readVertexPosition","uVertexAttributeSampler0",b.b.FLOAT32,3)),e.addVertexCode(n.getAccessor("readVertexNormal","uVertexAttributeSampler1",b.b.FLOAT32,3));let s=`\nvec3 vertexPosition = readVertexPosition(${t});\nvec3 vertexNormal = readVertexNormal(${t});\n`;this.attributeInfo.forEach((o,a)=>{if(void 0!==r[a]){e.addTextureSampler(`${Object(N.f)(o.dataType)}sampler2D`,`uVertexAttributeSampler${i}`,_[i]);const l=V(o);e.addVarying(`highp ${l}`,`vCustom${a}`),e.addFragmentCode(`\n#define ${r[a]} vCustom${a}\n`),e.addVertexCode(n.getAccessor(`readAttribute${a}`,`uVertexAttributeSampler${i}`,o.dataType,o.numComponents)),s+=`vCustom${a} = readAttribute${a}(${t});\n`,++i}}),e.addVertexMain(s)}defineShader(e){e.require(A),this.indexBufferHelper.defineShader(e),e.addVarying("highp float","vLightingFactor"),e.addUniform("highp vec4","uLightDirection"),e.addUniform("highp vec4","uColor"),e.addUniform("highp mat4","uModelMatrix"),e.addUniform("highp mat4","uProjection"),e.addUniform("highp uint","uPickID"),e.addVarying("highp uint","vPickID","flat"),e.addVertexMain("\nuint triangleIndex = getPrimitiveIndex() / 3u;\nvPickID = uPickID + triangleIndex;\n"),e.addFragmentCode("\nvoid emitPremultipliedRGBA(vec4 color) {\n  emit(vec4(color.rgb * vLightingFactor, color.a), vPickID);\n}\nvoid emitRGBA(vec4 color) {\n  color = clamp(color, 0.0, 1.0);\n  color.xyz *= color.a;\n  emitPremultipliedRGBA(color);\n}\nvoid emitRGB(vec3 color) {\n  emitRGBA(vec4(color, 1.0));\n}\nvoid emitGray() {\n  emitRGB(vec3(1.0, 1.0, 1.0));\n}\n"),e.addFragmentCode(C.a),this.defineAttributeAccess(e,"vertexIndex"),e.addVertexMain("\ngl_Position = uProjection * (uModelMatrix * vec4(vertexPosition, 1.0));\nvec3 normal = normalize((uModelMatrix * vec4(vertexNormal, 0.0)).xyz);\nvLightingFactor = abs(dot(normal, uLightDirection.xyz)) + uLightDirection.w;\n"),e.setFragmentMainFunction(R+"\n"+this.fragmentMain)}beginLayer(e,t,n){let{dataToDevice:i,lightDirection:r,ambientLighting:s,directionalLighting:o}=n;e.uniformMatrix4fv(t.uniform("uProjection"),!1,i);let a=this.tempLightVec;y.u.scale(a,r,o),a[3]=s,e.uniform4fv(t.uniform("uLightDirection"),a)}setPickID(e,t,n){e.uniform1ui(t.uniform("uPickID"),n)}beginObject(e,t,n){e.uniformMatrix4fv(t.uniform("uModelMatrix"),!1,n)}getShader(e,t){const n={attributeNames:this.attributeNames,attributeInfo:this.attributeInfo,fragmentMain:this.fragmentMain};return e.memoize.get(`single_mesh/SingleMeshShaderManager:${Object(x.a)(t)}:${Object(w.g)(n)}`,()=>{let n=new I.a(e);return n.require(t),this.defineShader(n),n.build()})}bindVertexData(e,t,n){this.textureAccessHelper.setupTextureLayout(e,t,n);let i=0;const r=n=>{const r=WebGL2RenderingContext.TEXTURE0+t.textureUnit(_[i]);e.activeTexture(r),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,n),++i};r(n.vertexTexture),r(n.normalTexture);const{attributeNames:s}=this;n.vertexAttributeTextures.forEach((e,t)=>{void 0!==s[t]&&r(e)})}disableVertexData(e,t){let n=2,i=this.attributeInfo.length,{attributeNames:r}=this;for(let e=0;e<i;++e)void 0!==r[e]&&++n;for(let i=0;i<n;++i){let n=t.textureUnit(_[i])+WebGL2RenderingContext.TEXTURE0;e.activeTexture(n),e.bindTexture(e.TEXTURE_2D,null)}}drawFragment(e,t,n,i){i.ensure(n.numIndices).bind(t),this.bindVertexData(e,t,n.vertexData),this.indexBufferHelper.bind(n.indexBuffer,t),e.drawArrays(WebGL2RenderingContext.TRIANGLES,0,n.numIndices)}endLayer(e,t){!function(e,t,n=!1){const i=t.attribute("aIndexRaw");i>=0&&(n&&e.vertexAttribDivisor(i,0),e.disableVertexAttribArray(i))}(e,t),this.indexBufferHelper.disable(t),this.disableVertexData(e,t)}}class B{copyToGPU(e,t){let n=this.vertexPositions.length/3;Object(N.d)(this,e,1,n);const i=(t,n)=>{let i=e.createTexture();return e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,i),Object(N.g)(e,this,n,t),i};this.vertexTexture=i(this.vertexPositions,U),this.normalTexture=i(this.vertexNormals,F),this.vertexAttributeTextures=this.vertexAttributes.map((e,n)=>i(e,t[n])),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,null)}freeGPUMemory(e){e.deleteTexture(this.vertexTexture),e.deleteTexture(this.normalTexture);let{vertexAttributeTextures:t}=this;for(const n of t)e.deleteTexture(n);t.length=0}}class G extends c.b{constructor(e,t){super(e);const n=this.vertexData=new B;n.vertexPositions=t.vertexPositions,n.vertexNormals=t.vertexNormals,n.vertexAttributes=t.vertexAttributes;let i=this.indices=t.indices;this.numIndices=i.length}copyToGPU(e){super.copyToGPU(e),this.vertexData.copyToGPU(e,this.source.attributeTextureFormats),this.indexBuffer=function(e,t){return T.a.fromData(e,t,WebGL2RenderingContext.ARRAY_BUFFER,WebGL2RenderingContext.STATIC_DRAW)}(e,this.indices)}freeGPUMemory(e){super.freeGPUMemory(e),this.vertexData.freeGPUMemory(e),this.indexBuffer.dispose()}}class W extends(Object(c.f)(c.e,m)){constructor(){super(...arguments),this.attributeTextureFormats=this.info.vertexAttributes.map(e=>Object(N.e)(new N.b,e.dataType,e.numComponents))}get info(){return this.parameters.info}getChunk(e){return new G(this,e)}}const $=Object(S.c)(D.b);class H extends ${}class q extends d.a{constructor(e,t){var n;super(),this.source=e,this.displayState=t,this.shaders=new Map,this.sharedObject=this.registerDisposer(new H),this.fallbackFragmentMain=P,this.countingBuffer=this.registerDisposer((n=this.gl).memoize.get("IndexBuffer",()=>new E(n))),this.displayState.shaderError.value=void 0;const i=()=>{this.shaderManager=void 0,this.displayState.shaderError.value=void 0,this.disposeShaders(),this.redrawNeeded.dispatch()};this.registerDisposer(t.fragmentMain.changed.add(i)),this.registerDisposer(t.attributeNames.changed.add(i)),this.registerDisposer(t.objectToDataTransform.changed.add(()=>{this.redrawNeeded.dispatch()})),this.displayState.shaderError.value=void 0;const{sharedObject:r}=this;r.visibility.add(this.visibility),r.RPC_TYPE_ID=h,r.initializeCounterpart(e.chunkManager.rpc,{chunkManager:e.chunkManager.rpcId,source:e.addCounterpartRef()}),this.setReady(!0)}disposeShaders(){let{shaders:e}=this;for(let t of e.values())null!==t&&t.dispose();e.clear()}disposed(){this.disposeShaders(),super.disposed()}makeShaderManager(e=this.displayState.fragmentMain.value){return new z(this.displayState.attributeNames.value,this.source.info.vertexAttributes,e)}getShader(e){let{shaders:t}=this,n=t.get(e);if(void 0===n){n=null;let{shaderManager:i}=this;void 0===i&&(i=this.shaderManager=this.makeShaderManager());const r=this.displayState.fragmentMain.value;try{n=i.getShader(this.gl,e),this.fallbackFragmentMain=r,this.displayState.shaderError.value=null}catch(t){this.displayState.shaderError.value=t;let{fallbackFragmentMain:s}=this;if(s!==r){i=this.shaderManager=this.makeShaderManager(s);try{n=i.getShader(this.gl,e)}catch(e){}}}t.set(e,n)}return n}get isTransparent(){return null!==this.displayState.fragmentMain.value.match(/emitRGBA|emitPremultipliedRGBA/)}get gl(){return this.source.gl}draw(e){if(!e.emitColor&&e.alreadyEmittedPickID)return;let t=this.source.chunks.get(f);if(void 0===t||t.state!==l.g.GPU_MEMORY)return;let n=this.getShader(e.emitter);if(null===n)return;let{gl:i}=this,r=this.shaderManager;n.bind(),r.beginLayer(i,n,e);let{pickIDs:s}=e;r.beginObject(i,n,this.displayState.objectToDataTransform.transform),e.emitPickID&&r.setPickID(i,n,s.register(this,t.numIndices/3)),r.drawFragment(i,n,t,this.countingBuffer),r.endLayer(i,n)}drawPicking(e){this.draw(e)}transformPickedValue(e,t){let n=this.source.chunks.get(f);if(void 0===n)return;let i=3*t,{indices:r}=n;if(i>=r.length)return;let s=r[i],o=[],a=this.displayState.attributeNames.value;return n.vertexData.vertexAttributes.forEach((e,t)=>{const n=a[t];void 0!==n&&o.push(`${n}=${e[s].toPrecision(6)}`)}),o.join(", ")}}function Y(e,t){return function(e,t){return e.memoize.getUncounted({type:"single_mesh:getMeshInfo",parameters:t},()=>e.rpc.promiseInvoke(p,{chunkManager:e.addCounterpartRef(),parameters:t}))}(e,t).then(n=>e.getChunkSource(W,{parameters:Object.assign({},t,{info:n})}))}var J=n(93),X=n(10),K=n(92),Q=n(31);n.d(t,"SingleMeshUserLayer",function(){return ee}),
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(191);const Z=Object(J.a)(s.i);class ee extends Z{constructor(e,t){super(e,t),this.manager=e,this.displayState=new j,this.displayState.objectToDataTransform=this.transform,this.parameters={meshSourceUrl:Object(w.v)(t,"source",w.A),attributeSourceUrls:Object(w.v)(t,"vertexAttributeSources",e=>void 0!==e?Object(w.a)(e,w.A):[])},this.displayState.fragmentMain.restoreState(t.shader),this.userSpecifiedAttributeNames=Object(w.v)(t,"vertexAttributeNames",e=>{if(void 0!==e)return Object(w.a)(e,e=>{let t=Object(w.y)(e);if(t)return t})}),Y(e.chunkManager,this.parameters).then(e=>{if(this.wasDisposed)return;this.meshSource=e;const t=this.defaultAttributeNames=function(e){const t=new Set;let n=[];for(let i of e){let e=i.split(/[^a-zA-Z0-9]+/).filter(e=>e).join("_"),r="",s=0;for(;t.has(e+r);)r=""+ ++s;n.push(e+r)}return n}(e.info.vertexAttributes.map(e=>e.name)),{userSpecifiedAttributeNames:n}=this;let i;void 0!==n&&n.length===t.length?(i=n,this.userSpecifiedAttributeNames=void 0):i=Array.from(t),this.displayState.attributeNames.value=i,this.addRenderLayer(new q(e,this.displayState)),this.isReady=!0}),this.registerDisposer(this.displayState.fragmentMain.changed.add(()=>{this.specificationChanged.dispatch()})),this.registerDisposer(this.displayState.attributeNames.changed.add(()=>{this.specificationChanged.dispatch()})),this.tabs.add("rendering",{label:"Rendering",order:-100,getter:()=>new se(this)}),this.tabs.default="rendering"}toJSON(){let e=super.toJSON();e.type="mesh";let{parameters:t}=this,{attributeSourceUrls:n}=t;e.source=this.parameters.meshSourceUrl,n&&(e.vertexAttributeSources=n),e.shader=this.displayState.fragmentMain.toJSON();let i=void 0;if(void 0===this.meshSource)i=this.userSpecifiedAttributeNames;else{const e=this.defaultAttributeNames,t=this.displayState.attributeNames.value;let n=!0;const r=t.length;for(let i=0;i<r;++i)if(t[i]!==e[i]){n=!1;break}i=n?void 0:Array.from(t)}return e.vertexAttributeNames=i,e}}function te(e){return new K.a({fragmentMain:e.displayState.fragmentMain,shaderError:e.displayState.shaderError,fragmentMainStartLine:R})}const ne=500;class ie extends L.a{constructor(e,t){super(),this.attributeNames=e,this.getAttributeInfo=t,this.element=document.createElement("div"),this.debouncedValueUpdater=r()(()=>{this.updateAttributeNames()},ne),this.element.className="neuroglancer-single-mesh-attribute-widget",this.updateInputElements(),this.registerDisposer(e.changed.add(()=>{this.updateInputElements()}))}updateInputElements(){const e=this.attributeNames;let{attributeNameElements:t}=this;if(void 0===t){let n=this.getAttributeInfo();if(void 0===n)return;t=this.attributeNameElements=new Array;let i=void 0,r=e.value.length,{element:s}=this;for(let e=0;e<r;++e){let r=n[e],{source:o}=r;if(o!==i&&void 0!==o){i=o;let e=document.createElement("div");e.className="neuroglancer-single-mesh-source-header",e.textContent=o,s.appendChild(e)}let a=document.createElement("div");a.className="neuroglancer-single-mesh-attribute";let l=document.createElement("input");if(l.title=r.name,this.registerEventListener(l,"input",this.debouncedValueUpdater),l.type="text",a.textContent=V(r),a.appendChild(l),void 0!==r.min&&void 0!==r.max){let e=document.createElement("span");e.className="neuroglancer-single-mesh-attribute-range",e.textContent=`[${r.min.toPrecision(6)}, ${r.max.toPrecision(6)}]`,a.appendChild(e)}t[e]=l,s.appendChild(a)}}e.value.forEach((e,n)=>{t[n].value=e||""})}disposed(){Object(X.b)(this.element)}updateAttributeNames(){const e=this.attributeNames.value,t=this.attributeNameElements;let n=!1;e.forEach((i,r)=>{let s=t[r].value;s||(s=void 0),s!==i&&(n=!0,e[r]=s)}),n&&this.attributeNames.changed.dispatch()}}function re(e){return new ie(e.displayState.attributeNames,()=>e.meshSource&&e.meshSource.info.vertexAttributes)}class se extends Q.b{constructor(e){super(),this.layer=e,this.attributeWidget=this.registerDisposer(re(this.layer)),this.codeWidget=this.registerDisposer(te(this.layer));const{element:t}=this;t.classList.add("neuroglancer-single-mesh-dropdown");let n=document.createElement("div");n.className="neuroglancer-single-mesh-dropdown-top-row";let i=document.createElement("div");i.style.flex="1";let r=document.createElement("a"),s=document.createElement("button");s.type="button",s.textContent="?",s.className="help-link",r.appendChild(s),r.title="Documentation on single mesh layer rendering",r.target="_blank",r.href="https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/image_layer_rendering.md";let o=document.createElement("button");o.innerHTML="&square;",o.className="maximize-button",o.title="Show larger editor view",this.registerEventListener(o,"click",()=>{new oe(this.layer)}),n.appendChild(i),n.appendChild(o),n.appendChild(r),t.appendChild(n),t.appendChild(this.attributeWidget.element),t.appendChild(this.codeWidget.element),this.codeWidget.textEditor.refresh(),this.visibility.changed.add(()=>{this.visible&&this.codeWidget.textEditor.refresh()})}}class oe extends a.a{constructor(e){super(),this.layer=e,this.attributeWidget=this.registerDisposer(re(this.layer)),this.codeWidget=this.registerDisposer(te(this.layer)),this.content.classList.add("neuroglancer-single-mesh-layer-shader-overlay"),this.content.appendChild(this.attributeWidget.element),this.content.appendChild(this.codeWidget.element),this.codeWidget.textEditor.refresh()}}Object(o.e)("mesh",ee)},function(e,t,n){"use strict";n.r(t);var i=n(88),r=n(63),s=n(74),o=n(22),a=n(14),l=n(10),c=n(1),u=n(51),d=n(3);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const h="https://accounts.google.com/o/oauth2/auth",p="https://accounts.google.com";class f{constructor(){this.finished=new d.b}}class g{constructor(){this.proxyName=`postmessageRelay${Object(u.a)()}`,this.rpcToken=`${Object(u.a)()}`,this.relayReadyService=`oauth2relayReady:${this.rpcToken}`,this.oauth2CallbackService=`oauth2callback:${this.rpcToken}`,this.pendingRequests=new Map,function(e,t){let n=document.createElement("iframe");n.style.display="none",n.id=e,n.name=e;const i=location.origin;n.src="https://accounts.google.com/o/oauth2/postmessageRelay?"+`parent=${encodeURIComponent(i)}#rpctoken=${t}`,document.body.appendChild(n)}(this.proxyName,this.rpcToken),this.relayReadyPromise=new Promise(e=>{addEventListener("message",t=>{if(t.origin===p)try{let n=Object(c.t)(JSON.parse(t.data)),i=Object(c.A)(n.s);if(i===this.relayReadyService&&e(),i===this.oauth2CallbackService){let e=Object(c.a)(n.a,e=>e),t=Object(c.A)(e[0]),i=location.origin;if(!t.startsWith(i+"#")&&!t.startsWith(i+"?"))throw new Error(`oauth2callback: URL ${JSON.stringify(t)} `+`does not match current origin ${i}.`);let r=t.substring(i.length+1).split("&"),s=new Map;for(let e of r){let t=e.match("^([a-z_]+)=(.*)$");if(null===t)throw new Error(`oauth2callback: URL part ${JSON.stringify(t)} `+"does not match expected pattern.");s.set(t[1],t[2])}let o=s.get("state");if(void 0===o)throw new Error("oauth2callback: State argument is missing.");let a=this.pendingRequests.get(o);if(void 0===a)return;let l=s.get("error");if(void 0!==l){let e=s.get("error_subtype"),t=l;return void 0!==e&&(t+=": "+e),void a.finished.dispatch(void 0,new Error(`Error obtaining Google OAuth2 token: ${t}`))}let u=s.get("access_token"),d=s.get("token_type"),h=s.get("expires_in"),p=s.get("scope");if(void 0===u||void 0===d||void 0===h||void 0===p)throw new Error("oauth2callback: URL lacks expected parameters.");return void a.finished.dispatch({accessToken:u,tokenType:d,expiresIn:h,scope:p})}}catch(e){throw new Error(`Invalid message received from ${p}: ${JSON.stringify(t.data)}: `+`${e.message}.`)}})})}addPendingRequest(e){let t=new f;return this.pendingRequests.set(e,t),t.finished.add(()=>{this.pendingRequests.delete(e)}),t}makeAuthRequestUrl(e){let t=`${h}?client_id=${encodeURIComponent(e.clientId)}`;t+="&redirect_uri=postmessage",t+="&response_type=token";let{origin:n=location.origin}=e;return t+=`&origin=${encodeURIComponent(n)}`,t+=`&proxy=${this.proxyName}`,t+="&include_granted_scopes=true",t+=`&scope=${encodeURIComponent(e.scopes.join(" "))}`,e.state&&(t+=`&state=${e.state}`),e.approvalPrompt&&(t+=`&approval_prompt=${encodeURIComponent(e.approvalPrompt)}`),e.loginHint&&(t+=`&login_hint=${encodeURIComponent(e.loginHint)}`),e.immediate&&(t+="&immediate=true"),void 0!==e.authUser&&(t+=`&authuser=${e.authUser}`),t}}let m;function v(e,t=a.e){const n=Object(u.a)(),i=(void 0===m&&(m=new g),m),r=i.makeAuthRequestUrl({state:n,clientId:e.clientId,scopes:e.scopes,approvalPrompt:e.approvalPrompt,loginHint:e.loginHint,immediate:e.immediate,authUser:e.authUser}),s=i.addPendingRequest(n),o=new Promise((e,t)=>{s.finished.add((n,i)=>{void 0!==n?e(n):t(i)})});if(s.finished.add(t.add(()=>{s.finished.dispatch(void 0,a.a)})),e.immediate)i.relayReadyPromise.then(()=>{if(t.isCanceled)return;const e=document.createElement("iframe");e.src=r,e.style.display="none",document.body.appendChild(e),s.finished.add(()=>{Object(l.b)(e)})});else if(!t.isCanceled){const e=open(r);null!==e&&s.finished.add(()=>{e.close()})}return o}class b extends s.b{constructor(e){super(),this.options=e,this.get=Object(s.c)(e=>{const{options:t}=this,n=new o.a(!0);let i;return new Promise((r,s)=>{const o=()=>{i=void 0,n.dispose()};function l(e=`${t.description} authorization required.`,i="Request authorization."){n.setText(e+"  ");let r=document.createElement("button");r.textContent=i,n.element.appendChild(r),r.addEventListener("click",()=>{c(!1)}),n.setVisible(!0)}function c(e){void 0!==i&&i.cancel(),i=new a.b,l(`Waiting for ${t.description} authorization...`,"Retry"),v({clientId:t.clientId,scopes:t.scopes,immediate:e,authUser:0},i).then(e=>{void 0!==i&&(o(),r(e))},n=>{void 0!==i&&(i=void 0,e?l():l(`${t.description} authorization failed: ${n}.`,"Retry"))})}e.add(()=>{void 0!==i&&(i.cancel(),i=void 0,n.dispose(),s(a.a))}),c(!0)})})}}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const y="https://www.googleapis.com/auth/brainmaps";class w extends b{constructor(){super({clientId:"639403125587-4k5hgdfumtrvur8v48e3pr7oo91d765k.apps.googleusercontent.com",scopes:[y],description:"Brain Maps"})}}
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */i.a.register(r.a,()=>new w)},function(e,t,n){"use strict";n.r(t);var i,r=n(20),s=n(28),o=n(49),a=n(4),l=n(107),c=n(47),u=n(9),d=n(1);!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.ADDITIVE=1]="ADDITIVE"}(i||(i={}));const h=new Map;function p(e){if(Object(d.m)(e,i))return Object(d.A)(e);throw new Error}function f(e="default"){return new u.c(e,p)}h.set(i.DEFAULT,e=>{e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)}),h.set(i.ADDITIVE,e=>{e.blendFunc(e.SRC_ALPHA,e.ONE)});var g=n(82),m=n(46);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const v="//NEUROGLANCER_IMAGE_RENDERLAYER_FRAGMENT_MAIN_START",b="void main() {\n  emitGrayscale(toNormalized(getDataValue()));\n}\n";function y(e=b){return Object(m.b)(e)}class w extends l.a{constructor(e,t){super(e,t);const{opacity:n=Object(c.a)(.5),blendMode:i=f(),fragmentMain:r=y()}=t;this.fragmentMain=r,this.opacity=n,this.blendMode=i,this.registerDisposer(n.changed.add(()=>{this.redrawNeeded.dispatch()})),this.registerDisposer(r.changed.add(()=>{this.shaderGetter.invalidateShader(),this.redrawNeeded.dispatch()}))}getShaderKey(){return`volume.ImageRenderLayer:${JSON.stringify(this.fragmentMain.value)}`}defineShader(e){super.defineShader(e),e.addUniform("highp float","uOpacity"),e.addFragmentCode("\nvoid emitRGBA(vec4 rgba) {\n  emit(vec4(rgba.rgb, rgba.a * uOpacity));\n}\nvoid emitRGB(vec3 rgb) {\n  emit(vec4(rgb, uOpacity));\n}\nvoid emitGrayscale(float value) {\n  emit(vec4(value, value, value, uOpacity));\n}\nvoid emitTransparent() {\n  emit(vec4(0.0, 0.0, 0.0, 0.0));\n}\n"),e.addFragmentCode(g.a),e.setFragmentMainFunction(v+"\n"+this.fragmentMain.value)}beginSlice(e){let t=super.beginSlice(e);if(void 0===t)return;let{gl:n}=this;return n.uniform1f(t.uniform("uOpacity"),this.opacity.value),t}setGLBlendMode(e,t){let n=Object(d.m)(this.blendMode.value,i);(n===i.ADDITIVE||t>0)&&(e.enable(e.BLEND),h.get(n)(e))}}var x=n(108),S=n(55),C=n(98),O=n(92),L=n(31);n.d(t,"ImageUserLayer",function(){return M}),
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(128),n(129);const T="opacity",k="blend",E="shader",A=Object(x.a)(r.i);class M extends A{constructor(e,t){super(e,t),this.opacity=Object(c.a)(.5),this.blendMode=f(),this.fragmentMain=y(),this.shaderError=Object(m.c)(),this.registerDisposer(this.fragmentMain.changed.add(this.specificationChanged.dispatch)),this.tabs.add("rendering",{label:"Rendering",order:-100,getter:()=>new N(this)}),this.tabs.default="rendering"}restoreState(e){super.restoreState(e),this.opacity.restoreState(e[T]),this.blendMode.restoreState(e[k]),this.fragmentMain.restoreState(e[E]);const{multiscaleSource:t}=this;if(void 0===t)throw new Error("source property must be specified");t.then(e=>{if(!this.wasDisposed){let t=this.renderLayer=new w(e,{opacity:this.opacity,blendMode:this.blendMode,fragmentMain:this.fragmentMain,shaderError:this.shaderError,transform:this.transform,renderScaleTarget:this.sliceViewRenderScaleTarget,renderScaleHistogram:this.sliceViewRenderScaleHistogram});this.addRenderLayer(t),this.shaderError.changed.dispatch(),this.isReady=!0}})}toJSON(){const e=super.toJSON();return e.type="image",e[T]=this.opacity.toJSON(),e[k]=this.blendMode.toJSON(),e[E]=this.fragmentMain.toJSON(),e}}function I(e){return new O.a({shaderError:e.shaderError,fragmentMain:e.fragmentMain,fragmentMainStartLine:v})}class N extends L.b{constructor(e){super(),this.layer=e,this.opacityWidget=this.registerDisposer(new S.a(this.layer.opacity)),this.codeWidget=this.registerDisposer(I(this.layer));const{element:t}=this;t.classList.add("image-dropdown");let{opacityWidget:n}=this,i=document.createElement("div");i.className="image-dropdown-top-row",n.promptElement.textContent="Opacity";{const e=this.registerDisposer(new C.a(this.layer.sliceViewRenderScaleHistogram,this.layer.sliceViewRenderScaleTarget));e.label.textContent="Resolution (slice)",t.appendChild(e.element)}let r=document.createElement("div");r.style.flex="1";let s=document.createElement("a"),o=document.createElement("button");o.type="button",o.textContent="?",o.className="help-link",s.appendChild(o),s.title="Documentation on image layer rendering",s.target="_blank",s.href="https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/image_layer_rendering.md";let a=document.createElement("button");a.innerHTML="&square;",a.className="maximize-button",a.title="Show larger editor view",this.registerEventListener(a,"click",()=>{new D(this.layer)}),i.appendChild(this.opacityWidget.element),i.appendChild(r),i.appendChild(a),i.appendChild(s),t.appendChild(i),t.appendChild(this.codeWidget.element),this.codeWidget.textEditor.refresh(),this.visibility.changed.add(()=>{this.visible&&this.codeWidget.textEditor.refresh()})}}class D extends o.a{constructor(e){super(),this.layer=e,this.codeWidget=this.registerDisposer(I(this.layer)),this.content.classList.add("image-layer-shader-overlay"),this.content.appendChild(this.codeWidget.element),this.codeWidget.textEditor.refresh()}}Object(s.e)("image",M),Object(s.f)(a.c.IMAGE,M)},function(e,t,n){"use strict";n.r(t);var i=n(88),r=n(65),s=n(74),o=n(22),a=n(14),l=n(1),c=n(51),u=n(3);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class d{constructor(){this.finished=new u.b}}class h{constructor(){this.oidcCallbackService="bossAuthCallback",this.pendingRequests=new Map,this.registerListener()}registerListener(){addEventListener("message",e=>{if(e.origin===location.origin)try{let t=Object(l.t)(JSON.parse(e.data));if(Object(l.A)(t.service)===this.oidcCallbackService){let e=Object(l.A)(t.access_token),n=Object(l.A)(t.state),i=this.pendingRequests.get(n);if(void 0===i)return;i.finished.dispatch(e)}}catch(e){}})}addPendingRequest(e){let t=new d;return this.pendingRequests.set(e,t),t.finished.add(()=>{this.pendingRequests.delete(e)}),t}makeAuthRequestUrl(e){let t=`${e.authServer}/realms/BOSS/protocol/openid-connect/auth?`;return t+=`client_id=${encodeURIComponent(e.clientId)}`,t+=`&redirect_uri=${encodeURIComponent(e.redirect_uri)}`,t+="&response_mode=fragment",t+="&response_type=code%20id_token%20token",e.state&&(t+=`&state=${e.state}`),e.nonce&&(t+=`&nonce=${e.nonce}`),t}}let p;function f(e,t=a.e){const n=Object(c.a)(),i=Object(c.a)(),r=(void 0===p&&(p=new h),p),s=r.makeAuthRequestUrl({state:n,clientId:e.clientId,redirect_uri:new URL("bossauth.html",window.location.href).href,authServer:e.authServer,nonce:i}),o=r.addPendingRequest(n),l=new Promise((e,t)=>{o.finished.add((n,i)=>{void 0!==n?e(n):t(i)})});if(o.finished.add(t.add(()=>{o.finished.dispatch(void 0,a.a)})),!t.isCanceled){const e=open(s);null!==e&&o.finished.add(()=>{e.close()})}return l}class g extends s.b{constructor(e){super(),this.authServer=e,this.get=Object(s.c)(e=>{const t=new o.a(!0);let n;return new Promise((i,r)=>{const s=()=>{n=void 0,t.dispose()};function o(e="Boss authorization required.",r="Request authorization."){t.setText(e+" ");let c=document.createElement("button");c.textContent=r,t.element.appendChild(c),c.addEventListener("click",()=>{!function(){void 0!==n&&n.cancel();n=new a.b,o("Waiting for Boss authorization...","Retry"),f({realm:"boss",clientId:"endpoint",authServer:l},n).then(e=>{void 0!==n&&(s(),i(e))},e=>{void 0!==n&&(n=void 0,o(`Boss authorization failed: ${e}.`,"Retry"))})}()}),t.setVisible(!0)}e.add(()=>{void 0!==n&&(n.cancel(),n=void 0,t.dispose(),r(a.a))});let l=this.authServer;o()})})}}
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */i.a.register(r.a,e=>new g(e))},function(e,t,n){"use strict";n.r(t);var i=n(6),r=n(62),s=n(59),o=n(20),a=n(28),l=n(29),c=n(111),u=n(22),d=n(18),h=n(9),p=n(76),f=n(93),g=n(0),m=n(1),v=n(13),b=n.n(v),y=n(2),w=n(10);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class x extends y.a{constructor(e){super(),this.ref=e,this.element=document.createElement("label"),this.selectElement=document.createElement("select"),this.registerDisposer(e);const{element:t,selectElement:n}=this;t.appendChild(n),this.updateView(),this.registerEventListener(n,"change",()=>this.updateModel()),this.registerDisposer(this.ref.changed.add(b()(()=>this.updateView(),0)))}updateModel(){this.ref.layerName=this.selectElement.value||void 0}updateView(){const{selectElement:e,ref:t}=this,{filter:n}=t;Object(w.a)(e);const i=document.createElement("option");e.appendChild(i);for(const t of this.ref.layerManager.managedLayers)if(n(t)){const n=document.createElement("option"),{name:i}=t;n.textContent=i,n.value=i,e.appendChild(n)}e.value=t.layerName||""}}n.d(t,"AnnotationUserLayer",function(){return M}),
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
n(193);const S="points",C="annotations";function O(e){const t=e.layer;return null===t||t instanceof c.SegmentationUserLayer}const L="voxelSize",T="source",k="linkedSegmentationLayer",E="filterBySegmentation",A=Object(p.a)(Object(f.a)(o.i));class M extends A{constructor(e,t){super(e,t),this.localAnnotations=this.registerDisposer(new i.d),this.voxelSize=new l.h,this.linkedSegmentationLayer=this.registerDisposer(new o.b(this.manager.rootLayers.addRef(),O)),this.filterBySegmentation=new d.b(!1);const n=this.sourceUrl=t[T];if(this.linkedSegmentationLayer.restoreState(t[k]),this.filterBySegmentation.restoreState(t[E]),void 0===n){this.isReady=!0,this.voxelSize.restoreState(t[L]),this.localAnnotations.restoreState(t[C]),a=this.localAnnotations,void 0!==(c=t[S])&&Object(m.a)(c,(e,t)=>{a.add({type:i.c.POINT,id:""+t,point:Object(m.k)(e)})});let n=!1;const o=()=>{if(!this.voxelSize.valid&&e.voxelSize.valid&&(g.u.copy(this.voxelSize.size,e.voxelSize.size),this.voxelSize.setValid()),this.voxelSize.valid&&!1===n){const e=new s.a;this.registerDisposer(Object(s.b)(e,this.transform,(e,t)=>{const n=g.m.fromScaling(g.m.create(),this.voxelSize.size);g.m.multiply(e,t,n)})),this.annotationLayerState.value=new r.b(Object.assign({transform:e,source:this.localAnnotations.addRef()},this.getAnnotationRenderOptions())),n=!0}};this.registerDisposer(this.localAnnotations.changed.add(this.specificationChanged.dispatch)),this.registerDisposer(this.voxelSize.changed.add(this.specificationChanged.dispatch)),this.registerDisposer(this.filterBySegmentation.changed.add(this.specificationChanged.dispatch)),this.registerDisposer(this.voxelSize.changed.add(o)),this.registerDisposer(this.manager.voxelSize.changed.add(o)),o()}else u.a.forPromise(this.manager.dataSourceProvider.getAnnotationSource(this.manager.chunkManager,n),{initialMessage:`Retrieving metadata for volume ${n}.`,delay:!0,errorPrefix:`Error retrieving metadata for volume ${n}: `}).then(e=>{this.wasDisposed||(this.annotationLayerState.value=new r.b(Object.assign({transform:this.transform,source:e},this.getAnnotationRenderOptions())),this.isReady=!0)});var a,c;this.tabs.default="annotations"}getAnnotationRenderOptions(){const e=new h.f(void 0),t=()=>{const{linkedSegmentationLayer:t}=this;if(void 0===t.layerName)e.value=null;else{const{layer:n}=t;e.value=function(e){if(void 0===e)return;const t=e.layer;return null!==t&&t instanceof c.SegmentationUserLayer?t.displayState:void 0}(n)}};return this.registerDisposer(this.linkedSegmentationLayer.changed.add(t)),t(),Object.assign({segmentationState:e,filterBySegmentation:this.filterBySegmentation},Object(p.b)(this))}initializeAnnotationLayerViewTab(e){const t=e.registerDisposer(new x(this.linkedSegmentationLayer));t.element.insertBefore(document.createTextNode("Linked segmentation: "),t.element.firstChild),e.element.appendChild(t.element);{const t=this.registerDisposer(new d.c(e.annotationLayer.filterBySegmentation)),n=document.createElement("label");n.textContent="Filter by segmentation: ",n.appendChild(t.element),e.element.appendChild(n),e.registerDisposer(new d.a(this.registerDisposer(Object(h.g)(e=>void 0!==e,e.annotationLayer.segmentationState)),n))}}toJSON(){const e=super.toJSON();return e.type="annotation",e[T]=this.sourceUrl,void 0===this.sourceUrl&&(e[C]=this.localAnnotations.toJSON(),e[L]=this.voxelSize.toJSON()),e[k]=this.linkedSegmentationLayer.toJSON(),e[E]=this.filterBySegmentation.toJSON(),e}}Object(a.e)("annotation",M),Object(a.e)("pointAnnotation",M)}]);
//# sourceMappingURL=main.bundle.js.map